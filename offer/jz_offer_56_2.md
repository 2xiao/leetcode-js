# [56-II. æ•°ç»„ä¸­æ•°å­—å‡ºç°çš„æ¬¡æ•° II](https://leetcode.cn/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`æ•°ç»„`](/tag/array.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.cn/problems/shu-zu-zhong-shu-zi-chu-xian-de-ci-shu-ii-lcof)

## é¢˜ç›®

æ•™å­¦è¿‡ç¨‹ä¸­ï¼Œæ•™ç»ƒç¤ºèŒƒä¸€æ¬¡ï¼Œå­¦å‘˜è·Ÿåšä¸‰æ¬¡ã€‚è¯¥è¿‡ç¨‹è¢«æ··ä¹±å‰ªè¾‘åï¼Œè®°å½•äºæ•°ç»„ `actions`ï¼Œå…¶ä¸­ `actions[i]`
è¡¨ç¤ºåšå‡ºè¯¥åŠ¨ä½œçš„äººå‘˜ç¼–å·ã€‚è¯·è¿”å›æ•™ç»ƒçš„ç¼–å·ã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š** actions = [5, 7, 5, 5]
>
> **è¾“å‡ºï¼š** 7

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** actions = [12, 1, 6, 12, 6, 12, 6]
>
> **è¾“å‡ºï¼š** 1

**æç¤ºï¼š**

- `1 <= actions.length <= 10000`
- `1 <= actions[i] < 2^31`

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šä½è¿ç®—

1. ä½¿ç”¨ä¸¤ä¸ªå˜é‡ `ones` å’Œ `twos` æ¥åˆ†åˆ«è®°å½•å½“å‰ä½ä¸­å‡ºç° 1 æ¬¡å’Œ 2 æ¬¡çš„æ•°å­—ï¼Œåˆå§‹åŒ–ä¸º `0`ï¼›
2. éå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—ï¼Œæ›´æ–° `ones` å’Œ `twos` çš„çŠ¶æ€ï¼›
3. ä½¿ç”¨ä½è¿ç®—æ›´æ–° `twos`ï¼Œåªåœ¨ `ones` ä¸­å­˜åœ¨çš„æ•°å­—ä¸­å¢åŠ è®¡æ•°ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å°†å·²ç»å‡ºç° 3 æ¬¡çš„æ•°å­—å†æ¬¡è®¡å…¥ï¼›

- `twos |= ones & num`: å°† `twos` ä¸­çš„ä½æ›´æ–°ä¸ºé‚£äº›åŒæ—¶åœ¨ `ones` å’Œ `num` ä¸­ä¸º `1` çš„ä½ï¼›
- `ones & num`: è¿™éƒ¨åˆ†è®¡ç®—åœ¨ `ones` å’Œ `num` ä¸­éƒ½ä¸º `1` çš„ä½ï¼Œç»“æœæ˜¯ä¸€ä¸ªæ–°çš„æ•´æ•°ï¼›
- `twos |=`: è¿™éƒ¨åˆ†æ˜¯å°†è®¡ç®—å¾—åˆ°çš„ç»“æœä¸ `twos` è¿›è¡ŒæŒ‰ä½æˆ–ï¼ˆORï¼‰æ“ä½œï¼Œæ›´æ–° `twos` çš„å€¼ï¼›

4. ä½¿ç”¨å¼‚æˆ–è¿ç®—æ›´æ–° `ones`ï¼Œæ·»åŠ å½“å‰æ•°å­—ï¼›

- `ones ^= num`: ä»»ä½•ä¸€ä¸ªæ•°å­—å¼‚æˆ–å®ƒè‡ªå·±éƒ½ç­‰äº `0` (`x ^ x = 0`)ï¼Œå‡ºç°ä¸¤æ¬¡çš„æ•°å­—åœ¨å¼‚æˆ–ä¸­ä¼šè¢«æŠµæ¶ˆæ‰ï¼›

5. `threes` å˜é‡é€šè¿‡ `ones & twos` è®¡ç®—å¾—å‡ºï¼Œè¡¨ç¤ºå“ªäº›æ•°å­—å‡ºç°äº† 3 æ¬¡ï¼›

6. ä½¿ç”¨ä½æ¸…é™¤æ“ä½œå°†è¿™äº›æ•°å­—ä» `ones` å’Œ `twos` ä¸­ç§»é™¤ï¼Œ`ones &= ~threes`ï¼›

- `~threes`: è¿™æ˜¯ `threes` çš„æŒ‰ä½å–åï¼ˆbitwise NOTï¼‰ï¼Œå°†æ‰€æœ‰çš„äºŒè¿›åˆ¶ä½åè½¬ã€‚å³ï¼Œå¦‚æœ `threes` ä¸­æŸä¸ªä½ç½®æ˜¯ `1`ï¼Œé‚£ä¹ˆ `~threes` ä¸­è¯¥ä½ç½®å°±æ˜¯ `0`ï¼Œåä¹‹äº¦ç„¶ã€‚
- `ones` ä¸­çš„æ¯ä¸€ä½å’Œ `~threes` ä¸­çš„æ¯ä¸€ä½è¿›è¡ŒæŒ‰ä½ä¸ï¼ˆANDï¼‰æ“ä½œã€‚
- å¦‚æœ `threes` ä¸­çš„æŸä¸€ä½æ˜¯ `1`ï¼Œé‚£ä¹ˆ `~threes` ä¸­çš„å¯¹åº”ä½æ˜¯ `0`ï¼Œå› æ­¤ `ones` çš„è¯¥ä½å°†è¢«ç½®ä¸º `0`ã€‚
- å¦‚æœ `threes` ä¸­çš„æŸä¸€ä½æ˜¯ `0`ï¼Œé‚£ä¹ˆ `~threes` ä¸­çš„å¯¹åº”ä½æ˜¯ `1`ï¼Œå› æ­¤ `ones` çš„è¯¥ä½ä¿æŒä¸å˜ã€‚

7. åœ¨éå†å®Œæˆåï¼Œ`ones` ä¸­çš„å€¼å°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œåªéœ€éå†æ•°ç»„ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œåªä½¿ç”¨äº†å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ã€‚

---

### æ€è·¯äºŒï¼šä½è¿ç®—

1. **ä½è®¡æ•°**ï¼šåˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸º 32 çš„æ•°ç»„ `count`ï¼ˆå› ä¸ºæ•´æ•°é€šå¸¸æ˜¯ 32 ä½çš„ï¼‰ï¼Œç”¨æ¥è®¡æ•°æ¯ä¸ªä½ä¸Š `1` å‡ºç°çš„æ¬¡æ•°ï¼›
2. **éå†**ï¼šéå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªæ•°ï¼Œæ›´æ–° `count` æ¯ä¸ªä½ä¸Š 1 çš„ä¸ªæ•°ï¼›
3. **å–æ¨¡**ï¼šå¯¹äºæ¯ä¸ªä½ï¼Œå¦‚æœè¯¥ä½çš„è®¡æ•°å¯ä»¥è¢« `3` æ•´é™¤ï¼Œè¯´æ˜è¯¥ä½ä¸æ˜¯å”¯ä¸€çš„æ•°çš„ä¸€éƒ¨åˆ†ï¼›å¦åˆ™ï¼Œè¯´æ˜è¯¥ä½æ˜¯å”¯ä¸€çš„æ•°çš„ä¸€éƒ¨åˆ†ï¼›
4. **æ„é€ ç»“æœ**ï¼šè®¡ç®—ç»“æœï¼Œæ ¹æ®è®¡æ•°ç»“æœæ„é€ åªå‡ºç°ä¸€æ¬¡çš„æ•°ï¼›

#### å¤æ‚åº¦åˆ†æï¼š

- **æ—¶é—´å¤æ‚åº¦**: `O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œéœ€è¦éå†æ•°ç»„ä¸¤æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**: `O(1)`ï¼Œåªä½¿ç”¨äº†å¸¸é‡çš„é¢å¤–ç©ºé—´æ¥å­˜å‚¨è®¡æ•°æ•°ç»„ï¼ˆå¤§å°ä¸º 32ï¼‰ã€‚

## ä»£ç 

::: code-tabs

@tab æ€è·¯ä¸€

```javascript
/**
 * @param {number[]} actions
 * @return {number}
 */
var trainingPlan = function (actions) {
	let ones = 0,
		twos = 0;

	for (let num of actions) {
		// æ›´æ–° twosï¼šåªè®°å½•åœ¨ ones ä¸­å·²ç»å‡ºç°è¿‡çš„æ•°å­—
		twos |= ones & num;

		// æ›´æ–° onesï¼šå°†å½“å‰æ•°å­—åŠ å…¥ ones
		ones ^= num;

		// å°†å‡ºç° 3 æ¬¡çš„æ•°å­—ä» ones å’Œ twos ä¸­ç§»é™¤
		const threes = ones & twos;
		ones &= ~threes;
		twos &= ~threes;
	}

	return ones; // ç»“æœåœ¨ ones ä¸­
};
```

@tab æ€è·¯äºŒ

```javascript
/**
 * @param {number[]} actions
 * @return {number}
 */
var trainingPlan = function (actions) {
	const count = new Array(32).fill(0);

	// ç»Ÿè®¡æ¯ä¸ªä½ä¸Š1çš„ä¸ªæ•°
	for (const num of actions) {
		for (let i = 0; i < 32; i++) {
			count[i] += (num >> i) & 1; // ç»Ÿè®¡ç¬¬iä½ä¸Šçš„1çš„ä¸ªæ•°
		}
	}

	let result = 0;
	// é€šè¿‡è®¡æ•°ç»“æœæ„é€ æ•°è¿”å›å€¼
	for (let i = 0; i < 32; i++) {
		if (count[i] % 3 !== 0) {
			result |= 1 << i;
		}
	}

	return result;
};
```

:::
