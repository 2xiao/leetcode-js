# [16.25. LRU ç¼“å­˜](https://leetcode.cn/problems/lru-cache-lcci)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`é“¾è¡¨`](/tag/linked-list.md) [`åŒå‘é“¾è¡¨`](/tag/doubly-linked-list.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.cn/problems/lru-cache-lcci)

## é¢˜ç›®

<p>è®¾è®¡å’Œæ„å»ºä¸€ä¸ª&ldquo;æœ€è¿‘æœ€å°‘ä½¿ç”¨&rdquo;ç¼“å­˜ï¼Œè¯¥ç¼“å­˜ä¼šåˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚ç¼“å­˜åº”è¯¥ä»é”®æ˜ å°„åˆ°å€¼(å…è®¸ä½ æ’å…¥å’Œæ£€ç´¢ç‰¹å®šé”®å¯¹åº”çš„å€¼)ï¼Œå¹¶åœ¨åˆå§‹åŒ–æ—¶æŒ‡å®šæœ€å¤§å®¹é‡ã€‚å½“ç¼“å­˜è¢«å¡«æ»¡æ—¶ï¼Œå®ƒåº”è¯¥åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡¹ç›®ã€‚</p>

<p>å®ƒåº”è¯¥æ”¯æŒä»¥ä¸‹æ“ä½œï¼š è·å–æ•°æ® <code>get</code> å’Œ å†™å…¥æ•°æ® <code>put</code> ã€‚</p>

<p>è·å–æ•°æ® <code>get(key)</code> - å¦‚æœå¯†é’¥ (key) å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è·å–å¯†é’¥çš„å€¼ï¼ˆæ€»æ˜¯æ­£æ•°ï¼‰ï¼Œå¦åˆ™è¿”å› -1ã€‚<br>
å†™å…¥æ•°æ® <code>put(key, value)</code> - å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œåˆ™å†™å…¥å…¶æ•°æ®å€¼ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚</p>

<p><strong>ç¤ºä¾‹:</strong></p>

<pre>LRUCache cache = new LRUCache( 2 /* ç¼“å­˜å®¹é‡ */ );

cache.put(1, 1);
cache.put(2, 2);
cache.get(1);       // è¿”å›  1
cache.put(3, 3);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 2 ä½œåºŸ
cache.get(2);       // è¿”å› -1 (æœªæ‰¾åˆ°)
cache.put(4, 4);    // è¯¥æ“ä½œä¼šä½¿å¾—å¯†é’¥ 1 ä½œåºŸ
cache.get(1);       // è¿”å› -1 (æœªæ‰¾åˆ°)
cache.get(3);       // è¿”å›  3
cache.get(4);       // è¿”å›  4
</pre>

æœ¬é¢˜ä¸ LeetCode [ç¬¬ 146 é¢˜](../problem/0146.md) ç›¸åŒã€‚

## è§£é¢˜æ€è·¯

`LRU` æ˜¯ `Least Recently Used` çš„ç¼©å†™ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œé€‰æ‹©æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚

![](../image/2-2-7.png)

å¯ä»¥ç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰è®¿é—®çš„ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š

- è¦æ’å…¥ B çš„æ—¶å€™ï¼Œå‘ç°ç¼“å­˜ä¸­æœ‰ B ï¼Œè¿™æ—¶éœ€è¦æŠŠ B æ”¾åˆ°é“¾é¦–ï¼Œå› ä¸ºå®ƒè¢«ä½¿ç”¨äº†ï¼›
- è¦æ’å…¥ E çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Eï¼Œç›´æ¥æŠŠ E æ’å…¥é“¾é¦–ï¼›
- è¦æ’å…¥ F çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Fï¼Œå®¹é‡å·²æ»¡ï¼Œéœ€è¦æ·˜æ±°æ‰ A ï¼Œå› ä¸º A æœ€ä¹…æœªè¢«ä½¿ç”¨ï¼›
- è¦æ’å…¥ C çš„æ—¶å€™ï¼Œå‘ç°ç¼“å­˜ä¸­æœ‰ C ï¼Œè¿™æ—¶éœ€è¦æŠŠ C æ”¾åˆ°é“¾é¦–ï¼›
- è¦æ’å…¥ H çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Hï¼Œå®¹é‡å·²æ»¡ï¼Œéœ€è¦æ·˜æ±°æ‰ D ï¼Œå› ä¸º D æœ€ä¹…æœªè¢«ä½¿ç”¨ï¼›

å¯ä»¥å‘ç°ï¼ŒLRU æ›´æ–°å’Œæ’å…¥æ–°èŠ‚ç‚¹éƒ½å‘ç”Ÿåœ¨é“¾é¦–ï¼Œåˆ é™¤æ•°æ®éƒ½å‘ç”Ÿåœ¨é“¾å°¾ã€‚

`LRUCache` ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

- `get` å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼š
  - å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œéå†å¾—åˆ°è¿™ä¸ªæ•°æ®å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿”å›æ•°æ®çš„å€¼ï¼›
  - å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆ™è¿”å› `-1`ï¼›
- `put` å¾€é“¾è¡¨é‡Œæ–°å¢æ•°æ®æ—¶ï¼š
  - å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œæ›´æ–°æ­¤æ•°æ®çš„å€¼ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›
  - å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š
    - å¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œåˆ™å°†æ­¤èŠ‚ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›
    - å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œåˆ™é“¾è¡¨å°¾èŠ‚ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®èŠ‚ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ã€‚

è¿™æ ·å°±ç”¨é“¾è¡¨å®ç°äº†ä¸€ä¸ª LRU ç¼“å­˜ï¼Œå¦‚æœä½¿ç”¨å•å‘é“¾è¡¨å®ç°ï¼Œåˆ™ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ï¼Œå› ä¸ºä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ï¼Œéƒ½éœ€è¦éå†ä¸€éé“¾è¡¨ã€‚

å¯ä»¥ç»§ç»­ä¼˜åŒ–è¿™ä¸ªå®ç°æ€è·¯ï¼Œæ¯”å¦‚ä½¿ç”¨åŒå‘é“¾è¡¨ï¼Œå¹¶å¼•å…¥ **å“ˆå¸Œè¡¨ï¼ˆHash tableï¼‰** æ¥è®°å½•æ¯ä¸ªæ•°æ®çš„ä½ç½®ï¼Œå°†ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦é™åˆ° `O(1)`ã€‚

## ä»£ç 

```javascript
class Node {
	// @param {number} key
	// @param {number} value
	constructor(key, value) {
		this.key = key;
		this.value = value;
		this.next = null;
		this.prev = null;
	}
}

class LRUCache {
	// @param {number} capacity
	constructor(capacity) {
		this.cap = capacity;
		this.cache = new Map();
		this.head = new Node(0, 0);
		this.tail = new Node(0, 0);
		this.head.next = this.tail;
		this.tail.prev = this.head;
	}

	// @param {number} key
	// @return {number}
	get(key) {
		if (this.cache.has(key)) {
			this.remove(this.cache.get(key));
			this.insert(this.cache.get(key));
			return this.cache.get(key).value;
		}
		return -1;
	}

	// @param {Node} node
	remove(node) {
		const prev = node.prev;
		const next = node.next;
		prev.next = next;
		next.prev = prev;
	}

	// @param {Node} node
	insert(node) {
		const next = this.head.next;
		this.head.next = node;
		next.prev = node;
		node.prev = this.head;
		node.next = next;
	}

	// @param {number} key
	// @param {number} value
	// @return {void}
	put(key, value) {
		if (this.cache.has(key)) {
			this.remove(this.cache.get(key));
		}
		this.cache.set(key, new Node(key, value));
		this.insert(this.cache.get(key));
		if (this.cache.size > this.cap) {
			const old = this.tail.prev;
			this.remove(old);
			this.cache.delete(old.key);
		}
	}
}

/**
 * Your LRUCache object will be instantiated and called as such:
 * var obj = new LRUCache(capacity)
 * var param_1 = obj.get(key)
 * obj.put(key,value)
 */
```
