---
title: 873. æœ€é•¿çš„æ–æ³¢é‚£å¥‘å­åºåˆ—çš„é•¿åº¦
description: LeetCode 873. æœ€é•¿çš„æ–æ³¢é‚£å¥‘å­åºåˆ—çš„é•¿åº¦é¢˜è§£ï¼ŒLength of Longest Fibonacci Subsequenceï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 873. æœ€é•¿çš„æ–æ³¢é‚£å¥‘å­åºåˆ—çš„é•¿åº¦
  - æœ€é•¿çš„æ–æ³¢é‚£å¥‘å­åºåˆ—çš„é•¿åº¦
  - Length of Longest Fibonacci Subsequence
  - è§£é¢˜æ€è·¯
  - æ•°ç»„
  - å“ˆå¸Œè¡¨
  - åŠ¨æ€è§„åˆ’
---

# 873. æœ€é•¿çš„æ–æ³¢é‚£å¥‘å­åºåˆ—çš„é•¿åº¦

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/length-of-longest-fibonacci-subsequence) [`LeetCode`](https://leetcode.com/problems/length-of-longest-fibonacci-subsequence)

## é¢˜ç›®

A sequence `x1, x2, ..., xn` is _Fibonacci-like_ if:

- `n >= 3`
- `xi + xi+1 == xi+2` for all `i + 2 <= n`

Given a **strictly increasing** array `arr` of positive integers forming a
sequence, return _the **length** of the longest Fibonacci-like subsequence of_
`arr`. If one does not exist, return `0`.

A **subsequence** is derived from another sequence `arr` by deleting any
number of elements (including none) from `arr`, without changing the order of
the remaining elements. For example, `[3, 5, 8]` is a subsequence of `[3, 4,
5, 6, 7, 8]`.

**Example 1:**

> Input: arr = [1,2,3,4,5,6,7,8]
>
> Output: 5
>
> Explanation: The longest subsequence that is fibonacci-like: [1,2,3,5,8].

**Example 2:**

> Input: arr = [1,3,7,11,12,14,18]
>
> Output: 3
>
> **Explanation** : The longest subsequence that is fibonacci-like: [1,11,12], [3,11,14] or [7,11,18].

**Constraints:**

- `3 <= arr.length <= 1000`
- `1 <= arr[i] < arr[i + 1] <= 10^9`

## é¢˜ç›®å¤§æ„

å¦‚æœåºåˆ— `X_1, X_2, ..., X_n` æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ï¼Œå°±è¯´å®ƒæ˜¯ _æ–æ³¢é‚£å¥‘å¼_ çš„ï¼š

- `n >= 3`
- å¯¹äºæ‰€æœ‰ `i + 2 <= n`ï¼Œéƒ½æœ‰ `X_i + X_{i+1} = X_{i+2}`

ç»™å®šä¸€ä¸ª**ä¸¥æ ¼é€’å¢** çš„æ­£æ•´æ•°æ•°ç»„å½¢æˆåºåˆ— arr ï¼Œæ‰¾åˆ° arr ä¸­æœ€é•¿çš„æ–æ³¢é‚£å¥‘å¼çš„å­åºåˆ—çš„é•¿åº¦ã€‚å¦‚æœä¸€ä¸ªä¸å­˜åœ¨ï¼Œè¿”å› 0 ã€‚

_ï¼ˆå›æƒ³ä¸€ä¸‹ï¼Œå­åºåˆ—æ˜¯ä»åŸåºåˆ— arr ä¸­æ´¾ç”Ÿå‡ºæ¥çš„ï¼Œå®ƒä» arr ä¸­åˆ æ‰ä»»æ„æ•°é‡çš„å…ƒç´ ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ ï¼‰ï¼Œè€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ `[3, 5,
8]` æ˜¯ `[3, 4, 5, 6, 7, 8]` çš„ä¸€ä¸ªå­åºåˆ—ï¼‰_

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥:** arr =[1,2,3,4,5,6,7,8]
>
> **è¾“å‡º:** 5
>
> **è§£é‡Š:** æœ€é•¿çš„æ–æ³¢é‚£å¥‘å¼å­åºåˆ—ä¸º [1,2,3,5,8] ã€‚

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥:** arr =[1,3,7,11,12,14,18]
>
> **è¾“å‡º:** 3
>
> **è§£é‡Š** : æœ€é•¿çš„æ–æ³¢é‚£å¥‘å¼å­åºåˆ—æœ‰ [1,11,12]ã€[3,11,14] ä»¥åŠ [7,11,18] ã€‚

**æç¤ºï¼š**

- `3 <= arr.length <= 1000`
- `1 <= arr[i] < arr[i + 1] <= 10^9`

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šåŠ¨æ€è§„åˆ’ + åŒæŒ‡é’ˆ

1. çŠ¶æ€å®šä¹‰
   æˆ‘ä»¬ç”¨ `dp[cur][next]` è¡¨ç¤ºä»¥ `arr[cur]` å’Œ `arr[next]` ä½œä¸ºæœ€åä¸¤ä¸ªå…ƒç´ çš„æœ€é•¿æ–æ³¢é‚£å¥‘å¼å­åºåˆ—çš„é•¿åº¦ã€‚

2. çŠ¶æ€è½¬ç§»
   æˆ‘ä»¬éå† `next` ä½œä¸ºå­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä½¿ç”¨ `prev` å’Œ `cur` ä½œä¸ºå‰ä¸¤ä¸ªå…ƒç´ ï¼š

- **å¦‚æœ `arr[prev] + arr[cur] > arr[next]`**ï¼Œè¯´æ˜å½“å‰ `prev` å¤ªå¤§äº†ï¼Œ`cur--`ï¼ˆå‘å‰è°ƒæ•´ `cur`ï¼‰ã€‚
- **å¦‚æœ `arr[prev] + arr[cur] < arr[next]`**ï¼Œè¯´æ˜ `prev` å¤ªå°äº†ï¼Œ`prev++`ï¼ˆå‘åè°ƒæ•´ `prev`ï¼‰ã€‚
- **å¦‚æœ `arr[prev] + arr[cur] == arr[next]`**ï¼Œè¯´æ˜ `arr[prev]`ã€`arr[cur]`ã€`arr[next]` å¯ä»¥ç»„æˆæ–æ³¢é‚£å¥‘å¼å­åºåˆ—ï¼š
  - `dp[cur][next] = dp[prev][cur] + 1`
  - æ›´æ–°æœ€é•¿å­åºåˆ—çš„é•¿åº¦ `maxLen`
  - ç»§ç»­å‘å‰å¯»æ‰¾æ–°çš„ `prev` å’Œ `cur` ç»„åˆã€‚

3. åˆå§‹çŠ¶æ€

- `dp[cur][next]` åˆå§‹å€¼ä¸º 0ï¼Œè¡¨ç¤ºé»˜è®¤æ²¡æœ‰åŒ¹é…çš„æ–æ³¢é‚£å¥‘å¼å­åºåˆ—ã€‚
- `maxLen` è®°å½•æœ€é•¿çš„åºåˆ—é•¿åº¦ï¼Œåˆå§‹åŒ–ä¸º 0ã€‚

4. ç»ˆæ­¢æ¡ä»¶

- éå†å®Œæ•´ä¸ªæ•°ç»„åï¼Œå¦‚æœ `maxLen > 0`ï¼Œè¯´æ˜å­˜åœ¨ç¬¦åˆè¦æ±‚çš„åºåˆ—ï¼Œè¿”å› `maxLen + 2`ï¼ˆå› ä¸º `dp[cur][next]` è®°å½•çš„æ˜¯é¢å¤–çš„é•¿åº¦ï¼Œéœ€è¦åŠ ä¸Š `prev` å’Œ `cur`ï¼‰ã€‚
- å¦åˆ™è¿”å› `0`ï¼ˆè¡¨ç¤ºä¸å­˜åœ¨ç¬¦åˆè¦æ±‚çš„æ–æ³¢é‚£å¥‘å­åºåˆ—ï¼‰ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n^2)`ï¼Œéå†æ‰€æœ‰å¯èƒ½çš„ `(prev, cur, next)` ç»„åˆã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n^2)`ï¼Œä½¿ç”¨ `dp` æ•°ç»„å­˜å‚¨çŠ¶æ€ã€‚

---

### æ€è·¯äºŒï¼šæš´åŠ›éå†

1. æšä¸¾æ‰€æœ‰èµ·ç‚¹
   æˆ‘ä»¬å°è¯•æ‰€æœ‰ `arr[i]` å’Œ `arr[j]` ä½œä¸ºå­åºåˆ—çš„å‰ä¸¤ä¸ªå…ƒç´  `(prev, cur)`ï¼Œç„¶åæŸ¥æ‰¾åç»­å…ƒç´ æ˜¯å¦æ»¡è¶³æ–æ³¢é‚£å¥‘å…³ç³»ã€‚

2. æŸ¥æ‰¾åç»­å…ƒç´ 

- è®¡ç®— `next = prev + cur`ï¼Œåˆ¤æ–­ `next` æ˜¯å¦åœ¨ `arr` ä¸­ï¼š
  - å¦‚æœ `next` å­˜åœ¨ï¼Œåˆ™æ›´æ–° `prev = cur`ï¼Œ`cur = next`ï¼Œé•¿åº¦ `len++`ï¼Œç»§ç»­æŸ¥æ‰¾ã€‚
  - å¦‚æœ `next` ä¸å­˜åœ¨ï¼Œåˆ™åœæ­¢ï¼Œè®°å½• `maxLen`ã€‚

3. ç»ˆæ­¢æ¡ä»¶

- éå†å®Œæ•´ä¸ªæ•°ç»„åï¼Œè¿”å› `maxLen` ä½œä¸ºæœ€é•¿å­åºåˆ—çš„é•¿åº¦ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n^2 logM)`ï¼Œå…¶ä¸­ `M` ä¸º `arr` çš„æœ€å¤§å…ƒç´ ï¼ŒæŸ¥æ‰¾æ“ä½œ `while(Set.has())` è¿‘ä¼¼ `O(logM)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œä½¿ç”¨ `Set` å­˜å‚¨ `arr` ä¸­çš„å…ƒç´ ï¼ŒåŠ é€ŸæŸ¥æ‰¾ã€‚

## ä»£ç 

::: code-tabs
@tab åŠ¨æ€è§„åˆ’ + åŒæŒ‡é’ˆ

```javascript
/**
 * @param {number[]} arr
 * @return {number}
 */
var lenLongestFibSubseq = function (arr) {
	const n = arr.length;
	let dp = new Array(n).fill().map(() => new Array(n).fill(0));
	let maxLen = 0;
	for (let next = 2; next < n; next++) {
		let prev = 0;
		let cur = next - 1;
		while (prev < cur) {
			let sum = arr[prev] + arr[cur];
			if (sum > arr[next]) {
				cur--;
			} else if (sum < arr[next]) {
				prev++;
			} else {
				dp[cur][next] = dp[prev][cur] + 1;
				maxLen = Math.max(maxLen, dp[cur][next]);
				cur--;
				prev++;
			}
		}
	}
	return maxLen == 0 ? 0 : maxLen + 2;
};
```

@tab æš´åŠ›éå†

```javascript
/**
 * @param {number[]} arr
 * @return {number}
 */
var lenLongestFibSubseq = function (arr) {
	const n = arr.length;
	let numSet = new Set(arr);
	let maxLen = 0;
	for (let i = 0; i < n; i++) {
		for (let j = i + 1; j < n; j++) {
			let prev = arr[j];
			let cur = arr[i] + arr[j];
			let len = 2;
			while (numSet.has(cur)) {
				len++;
				let temp = cur;
				cur += prev;
				prev = temp;
				maxLen = Math.max(maxLen, len);
			}
		}
	}
	return maxLen;
};
```

:::

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 509 | æ–æ³¢é‚£å¥‘æ•° | [[âœ“]](/problem/0509.md) |  [`é€’å½’`](/tag/recursion.md) [`è®°å¿†åŒ–æœç´¢`](/tag/memoization.md) [`æ•°å­¦`](/tag/math.md) `1+` | ğŸŸ¢ | [ğŸ€„ï¸](https://leetcode.cn/problems/fibonacci-number) [ğŸ”—](https://leetcode.com/problems/fibonacci-number) |