# [2636. Promise å¯¹è±¡æ± ](https://leetcode.com/problems/promise-pool)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/promise-pool)

## é¢˜ç›®



## è§£é¢˜æ€è·¯

**æ± é™åˆ¶**çš„æ ¸å¿ƒæ˜¯æ§åˆ¶å¹¶å‘æ•°é‡ï¼Œå³åŒæ—¶åªèƒ½æœ‰æœ€å¤š `n` ä¸ªå¼‚æ­¥ä»»åŠ¡åœ¨æ‰§è¡Œï¼Œéœ€è¦åœ¨ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œæ‰èƒ½å¯åŠ¨æ–°çš„ä»»åŠ¡ã€‚

1. å®šä¹‰ä¸€ä¸ªè°ƒåº¦å™¨å‡½æ•°`executeNext`ï¼Œå®ƒä¼šé€’å½’åœ°è°ƒç”¨è‡ªèº«ä»¥ç¡®ä¿æ‰€æœ‰ä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œã€‚æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªå‡½æ•°åï¼Œä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œç›´åˆ°å‡½æ•°æ•°ç»„ä¸ºç©ºã€‚

2. åˆ›å»ºå¹¶å‘æ± ï¼Œä½¿ç”¨ `Array(n).fill(null)` åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„ï¼Œ`map` æ–¹æ³•ç”¨æ¥è°ƒç”¨ `executeNext`ï¼Œå³å¯åŠ¨ `n` ä¸ªå¹¶å‘ä»»åŠ¡ã€‚
3. `Promise.all` ä¼šç­‰å¾…æ‰€æœ‰å¹¶å‘ä»»åŠ¡å®Œæˆï¼Œç¡®ä¿ `promisePool` å‡½æ•°åœ¨æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ resolveã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**: `O(m)`ï¼Œå…¶ä¸­ `m` æ˜¯ `functions` çš„é•¿åº¦ã€‚æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´å–å†³äºå„è‡ªçš„æ‰§è¡Œæ—¶é—´ï¼Œæ€»å…±ä¼šæ‰§è¡Œ `m` ä¸ªä»»åŠ¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**: `O(n)`ï¼Œå› ä¸ºæœ€å¤šä¼šåŒæ—¶æ‰§è¡Œ `n` ä¸ªä»»åŠ¡ã€‚

## ä»£ç 

```javascript
/**
 * @param {Function[]} functions
 * @param {Number} n
 * @return {Function}
 */
var promisePool = async function (functions, n) {
	const executeNext = async () => {
		if (functions.length === 0) return; // æ‰€æœ‰å‡½æ•°éƒ½æ‰§è¡Œå®Œæ¯•
		const fn = functions.shift(); // å–å‡ºä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„å‡½æ•°
		await fn(); // æ‰§è¡Œå‡½æ•°å¹¶ç­‰å¾…å…¶å®Œæˆ
		await executeNext(); // é€’å½’è°ƒç”¨ï¼Œå¤„ç†ä¸‹ä¸€ä¸ªä»»åŠ¡
	};

	// åˆ›å»º n ä¸ªå¹¶å‘ä»»åŠ¡ï¼Œå¼€å§‹æ‰§è¡Œ
	const pool = Array(n).fill(null).map(executeNext);

	// ç­‰å¾…æ‰€æœ‰å¹¶å‘ä»»åŠ¡éƒ½å®Œæˆ
	await Promise.all(pool);
};

/**
 * Example usage:
 * const sleep = (time) => new Promise(resolve => setTimeout(resolve, time));
 *
 * promisePool([() => sleep(500), () => sleep(400), () => sleep(300)], 2)
 *   .then(() => console.log('All functions done'));
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 2621 | [ç¡çœ å‡½æ•°](https://leetcode.com/problems/sleep) | [[âœ“]](/problem/2621.md) |  | <font color=#15bd66>Easy</font> |
| 2622 | [æœ‰æ—¶é—´é™åˆ¶çš„ç¼“å­˜](https://leetcode.com/problems/cache-with-time-limit) | [[âœ“]](/problem/2622.md) |  | <font color=#ffb800>Medium</font> |
| 2637 | [æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡](https://leetcode.com/problems/promise-time-limit) | [[âœ“]](/problem/2637.md) |  | <font color=#ffb800>Medium</font> |
| 2676 | [èŠ‚æµ](https://leetcode.com/problems/throttle) | [[âœ“]](/problem/2676.md) |  | <font color=#ffb800>Medium</font> |