# [380. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ](https://leetcode.com/problems/insert-delete-getrandom-o1)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°å­¦`](/tag/math.md) [`éšæœºåŒ–`](/tag/randomized.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/insert-delete-getrandom-o1)

## é¢˜ç›®

<p>å®ç°<code>RandomizedSet</code> ç±»ï¼š</p>

<div class="original__bRMd">
<div>
<ul>
	<li><code>RandomizedSet()</code> åˆå§‹åŒ– <code>RandomizedSet</code> å¯¹è±¡</li>
	<li><code>bool insert(int val)</code> å½“å…ƒç´  <code>val</code> ä¸å­˜åœ¨æ—¶ï¼Œå‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¹¶è¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</li>
	<li><code>bool remove(int val)</code> å½“å…ƒç´  <code>val</code> å­˜åœ¨æ—¶ï¼Œä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¹¶è¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</li>
	<li><code>int getRandom()</code> éšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¿è¯è°ƒç”¨æ­¤æ–¹æ³•æ—¶é›†åˆä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ <strong>ç›¸åŒçš„æ¦‚ç‡</strong> è¢«è¿”å›ã€‚</li>
</ul>

<p>ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„ <strong>å¹³å‡</strong> æ—¶é—´å¤æ‚åº¦ä¸º <code>O(1)</code> ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>
<strong>è¾“å…¥</strong>
["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
[[], [1], [2], [2], [], [1], [2], []]
<strong>è¾“å‡º</strong>
[null, true, false, true, 2, true, false, 2]

<strong>è§£é‡Š</strong>
RandomizedSet randomizedSet = new RandomizedSet();
randomizedSet.insert(1); // å‘é›†åˆä¸­æ’å…¥ 1 ã€‚è¿”å› true è¡¨ç¤º 1 è¢«æˆåŠŸåœ°æ’å…¥ã€‚
randomizedSet.remove(2); // è¿”å› false ï¼Œè¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨ 2 ã€‚
randomizedSet.insert(2); // å‘é›†åˆä¸­æ’å…¥ 2 ã€‚è¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [1,2] ã€‚
randomizedSet.getRandom(); // getRandom åº”éšæœºè¿”å› 1 æˆ– 2 ã€‚
randomizedSet.remove(1); // ä»é›†åˆä¸­ç§»é™¤ 1 ï¼Œè¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [2] ã€‚
randomizedSet.insert(2); // 2 å·²åœ¨é›†åˆä¸­ï¼Œæ‰€ä»¥è¿”å› false ã€‚
randomizedSet.getRandom(); // ç”±äº 2 æ˜¯é›†åˆä¸­å”¯ä¸€çš„æ•°å­—ï¼ŒgetRandom æ€»æ˜¯è¿”å› 2 ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>-2<sup>31</sup> &lt;= val &lt;= 2<sup>31</sup> - 1</code></li>
	<li>æœ€å¤šè°ƒç”¨ <code>insert</code>ã€<code>remove</code> å’Œ <code>getRandom</code> å‡½æ•° <code>2 *&nbsp;</code><code>10<sup>5</sup></code> æ¬¡</li>
	<li>åœ¨è°ƒç”¨ <code>getRandom</code> æ–¹æ³•æ—¶ï¼Œæ•°æ®ç»“æ„ä¸­ <strong>è‡³å°‘å­˜åœ¨ä¸€ä¸ª</strong> å…ƒç´ ã€‚</li>
</ul>
</div>
</div>


## è§£é¢˜æ€è·¯

æœ¬é¢˜çš„éš¾ç‚¹åœ¨äºä¸¤ç‚¹ï¼š

1. æ’å…¥ï¼Œåˆ é™¤ï¼Œè·å–éšæœºå…ƒç´ è¿™ä¸‰ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦å¿…é¡»éƒ½æ˜¯ `O(1)`ã€‚
2. `getRandom` æ–¹æ³•è¿”å›çš„å…ƒç´ å¿…é¡»ç­‰æ¦‚ç‡è¿”å›éšæœºå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé›†åˆé‡Œé¢æœ‰ `n` ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡å¿…é¡»æ˜¯ `1/n`ã€‚

`HashSet` æ’å…¥ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾è¿™å‡ ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)` ï¼Œä½†æ˜¯ç”±äº`HashSet`å­˜å‚¨æ•°æ®æ—¶ï¼Œæ˜¯ç”±å“ˆå¸Œå‡½æ•°åˆ†æ•£åœ°å­˜åˆ°æ•´ä¸ªæ•°ç»„é‡Œé¢çš„ï¼Œé‡åˆ°å“ˆå¸Œå†²çªè¿˜ä¼šæœ‰æ‹‰é“¾æ³•ç­‰æœºåˆ¶ï¼Œæ‰€ä»¥åšä¸åˆ° `O(1)` æ—¶é—´ã€Œç­‰æ¦‚ç‡ã€éšæœºè·å–å…ƒç´ ã€‚

å¦‚æœæƒ³ã€Œç­‰æ¦‚ç‡ã€ä¸”ã€Œåœ¨ `O(1)` çš„æ—¶é—´ã€å–å‡ºå…ƒç´ ï¼Œä¸€å®šè¦æ»¡è¶³ï¼šåº•å±‚ç”¨æ•°ç»„å®ç°ï¼Œä¸”æ•°ç»„å¿…é¡»æ˜¯ç´§å‡‘çš„ã€‚å¯ä»¥ç›´æ¥ç”Ÿæˆéšæœºæ•°ä½œä¸ºç´¢å¼•ï¼Œä»æ•°ç»„ä¸­å–å‡ºè¯¥éšæœºç´¢å¼•å¯¹åº”çš„å…ƒç´ ï¼Œä½œä¸ºéšæœºå…ƒç´ ã€‚

ä½†å¦‚æœç”¨æ•°ç»„å­˜å‚¨å…ƒç´ çš„è¯ï¼Œæ’å…¥ï¼Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ€ä¹ˆåšåˆ° `O(1)` å‘¢ï¼Ÿ

ç”±äºå¯¹æ•°ç»„å°¾éƒ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ä¸ä¼šæ¶‰åŠæ•°æ®æ¬ç§»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)`ï¼Œæ‰€ä»¥ï¼š

- æ’å…¥æ•°æ®æ—¶ç›´æ¥æ’å…¥åˆ°æ•°ç»„å°¾ç«¯å³å¯ï¼›
- åˆ é™¤æ•°ç»„ä¸­çš„æŸä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå…ˆæŠŠè¿™ä¸ªå…ƒç´ äº¤æ¢åˆ°æ•°ç»„çš„å°¾éƒ¨ï¼Œç„¶åå† `pop` æ‰ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ æ—¶é€šè¿‡ç´¢å¼•è¿›è¡Œäº¤æ¢ï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `indexMap` æ¥è®°å½•æ¯ä¸ªå…ƒç´ å€¼å¯¹åº”çš„ç´¢å¼•ã€‚

## ä»£ç 

```javascript
class RandomizedSet {
	constructor() {
		this.nums = [];
		this.map = new Map();
	}

	// @param {number} val
	// @return {boolean}
	insert(val) {
		if (this.map.has(val)) return false;
		this.nums.push(val);
		this.map.set(val, this.nums.length - 1);
		return true;
	}

	// @param {number} val
	// @return {boolean}
	remove(val) {
		if (!this.map.has(val)) return false;
		const index = this.map.get(val);
		const last_val = this.nums[this.nums.length - 1];
		this.nums[index] = last_val;
		this.nums.pop();
		this.map.set(last_val, index);
		this.map.delete(val);
		return true;
	}

	// @return {number}
	getRandom() {
		return this.nums[Math.floor(Math.random() * this.nums.length)];
	}
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 381 | [O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤](https://leetcode.com/problems/insert-delete-getrandom-o1-duplicates-allowed) |  |  [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) `2+` | <font color=#ff334b>Hard</font> |