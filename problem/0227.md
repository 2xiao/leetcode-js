# [227. åŸºæœ¬è®¡ç®—å™¨ II](https://leetcode.com/problems/basic-calculator-ii)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ ˆ`](/tag/stack.md) [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/basic-calculator-ii)

## é¢˜ç›®

<p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ <code>s</code> ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚</p>

<p>æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚</p>

<p>ä½ å¯ä»¥å‡è®¾ç»™å®šçš„è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€æœ‰ä¸­é—´ç»“æœå°†åœ¨&nbsp;<code>[-2<sup>31</sup>, 2<sup>31</sup>&nbsp;- 1]</code> çš„èŒƒå›´å†…ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>ä¸å…è®¸ä½¿ç”¨ä»»ä½•å°†å­—ç¬¦ä¸²ä½œä¸ºæ•°å­¦è¡¨è¾¾å¼è®¡ç®—çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ <code>eval()</code> ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>s = "3+2*2"
<strong>è¾“å‡ºï¼š</strong>7
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>s = " 3/2 "
<strong>è¾“å‡ºï¼š</strong>1
</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>s = " 3+5 / 2 "
<strong>è¾“å‡ºï¼š</strong>5
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= s.length &lt;= 3 * 10<sup>5</sup></code></li>
	<li><code>s</code> ç”±æ•´æ•°å’Œç®—ç¬¦ <code>('+', '-', '*', '/')</code> ç»„æˆï¼Œä¸­é—´ç”±ä¸€äº›ç©ºæ ¼éš”å¼€</li>
	<li><code>s</code> è¡¨ç¤ºä¸€ä¸ª <strong>æœ‰æ•ˆè¡¨è¾¾å¼</strong></li>
	<li>è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½æ˜¯éè´Ÿæ•´æ•°ï¼Œä¸”åœ¨èŒƒå›´ <code>[0, 2<sup>31</sup> - 1]</code> å†…</li>
	<li>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª <strong>32-bit æ•´æ•°</strong></li>
</ul>


## è§£é¢˜æ€è·¯

1. **ä½¿ç”¨æ ˆ**ï¼š

   - é‡‡ç”¨æ ˆæ¥å­˜å‚¨è®¡ç®—è¿‡ç¨‹ä¸­é—´çš„ç»“æœã€‚
   - é‡åˆ°ä¹˜æ³•å’Œé™¤æ³•æ—¶ç«‹å³è®¡ç®—å¹¶å°†ç»“æœæ”¾å…¥æ ˆä¸­ï¼›é‡åˆ°åŠ æ³•å’Œå‡æ³•æ—¶ï¼Œå…ˆå°†å½“å‰æ•°å­—å‹å…¥æ ˆä¸­ï¼Œåç»­å¤„ç†ã€‚

2. **éå†å­—ç¬¦ä¸²**ï¼š

   - éå†è¾“å…¥å­—ç¬¦ä¸²ï¼Œé€ä¸ªå­—ç¬¦å¤„ç†ï¼š
     - å½“é‡åˆ°æ•°å­—æ—¶ï¼Œæ„å»ºå®Œæ•´çš„æ•°å­—ï¼ˆå¯èƒ½æ˜¯å¤šä½æ•°ï¼‰ã€‚
     - å½“é‡åˆ°æ“ä½œç¬¦æ—¶ï¼Œæ ¹æ®ä¸Šä¸€ä¸ªæ“ä½œç¬¦å†³å®šå¦‚ä½•å¤„ç†æ ˆã€‚
     - æ³¨æ„å¤„ç†ç©ºæ ¼ï¼Œç¡®ä¿åªåœ¨é‡åˆ°æœ‰æ•ˆæ“ä½œç¬¦æ—¶è¿›è¡Œå¤„ç†ã€‚

3. **å¤„ç†æ“ä½œç¬¦**ï¼š

   - ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥è®°å½•å½“å‰æ“ä½œç¬¦ã€‚æ ¹æ®å½“å‰æ“ä½œç¬¦çš„ç±»å‹ï¼Œå†³å®šæ˜¯å°†å½“å‰æ•°å­—æ¨å…¥æ ˆä¸­ã€è¿˜æ˜¯æ‰§è¡Œä¹˜æ³•æˆ–é™¤æ³•ã€‚

4. **æœ€åè®¡ç®—ç»“æœ**ï¼š

   - éå†å®Œå­—ç¬¦ä¸²åï¼Œæ ˆä¸­ä¼šå­˜å‚¨æ‰€æœ‰çš„ç»“æœã€‚æœ€ç»ˆåªéœ€å°†æ ˆä¸­çš„æ‰€æœ‰æ•°å­—ç›¸åŠ ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚éœ€è¦éå†å­—ç¬¦ä¸²ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨æ ˆä¸­é—´ç»“æœã€‚

## ä»£ç 

```javascript
/**
 * @param {string} s
 * @return {number}
 */
var calculate = function (s) {
	const isDigit = (char) => char >= '0' && char <= '9';
	let stack = [],
		sum = 0,
		operation = '+'; // åˆå§‹æ“ä½œç¬¦
	for (let i = 0; i < s.length; i++) {
		let char = s[i];

		// å¦‚æœæ˜¯æ•°å­—ï¼Œæ„å»ºå®Œæ•´çš„æ•°å­—
		if (isDigit(char)) {
			sum = sum * 10 + Number(char);
		}

		// è·³è¿‡ç©ºæ ¼
		if (char == ' ' && i < s.length - 1) {
			continue;
		}

		// å¦‚æœæ˜¯æ“ä½œç¬¦æˆ–è€…åˆ°è¾¾å­—ç¬¦ä¸²æœ«å°¾
		if (['+', '-', '*', '/'].includes(char) || i === s.length - 1) {
			if (operation == '+') {
				stack.push(sum);
			} else if (operation == '-') {
				stack.push(-sum);
			} else if (operation == '*') {
				stack.push(stack.pop() * sum);
			} else if (operation == '/') {
				stack.push((stack.pop() / sum) | 0);
			}
			// æ›´æ–°å½“å‰æ“ä½œç¬¦
			operation = char;
			sum = 0;
		}
	}
	return stack.reduce((a, b) => a + b, 0);
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 224 | [åŸºæœ¬è®¡ç®—å™¨](https://leetcode.com/problems/basic-calculator) | [[âœ“]](/problem/0224.md) |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) `1+` | <font color=#ff334b>Hard</font> |
| 282 | [ç»™è¡¨è¾¾å¼æ·»åŠ è¿ç®—ç¬¦](https://leetcode.com/problems/expression-add-operators) |  |  [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`å›æº¯`](/tag/backtracking.md) | <font color=#ff334b>Hard</font> |
| 772 | [åŸºæœ¬è®¡ç®—å™¨ III](https://leetcode.com/problems/basic-calculator-iii) | [[âœ“]](/problem/0772.md) |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) `1+` | <font color=#ff334b>Hard</font> |