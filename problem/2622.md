# [2622. æœ‰æ—¶é—´é™åˆ¶çš„ç¼“å­˜](https://leetcode.com/problems/cache-with-time-limit)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/cache-with-time-limit)

## é¢˜ç›®

<p>ç¼–å†™ä¸€ä¸ªç±»ï¼Œå®ƒå…è®¸è·å–å’Œè®¾ç½®é”®-å€¼å¯¹ï¼Œå¹¶ä¸”æ¯ä¸ªé”®éƒ½æœ‰ä¸€ä¸ª&nbsp;<strong>è¿‡æœŸæ—¶é—´</strong>&nbsp;ã€‚</p>

<p>è¯¥ç±»æœ‰ä¸‰ä¸ªå…¬å…±æ–¹æ³•ï¼š</p>

<p><code>set(key, value, duration)</code>&nbsp;ï¼šæ¥æ”¶å‚æ•°ä¸ºæ•´å‹é”® <code>key</code> ã€æ•´å‹å€¼ <code>value</code> å’Œä»¥æ¯«ç§’ä¸ºå•ä½çš„æŒç»­æ—¶é—´ <code>duration</code> ã€‚ä¸€æ—¦ <code>duration</code>&nbsp;åˆ°æœŸåï¼Œè¿™ä¸ªé”®å°±æ— æ³•è®¿é—®ã€‚å¦‚æœç›¸åŒçš„æœªè¿‡æœŸé”®å·²ç»å­˜åœ¨ï¼Œè¯¥æ–¹æ³•å°†è¿”å›&nbsp;<code>true</code>&nbsp;ï¼Œå¦åˆ™è¿”å›&nbsp;<code>false</code>&nbsp;ã€‚å¦‚æœè¯¥é”®å·²ç»å­˜åœ¨ï¼Œåˆ™å®ƒçš„å€¼å’ŒæŒç»­æ—¶é—´éƒ½åº”è¯¥è¢«è¦†ç›–ã€‚</p>

<p><code>get(key)</code>&nbsp;ï¼šå¦‚æœå­˜åœ¨ä¸€ä¸ªæœªè¿‡æœŸçš„é”®ï¼Œå®ƒåº”è¯¥è¿”å›è¿™ä¸ªé”®ç›¸å…³çš„å€¼ã€‚å¦åˆ™è¿”å›&nbsp;<code>-1</code>&nbsp;ã€‚</p>

<p><code>count()</code>&nbsp;ï¼šè¿”å›æœªè¿‡æœŸé”®çš„æ€»æ•°ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong> 
actions = ["TimeLimitedCache", "set", "get", "count", "get"]
values = [[], [1, 42, 100], [1], [], [1]]
timeDeays = [0, 0, 50, 50, 150]
<strong>è¾“å‡ºï¼š</strong> [null, false, 42, 1, -1]
<strong>è§£é‡Šï¼š</strong>
åœ¨ t=0 æ—¶ï¼Œç¼“å­˜è¢«æ„é€ ã€‚
åœ¨ t=0 æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ (1: 42) ï¼Œè¿‡æœŸæ—¶é—´ä¸º 100ms ã€‚å› ä¸ºè¯¥å€¼ä¸å­˜åœ¨ï¼Œå› æ­¤è¿”å›falseã€‚
åœ¨ t=50 æ—¶ï¼Œè¯·æ±‚ key=1 å¹¶è¿”å›å€¼ 42ã€‚
åœ¨ t=50 æ—¶ï¼Œè°ƒç”¨ count() ï¼Œç¼“å­˜ä¸­æœ‰ä¸€ä¸ªæœªè¿‡æœŸçš„é”®ã€‚
åœ¨ t=100 æ—¶ï¼Œkey=1 åˆ°æœŸã€‚
åœ¨ t=150 æ—¶ï¼Œè°ƒç”¨ get(1) ï¼Œè¿”å› -1ï¼Œå› ä¸ºç¼“å­˜æ˜¯ç©ºçš„ã€‚
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>
actions = ["TimeLimitedCache", "set", "set", "get", "get", "get", "count"]
values = [[], [1, 42, 50], [1, 50, 100], [1], [1], [1], []]
timeDelays = [0, 0, 40, 50, 120, 200, 250]
<strong>è¾“å‡ºï¼š</strong> [null, false, true, 50, 50, -1]
<strong>è§£é‡Šï¼š</strong>
åœ¨ t=0 æ—¶ï¼Œç¼“å­˜è¢«æ„é€ ã€‚
åœ¨ t=0 æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ (1: 42) ï¼Œè¿‡æœŸæ—¶é—´ä¸º 50msã€‚å› ä¸ºè¯¥å€¼ä¸å­˜åœ¨ï¼Œå› æ­¤è¿”å›falseã€‚
å½“ t=40 æ—¶ï¼Œæ·»åŠ ä¸€ä¸ªé”®å€¼å¯¹ (1: 50) ï¼Œè¿‡æœŸæ—¶é—´ä¸º 100msã€‚å› ä¸ºä¸€ä¸ªæœªè¿‡æœŸçš„é”®å·²ç»å­˜åœ¨ï¼Œè¿”å› true å¹¶è¦†ç›–è¿™ä¸ªé”®çš„æ—§å€¼ã€‚
åœ¨ t=50 æ—¶ï¼Œè°ƒç”¨ get(1) ï¼Œè¿”å› 50ã€‚
åœ¨ t=120 æ—¶ï¼Œè°ƒç”¨ get(1) ï¼Œè¿”å› 50ã€‚
åœ¨ t=140 æ—¶ï¼Œkey=1 è¿‡æœŸã€‚
åœ¨ t=200 æ—¶ï¼Œè°ƒç”¨ get(1) ï¼Œä½†ç¼“å­˜ä¸ºç©ºï¼Œå› æ­¤è¿”å› -1ã€‚
åœ¨ t=250 æ—¶ï¼Œcount() è¿”å›0 ï¼Œå› ä¸ºç¼“å­˜æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰æœªè¿‡æœŸçš„é”®ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>0 &lt;= key, value &lt;= 10<sup>9</sup></code></li>
	<li><code>0 &lt;= duration &lt;= 1000</code></li>
	<li><code>1 &lt;= actions.length &lt;= 100</code></li>
	<li><code>actions.length === values.length</code></li>
	<li><code>actions.length === timeDelays.length</code></li>
	<li><code>0 &lt;= timeDelays[i] &lt;= 1450</code></li>
	<li><code>actions[i]</code> æ˜¯ "TimeLimitedCache"ã€"set"ã€"get" å’Œ "count" ä¸­çš„ä¸€ä¸ªã€‚</li>
	<li>ç¬¬ä¸€ä¸ªæ“ä½œå§‹ç»ˆæ˜¯ "TimeLimitedCache" è€Œä¸”ä¸€å®šä¼šä»¥ 0 æ¯«ç§’çš„å»¶è¿Ÿç«‹å³æ‰§è¡Œ</li>
</ul>


## è§£é¢˜æ€è·¯

1. **`constructor`**ï¼š

   - ä½¿ç”¨ `Map` æ•°æ®ç»“æ„æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œå…¶ä¸­æ¯ä¸ªé”®å¯¹åº”çš„å€¼ä¸ºä¸€ä¸ªæ•°ç»„ `[value, timer]`ï¼Œå…¶ä¸­ `value` æ˜¯å­˜å‚¨çš„å€¼ï¼Œ`timer` æ˜¯è¯¥é”®çš„å®šæ—¶å™¨ï¼Œç”¨äºåˆ é™¤è¿‡æœŸé”®ã€‚

2. **`set(key, value, duration)`**ï¼š

   - è¯¥æ–¹æ³•å°†ç»™å®šçš„é”® `key` å’Œå€¼ `value` å­˜å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¯¥é”®å€¼å¯¹çš„æœ‰æ•ˆæœŸ `duration` æ¯«ç§’ã€‚
   - å¦‚æœç›¸åŒé”®å·²ç»å­˜åœ¨ä¸”æœªè¿‡æœŸï¼Œåˆ™è¿”å› `true`ï¼Œå¦åˆ™è¿”å› `false`ã€‚
   - ä½¿ç”¨ `setTimeout` å®šæ—¶å‡½æ•°ï¼Œåœ¨åˆ°æœŸæ—¶é—´åè‡ªåŠ¨åˆ é™¤è¯¥é”®å€¼å¯¹ã€‚
   - å¦‚æœé”®å·²ç»å­˜åœ¨ä¸”å®šæ—¶å™¨æ²¡æœ‰åˆ°æœŸï¼Œé¦–å…ˆæ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨ï¼Œä»¥ç¡®ä¿æ–°è®¾ç½®çš„ `duration` è¦†ç›–æ—§çš„æ—¶é—´ã€‚

3. **`get(key)`**ï¼š

   - æŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨æœªè¿‡æœŸçš„é”® `key`ã€‚
   - å¦‚æœé”®å­˜åœ¨ä¸”æœªè¿‡æœŸï¼Œåˆ™è¿”å›å…¶å¯¹åº”çš„å€¼ï¼Œå¦åˆ™è¿”å› `-1`ã€‚

4. **`count()`**ï¼š
   - è¿”å›å½“å‰ç¼“å­˜ä¸­æœªè¿‡æœŸçš„é”®å€¼å¯¹æ•°é‡ï¼Œç›´æ¥é€šè¿‡ `Map` å¯¹è±¡çš„ `size` å±æ€§æ¥è·å–å½“å‰é”®çš„æ•°é‡ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - **`set`**ï¼šæ¯æ¬¡è°ƒç”¨ `set`ï¼ŒæŸ¥æ‰¾å’Œæ’å…¥æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ï¼Œåˆ é™¤æ—§çš„å®šæ—¶å™¨å’Œè®¾ç½®æ–°çš„å®šæ—¶å™¨ä¹Ÿä¸ºå¸¸æ•°æ—¶é—´æ“ä½œã€‚å› æ­¤ `set` çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
  - **`get`**ï¼šæŸ¥æ‰¾é”®çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
  - **`count`**ï¼š`Map.size` çš„è®¿é—®æ˜¯å¸¸æ•°æ—¶é—´æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` ä¸ºç¼“å­˜ä¸­å­˜å‚¨çš„é”®å€¼å¯¹æ•°é‡ï¼Œä½¿ç”¨äº† `Map` æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚

## ä»£ç 

```javascript
var TimeLimitedCache = function () {
	this.cache = new Map();
};

/**
 * @param {number} key
 * @param {number} value
 * @param {number} duration time until expiration in ms
 * @return {boolean} if un-expired key already existed
 */
TimeLimitedCache.prototype.set = function (key, value, duration) {
	const timer = setTimeout(() => this.cache.delete(key), duration);
	const exist = this.cache.has(key);
	if (exist) {
		const oldTimer = this.cache.get(key)[1];
		clearTimeout(oldTimer);
	}
	this.cache.set(key, [value, timer]);
	return exist;
};

/**
 * @param {number} key
 * @return {number} value associated with key
 */
TimeLimitedCache.prototype.get = function (key) {
	if (this.cache.has(key)) return this.cache.get(key)[0];
	return -1;
};

/**
 * @return {number} count of non-expired keys
 */
TimeLimitedCache.prototype.count = function () {
	return this.cache.size;
};

/**
 * const timeLimitedCache = new TimeLimitedCache()
 * timeLimitedCache.set(1, 42, 1000); // false
 * timeLimitedCache.get(1) // 42
 * timeLimitedCache.count() // 1
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 2627 | [å‡½æ•°é˜²æŠ–](https://leetcode.com/problems/debounce) | [[âœ“]](/problem/2627.md) |  | <font color=#ffb800>Medium</font> |
| 2636 | [Promise å¯¹è±¡æ± ](https://leetcode.com/problems/promise-pool) | [[âœ“]](/problem/2636.md) |  | <font color=#ffb800>Medium</font> |
| 2637 | [æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡](https://leetcode.com/problems/promise-time-limit) | [[âœ“]](/problem/2637.md) |  | <font color=#ffb800>Medium</font> |