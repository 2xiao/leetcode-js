# [731. æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ II](https://leetcode.com/problems/my-calendar-ii)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) [`æ•°ç»„`](/tag/array.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md) [`æœ‰åºé›†åˆ`](/tag/ordered-set.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/my-calendar-ii)

## é¢˜ç›®

<p>å®ç°ä¸€ä¸ª <code>MyCalendar</code> ç±»æ¥å­˜æ”¾ä½ çš„æ—¥ç¨‹å®‰æ’ã€‚å¦‚æœè¦æ·»åŠ çš„æ—¶é—´å†…ä¸ä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢æ—¶ï¼Œåˆ™å¯ä»¥å­˜å‚¨è¿™ä¸ªæ–°çš„æ—¥ç¨‹å®‰æ’ã€‚</p>

<p><code>MyCalendar</code> æœ‰ä¸€ä¸ª <code>book(int start, int end)</code>æ–¹æ³•ã€‚å®ƒæ„å‘³ç€åœ¨ <code>start</code> åˆ° <code>end</code> æ—¶é—´å†…å¢åŠ ä¸€ä¸ªæ—¥ç¨‹å®‰æ’ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„æ—¶é—´æ˜¯åŠå¼€åŒºé—´ï¼Œå³ <code>[start, end)</code>, å®æ•°&nbsp;<code>x</code> çš„èŒƒå›´ä¸ºï¼Œ &nbsp;<code>start &lt;= x &lt; end</code>ã€‚</p>

<p>å½“ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’æœ‰ä¸€äº›æ—¶é—´ä¸Šçš„äº¤å‰æ—¶ï¼ˆä¾‹å¦‚ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’éƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼‰ï¼Œå°±ä¼šäº§ç”Ÿä¸‰é‡é¢„è®¢ã€‚</p>

<p>æ¯æ¬¡è°ƒç”¨ <code>MyCalendar.book</code>æ–¹æ³•æ—¶ï¼Œå¦‚æœå¯ä»¥å°†æ—¥ç¨‹å®‰æ’æˆåŠŸæ·»åŠ åˆ°æ—¥å†ä¸­è€Œä¸ä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢ï¼Œè¿”å› <code>true</code>ã€‚å¦åˆ™ï¼Œè¿”å› <code>false</code> å¹¶ä¸”ä¸è¦å°†è¯¥æ—¥ç¨‹å®‰æ’æ·»åŠ åˆ°æ—¥å†ä¸­ã€‚</p>

<p>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è°ƒç”¨<code>MyCalendar</code> ç±»: <code>MyCalendar cal = new MyCalendar();</code> <code>MyCalendar.book(start, end)</code></p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ï¼š</strong></p>

<pre>
MyCalendar();
MyCalendar.book(10, 20); // returns true
MyCalendar.book(50, 60); // returns true
MyCalendar.book(10, 40); // returns true
MyCalendar.book(5, 15); // returns false
MyCalendar.book(5, 10); // returns true
MyCalendar.book(25, 55); // returns true
<strong>è§£é‡Šï¼š</strong> 
å‰ä¸¤ä¸ªæ—¥ç¨‹å®‰æ’å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ã€‚ ç¬¬ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’ä¼šå¯¼è‡´åŒé‡é¢„è®¢ï¼Œä½†å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ã€‚
ç¬¬å››ä¸ªæ—¥ç¨‹å®‰æ’æ´»åŠ¨ï¼ˆ5,15ï¼‰ä¸èƒ½æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢ã€‚
ç¬¬äº”ä¸ªæ—¥ç¨‹å®‰æ’ï¼ˆ5,10ï¼‰å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºå®ƒæœªä½¿ç”¨å·²ç»åŒé‡é¢„è®¢çš„æ—¶é—´10ã€‚
ç¬¬å…­ä¸ªæ—¥ç¨‹å®‰æ’ï¼ˆ25,55ï¼‰å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºæ—¶é—´ [25,40] å°†å’Œç¬¬ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’åŒé‡é¢„è®¢ï¼›
æ—¶é—´ [40,50] å°†å•ç‹¬é¢„è®¢ï¼Œæ—¶é—´ [50,55ï¼‰å°†å’Œç¬¬äºŒä¸ªæ—¥ç¨‹å®‰æ’åŒé‡é¢„è®¢ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè°ƒç”¨&nbsp;<code>MyCalendar.book</code>&nbsp;å‡½æ•°æœ€å¤šä¸è¶…è¿‡&nbsp;<code>1000</code>æ¬¡ã€‚</li>
	<li>è°ƒç”¨å‡½æ•°&nbsp;<code>MyCalendar.book(start, end)</code>æ—¶ï¼Œ&nbsp;<code>start</code> å’Œ&nbsp;<code>end</code> çš„å–å€¼èŒƒå›´ä¸º&nbsp;<code>[0, 10^9]</code>ã€‚</li>
</ul>


## è§£é¢˜æ€è·¯

1. åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„ `deltas` å¯¹è±¡ï¼Œç”¨äºè®°å½•æ—¶é—´ç‚¹çš„å˜åŒ–ã€‚
2. **`book` æ–¹æ³•**ï¼š
   - å¯¹äºæ–°äº‹ä»¶ `[start, end)`ï¼Œæ›´æ–° `deltas` å¯¹è±¡ï¼Œå°† `deltas[start]` åŠ ä¸€ï¼Œ `deltas[start]` å‡ä¸€ã€‚ - æŒ‰ç…§æ—¶é—´ç‚¹é¡ºåºéå† `deltas`ï¼Œè®¡ç®—å½“å‰é‡å äº‹ä»¶çš„æ•°é‡ã€‚
   - éå†æ‰€æœ‰äº‹ä»¶ï¼Œç´¯åŠ è®¡ç®—é‡å æ•°é‡ï¼Œå¦‚æœå‘ç°é‡å æ•°é‡è¾¾åˆ° `3`ï¼Œè¡¨ç¤ºä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢ï¼Œæ­¤æ—¶æ’¤é”€ä¹‹å‰å¯¹ `deltas` çš„ä¿®æ”¹å¹¶è¿”å› `false`ã€‚
   - å¦‚æœæ²¡æœ‰å†²çªï¼Œè¡¨ç¤ºæˆåŠŸæ·»åŠ äº‹ä»¶ï¼Œè¿”å› `true`ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n log n)`ï¼Œä¸»è¦æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦å¯¹ `deltas` çš„é”®è¿›è¡Œæ’åºã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨ `deltas` å¯¹è±¡ã€‚

## ä»£ç 

```javascript
var MyCalendarTwo = function () {
	this.deltas = {};
};

/**
 * @param {number} start
 * @param {number} end
 * @return {boolean}
 */
MyCalendarTwo.prototype.book = function (start, end) {
	// æ›´æ–°é‡å äº‹ä»¶è®¡æ•°
	this.deltas[start] = (this.deltas[start] || 0) + 1; // æ–°äº‹ä»¶å¼€å§‹
	this.deltas[end] = (this.deltas[end] || 0) - 1; // æ–°äº‹ä»¶ç»“æŸ

	// æ£€æŸ¥é‡å æ•°é‡
	let overlap = 0;
	for (const time of Object.keys(this.deltas).sort((a, b) => a - b)) {
		overlap += this.deltas[time];
		if (overlap >= 3) {
			// å¦‚æœé‡å äº‹ä»¶è¾¾åˆ°3ï¼Œæ’¤é”€ä¹‹å‰çš„ä¿®æ”¹
			this.deltas[start] -= 1;
			this.deltas[end] += 1;
			if (this.deltas[start] === 0) delete this.deltas[start];
			if (this.deltas[end] === 0) delete this.deltas[end];
			return false; // è¿”å› falseï¼Œè¡¨ç¤ºæ·»åŠ å¤±è´¥
		}
	}
	return true; // æˆåŠŸæ·»åŠ äº‹ä»¶ï¼Œè¿”å› true
};

/**
 * Your MyCalendarTwo object will be instantiated and called as such:
 * var obj = new MyCalendarTwo()
 * var param_1 = obj.book(start,end)
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 729 | [æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ I](https://leetcode.com/problems/my-calendar-i) | [[âœ“]](/problem/0729.md) |  [`è®¾è®¡`](/tag/design.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) [`æ•°ç»„`](/tag/array.md) `2+` | <font color=#ffb800>Medium</font> |
| 732 | [æˆ‘çš„æ—¥ç¨‹å®‰æ’è¡¨ III](https://leetcode.com/problems/my-calendar-iii) |  |  [`è®¾è®¡`](/tag/design.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md) `2+` | <font color=#ff334b>Hard</font> |