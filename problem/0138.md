# [138. éšæœºé“¾è¡¨çš„å¤åˆ¶](https://leetcode.com/problems/copy-list-with-random-pointer)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`é“¾è¡¨`](/tag/linked-list.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/copy-list-with-random-pointer)

## é¢˜ç›®

<p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ <code>random</code> ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p>

<p>æ„é€ è¿™ä¸ªé“¾è¡¨çš„&nbsp;<strong><a href="https://baike.baidu.com/item/æ·±æ‹·è´/22785317?fr=aladdin" target="_blank">æ·±æ‹·è´</a></strong>ã€‚&nbsp;æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± <code>n</code> ä¸ª <strong>å…¨æ–°</strong> èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆå’Œ <code>random</code> æŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚<strong>å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ </strong>ã€‚</p>

<p>ä¾‹å¦‚ï¼Œå¦‚æœåŸé“¾è¡¨ä¸­æœ‰ <code>X</code> å’Œ <code>Y</code> ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ <code>X.random --&gt; Y</code> ã€‚é‚£ä¹ˆåœ¨å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹ <code>x</code> å’Œ <code>y</code> ï¼ŒåŒæ ·æœ‰ <code>x.random --&gt; y</code> ã€‚</p>

<p>è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p>

<p>ç”¨ä¸€ä¸ªç”±&nbsp;<code>n</code>&nbsp;ä¸ªèŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ¥è¡¨ç¤ºè¾“å…¥/è¾“å‡ºä¸­çš„é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ª&nbsp;<code>[val, random_index]</code>&nbsp;è¡¨ç¤ºï¼š</p>

<ul>
	<li><code>val</code>ï¼šä¸€ä¸ªè¡¨ç¤º&nbsp;<code>Node.val</code>&nbsp;çš„æ•´æ•°ã€‚</li>
	<li><code>random_index</code>ï¼šéšæœºæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ç´¢å¼•ï¼ˆèŒƒå›´ä»&nbsp;<code>0</code>&nbsp;åˆ°&nbsp;<code>n-1</code>ï¼‰ï¼›å¦‚æœä¸æŒ‡å‘ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸º&nbsp;&nbsp;<code>null</code>&nbsp;ã€‚</li>
</ul>

<p>ä½ çš„ä»£ç  <strong>åª</strong> æ¥å—åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ä½œä¸ºä¼ å…¥å‚æ•°ã€‚</p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1ï¼š</strong></p>

<p><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e1.png" style="height: 142px; width: 700px;" /></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>head = [[7,null],[13,0],[11,4],[10,2],[1,0]]
<strong>è¾“å‡ºï¼š</strong>[[7,null],[13,0],[11,4],[10,2],[1,0]]
</pre>

<p><strong class="example">ç¤ºä¾‹ 2ï¼š</strong></p>

<p><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e2.png" style="height: 114px; width: 700px;" /></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>head = [[1,1],[2,1]]
<strong>è¾“å‡ºï¼š</strong>[[1,1],[2,1]]
</pre>

<p><strong class="example">ç¤ºä¾‹ 3ï¼š</strong></p>

<p><strong><img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/01/09/e3.png" style="height: 122px; width: 700px;" /></strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>head = [[3,null],[3,0],[3,null]]
<strong>è¾“å‡ºï¼š</strong>[[3,null],[3,0],[3,null]]
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>0 &lt;= n &lt;= 1000</code><meta charset="UTF-8" /></li>
	<li><code>-10<sup>4</sup>&nbsp;&lt;= Node.val &lt;= 10<sup>4</sup></code></li>
	<li><code>Node.random</code>&nbsp;ä¸º&nbsp;<code>null</code> æˆ–æŒ‡å‘é“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</li>
</ul>

<p>&nbsp;</p>


## è§£é¢˜æ€è·¯

å¯¹äºæ•°æ®ç»“æ„å¤åˆ¶ï¼Œä¸ç®¡æ€ä¹ˆå˜ï¼Œä½ å°±è®°ä½æœ€ç®€å•çš„æ–¹å¼ï¼š **ä¸€ä¸ªå“ˆå¸Œè¡¨ + ä¸¤æ¬¡éå†** ã€‚

ç¬¬ä¸€æ¬¡éå†ä¸“é—¨å…‹éš†èŠ‚ç‚¹ï¼Œå€ŸåŠ©å“ˆå¸Œè¡¨æŠŠåŸå§‹èŠ‚ç‚¹å’Œå…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å­˜å‚¨èµ·æ¥ï¼›ç¬¬äºŒæ¬¡ä¸“é—¨ç»„è£…èŠ‚ç‚¹ï¼Œç…§ç€åŸæ•°æ®ç»“æ„çš„æ ·å­ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„æŒ‡é’ˆç»„è£…èµ·æ¥ã€‚

é¢˜ç›®å¦‚æœè®©ä½ å…‹éš†å¸¦éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘ï¼Œæˆ–è€…å…‹éš†å›¾ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯éå†çš„æ–¹å¼ä» for å¾ªç¯è¿­ä»£éå†å˜æˆ traverse é€’å½’å‡½æ•°éå†ç½¢äº†ã€‚

å¦å¤–ï¼Œè¿™é“é¢˜å’Œ [ç¬¬ 133 é¢˜ å…‹éš†å›¾](./0133) æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå› ä¸ºé“¾è¡¨åŠ ä¸€ä¸ªéšæœºæŒ‡é’ˆæœ¬è´¨ä¸Šå°±å˜æˆäº†ä¸€å¹…å›¾ã€‚

## ä»£ç 

```javascript
/**
 * // Definition for a Node.
 * function Node(val, next, random) {
 *    this.val = val;
 *    this.next = next;
 *    this.random = random;
 * };
 */

/**
 * @param {Node} head
 * @return {Node}
 */
var copyRandomList = function (head) {
	let clone = new Map();
	for (let p = head; p !== null; p = p.next) {
		if (!clone.has(p)) {
			clone.set(p, new Node(p.val));
		}
	}
	for (let p = head; p !== null; p = p.next) {
		if (p.next !== null) {
			clone.get(p).next = clone.get(p.next);
		}
		if (p.random !== null) {
			clone.get(p).random = clone.get(p.random);
		}
	}
	return clone.get(head);
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 133 | [å…‹éš†å›¾](https://leetcode.com/problems/clone-graph) | [[âœ“]](/problem/0133.md) |  [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) [`å›¾`](/tag/graph.md) `1+` | <font color=#ffb800>Medium</font> |
| 1485 | [å…‹éš†å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘](https://leetcode.com/problems/clone-binary-tree-with-random-pointer) |  |  [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) `2+` | <font color=#ffb800>Medium</font> |
| 1490 | [å…‹éš† N å‰æ ‘](https://leetcode.com/problems/clone-n-ary-tree) |  |  [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) `1+` | <font color=#ffb800>Medium</font> |