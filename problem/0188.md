---
title: 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV
description: LeetCode 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IVé¢˜è§£ï¼ŒBest Time to Buy and Sell Stock IVï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV
  - ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV
  - Best Time to Buy and Sell Stock IV
  - è§£é¢˜æ€è·¯
  - æ•°ç»„
  - åŠ¨æ€è§„åˆ’
---

# 188. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº IV

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-iv) [`LeetCode`](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv)

## é¢˜ç›®

You are given an integer array `prices` where `prices[i]` is the price of a
given stock on the `ith` day, and an integer `k`.

Find the maximum profit you can achieve. You may complete at most `k`
transactions: i.e. you may buy at most `k` times and sell at most `k` times.

**Note:** You may not engage in multiple transactions simultaneously (i.e.,
you must sell the stock before you buy again).

**Example 1:**

> Input: k = 2, prices = [2,4,1]
>
> Output: 2
>
> Explanation: Buy on day 1 (price = 2) and sell on day 2 (price = 4), profit = 4-2 = 2.

**Example 2:**

> Input: k = 2, prices = [3,2,6,5,0,3]
>
> Output: 7
>
> Explanation: Buy on day 2 (price = 2) and sell on day 3 (price = 6), profit = 6-2 = 4. Then buy on day 5 (price = 0) and sell on day 6 (price = 3), profit = 3-0 = 3.

**Constraints:**

- `1 <= k <= 100`
- `1 <= prices.length <= 1000`
- `0 <= prices[i] <= 1000`

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `prices` å’Œä¸€ä¸ªæ•´æ•° `k` ï¼Œå…¶ä¸­ `prices[i]` æ˜¯æŸæ”¯ç»™å®šçš„è‚¡ç¥¨åœ¨ç¬¬ `i` å¤©çš„ä»·æ ¼ã€‚

è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚ä½ æœ€å¤šå¯ä»¥å®Œæˆ `k` ç¬”äº¤æ˜“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æœ€å¤šå¯ä»¥ä¹° `k` æ¬¡ï¼Œå– `k` æ¬¡ã€‚

**æ³¨æ„**ï¼šä½ ä¸èƒ½åŒæ—¶å‚ä¸å¤šç¬”äº¤æ˜“ï¼ˆä½ å¿…é¡»åœ¨å†æ¬¡è´­ä¹°å‰å‡ºå”®æ‰ä¹‹å‰çš„è‚¡ç¥¨ï¼‰ã€‚

**ç¤ºä¾‹ 1ï¼š**

> è¾“å…¥ï¼šk = 2, prices = [2,4,1]
>
> è¾“å‡ºï¼š2
>
> è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 4) çš„æ—¶å€™å–å‡ºï¼Œè¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 4-2 = 2 ã€‚

**ç¤ºä¾‹ 2ï¼š**

> è¾“å…¥ï¼šk = 2, prices = [3,2,6,5,0,3]
>
> è¾“å‡ºï¼š7
>
> è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤© (è‚¡ç¥¨ä»·æ ¼ = 2) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤© (è‚¡ç¥¨ä»·æ ¼ = 6) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 6-2 = 4 ã€‚
>
> éšåï¼Œåœ¨ç¬¬ 5 å¤© (è‚¡ç¥¨ä»·æ ¼ = 0) çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 6 å¤© (è‚¡ç¥¨ä»·æ ¼ = 3) çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ = 3-0 = 3 ã€‚

## è§£é¢˜æ€è·¯

1. **åŠ¨æ€è§„åˆ’ï¼š** å®šä¹‰ä¸€ä¸ªä¸‰ç»´æ•°ç»„ `dp`ï¼Œå…¶ä¸­ `dp[i][j][0]` è¡¨ç¤ºæˆªè‡³ç¬¬ `i` å¤©ã€æœ€å¤šè¿›è¡Œ `j` æ¬¡äº¤æ˜“ã€ä¸æŒæœ‰è‚¡ç¥¨æ—¶çš„æœ€å¤§åˆ©æ¶¦ï¼Œ `dp[i][j][1]` è¡¨ç¤ºç¤ºæˆªè‡³ç¬¬ `i` å¤©ã€æœ€å¤šè¿›è¡Œ `j` æ¬¡äº¤æ˜“ã€æŒæœ‰è‚¡ç¥¨æ—¶çš„æœ€å¤§åˆ©æ¶¦ã€‚

::: info
çŠ¶æ€ `j` çš„å®šä¹‰å¹¶ä¸æ˜¯ã€Œ**å·²è¿›è¡Œçš„äº¤æ˜“æ¬¡æ•°**ã€ï¼Œè€Œæ˜¯ã€Œ**æœ€å¤§äº¤æ˜“æ¬¡æ•°çš„ä¸Šé™é™åˆ¶**ã€ã€‚å¦‚æœç¡®å®šä»Šå¤©è¿›è¡Œä¸€æ¬¡äº¤æ˜“ï¼Œä¸”è¦ä¿è¯æˆªè‡³ä»Šå¤©æœ€å¤§äº¤æ˜“æ¬¡æ•°ä¸Šé™ä¸º `j`ï¼Œé‚£ä¹ˆæ˜¨å¤©çš„æœ€å¤§äº¤æ˜“æ¬¡æ•°ä¸Šé™å¿…é¡»æ˜¯ `j - 1`ã€‚
:::

2. **çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š**

   - `dp[i][j][0] = max(dp[i-1][j][0], dp[i-1][j][1] + prices[i])`ï¼Œè¡¨ç¤ºåœ¨ç¬¬ `i` å¤©ï¼Œä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ç­‰äºå‰ä¸€å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦æˆ–è€…å‰ä¸€å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦åŠ ä¸Šä»Šå¤©å–å‡ºçš„åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚
   - `dp[i][j][1] = max(dp[i-1][j][1], dp[i-1][j-1][0] - prices[i])`ï¼Œè¡¨ç¤ºåœ¨ç¬¬ `i` å¤©ï¼ŒæŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ç­‰äºå‰ä¸€å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦æˆ–è€…å‰ä¸€å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦å‡å»ä»Šå¤©ä¹°å…¥çš„åˆ©æ¶¦çš„æœ€å¤§å€¼ã€‚ä»Šå¤©ä¹°å…¥çš„è¯ï¼Œå‰ä¸€å¤©çš„äº¤æ˜“æ¬¡æ•°ä¸Šé™è¦å‡ä¸€ã€‚

3. **è¾¹ç•Œæ¡ä»¶ï¼š** ç¬¬ä¸€å¤©ï¼ˆ`i == 0`ï¼‰æ—¶ï¼Œ`dp[0][j][0] = 0`ï¼Œ`dp[0][j][1] = -prices[0]`ã€‚
4. **åˆå§‹åŒ–ï¼š** åˆå§‹åŒ–åˆ©æ¶¦ä¸º 0ã€‚
5. **è¿”å›æœ€å¤§åˆ©æ¶¦ï¼š** æœ€åè¿”å› `dp[n - 1][k][0]`ï¼Œå³æœ€åä¸€å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§åˆ©æ¶¦ï¼Œå› ä¸ºè‹¥æœ€åä¸€å¤©è¿˜æŒæœ‰è‚¡ç¥¨æ²¡æœ‰å–å‡ºï¼Œæ”¶ç›Šè‚¯å®šå°äºåšäº†ä¸€æ¬¡äº¤æ˜“çš„æƒ…å†µã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**: `O(n * k)`ï¼Œéå†æ•´ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­ n æ˜¯è‚¡ç¥¨ä»·æ ¼æ•°ç»„çš„é•¿åº¦ã€‚
- **ç©ºé—´å¤æ‚åº¦**: `O(n * k)`ï¼Œä½¿ç”¨äº†ä¸€ä¸ª `2 * k * n` çš„ä¸‰ç»´æ•°ç»„æ¥å­˜å‚¨ä¸­é—´çŠ¶æ€ã€‚

## ä»£ç 

```javascript
/**
 * @param {number} k
 * @param {number[]} prices
 * @return {number}
 */
var maxProfit = function (k, prices) {
	const n = prices.length;
	const dp = new Array(n)
		.fill(0)
		.map(() => new Array(k + 1).fill(0).map(() => new Array(2).fill(0)));
	for (let i = 0; i < n; i++) {
		for (let j = 1; j <= k; j++) {
			if (i == 0) {
				dp[0][j][0] = 0;
				dp[0][j][1] = -prices[0];
				continue;
			}
			dp[i][j][0] = Math.max(dp[i - 1][j][0], dp[i - 1][j][1] + prices[i]);
			dp[i][j][1] = Math.max(dp[i - 1][j][1], dp[i - 1][j - 1][0] - prices[i]);
		}
	}
	return dp[n - 1][k][0];
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 121 | ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº | [[âœ“]](/problem/0121.md) |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | ğŸŸ¢ | [ğŸ€„ï¸](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock) [ğŸ”—](https://leetcode.com/problems/best-time-to-buy-and-sell-stock) |
| 122 | ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II | [[âœ“]](/problem/0122.md) |  [`è´ªå¿ƒ`](/tag/greedy.md) [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii) [ğŸ”—](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii) |
| 123 | ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº III | [[âœ“]](/problem/0123.md) |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-iii) [ğŸ”—](https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii) |
| 2291 | æœ€å¤§è‚¡ç¥¨æ”¶ç›Š ğŸ”’ |  |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/maximum-profit-from-trading-stocks) [ğŸ”—](https://leetcode.com/problems/maximum-profit-from-trading-stocks) |