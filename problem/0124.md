# [124. äºŒå‰æ ‘ä¸­çš„æœ€å¤§è·¯å¾„å’Œ](https://leetcode.com/problems/binary-tree-maximum-path-sum)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`åŠ¨æ€è§„åˆ’`](/outline/tag/dynamic-programming.md) [`äºŒå‰æ ‘`](/outline/tag/binary-tree.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/binary-tree-maximum-path-sum)

## é¢˜ç›®

A **path** in a binary tree is a sequence of nodes where each pair of adjacent
nodes in the sequence has an edge connecting them. A node can only appear in
the sequence **at most once**. Note that the path does not need to pass
through the root.

The **path sum** of a path is the sum of the node's values in the path.

Given the `root` of a binary tree, return _the maximum **path sum** of any
**non-empty** path_.

**Example 1:**

![](https://assets.leetcode.com/uploads/2020/10/13/exx1.jpg)

> Input: root = [1,2,3]
>
> Output: 6
>
> Explanation: The optimal path is 2 -> 1 -> 3 with a path sum of 2 + 1 + 3 = 6.

**Example 2:**

![](https://assets.leetcode.com/uploads/2020/10/13/exx2.jpg)

> Input: root = [-10,9,20,null,null,15,7]
>
> Output: 42
>
> Explanation: The optimal path is 15 -> 20 -> 7 with a path sum of 15 + 20 + 7 = 42.

**Constraints:**

- The number of nodes in the tree is in the range `[1, 3 * 10^4]`.
- `-1000 <= Node.val <= 1000`

## é¢˜ç›®å¤§æ„

äºŒå‰æ ‘ä¸­çš„ **è·¯å¾„** è¢«å®šä¹‰ä¸ºä¸€æ¡èŠ‚ç‚¹åºåˆ—ï¼Œåºåˆ—ä¸­æ¯å¯¹ç›¸é‚»èŠ‚ç‚¹ä¹‹é—´éƒ½å­˜åœ¨ä¸€æ¡è¾¹ã€‚åŒä¸€ä¸ªèŠ‚ç‚¹åœ¨ä¸€æ¡è·¯å¾„åºåˆ—ä¸­ **è‡³å¤šå‡ºç°ä¸€æ¬¡** ã€‚è¯¥è·¯å¾„ **è‡³å°‘åŒ…å«ä¸€ä¸ª** èŠ‚ç‚¹ï¼Œä¸”ä¸ä¸€å®šç»è¿‡æ ¹èŠ‚ç‚¹ã€‚

**è·¯å¾„å’Œ** æ˜¯è·¯å¾„ä¸­å„èŠ‚ç‚¹å€¼çš„æ€»å’Œã€‚

ç»™ä½ ä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root` ï¼Œè¿”å›å…¶ **æœ€å¤§è·¯å¾„å’Œ** ã€‚

## è§£é¢˜æ€è·¯

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘ï¼Œè·¯å¾„ä¸ä¸€å®šè¦ä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œå¯ä»¥ä»ä»»æ„èŠ‚ç‚¹å¼€å§‹ï¼Œå¹¶å¯ä»¥åˆ°è¾¾ä»»æ„èŠ‚ç‚¹ã€‚è¦æ‰¾åˆ°è·¯å¾„å’Œçš„æœ€å¤§å€¼ï¼Œéœ€è¦é€’å½’åœ°è®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®å€¼ã€‚

- å¯¹äºå½“å‰èŠ‚ç‚¹ `root`ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•° `maxGain(node)`ï¼Œè¡¨ç¤ºä»å½“å‰èŠ‚ç‚¹å‡ºå‘åˆ°ä»»æ„ä¸‹å±èŠ‚ç‚¹çš„è·¯å¾„æœ€å¤§è´¡çŒ®å€¼ã€‚è´¡çŒ®å€¼æ˜¯æŒ‡è¯¥èŠ‚ç‚¹åŠå…¶å­æ ‘ä¸ºè·¯å¾„æä¾›çš„æœ€å¤§å’Œã€‚
- å½“é€’å½’åˆ°å¶èŠ‚ç‚¹çš„ `null` èŠ‚ç‚¹æ—¶ï¼Œè¿”å› `0`ï¼Œè¡¨ç¤ºç©ºèŠ‚ç‚¹çš„è´¡çŒ®ä¸º `0`ã€‚
- è®¡ç®—å‡ºå½“å‰èŠ‚ç‚¹å·¦å³å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼ `leftGain` å’Œ `rightGain`ã€‚
- å½“å‰èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„å’Œå¯ä»¥æ˜¯ï¼š
  - å½“å‰èŠ‚ç‚¹å€¼ `node.val`ã€‚
  - å½“å‰èŠ‚ç‚¹ + å·¦å­æ ‘çš„è´¡çŒ®ã€‚
  - å½“å‰èŠ‚ç‚¹ + å³å­æ ‘çš„è´¡çŒ®ã€‚
  - å½“å‰èŠ‚ç‚¹ + å·¦å­æ ‘çš„è´¡çŒ® + å³å­æ ‘çš„è´¡çŒ®ï¼ˆä»£è¡¨è·¯å¾„ç©¿è¿‡å½“å‰èŠ‚ç‚¹ï¼‰ã€‚
- æ›´æ–°å…¨å±€æœ€å¤§è·¯å¾„å’Œ `res`ã€‚
- è¿”å›å½“å‰èŠ‚ç‚¹å¯ä»¥æä¾›ç»™çˆ¶èŠ‚ç‚¹çš„æœ€å¤§è·¯å¾„è´¡çŒ®ï¼Œå€¼ä¸º `node.val + max(leftGain, rightGain)`ï¼Œå³é€‰æ‹©å·¦å³å­æ ‘ä¸­è´¡çŒ®è¾ƒå¤§çš„é‚£ä¸ªã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ•°é‡ã€‚æˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªèŠ‚ç‚¹ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(h)`ï¼Œå…¶ä¸­ `h`æ˜¯äºŒå‰æ ‘çš„é«˜åº¦ã€‚é€’å½’æ ˆçš„æ·±åº¦å–å†³äºæ ‘çš„é«˜åº¦ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ ‘çš„é«˜åº¦ä¸º`O(n)`ï¼Œå³é€€åŒ–æˆé“¾è¡¨çš„æƒ…å†µã€‚

## ä»£ç 

```javascript
/**
 * @param {TreeNode} root
 * @return {number}
 */
var maxPathSum = function (root) {
	let res = -Infinity;

	const maxGain = (node) => {
		if (!node) return 0;

		// é€’å½’è®¡ç®—å·¦å³å­æ ‘çš„æœ€å¤§è´¡çŒ®å€¼
		let leftGain = Math.max(maxGain(node.left), 0); // è´Ÿæ•°æ—¶é€‰æ‹©0
		let rightGain = Math.max(maxGain(node.right), 0);

		// æ›´æ–°å…¨å±€æœ€å¤§è·¯å¾„å’Œ
		res = Math.max(res, node.val + leftGain + rightGain);

		// è¿”å›å½“å‰èŠ‚ç‚¹å¯ä»¥æä¾›ç»™çˆ¶èŠ‚ç‚¹çš„æœ€å¤§è´¡çŒ®
		return node.val + Math.max(leftGain, rightGain);
	};

	maxGain(root);

	return res;
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 112 | [è·¯å¾„æ€»å’Œ](https://leetcode.com/problems/path-sum) | [[âœ“]](/problem/0112.md) |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/breadth-first-search.md) `1+` | <font color=#15bd66>Easy</font> |
| 129 | [æ±‚æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹æ•°å­—ä¹‹å’Œ](https://leetcode.com/problems/sum-root-to-leaf-numbers) | [[âœ“]](/problem/0129.md) |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`äºŒå‰æ ‘`](/outline/tag/binary-tree.md) | <font color=#ffb800>Medium</font> |
| 666 | [è·¯å¾„æ€»å’Œ IV](https://leetcode.com/problems/path-sum-iv) |  |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`æ•°ç»„`](/outline/tag/array.md) `2+` | <font color=#ffb800>Medium</font> |
| 687 | [æœ€é•¿åŒå€¼è·¯å¾„](https://leetcode.com/problems/longest-univalue-path) |  |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`äºŒå‰æ ‘`](/outline/tag/binary-tree.md) | <font color=#ffb800>Medium</font> |
| 1376 | [é€šçŸ¥æ‰€æœ‰å‘˜å·¥æ‰€éœ€çš„æ—¶é—´](https://leetcode.com/problems/time-needed-to-inform-all-employees) |  |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/breadth-first-search.md) | <font color=#ffb800>Medium</font> |
| 2538 | [æœ€å¤§ä»·å€¼å’Œä¸æœ€å°ä»·å€¼å’Œçš„å·®å€¼](https://leetcode.com/problems/difference-between-maximum-and-minimum-price-sum) |  |  [`æ ‘`](/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/outline/tag/depth-first-search.md) [`æ•°ç»„`](/outline/tag/array.md) `1+` | <font color=#ff334b>Hard</font> |

<style>
.blue {
    background-color: #096dd9;
    padding: 0.25rem 0.5rem;
    margin: 0;
    font-size: 0.85em;
    border-radius: 3px;
    color: white;
    font-weight: 500;
}
table th:first-of-type { width: 10%; }
table th:nth-of-type(2) { width: 35%; }
table th:nth-of-type(3) { width: 10%; }
table th:nth-of-type(4) { width: 35%; }
table th:nth-of-type(5) { width: 10%; }
</style>
