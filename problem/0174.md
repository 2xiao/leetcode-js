# [174. åœ°ä¸‹åŸæ¸¸æˆ](https://leetcode.com/problems/dungeon-game)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/dungeon-game)

## é¢˜ç›®

<style type="text/css">table.dungeon, .dungeon th, .dungeon td {
  border:3px solid black;
}

 .dungeon th, .dungeon td {
    text-align: center;
    height: 70px;
    width: 70px;
}
</style>
<p>æ¶é­”ä»¬æŠ“ä½äº†å…¬ä¸»å¹¶å°†å¥¹å…³åœ¨äº†åœ°ä¸‹åŸ&nbsp;<code>dungeon</code> çš„ <strong>å³ä¸‹è§’</strong> ã€‚åœ°ä¸‹åŸæ˜¯ç”± <code>m x n</code> ä¸ªæˆ¿é—´ç»„æˆçš„äºŒç»´ç½‘æ ¼ã€‚æˆ‘ä»¬è‹±å‹‡çš„éª‘å£«æœ€åˆè¢«å®‰ç½®åœ¨ <strong>å·¦ä¸Šè§’</strong> çš„æˆ¿é—´é‡Œï¼Œä»–å¿…é¡»ç©¿è¿‡åœ°ä¸‹åŸå¹¶é€šè¿‡å¯¹æŠ—æ¶é­”æ¥æ‹¯æ•‘å…¬ä¸»ã€‚</p>

<p>éª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°ä¸ºä¸€ä¸ªæ­£æ•´æ•°ã€‚å¦‚æœä»–çš„å¥åº·ç‚¹æ•°åœ¨æŸä¸€æ—¶åˆ»é™è‡³ 0 æˆ–ä»¥ä¸‹ï¼Œä»–ä¼šç«‹å³æ­»äº¡ã€‚</p>

<p>æœ‰äº›æˆ¿é—´ç”±æ¶é­”å®ˆå«ï¼Œå› æ­¤éª‘å£«åœ¨è¿›å…¥è¿™äº›æˆ¿é—´æ—¶ä¼šå¤±å»å¥åº·ç‚¹æ•°ï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸º<em>è´Ÿæ•´æ•°</em>ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†æŸå¤±å¥åº·ç‚¹æ•°ï¼‰ï¼›å…¶ä»–æˆ¿é—´è¦ä¹ˆæ˜¯ç©ºçš„ï¼ˆæˆ¿é—´é‡Œçš„å€¼ä¸º <em>0</em>ï¼‰ï¼Œè¦ä¹ˆåŒ…å«å¢åŠ éª‘å£«å¥åº·ç‚¹æ•°çš„é­”æ³•çƒï¼ˆè‹¥æˆ¿é—´é‡Œçš„å€¼ä¸º<em>æ­£æ•´æ•°</em>ï¼Œåˆ™è¡¨ç¤ºéª‘å£«å°†å¢åŠ å¥åº·ç‚¹æ•°ï¼‰ã€‚</p>

<p>ä¸ºäº†å°½å¿«è§£æ•‘å…¬ä¸»ï¼Œéª‘å£«å†³å®šæ¯æ¬¡åª <strong>å‘å³</strong> æˆ– <strong>å‘ä¸‹</strong> ç§»åŠ¨ä¸€æ­¥ã€‚</p>

<p>è¿”å›ç¡®ä¿éª‘å£«èƒ½å¤Ÿæ‹¯æ•‘åˆ°å…¬ä¸»æ‰€éœ€çš„æœ€ä½åˆå§‹å¥åº·ç‚¹æ•°ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong>ä»»ä½•æˆ¿é—´éƒ½å¯èƒ½å¯¹éª‘å£«çš„å¥åº·ç‚¹æ•°é€ æˆå¨èƒï¼Œä¹Ÿå¯èƒ½å¢åŠ éª‘å£«çš„å¥åº·ç‚¹æ•°ï¼ŒåŒ…æ‹¬éª‘å£«è¿›å…¥çš„å·¦ä¸Šè§’æˆ¿é—´ä»¥åŠå…¬ä¸»è¢«ç›‘ç¦çš„å³ä¸‹è§’æˆ¿é—´ã€‚</p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1ï¼š</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2021/03/13/dungeon-grid-1.jpg" style="width: 253px; height: 253px;" />
<pre>
<strong>è¾“å…¥ï¼š</strong>dungeon = [[-2,-3,3],[-5,-10,1],[10,30,-5]]
<strong>è¾“å‡ºï¼š</strong>7
<strong>è§£é‡Šï¼š</strong>å¦‚æœéª‘å£«éµå¾ªæœ€ä½³è·¯å¾„ï¼šå³ -&gt; å³ -&gt; ä¸‹ -&gt; ä¸‹ ï¼Œåˆ™éª‘å£«çš„åˆå§‹å¥åº·ç‚¹æ•°è‡³å°‘ä¸º 7 ã€‚</pre>

<p><strong class="example">ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>dungeon = [[0]]
<strong>è¾“å‡ºï¼š</strong>1
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>m == dungeon.length</code></li>
	<li><code>n == dungeon[i].length</code></li>
	<li><code>1 &lt;= m, n &lt;= 200</code></li>
	<li><code>-1000 &lt;= dungeon[i][j] &lt;= 1000</code></li>
</ul>


## è§£é¢˜æ€è·¯

- **é”™è¯¯çš„åšæ³•**ï¼š

  - è¿™é“é¢˜å¯¹ `dp` æ•°ç»„çš„å®šä¹‰æ¯”è¾ƒæœ‰æ„æ€ï¼ŒæŒ‰ç…§å¸¸ç†ï¼Œ`dp` æ•°ç»„çš„å®šä¹‰åº”è¯¥æ˜¯ï¼šä»å·¦ä¸Šè§’ `(0, 0)` èµ°åˆ° `(i, j)` è‡³å°‘éœ€è¦ `dp[i][j]` çš„ç”Ÿå‘½å€¼ã€‚

  - ä½†æ˜¯å¦‚æœåªçŸ¥é“ã€Œèƒ½å¤Ÿä»å·¦ä¸Šè§’åˆ°è¾¾ `(i, j)` çš„æœ€å°ç”Ÿå‘½å€¼ã€ï¼Œä½†å¹¶ä¸çŸ¥é“ã€Œåˆ°è¾¾ `(i, j)` æ—¶çš„ç”Ÿå‘½å€¼ã€ï¼Œå°±æ— æ³•è¿›è¡ŒçŠ¶æ€è½¬ç§»ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š

  ![](../image/174.png)

  - å›¾ä¸­ï¼Œéª‘å£«æ•‘å…¬ä¸»çš„æœ€ä¼˜è·¯çº¿æ˜¯æŒ‰ç…§å›¾ä¸­è“è‰²çš„çº¿èµ°åˆ° `B`ï¼Œæœ€åèµ°åˆ° `A` ï¼Œè¿™æ ·åˆå§‹è¡€é‡åªéœ€è¦ `1` ï¼›å¦‚æœèµ°é»„è‰²ç®­å¤´è¿™æ¡è·¯ï¼Œå…ˆèµ°åˆ° `C` ç„¶åèµ°åˆ° `A`ï¼Œåˆå§‹è¡€é‡è‡³å°‘éœ€è¦ `6`ã€‚
  - å› ä¸ºéª‘å£«èµ°åˆ° `B` çš„æ—¶å€™ç”Ÿå‘½å€¼ä¸º `11`ï¼Œè€Œèµ°åˆ° `C` çš„æ—¶å€™ç”Ÿå‘½å€¼ä¾ç„¶æ˜¯ `1`ã€‚æ‰€ä»¥è™½ç„¶éª‘å£«èµ°åˆ° `B` å’Œ `C` çš„æœ€å°‘åˆå§‹è¡€é‡éƒ½æ˜¯ `1`ï¼Œä½†æ˜¯æœ€åéœ€è¦é€‰æ‹©ä» `B` èµ°åˆ° `A` ã€‚
  - **æ‰€ä»¥è¯´ï¼Œä¹‹å‰å¯¹ `dp` æ•°ç»„çš„å®šä¹‰æ˜¯é”™è¯¯çš„ï¼Œä¿¡æ¯é‡ä¸è¶³ï¼Œç®—æ³•æ— æ³•åšå‡ºæ­£ç¡®çš„çŠ¶æ€è½¬ç§»ã€‚**

- **æ­£ç¡®çš„åšæ³•**ï¼š

  - æ­£ç¡®çš„åšæ³•éœ€è¦åå‘æ€è€ƒï¼Œ`dp` æ•°ç»„çš„å®šä¹‰ä¸ºï¼š**ä» `(i, j)` åˆ°è¾¾ç»ˆç‚¹ï¼ˆå³ä¸‹è§’ï¼‰æ‰€éœ€çš„æœ€å°‘ç”Ÿå‘½å€¼æ˜¯ `dp[i][j]`ã€‚**
  - ä»å³ä¸‹è§’å¼€å§‹é€†å‘éå†ï¼Œé€šè¿‡ `dp[i][j+1]` å’Œ `dp[i+1][j]` æ¨å¯¼å‡º `dp[i][j]`ï¼Œæœ€åè¿”å› `dp[0][0]`ã€‚
  - **çŠ¶æ€è½¬ç§»æ–¹ç¨‹**ï¼š`dp[i][j] = max(1, min(dp[i+1][j], dp[i][j+1]) - dungeon[i][j])`ï¼Œå…¶ä¸­ `dp[i+1][j]` å’Œ `dp[i][j+1]` åˆ†åˆ«è¡¨ç¤ºä»ä¸‹æ–¹å’Œå³æ–¹åˆ°è¾¾ `(i, j)` çš„æœ€å°ç”Ÿå‘½å€¼ï¼Œç„¶åå‡å»å½“å‰æ ¼å­æ‰€éœ€çš„ç”Ÿå‘½å€¼ï¼Œæœ€åå–æœ€å¤§å€¼ä¸ºå½“å‰æ ¼å­æ‰€éœ€çš„æœ€å°ç”Ÿå‘½å€¼ã€‚
  - **åˆå§‹åŒ–è¾¹ç•Œ**ï¼šä¸ºäº†å¤„ç†è¾¹ç•Œæƒ…å†µï¼Œéœ€è¦åœ¨å³ä¸‹è§’ã€æœ€åä¸€è¡Œã€æœ€åä¸€åˆ—çš„ä½ç½®åˆå§‹åŒ–ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**: `O(m * n)`ï¼Œéå†æ•´ä¸ªäºŒç»´æ•°ç»„ã€‚
- **ç©ºé—´å¤æ‚åº¦**: `O(m * n)`ï¼Œä½¿ç”¨äº†ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥å­˜å‚¨ä¸­é—´çŠ¶æ€ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[][]} dungeon
 * @return {number}
 */
var calculateMinimumHP = function (dungeon) {
	const m = dungeon.length;
	const n = dungeon[0].length;
	// åˆå§‹åŒ– dp æ•°ç»„
	const dp = new Array(m).fill(0).map(() => new Array(n).fill(-1));
	for (let i = m - 1; i >= 0; i--) {
		for (let j = n - 1; j >= 0; j--) {
			if (i == m - 1 && j == n - 1) {
				// å¤„ç†å³ä¸‹è§’çš„è¾¹ç•Œæƒ…å†µ
				dp[i][j] = Math.max(1, 1 - dungeon[i][j]);
			} else if (i == m - 1) {
				// å¤„ç†æœ€åä¸€è¡Œçš„è¾¹ç•Œæƒ…å†µ
				dp[i][j] = Math.max(1, dp[i][j + 1] - dungeon[i][j]);
			} else if (j == n - 1) {
				// å¤„ç†æœ€åä¸€åˆ—çš„è¾¹ç•Œæƒ…å†µ
				dp[i][j] = Math.max(1, dp[i + 1][j] - dungeon[i][j]);
			} else {
				dp[i][j] = Math.max(
					1,
					Math.min(dp[i][j + 1], dp[i + 1][j]) - dungeon[i][j]
				);
			}
		}
	}
	return dp[0][0];
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 62 | [ä¸åŒè·¯å¾„](https://leetcode.com/problems/unique-paths) | [[âœ“]](/problem/0062.md) |  [`æ•°å­¦`](/tag/math.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`ç»„åˆæ•°å­¦`](/tag/combinatorics.md) | <font color=#ffb800>Medium</font> |
| 64 | [æœ€å°è·¯å¾„å’Œ](https://leetcode.com/problems/minimum-path-sum) | [[âœ“]](/problem/0064.md) |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) | <font color=#ffb800>Medium</font> |
| 741 | [æ‘˜æ¨±æ¡ƒ](https://leetcode.com/problems/cherry-pickup) |  |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) | <font color=#ff334b>Hard</font> |
| 2214 | [é€šå…³æ¸¸æˆæ‰€éœ€çš„æœ€ä½ç”Ÿå‘½å€¼](https://leetcode.com/problems/minimum-health-to-beat-game) |  |  [`è´ªå¿ƒ`](/tag/greedy.md) [`æ•°ç»„`](/tag/array.md) | <font color=#ffb800>Medium</font> |
| 2304 | [ç½‘æ ¼ä¸­çš„æœ€å°è·¯å¾„ä»£ä»·](https://leetcode.com/problems/minimum-path-cost-in-a-grid) |  |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) | <font color=#ffb800>Medium</font> |
| 2435 | [çŸ©é˜µä¸­å’Œèƒ½è¢« K æ•´é™¤çš„è·¯å¾„](https://leetcode.com/problems/paths-in-matrix-whose-sum-is-divisible-by-k) |  |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) | <font color=#ff334b>Hard</font> |
| 2510 | [æ£€æŸ¥æ˜¯å¦æœ‰è·¯å¾„ç»è¿‡ç›¸åŒæ•°é‡çš„ 0 å’Œ 1](https://leetcode.com/problems/check-if-there-is-a-path-with-equal-number-of-0s-and-1s) |  |  [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) | <font color=#ffb800>Medium</font> |