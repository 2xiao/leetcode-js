---
title: 2637. æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡
description: LeetCode,2637. æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡,æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡,Promise Time Limit,è§£é¢˜æ€è·¯
keywords:
  - LeetCode
  - 2637. æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡
  - æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡
  - Promise Time Limit
  - è§£é¢˜æ€è·¯
---

# 2637. æœ‰æ—¶é—´é™åˆ¶çš„ Promise å¯¹è±¡

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/promise-time-limit) [`LeetCode`](https://leetcode.com/problems/promise-time-limit)

## é¢˜ç›®

Given an asynchronous function `fn` and a time `t` in milliseconds, return a
new **time limited** version of the input function. `fn` takes arguments
provided to the **time limited **function.

The **time limited** function should follow these rules:

- If the `fn` completes within the time limit of `t` milliseconds, the **time limited** function should resolve with the result.
- If the execution of the `fn` exceeds the time limit, the **time limited** function should reject with the string `"Time Limit Exceeded"`.

**Example 1:**

> Input:
>
> fn = async (n) => {
>
> await new Promise(res => setTimeout(res, 100));
>
> return n \* n;
>
> }
>
> inputs = [5]
>
> t = 50
>
> Output: {"rejected":"Time Limit Exceeded","time":50}
>
> Explanation:
>
> const limited = timeLimit(fn, t)
>
> const start = performance.now()
>
> let result;
>
> try {
>
> const res = await limited(...inputs)
>
> result = {"resolved": res, "time": Math.floor(performance.now() - start)};
>
> } catch (err) {
>
> result = {"rejected": err, "time": Math.floor(performance.now() - start)};
>
> }
>
> console.log(result) // Output
>
> The provided function is set to resolve after 100ms. However, the time limit is set to 50ms. It rejects at t=50ms because the time limit was reached.

**Example 2:**

> Input:
>
> fn = async (n) => {
>
> await new Promise(res => setTimeout(res, 100));
>
> return n \* n;
>
> }
>
> inputs = [5]
>
> t = 150
>
> Output: {"resolved":25,"time":100}
>
> Explanation:
>
> The function resolved 5 \* 5 = 25 at t=100ms. The time limit is never reached.

**Example 3:**

> Input:
>
> fn = async (a, b) => {
>
> await new Promise(res => setTimeout(res, 120));
>
> return a + b;
>
> }
>
> inputs = [5,10]
>
> t = 150
>
> Output: {"resolved":15,"time":120}
>
> Explanation:
>
> â€‹â€‹â€‹â€‹The function resolved 5 + 10 = 15 at t=120ms. The time limit is never reached.

**Example 4:**

> Input:
>
> fn = async () => {
>
> throw "Error";
>
> }
>
> inputs = []
>
> t = 1000
>
> Output: {"rejected":"Error","time":0}
>
> Explanation:
>
> The function immediately throws an error.

**Constraints:**

- `0 <= inputs.length <= 10`
- `0 <= t <= 1000`
- `fn` returns a promise

## é¢˜ç›®å¤§æ„

è¯·ä½ ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¼‚æ­¥å‡½æ•° `fn` å’Œä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´ `t`ã€‚å®ƒåº”æ ¹æ®é™æ—¶å‡½æ•°è¿”å›ä¸€ä¸ªæœ‰ **é™æ—¶** æ•ˆæœçš„å‡½æ•°ã€‚å‡½æ•° `fn`
æ¥å—æä¾›ç»™ **é™æ—¶** å‡½æ•°çš„å‚æ•°ã€‚

**é™æ—¶** å‡½æ•°åº”éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š

- å¦‚æœ `fn` åœ¨ `t` æ¯«ç§’çš„æ—¶é—´é™åˆ¶å†…å®Œæˆï¼Œ**é™æ—¶** å‡½æ•°åº”è¿”å›ç»“æœã€‚
- å¦‚æœ `fn` çš„æ‰§è¡Œè¶…è¿‡æ—¶é—´é™åˆ¶ï¼Œ**é™æ—¶** å‡½æ•°åº”æ‹’ç»å¹¶è¿”å›å­—ç¬¦ä¸² `"Time Limit Exceeded"` ã€‚

**æç¤ºï¼š**

- `0 <= inputs.length <= 10`
- `0 <= t <= 1000`
- `fn` è¿”å›ä¸€ä¸ª Promise å¯¹è±¡

## è§£é¢˜æ€è·¯

1. åœ¨ `timeLimit` ä¸­è¿”å›äº†ä¸€ä¸ªæ–°çš„å¼‚æ­¥å‡½æ•°ï¼Œå¹¶é€šè¿‡ `Promise` æ¥æ§åˆ¶ç»“æœçš„è¿”å›ã€‚
2. è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ `setTimeout` ç”¨æ¥åˆ¤æ–­ `fn` æ˜¯å¦è¶…æ—¶ï¼Œå½“è¶…è¿‡ç»™å®šçš„æ—¶é—´ `t` æ—¶ï¼Œå®šæ—¶å™¨å°†è§¦å‘ï¼Œæ‹’ç» Promise å¹¶è¿”å› `"Time Limit Exceeded"`ã€‚
3. æ‰§è¡Œå¼‚æ­¥å‡½æ•° `fn`ï¼Œå¦‚æœ `fn` åœ¨è§„å®šæ—¶é—´å†…å®Œæˆï¼Œæ— è®ºæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½æ¸…ç†å®šæ—¶å™¨ä»¥ç¡®ä¿å…¶ä¸ä¼šå†æ¬¡æ‰§è¡Œã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šå–å†³äºä¼ å…¥çš„ `fn` çš„å¤æ‚åº¦ï¼Œå‡è®¾ä¸º `O(fn)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œä»…æœ‰å®šæ—¶å™¨å’Œ Promise ç›¸å…³çš„å†…å­˜å¼€é”€ã€‚

## ä»£ç 

```javascript
/**
 * @param {Function} fn
 * @param {number} t
 * @return {Function}
 */
var timeLimit = function (fn, t) {
	return async function (...args) {
		return new Promise((resolve, reject) => {
			// è¶…æ—¶åæ‹’ç» Promise
			const timer = setTimeout(() => reject('Time Limit Exceeded'), t);

			// æ‰§è¡Œå¼‚æ­¥å‡½æ•° fn
			fn(...args)
				.then((result) => {
					clearTimeout(timer); // æˆåŠŸæ—¶æ¸…é™¤å®šæ—¶å™¨
					resolve(result);
				})
				.catch((err) => {
					clearTimeout(timer); // å¤±è´¥æ—¶æ¸…é™¤å®šæ—¶å™¨
					reject(err);
				});
		});
	};
};

/**
 * const limited = timeLimit((t) => new Promise(res => setTimeout(res, t)), 100);
 * limited(150).catch(console.log) // "Time Limit Exceeded" at t=100ms
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 2621 | [ç¡çœ å‡½æ•°](https://leetcode.com/problems/sleep) | [[âœ“]](/problem/2621.md) |  | <font color=#15bd66>Easy</font> |
| 2622 | [æœ‰æ—¶é—´é™åˆ¶çš„ç¼“å­˜](https://leetcode.com/problems/cache-with-time-limit) | [[âœ“]](/problem/2622.md) |  | <font color=#ffb800>Medium</font> |
| 2627 | [å‡½æ•°é˜²æŠ–](https://leetcode.com/problems/debounce) | [[âœ“]](/problem/2627.md) |  | <font color=#ffb800>Medium</font> |
| 2636 | [Promise å¯¹è±¡æ±  ğŸ”’](https://leetcode.com/problems/promise-pool) | [[âœ“]](/problem/2636.md) |  | <font color=#ffb800>Medium</font> |
| 2676 | [èŠ‚æµ ğŸ”’](https://leetcode.com/problems/throttle) | [[âœ“]](/problem/2676.md) |  | <font color=#ffb800>Medium</font> |