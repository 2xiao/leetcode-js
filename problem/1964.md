---
title: 1964. æ‰¾å‡ºåˆ°æ¯ä¸ªä½ç½®ä¸ºæ­¢æœ€é•¿çš„æœ‰æ•ˆéšœç¢èµ›è·‘è·¯çº¿
description: LeetCode 1964. æ‰¾å‡ºåˆ°æ¯ä¸ªä½ç½®ä¸ºæ­¢æœ€é•¿çš„æœ‰æ•ˆéšœç¢èµ›è·‘è·¯çº¿é¢˜è§£ï¼ŒFind the Longest Valid Obstacle Course at Each Positionï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 1964. æ‰¾å‡ºåˆ°æ¯ä¸ªä½ç½®ä¸ºæ­¢æœ€é•¿çš„æœ‰æ•ˆéšœç¢èµ›è·‘è·¯çº¿
  - æ‰¾å‡ºåˆ°æ¯ä¸ªä½ç½®ä¸ºæ­¢æœ€é•¿çš„æœ‰æ•ˆéšœç¢èµ›è·‘è·¯çº¿
  - Find the Longest Valid Obstacle Course at Each Position
  - è§£é¢˜æ€è·¯
  - æ ‘çŠ¶æ•°ç»„
  - æ•°ç»„
  - äºŒåˆ†æŸ¥æ‰¾
---

# 1964. æ‰¾å‡ºåˆ°æ¯ä¸ªä½ç½®ä¸ºæ­¢æœ€é•¿çš„æœ‰æ•ˆéšœç¢èµ›è·‘è·¯çº¿

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ‘çŠ¶æ•°ç»„`](/tag/binary-indexed-tree.md) [`æ•°ç»„`](/tag/array.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/find-the-longest-valid-obstacle-course-at-each-position) [`LeetCode`](https://leetcode.com/problems/find-the-longest-valid-obstacle-course-at-each-position)

## é¢˜ç›®

You want to build some obstacle courses. You are given a **0-indexed** integer
array `obstacles` of length `n`, where `obstacles[i]` describes the height of
the `ith` obstacle.

For every index `i` between `0` and `n - 1` (**inclusive**), find the length
of the **longest obstacle course** in `obstacles` such that:

- You choose any number of obstacles between `0` and `i` **inclusive**.
- You must include the `ith` obstacle in the course.
- You must put the chosen obstacles in the **same order** as they appear in `obstacles`.
- Every obstacle (except the first) is **taller** than or the **same height** as the obstacle immediately before it.

Return _an array_ `ans` _of length_ `n`, _where_ `ans[i]` _is the length of
the**longest obstacle course** for index_ `i` _as described above_.

**Example 1:**

> Input: obstacles = [1,2,3,2]
>
> Output: [1,2,3,3]
>
> Explanation: The longest valid obstacle course at each position is:
>
> - i = 0: [_1_], [1] has length 1.
> - i = 1: [_1_ ,_2_], [1,2] has length 2.
> - i = 2: [_1_ ,_2_ ,_3_], [1,2,3] has length 3.
> - i = 3: [_1_ ,_2_ ,3,_2_], [1,2,2] has length 3.

**Example 2:**

> Input: obstacles = [2,2,1]
>
> Output: [1,2,1]
>
> Explanation: The longest valid obstacle course at each position is:
>
> - i = 0: [_2_], [2] has length 1.
> - i = 1: [_2_ ,_2_], [2,2] has length 2.
> - i = 2: [2,2,_1_], [1] has length 1.

**Example 3:**

> Input: obstacles = [3,1,5,6,4,2]
>
> Output: [1,1,2,3,2,2]
>
> Explanation: The longest valid obstacle course at each position is:
>
> - i = 0: [_3_], [3] has length 1.
> - i = 1: [3,_1_], [1] has length 1.
> - i = 2: [_3_ ,1,_5_], [3,5] has length 2. [1,5] is also valid.
> - i = 3: [_3_ ,1,_5_ ,_6_], [3,5,6] has length 3. [1,5,6] is also valid.
> - i = 4: [_3_ ,1,5,6,_4_], [3,4] has length 2. [1,4] is also valid.
> - i = 5: [3,_1_ ,5,6,4,_2_], [1,2] has length 2.

**Constraints:**

- `n == obstacles.length`
- `1 <= n <= 10^5`
- `1 <= obstacles[i] <= 10^7`

## é¢˜ç›®å¤§æ„

ä½ æ‰“ç®—æ„å»ºä¸€äº›éšœç¢èµ›è·‘è·¯çº¿ã€‚ç»™ä½ ä¸€ä¸ª **ä¸‹æ ‡ä» 0 å¼€å§‹** çš„æ•´æ•°æ•°ç»„ `obstacles` ï¼Œæ•°ç»„é•¿åº¦ä¸º `n` ï¼Œå…¶ä¸­
`obstacles[i]` è¡¨ç¤ºç¬¬ `i` ä¸ªéšœç¢çš„é«˜åº¦ã€‚

å¯¹äºæ¯ä¸ªä»‹äº `0` å’Œ `n - 1` ä¹‹é—´ï¼ˆåŒ…å« `0` å’Œ `n - 1`ï¼‰çš„ä¸‹æ ‡ `i` ï¼Œåœ¨æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„å‰æä¸‹ï¼Œè¯·ä½ æ‰¾å‡º
`obstacles` èƒ½æ„æˆçš„æœ€é•¿éšœç¢è·¯çº¿çš„é•¿åº¦ï¼š

- ä½ å¯ä»¥é€‰æ‹©ä¸‹æ ‡ä»‹äº `0` åˆ° `i` ä¹‹é—´ï¼ˆåŒ…å« `0` å’Œ `i`ï¼‰çš„ä»»æ„ä¸ªéšœç¢ã€‚
- åœ¨è¿™æ¡è·¯çº¿ä¸­ï¼Œå¿…é¡»åŒ…å«ç¬¬ `i` ä¸ªéšœç¢ã€‚
- ä½ å¿…é¡»æŒ‰éšœç¢åœ¨ `obstacles` ä¸­çš„**\*\***å‡ºç°é¡ºåº\*\* å¸ƒç½®è¿™äº›éšœç¢ã€‚
- é™¤ç¬¬ä¸€ä¸ªéšœç¢å¤–ï¼Œè·¯çº¿ä¸­æ¯ä¸ªéšœç¢çš„é«˜åº¦éƒ½å¿…é¡»å’Œå‰ä¸€ä¸ªéšœç¢ **ç›¸åŒ** æˆ–è€… **æ›´é«˜** ã€‚

è¿”å›é•¿åº¦ä¸º `n` çš„ç­”æ¡ˆæ•°ç»„ `ans` ï¼Œå…¶ä¸­ `ans[i]` æ˜¯ä¸Šé¢æ‰€è¿°çš„ä¸‹æ ‡ `i` å¯¹åº”çš„æœ€é•¿éšœç¢èµ›è·‘è·¯çº¿çš„é•¿åº¦ã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š** obstacles = [1,2,3,2]
>
> **è¾“å‡ºï¼š**[1,2,3,3]
>
> **è§£é‡Šï¼š** æ¯ä¸ªä½ç½®çš„æœ€é•¿æœ‰æ•ˆéšœç¢è·¯çº¿æ˜¯ï¼š
>
> - i = 0: [_**1**_], [1] é•¿åº¦ä¸º 1
> - i = 1: [_**1**_ ,_**2**_], [1,2] é•¿åº¦ä¸º 2
> - i = 2: [_**1**_ ,_**2**_ ,_**3**_], [1,2,3] é•¿åº¦ä¸º 3
> - i = 3: [_**1**_ ,_**2**_ ,3,_**2**_], [1,2,2] é•¿åº¦ä¸º 3

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** obstacles = [2,2,1]
>
> **è¾“å‡ºï¼š**[1,2,1]
>
> **è§£é‡Šï¼š** æ¯ä¸ªä½ç½®çš„æœ€é•¿æœ‰æ•ˆéšœç¢è·¯çº¿æ˜¯ï¼š
>
> - i = 0: [_**2**_], [2] é•¿åº¦ä¸º 1
> - i = 1: [_**2**_ ,_**2**_], [2,2] é•¿åº¦ä¸º 2
> - i = 2: [2,2,_**1**_], [1] é•¿åº¦ä¸º 1

**ç¤ºä¾‹ 3ï¼š**

> **è¾“å…¥ï¼š** obstacles = [3,1,5,6,4,2]
>
> **è¾“å‡ºï¼š**[1,1,2,3,2,2]
>
> **è§£é‡Šï¼š** æ¯ä¸ªä½ç½®çš„æœ€é•¿æœ‰æ•ˆéšœç¢è·¯çº¿æ˜¯ï¼š
>
> - i = 0: [_**3**_], [3] é•¿åº¦ä¸º 1
> - i = 1: [3,_**1**_], [1] é•¿åº¦ä¸º 1
> - i = 2: [_**3**_ ,1,_**5**_], [3,5] é•¿åº¦ä¸º 2, [1,5] ä¹Ÿæ˜¯æœ‰æ•ˆçš„éšœç¢èµ›è·‘è·¯çº¿
> - i = 3: [_**3**_ ,1,_**5**_ ,_**6**_], [3,5,6] é•¿åº¦ä¸º 3, [1,5,6] ä¹Ÿæ˜¯æœ‰æ•ˆçš„éšœç¢èµ›è·‘è·¯çº¿
> - i = 4: [_**3**_ ,1,5,6,_**4**_], [3,4] é•¿åº¦ä¸º 2, [1,4] ä¹Ÿæ˜¯æœ‰æ•ˆçš„éšœç¢èµ›è·‘è·¯çº¿
> - i = 5: [3,_**1**_ ,5,6,4,_**2**_], [1,2] é•¿åº¦ä¸º 2

**æç¤ºï¼š**

- `n == obstacles.length`
- `1 <= n <= 10^5`
- `1 <= obstacles[i] <= 10^7`

## è§£é¢˜æ€è·¯

1. **å®šä¹‰ `tails` æ•°ç»„**ï¼š

   - `tails[i]` è¡¨ç¤ºé•¿åº¦ä¸º `i+1` çš„**æœ€é•¿éé€’å‡å­åºåˆ—çš„æœ€å°ç»“å°¾å…ƒç´ **ã€‚
   - `len` è®°å½• `tails` å½“å‰æœ‰æ•ˆçš„é•¿åº¦ã€‚

2. **éå† `obstacles` å¹¶ç»´æŠ¤ `tails`**ï¼š

   - é€šè¿‡**äºŒåˆ†æŸ¥æ‰¾**æ‰¾åˆ° `obstacles[i]` åœ¨ `tails` ä¸­çš„æ’å…¥ä½ç½®ï¼š
     - å¦‚æœ `tails[mid] â‰¤ obstacles[i]`ï¼Œè¯´æ˜å¯ä»¥å»¶é•¿ LISï¼Œç§»åŠ¨ `left` ç»§ç»­æŸ¥æ‰¾æ›´å¤§çš„ä½ç½®ã€‚
     - å¦åˆ™ï¼Œæ›´æ–° `right` æ”¶ç¼©èŒƒå›´ã€‚
   - **æ›´æ–° `tails`**ï¼š
     - å¦‚æœ `left == len`ï¼Œè¯´æ˜ `obstacles[i]` æ¯” `tails` æ‰€æœ‰å…ƒç´ éƒ½å¤§ï¼Œç›´æ¥**æ–°å¢ä¸€ä¸ª LIS å…ƒç´ **ã€‚
     - å¦åˆ™ï¼Œæ›´æ–° `tails[left]`ï¼Œæ›¿æ¢å·²æœ‰çš„æ›´å¤§å…ƒç´ ã€‚

3. **è®°å½•ç»“æœ**ï¼š
   - `result[i] = left + 1`ï¼Œè¡¨ç¤ºå½“å‰ä½ç½®çš„ LIS é•¿åº¦ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n log n)`ï¼Œå…¶ä¸­ `n` æ˜¯ `obstacles` æ•°ç»„çš„é•¿åº¦ã€‚
  - éå† `obstacles`ï¼š`O(n)`ã€‚
  - äºŒåˆ†æŸ¥æ‰¾æ›´æ–° `tails`ï¼šæ¯æ¬¡ `O(log n)`ã€‚
  - æ€»å¤æ‚åº¦ï¼š`O(n log n)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œéœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨è¾…åŠ©æ•°ç»„ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[]} obstacles
 * @return {number[]}
 */
var longestObstacleCourseAtEachPosition = function (obstacles) {
	let result = [];
	let tails = [];

	for (let i = 0; i < obstacles.length; i++) {
		let left = 0,
			right = tails.length;
		while (left < right) {
			let mid = Math.floor((left + right) / 2);
			if (tails[mid] <= obstacles[i]) left = mid + 1;
			else right = mid;
		}
		if (left === tails.length) tails.push(obstacles[i]);
		else tails[left] = obstacles[i];
		result.push(left + 1);
	}

	return result;
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 300 | æœ€é•¿é€’å¢å­åºåˆ— | [[âœ“]](/problem/0300.md) |  [`æ•°ç»„`](/tag/array.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/longest-increasing-subsequence) [ğŸ”—](https://leetcode.com/problems/longest-increasing-subsequence) |