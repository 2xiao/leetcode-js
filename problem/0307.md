# [307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.com/problems/range-sum-query-mutable)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/tag/binary-indexed-tree.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) [`æ•°ç»„`](/tag/array.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/range-sum-query-mutable)

## é¢˜ç›®

<p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ å®Œæˆä¸¤ç±»æŸ¥è¯¢ã€‚</p>

<ol>
	<li>å…¶ä¸­ä¸€ç±»æŸ¥è¯¢è¦æ±‚ <strong>æ›´æ–°</strong> æ•°ç»„&nbsp;<code>nums</code>&nbsp;ä¸‹æ ‡å¯¹åº”çš„å€¼</li>
	<li>å¦ä¸€ç±»æŸ¥è¯¢è¦æ±‚è¿”å›æ•°ç»„&nbsp;<code>nums</code>&nbsp;ä¸­ç´¢å¼•&nbsp;<code>left</code>&nbsp;å’Œç´¢å¼•&nbsp;<code>right</code>&nbsp;ä¹‹é—´ï¼ˆ&nbsp;<strong>åŒ…å«&nbsp;</strong>ï¼‰çš„numså…ƒç´ çš„ <strong>å’Œ</strong>&nbsp;ï¼Œå…¶ä¸­&nbsp;<code>left &lt;= right</code></li>
</ol>

<p>å®ç° <code>NumArray</code> ç±»ï¼š</p>

<ul>
	<li><code>NumArray(int[] nums)</code> ç”¨æ•´æ•°æ•°ç»„ <code>nums</code> åˆå§‹åŒ–å¯¹è±¡</li>
	<li><code>void update(int index, int val)</code> å°† <code>nums[index]</code> çš„å€¼ <strong>æ›´æ–°</strong> ä¸º <code>val</code></li>
	<li><code>int sumRange(int left, int right)</code> è¿”å›æ•°ç»„&nbsp;<code>nums</code>&nbsp;ä¸­ç´¢å¼•&nbsp;<code>left</code>&nbsp;å’Œç´¢å¼•&nbsp;<code>right</code>&nbsp;ä¹‹é—´ï¼ˆ&nbsp;<strong>åŒ…å«&nbsp;</strong>ï¼‰çš„numså…ƒç´ çš„ <strong>å’Œ</strong>&nbsp;ï¼ˆå³ï¼Œ<code>nums[left] + nums[left + 1], ..., nums[right]</code>ï¼‰</li>
</ul>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥</strong>ï¼š
["NumArray", "sumRange", "update", "sumRange"]
[[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]
<strong>è¾“å‡º</strong>ï¼š
[null, 9, null, 8]

<strong>è§£é‡Š</strong>ï¼š
NumArray numArray = new NumArray([1, 3, 5]);
numArray.sumRange(0, 2); // è¿”å› 1 + 3 + 5 = 9
numArray.update(1, 2);   // nums = [1,2,5]
numArray.sumRange(0, 2); // è¿”å› 1 + 2 + 5 = 8
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= nums.length &lt;= 3 *&nbsp;10<sup>4</sup></code></li>
	<li><code>-100 &lt;= nums[i] &lt;= 100</code></li>
	<li><code>0 &lt;= index &lt; nums.length</code></li>
	<li><code>-100 &lt;= val &lt;= 100</code></li>
	<li><code>0 &lt;= left &lt;= right &lt; nums.length</code></li>
	<li>è°ƒç”¨ <code>update</code> å’Œ <code>sumRange</code> æ–¹æ³•æ¬¡æ•°ä¸å¤§äº&nbsp;<code>3 * 10<sup>4</sup></code>&nbsp;</li>
</ul>


## è§£é¢˜æ€è·¯

è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡çº¿æ®µæ ‘æ¥è§£å†³ï¼š

1. **åˆå§‹åŒ–ï¼š** åœ¨ `NumArray` ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œé¦–å…ˆå°†è¾“å…¥çš„æ•°ç»„ `nums` å­˜å‚¨èµ·æ¥ï¼Œå¹¶æ„å»ºä¸€ä¸ªçº¿æ®µæ ‘ï¼Œè¡¨ç¤ºæ•´ä¸ªæ•°ç»„çš„å’Œã€‚æ¯ä¸ªçº¿æ®µæ ‘èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªåŒºé—´çš„èµ·å§‹ä½ç½®ã€ç»“æŸä½ç½®å’Œè¯¥åŒºé—´çš„å’Œã€‚

2. **æ›´æ–°æ“ä½œï¼š** å½“è°ƒç”¨ `update` æ–¹æ³•æ—¶ï¼Œæ ¹æ®ç»™å®šçš„ç´¢å¼•å’Œæ–°çš„å€¼ï¼Œæ›´æ–°æ•°ç»„ `nums` å¯¹åº”ä½ç½®çš„å€¼ï¼Œå¹¶åœ¨çº¿æ®µæ ‘ä¸­æ›´æ–°å¯¹åº”çš„èŠ‚ç‚¹çš„å€¼ã€‚è¿™ä¸ªæ›´æ–°è¿‡ç¨‹æ˜¯é€šè¿‡é€’å½’åœ°å‘ä¸‹æ›´æ–°çº¿æ®µæ ‘èŠ‚ç‚¹å®ç°çš„ã€‚

3. **åŒºé—´å’ŒæŸ¥è¯¢ï¼š** å½“è°ƒç”¨ `sumRange` æ–¹æ³•æ—¶ï¼Œéœ€è¦æŸ¥è¯¢æ•°ç»„ä¸­æŒ‡å®šåŒºé—´ `[i, j]` çš„å’Œã€‚åœ¨çº¿æ®µæ ‘ä¸­ï¼Œå¯ä»¥é€šè¿‡é€’å½’åœ°æŸ¥è¯¢å·¦å³å­æ ‘æ¥è·å¾—åŒºé—´ `[i, j]` çš„å’Œï¼š
   - å¦‚æœå½“å‰èŠ‚ç‚¹çš„åŒºé—´å®Œå…¨åŒ…å«åœ¨ `[i, j]` ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹çš„å’Œã€‚
   - å¦åˆ™ï¼Œæ ¹æ®å½“å‰èŠ‚ç‚¹çš„ä¸­ç‚¹å°†æŸ¥è¯¢åŒºé—´ `[i, j]` åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œé€’å½’åœ°æŸ¥è¯¢å·¦å³å­æ ‘ï¼Œå¹¶å°†ä¸¤éƒ¨åˆ†çš„å’Œç›¸åŠ ã€‚

## ä»£ç 

```javascript
class NumArray {
	// @param {number[]} nums
	constructor(nums) {
		this.nums = nums;
		this.segmentTree = this.buildSegmentTree(nums, 0, nums.length - 1);
	}
	// @param {number[]} nums
	// @param {number} start
	// @param {number} end
	buildSegmentTree(nums, start, end) {
		if (start == end) {
			return { start, end, left: null, right: null, sum: nums[start] };
		}
		const mid = Math.floor((start + end) / 2);
		const left = this.buildSegmentTree(nums, start, mid);
		const right = this.buildSegmentTree(nums, mid + 1, end);
		const sum = left.sum + right.sum;
		return { start, end, left, right, sum };
	}

	// @param {number} index
	// @param {number} val
	// @return {void}
	update(index, val) {
		this.updateSegmentTree(this.segmentTree, index, val);
	}

	updateSegmentTree(root, index, val) {
		if (root.start == root.end) {
			root.sum = val;
			return;
		}
		const mid = Math.floor((root.start + root.end) / 2);
		if (index <= mid) {
			this.updateSegmentTree(root.left, index, val);
		} else {
			this.updateSegmentTree(root.right, index, val);
		}
		root.sum =
			(root.left ? root.left.sum : 0) + (root.right ? root.right.sum : 0);
	}

	// @param {number} left
	// @param {number} right
	// @return {number}
	sumRange(left, right) {
		return this.querySegmentTree(this.segmentTree, left, right);
	}

	querySegmentTree(root, start, end) {
		if (root.start > end || root.end < start) return 0;
		if (root.start >= start && root.end <= end) return root.sum;

		const mid = Math.floor((root.start + root.end) / 2);
		const leftSum = this.querySegmentTree(root.left, start, Math.min(mid, end));
		const rightSum = this.querySegmentTree(
			root.right,
			Math.max(mid + 1, start),
			end
		);
		return leftSum + rightSum;
	}
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 303 | [åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜](https://leetcode.com/problems/range-sum-query-immutable) | [[âœ“]](/problem/0303.md) |  [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md) | <font color=#15bd66>Easy</font> |
| 308 | [äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µå¯ä¿®æ”¹](https://leetcode.com/problems/range-sum-query-2d-mutable) |  |  [`è®¾è®¡`](/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/tag/binary-indexed-tree.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) `2+` | <font color=#ff334b>Hard</font> |
| 2381 | [å­—æ¯ç§»ä½ II](https://leetcode.com/problems/shifting-letters-ii) |  |  [`æ•°ç»„`](/tag/array.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md) | <font color=#ffb800>Medium</font> |