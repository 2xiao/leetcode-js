# [494. ç›®æ ‡å’Œ](https://leetcode.com/problems/target-sum)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`å›æº¯`](/tag/backtracking.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/target-sum)

## é¢˜ç›®

You are given an integer array `nums` and an integer `target`.

You want to build an **expression** out of nums by adding one of the symbols
`'+'` and `'-'` before each integer in nums and then concatenate all the
integers.

- For example, if `nums = [2, 1]`, you can add a `'+'` before `2` and a `'-'` before `1` and concatenate them to build the expression `"+2-1"`.

Return the number of different **expressions** that you can build, which
evaluates to `target`.

**Example 1:**

> Input: nums = [1,1,1,1,1], target = 3
>
> Output: 5
>
> Explanation: There are 5 ways to assign symbols to make the sum of nums be target 3.
>
> -1 + 1 + 1 + 1 + 1 = 3
>
> +1 - 1 + 1 + 1 + 1 = 3
>
> +1 + 1 - 1 + 1 + 1 = 3
>
> +1 + 1 + 1 - 1 + 1 = 3
>
> +1 + 1 + 1 + 1 - 1 = 3

**Example 2:**

> Input: nums = [1], target = 1
>
> Output: 1

**Constraints:**

- `1 <= nums.length <= 20`
- `0 <= nums[i] <= 1000`
- `0 <= sum(nums[i]) <= 1000`
- `-1000 <= target <= 1000`

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `target` ã€‚

å‘æ•°ç»„ä¸­çš„æ¯ä¸ªæ•´æ•°å‰æ·»åŠ  `'+'` æˆ– `'-'` ï¼Œç„¶åä¸²è”èµ·æ‰€æœ‰æ•´æ•°ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ª **è¡¨è¾¾å¼** ï¼š

- ä¾‹å¦‚ï¼Œ`nums = [2, 1]` ï¼Œå¯ä»¥åœ¨ `2` ä¹‹å‰æ·»åŠ  `'+'` ï¼Œåœ¨ `1` ä¹‹å‰æ·»åŠ  `'-'` ï¼Œç„¶åä¸²è”èµ·æ¥å¾—åˆ°è¡¨è¾¾å¼ `"+2-1"` ã€‚

è¿”å›å¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹æ³•æ„é€ çš„ã€è¿ç®—ç»“æœç­‰äº `target` çš„ä¸åŒ **è¡¨è¾¾å¼** çš„æ•°ç›®ã€‚

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šå›æº¯

ä»»ä½•ç®—æ³•çš„æ ¸å¿ƒéƒ½æ˜¯ç©·ä¸¾ï¼Œå›æº¯ç®—æ³•å°±æ˜¯ä¸€ä¸ªæš´åŠ›ç©·ä¸¾ç®—æ³•ï¼Œåœ¨ [ã€Š3.4 å›æº¯ç®—æ³•ã€‹](../book/backtracking.md) ä¸­è®²äº†å›æº¯ç®—æ³•æ¡†æ¶ï¼š

```javascript
function backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨) {
	if (æ»¡è¶³ç»“æŸæ¡ä»¶) {
		result.add(è·¯å¾„);
		return;
	}

	for (é€‰æ‹© in é€‰æ‹©åˆ—è¡¨) {
		åšé€‰æ‹©;
		backtrack(è·¯å¾„, é€‰æ‹©åˆ—è¡¨);
		æ’¤é”€é€‰æ‹©;
	}
}
```

- æ ¹æ®æ¨¡ç‰ˆæ¡†æ¶ï¼Œå¯ä»¥ä½¿ç”¨å›æº¯ç®—æ³•ï¼Œå°è¯•æ¯ä¸€ç§å¯èƒ½çš„ç»„åˆï¼›
- é€’å½’å‡½æ•° `backtrack` ä¸­ï¼Œå¯¹äºå½“å‰æ•°å­—ï¼Œåˆ†åˆ«è€ƒè™‘æ·»åŠ æ­£è´Ÿå·ï¼Œç„¶åé€’å½’åˆ°ä¸‹ä¸€å±‚ï¼›
- å¦‚æœéå†å®Œæ‰€æœ‰æ•°å­—åï¼Œç›®æ ‡å€¼ä¸º 0ï¼Œåˆ™è¯´æ˜æ‰¾åˆ°ä¸€ç§ç»„åˆï¼›

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(2^n)`ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„ `nums` çš„é•¿åº¦ï¼Œæ¯ä¸ªæ•°å­—éƒ½æœ‰ä¸¤ç§é€‰æ‹©ï¼ŒåŠ æˆ–è€…å‡ã€‚é‡å¤è®¡ç®—è¾ƒå¤šï¼Œéå¸¸ä½æ•ˆã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œé€’å½’æ ˆçš„æ·±åº¦ã€‚

---

### æ€è·¯äºŒï¼šåŠ¨æ€è§„åˆ’ - é€’å½’

åŠ¨æ€è§„åˆ’ä¹‹æ‰€ä»¥æ¯”æš´åŠ›ç®—æ³•å¿«ï¼Œæ˜¯å› ä¸ºåŠ¨æ€è§„åˆ’æŠ€å·§æ¶ˆé™¤äº†é‡å å­é—®é¢˜ã€‚ä½¿ç”¨åŠ¨æ€è§„åˆ’å’Œé€’å½’ç»“åˆçš„æ€è·¯ï¼Œä½¿ç”¨å“ˆå¸Œè¡¨ `dp` å­˜å‚¨ä¸­é—´ç»“æœï¼Œå¯ä»¥é¿å…é‡å¤è®¡ç®—ã€‚

é€’å½’å‡½æ•° `helper` ä¸­ï¼Œå¯¹äºæ¯ä¸ªæ•°å­—ï¼Œåˆ†åˆ«è€ƒè™‘æ·»åŠ æ­£è´Ÿå·ï¼Œç„¶åé€’å½’åˆ°ä¸‹ä¸€å±‚ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n * target)`ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„ `nums` çš„é•¿åº¦ï¼Œæ¯ä¸ªæ•°å­—éƒ½æœ‰ä¸¤ç§é€‰æ‹©ï¼ŒåŠ æˆ–è€…å‡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n * target)`ï¼Œå­˜å‚¨ä¸­é—´ç»“æœçš„å“ˆå¸Œè¡¨ã€‚

---

### æ€è·¯ä¸‰ï¼šåŠ¨æ€è§„åˆ’ - èƒŒåŒ…

è¿™ä¸ªé—®é¢˜è¿˜å¯ä»¥è½¬åŒ–ä¸ºä¸€ä¸ªå­é›†åˆ’åˆ†é—®é¢˜ï¼Œè€Œå­é›†åˆ’åˆ†é—®é¢˜åˆæ˜¯ä¸€ä¸ªå…¸å‹çš„èƒŒåŒ…é—®é¢˜ã€‚

é¦–å…ˆï¼Œå¦‚æœæŠŠ `nums` åˆ’åˆ†æˆä¸¤ä¸ªå­é›† `A` å’Œ `B`ï¼Œåˆ†åˆ«ä»£è¡¨åˆ†é… `+` çš„æ•°å’Œåˆ†é… `-` çš„æ•°ï¼Œé‚£ä¹ˆä»–ä»¬å’Œ `target` å­˜åœ¨å¦‚ä¸‹å…³ç³»ï¼š

```
sum(A) - sum(B) = target
sum(A) = target + sum(B)
sum(A) + sum(A) = target + sum(B) + sum(A)
2 * sum(A) = target + sum(nums)
```

ç»¼ä¸Šï¼Œå¯ä»¥æ¨å‡º `sum(A) = (target + sum(nums)) / 2`ï¼Œä¹Ÿå°±æŠŠåŸé—®é¢˜è½¬åŒ–æˆäº†ä¸€ä¸ªå…¸å‹çš„èƒŒåŒ…é—®é¢˜ï¼š`nums` ä¸­å­˜åœ¨å‡ ä¸ªå­é›† `A`ï¼Œä½¿å¾— **A** ä¸­å…ƒç´ çš„å’Œä¸º `(target + sum(nums)) / 2`ï¼Ÿ

- ä½¿ç”¨åŠ¨æ€è§„åˆ’æ•°ç»„ `dp[i][j]` è¡¨ç¤ºåœ¨å‰ `i` ä¸ªç‰©å“ä¸­é€‰æ‹©ï¼Œå®¹é‡ä¸º `j` çš„èƒŒåŒ…æœ‰å¤šå°‘ç§è£…æ³•ã€‚
- æ ¹æ®çŠ¶æ€è½¬ç§»æ–¹ç¨‹ `dp[i][j] = dp[i-1][j] + dp[i-1][j-nums[i-1]]`ï¼Œå®ç°åŠ¨æ€è§„åˆ’ã€‚
- åˆç”±äº `dp[i][j]` åªå’Œ `dp[i - 1][...]` æœ‰å…³ï¼Œæ‰€ä»¥å¯ä»¥å¯¹åŠ¨æ€è§„åˆ’æ•°ç»„è¿›è¡ŒçŠ¶æ€å‹ç¼©ï¼Œä»…ä½¿ç”¨ä¸€ä½æ•°ç»„å‚¨å­˜å½“å‰è¡Œçš„è®¡ç®—ç»“æœï¼Œå”¯ä¸€æ³¨æ„çš„æ˜¯ï¼Œ`j` éœ€è¦ä»åå¾€å‰éå†ã€‚
  - å› ä¸ºäºŒç»´å‹ç¼©åˆ°ä¸€ç»´çš„æ ¹æœ¬åŸç†æ˜¯ï¼Œ`dp[j]` å’Œ `dp[j-nums[i-1]]` è¿˜æ²¡è¢«æ–°ç»“æœè¦†ç›–çš„æ—¶å€™ï¼Œç›¸å½“äºäºŒç»´ `dp` ä¸­çš„ `dp[i-1][j]` å’Œ `dp[i-1][j-nums[i-1]]`ã€‚
  - é‚£ä¹ˆå°±è¦åšåˆ°ï¼šåœ¨è®¡ç®—æ–°çš„ `dp[j]` çš„æ—¶å€™ï¼Œ`dp[j]` å’Œ `dp[j-nums[i-1]]` è¿˜æ˜¯ä¸Šä¸€è½®å¤–å±‚ `for` å¾ªç¯çš„ç»“æœã€‚
  - å¦‚æœä½ ä»å‰å¾€åéå†ä¸€ç»´ `dp` æ•°ç»„ï¼Œ`dp[j]` æ˜¾ç„¶æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ `dp[j-nums[i-1]]` å·²ç»ä¸æ˜¯ä¸Šä¸€è½®å¤–å±‚ `for` å¾ªç¯çš„ç»“æœäº†ï¼Œè¿™é‡Œå°±ä¼šä½¿ç”¨é”™è¯¯çš„çŠ¶æ€ï¼Œå½“ç„¶å¾—ä¸åˆ°æ­£ç¡®çš„ç­”æ¡ˆã€‚

## ä»£ç 

::: code-tabs

@tab å›æº¯

```javascript
/**
 * @param {number[]} nums
 * @param {number} target
 * @return {number}
 */
var findTargetSumWays = function (nums, target) {
	let res = 0;
	if (nums.length == 0) return res;
	const backtrack = (i, rest) => {
		// base case
		if (i == nums.length) {
			// è¯´æ˜æ°å¥½å‡‘å‡º target
			if (rest == 0) {
				res++;
			}
			return;
		}

		// ç»™ nums[i] é€‰æ‹© - å·
		rest -= nums[i];
		backtrack(i + 1, rest);
		rest += nums[i];

		// ç»™ nums[i] é€‰æ‹© + å·
		rest += nums[i];
		backtrack(i + 1, rest);
		rest -= nums[i];
	};

	backtrack(0, target);
	return res;
};
```

@tab åŠ¨æ€è§„åˆ’ - é€’å½’

```javascript
/**
 * @param {number[]} nums
 * @param {number} target
 * @return {number}
 */
var findTargetSumWays = function (nums, target) {
	if (nums.length == 0) return 0;
	const dp = new Map();
	const helper = (i, rest) => {
		// base case
		if (i == nums.length) {
			if (rest == 0) return 1;
			return 0;
		}

		// è½¬æˆå­—ç¬¦ä¸²ä½œä¸ºå“ˆå¸Œè¡¨çš„é”®
		const key = i + '_' + rest;

		// é¿å…é‡å¤è®¡ç®—
		if (!dp.has(key)) {
			// è®°å…¥å“ˆå¸Œè¡¨
			dp.set(
				key,
				helper(i + 1, rest - nums[i]) + helper(i + 1, rest + nums[i]) // è¿˜æ˜¯ç©·ä¸¾
			);
		}
		return dp.get(key);
	};
	return helper(0, target);
};
```

@tab åŠ¨æ€è§„åˆ’ - èƒŒåŒ…

```javascript
/**
 * @param {number[]} nums
 * @param {number} target
 * @return {number}
 */
var findTargetSumWays = function (nums, target) {
	const sum = nums.reduce((num, acc) => num + acc, 0);
	if (sum < target || -sum > target || (sum + target) % 2 == 1) return 0;

	const subset = (nums, sum) => {
		const dp = new Array(sum + 1).fill(0);
		dp[0] = 1;
		for (let num of nums) {
			for (let j = sum; j >= 0; j--) {
				if (j >= num) {
					dp[j] = dp[j - num] + dp[j];
				}
			}
		}
		return dp[sum];
	};
	return subset(nums, (sum + target) / 2);
};
```

:::

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 282 | [ç»™è¡¨è¾¾å¼æ·»åŠ è¿ç®—ç¬¦](https://leetcode.com/problems/expression-add-operators) |  |  [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`å›æº¯`](/tag/backtracking.md) | <font color=#ff334b>Hard</font> |
| 2787 | [å°†ä¸€ä¸ªæ•°å­—è¡¨ç¤ºæˆå¹‚çš„å’Œçš„æ–¹æ¡ˆæ•°](https://leetcode.com/problems/ways-to-express-an-integer-as-sum-of-powers) |  |  [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) | <font color=#ffb800>Medium</font> |