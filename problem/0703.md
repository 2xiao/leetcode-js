# [703. æ•°æ®æµä¸­çš„ç¬¬ K å¤§å…ƒç´ ](https://leetcode.com/problems/kth-largest-element-in-a-stream)

ğŸŸ¢ <font color=#15bd66>Easy</font>&emsp; ğŸ”–&ensp; [`æ ‘`](/tag/tree.md) [`è®¾è®¡`](/tag/design.md) [`äºŒå‰æœç´¢æ ‘`](/tag/binary-search-tree.md) [`äºŒå‰æ ‘`](/tag/binary-tree.md) [`æ•°æ®æµ`](/tag/data-stream.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/kth-largest-element-in-a-stream)

## é¢˜ç›®

<p>è®¾è®¡ä¸€ä¸ªæ‰¾åˆ°æ•°æ®æµä¸­ç¬¬ <code>k</code> å¤§å…ƒç´ çš„ç±»ï¼ˆclassï¼‰ã€‚æ³¨æ„æ˜¯æ’åºåçš„ç¬¬ <code>k</code> å¤§å…ƒç´ ï¼Œä¸æ˜¯ç¬¬ <code>k</code> ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p>

<p>è¯·å®ç° <code>KthLargest</code>&nbsp;ç±»ï¼š</p>

<ul>
	<li><code>KthLargest(int k, int[] nums)</code> ä½¿ç”¨æ•´æ•° <code>k</code> å’Œæ•´æ•°æµ <code>nums</code> åˆå§‹åŒ–å¯¹è±¡ã€‚</li>
	<li><code>int add(int val)</code> å°† <code>val</code> æ’å…¥æ•°æ®æµ <code>nums</code> åï¼Œè¿”å›å½“å‰æ•°æ®æµä¸­ç¬¬ <code>k</code> å¤§çš„å…ƒç´ ã€‚</li>
</ul>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1ï¼š</strong></p>

<div class="example-block">
<p><strong>è¾“å…¥ï¼š</strong><br />
<span class="example-io">["KthLargest", "add", "add", "add", "add", "add"]<br />
[[3, [4, 5, 8, 2]], [3], [5], [10], [9], [4]]</span></p>

<p><strong>è¾“å‡ºï¼š</strong><span class="example-io">[null, 4, 5, 5, 8, 8]</span></p>

<p><strong>è§£é‡Šï¼š</strong></p>

<p>KthLargest kthLargest = new KthLargest(3, [4, 5, 8, 2]);<br />
kthLargest.add(3); // è¿”å› 4<br />
kthLargest.add(5); // è¿”å› 5<br />
kthLargest.add(10); // è¿”å› 5<br />
kthLargest.add(9); // è¿”å› 8<br />
kthLargest.add(4); // è¿”å› 8</p>

<p>&nbsp;</p>
</div>

<p><strong class="example">ç¤ºä¾‹&nbsp;2ï¼š</strong></p>

<div class="example-block">
<p><strong>è¾“å…¥ï¼š</strong><br />
<span class="example-io">["KthLargest", "add", "add", "add", "add"]<br />
[[4, [7, 7, 7, 7, 8, 3]], [2], [10], [9], [9]]</span></p>

<p><span class="example-io"><b>è¾“å‡ºï¼š</b>[null, 7, 7, 7, 8]</span></p>

<p><strong>è§£é‡Šï¼š</strong></p>
KthLargest kthLargest = new KthLargest(4, [7, 7, 7, 7, 8, 3]);<br />
kthLargest.add(2); // è¿”å› 7<br />
kthLargest.add(10); // è¿”å› 7<br />
kthLargest.add(9); // è¿”å› 7<br />
kthLargest.add(9); // è¿”å› 8</div>

<p>&nbsp;</p>
<strong>æç¤ºï¼š</strong>

<ul>
	<li><code>0 &lt;= nums.length &lt;= 10<sup>4</sup></code></li>
	<li><code>1 &lt;= k &lt;= nums.length + 1</code></li>
	<li><code>-10<sup>4</sup> &lt;= nums[i] &lt;= 10<sup>4</sup></code></li>
	<li><code>-10<sup>4</sup> &lt;= val &lt;= 10<sup>4</sup></code></li>
	<li>æœ€å¤šè°ƒç”¨ <code>add</code> æ–¹æ³• <code>10<sup>4</sup></code> æ¬¡</li>
</ul>


## è§£é¢˜æ€è·¯

å¯ä»¥ç”¨å°é¡¶å †æ¥åšã€‚

æ•°ç»„åœ¨ä¸æ–­æ’å…¥æ•°æ®ï¼Œå¦‚æœæ¯æ¬¡æ±‚å‰ `K` å¤§çš„æ•°æ®ï¼Œéƒ½åŸºäºå½“å‰çš„æ•°æ®é‡æ–°è®¡ç®—çš„è¯ï¼Œé‚£æ—¶é—´å¤æ‚åº¦å°±æ˜¯ `O(nlogK)`ï¼Œ`n` è¡¨ç¤ºå½“å‰çš„æ•°æ®çš„å¤§å°ã€‚

å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º `K` çš„å°é¡¶å †ï¼Œå½“æœ‰æ•°æ®è¢«æ·»åŠ åˆ°æ•°ç»„ä¸­æ—¶ï¼Œå°±æ‹¿å®ƒä¸å †é¡¶çš„å…ƒç´ å¯¹æ¯”ã€‚

- å¦‚æœæ¯”å †é¡¶å…ƒç´ å¤§ï¼Œå°±æŠŠå †é¡¶å…ƒç´ åˆ é™¤ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå…ƒç´ æ’å…¥åˆ°å †ä¸­ï¼›
- å¦‚æœæ¯”å †é¡¶å…ƒç´ å°ï¼Œåˆ™ä¸åšå¤„ç†ï¼›

è¿™æ ·ï¼Œæ— è®ºä»»ä½•æ—¶å€™éœ€è¦æŸ¥è¯¢å½“å‰çš„å‰ `K` å¤§çš„æ•°æ®ï¼Œéƒ½å¯ä»¥ç«‹åˆ»è¿”å›ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(log k)`

  å¯¹äº `add` æ–¹æ³•ï¼Œæœ€åæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå †åŒ–çš„æ¬¡æ•°æ˜¯å †çš„é«˜åº¦ï¼Œå³ `log k`ã€‚å› æ­¤ï¼Œ`add` æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(log k)`ã€‚åœ¨åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦å°†å‰ `k` ä¸ªå…ƒç´ æ„å»ºæœ€å°å †ï¼Œè¿™ä¸€è¿‡ç¨‹çš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(klog k)`ã€‚

  æ€»ä½“æ¥è¯´ï¼Œ`KthLargest` ç±»çš„æ—¶é—´å¤æ‚åº¦ä¸»è¦å— `add` æ–¹æ³•çš„å½±å“ï¼Œä¸º `O(log k)`ã€‚

- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(k)`ã€‚

## ä»£ç 

```javascript
class KthLargest {
	// @param {number} k
	// @param {number[]} nums
	constructor(k, nums) {
		this.k = k;
		this.heap = [];
		for (let i of nums) {
			this.add(i);
		}
	}
	// @param {number} val
	// @return {number}
	add(val) {
		if (this.heap.length < this.k) {
			this.heap.push(val);
			this.heapifyUp(this.heap.length - 1);
		} else if (this.heap[0] < val) {
			this.heap[0] = val;
			this.heapifyDown(0);
		}
		return this.heap[0];
	}

	heapifyUp(index) {
		while (index > 0) {
			const parent = Math.floor((index - 1) / 2);
			if (this.heap[parent] > this.heap[index]) {
				[this.heap[parent], this.heap[index]] = [
					this.heap[index],
					this.heap[parent]
				];
				index = parent;
			} else {
				break;
			}
		}
	}

	heapifyDown(index) {
		const left = 2 * index + 1;
		const right = 2 * index + 2;
		let min = index;

		if (left < this.heap.length && this.heap[left] < this.heap[min]) {
			min = left;
		}
		if (right < this.heap.length && this.heap[right] < this.heap[min]) {
			min = right;
		}
		if (min !== index) {
			[this.heap[min], this.heap[index]] = [this.heap[index], this.heap[min]];
			this.heapifyDown(min);
		}
	}
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 215 | [æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ](https://leetcode.com/problems/kth-largest-element-in-an-array) | [[âœ“]](/problem/0215.md) |  [`æ•°ç»„`](/tag/array.md) [`åˆ†æ²»`](/tag/divide-and-conquer.md) [`å¿«é€Ÿé€‰æ‹©`](/tag/quickselect.md) `2+` | <font color=#ffb800>Medium</font> |
| 1825 | [æ±‚å‡º MK å¹³å‡å€¼](https://leetcode.com/problems/finding-mk-average) |  |  [`è®¾è®¡`](/tag/design.md) [`é˜Ÿåˆ—`](/tag/queue.md) [`æ•°æ®æµ`](/tag/data-stream.md) `2+` | <font color=#ff334b>Hard</font> |
| 2102 | [åºåˆ—é¡ºåºæŸ¥è¯¢](https://leetcode.com/problems/sequentially-ordinal-rank-tracker) |  |  [`è®¾è®¡`](/tag/design.md) [`æ•°æ®æµ`](/tag/data-stream.md) [`æœ‰åºé›†åˆ`](/tag/ordered-set.md) `1+` | <font color=#ff334b>Hard</font> |