---
title: 407. æ¥é›¨æ°´ II
description: LeetCode 407. æ¥é›¨æ°´ IIé¢˜è§£ï¼ŒTrapping Rain Water IIï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 407. æ¥é›¨æ°´ II
  - æ¥é›¨æ°´ II
  - Trapping Rain Water II
  - è§£é¢˜æ€è·¯
  - å¹¿åº¦ä¼˜å…ˆæœç´¢
  - æ•°ç»„
  - çŸ©é˜µ
  - å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰
---

# 407. æ¥é›¨æ°´ II

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) [`æ•°ç»„`](/tag/array.md) [`çŸ©é˜µ`](/tag/matrix.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/trapping-rain-water-ii) [`LeetCode`](https://leetcode.com/problems/trapping-rain-water-ii)

## é¢˜ç›®

Given an `m x n` integer matrix `heightMap` representing the height of each
unit cell in a 2D elevation map, return _the volume of water it can trap after
raining_.

**Example 1:**

![](https://assets.leetcode.com/uploads/2021/04/08/trap1-3d.jpg)

> Input: heightMap = [[1,4,3,1,3,2],[3,2,1,3,2,4],[2,3,3,2,3,1]]
>
> Output: 4
>
> Explanation: After the rain, water is trapped between the blocks.
>
> We have two small ponds 1 and 3 units trapped.
>
> The total volume of water trapped is 4.

**Example 2:**

![](https://assets.leetcode.com/uploads/2021/04/08/trap2-3d.jpg)

> Input: heightMap = [[3,3,3,3,3],[3,2,2,2,3],[3,2,1,2,3],[3,2,2,2,3],[3,3,3,3,3]]
>
> Output: 10

**Constraints:**

- `m == heightMap.length`
- `n == heightMap[i].length`
- `1 <= m, n <= 200`
- `0 <= heightMap[i][j] <= 2 * 10^4`

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ª `m x n` çš„çŸ©é˜µï¼Œå…¶ä¸­çš„å€¼å‡ä¸ºéè´Ÿæ•´æ•°ï¼Œä»£è¡¨äºŒç»´é«˜åº¦å›¾æ¯ä¸ªå•å…ƒçš„é«˜åº¦ï¼Œè¯·è®¡ç®—å›¾ä¸­å½¢çŠ¶æœ€å¤šèƒ½æ¥å¤šå°‘ä½“ç§¯çš„é›¨æ°´ã€‚

**ç¤ºä¾‹ 1:**

![](https://assets.leetcode.com/uploads/2021/04/08/trap1-3d.jpg)

> **è¾“å…¥:** heightMap = [[1,4,3,1,3,2],[3,2,1,3,2,4],[2,3,3,2,3,1]]
>
> **è¾“å‡º:** 4
>
> **è§£é‡Š:** ä¸‹é›¨åï¼Œé›¨æ°´å°†ä¼šè¢«ä¸Šå›¾è“è‰²çš„æ–¹å—ä¸­ã€‚æ€»çš„æ¥é›¨æ°´é‡ä¸º 1+2+1=4ã€‚

**ç¤ºä¾‹ 2:**

![](https://assets.leetcode.com/uploads/2021/04/08/trap2-3d.jpg)

> **è¾“å…¥:** heightMap = [[3,3,3,3,3],[3,2,2,2,3],[3,2,1,2,3],[3,2,2,2,3],[3,3,3,3,3]]
>
> **è¾“å‡º:** 10

**æç¤º:**

- `m == heightMap.length`
- `n == heightMap[i].length`
- `1 <= m, n <= 200`
- `0 <= heightMap[i][j] <= 2 * 10^4`

## è§£é¢˜æ€è·¯

è¿™é“é¢˜æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨æœ€å°å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰æ¥æ¨¡æ‹Ÿæ°´ä½ä»ä½å‘é«˜é€æ­¥æ‰©å±•çš„è¿‡ç¨‹ï¼Œé€æ­¥è®¡ç®—å¯å‚¨å­˜çš„æ°´é‡ã€‚

- æ¯ä¸ªå•å…ƒæ ¼çš„å‚¨æ°´é‡ç”±å…¶å‘¨å›´çš„æœ€ä½è¾¹ç•Œå†³å®šã€‚å‚¨æ°´é‡å–å†³äºè¯¥å•å…ƒæ ¼çš„é«˜åº¦ä¸æœ€ä½è¾¹ç•Œé«˜åº¦çš„å·®å€¼ã€‚
- å¦‚æœè¾¹ç•Œè¾ƒä½ï¼Œåˆ™æ°´ä¼šä»è¾¹ç•Œæµå‡ºï¼Œå› æ­¤è¾¹ç•Œå•å…ƒæ ¼ä¸å‚¨æ°´ã€‚

**1. åˆå§‹åŒ–è¾¹ç•Œ**

- çŸ©é˜µè¿‡å°ï¼ˆ`m < 3` æˆ– `n < 3`ï¼‰æ—¶æ— æ³•å‚¨æ°´ï¼Œåº”ç›´æ¥è¿”å› 0ã€‚
- ä½¿ç”¨äºŒç»´å¸ƒå°”æ•°ç»„ `visited` é¿å…é‡å¤è®¿é—®åŒä¸€å•å…ƒæ ¼ã€‚
- é¦–å…ˆå°†çŸ©é˜µå››å‘¨çš„è¾¹ç•Œå•å…ƒæ ¼åŠ å…¥æœ€å°å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰ï¼Œå¹¶æ ‡è®°ä¸ºå·²è®¿é—®ã€‚
- è¾¹ç•Œå•å…ƒæ ¼ä½œä¸ºåˆå§‹æ°´ä½çš„æœ€ä½è¾¹ç•Œï¼Œç¡®ä¿ä¼˜å…ˆå¤„ç†ä½é«˜åº¦çš„å•å…ƒæ ¼ï¼Œæ¨¡æ‹Ÿæ°´ä»ä½åˆ°é«˜æ‰©å±•çš„è¿‡ç¨‹ã€‚

**2. ä½¿ç”¨æœ€å°å †æ¨¡æ‹Ÿæ°´ä½æ‰©å±•**

- æ¯æ¬¡ä»æœ€å°å †ä¸­å–å‡ºä¸€ä¸ªé«˜åº¦æœ€å°çš„å•å…ƒæ ¼ï¼Œä½œä¸ºå½“å‰æ°´ä½ã€‚
- æ£€æŸ¥å…¶å››ä¸ªç›¸é‚»å•å…ƒæ ¼ï¼š
  - å¦‚æœè¯¥ç›¸é‚»å•å…ƒæ ¼æœªè®¿é—®ï¼Œåˆ™æ ¹æ®å½“å‰å•å…ƒæ ¼çš„é«˜åº¦è®¡ç®—æ˜¯å¦å¯ä»¥å‚¨æ°´ã€‚
  - å¦‚æœå¯ä»¥å‚¨æ°´ï¼Œå°†å‚¨æ°´é‡ç´¯åŠ ï¼Œå¹¶å°†ç›¸é‚»å•å…ƒæ ¼åŠ å…¥å †ä¸­ï¼Œæ›´æ–°ä¸ºè¾ƒé«˜çš„æ°´ä½ã€‚

**3. æ›´æ–°å †**

- å¯¹æ¯ä¸ªç›¸é‚»å•å…ƒæ ¼ï¼Œå°†å…¶é«˜åº¦æ›´æ–°ä¸ºä¸¤è€…ä¹‹é—´çš„è¾ƒå¤§å€¼ï¼ˆæ¨¡æ‹Ÿæ°´ä½æå‡çš„è¿‡ç¨‹ï¼‰ã€‚
- å°†ç›¸é‚»å•å…ƒæ ¼åŠ å…¥æœ€å°å †ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡å¤„ç†æ›´ä½çš„å•å…ƒæ ¼ã€‚

**4. ç»ˆæ­¢æ¡ä»¶**

- å½“å †ä¸ºç©ºæ—¶ï¼Œè¡¨ç¤ºæ‰€æœ‰å¯ä»¥å‚¨æ°´çš„å•å…ƒæ ¼éƒ½å·²å¤„ç†ï¼Œè¿”å›ç´¯ç§¯çš„æ°´é‡ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(m * n * log(m * n))`ï¼Œæ¯ä¸ªå•å…ƒæ ¼æœ€å¤šè®¿é—®ä¸€æ¬¡ï¼Œå †çš„æ“ä½œå¤æ‚åº¦ä¸º `O(log(m * n))`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(m * n)`ï¼Œæœ€å°å †å’Œè®¿é—®æ ‡è®°æ•°ç»„å„å ç”¨ `O(m * n)` ç©ºé—´ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[][]} heightMap
 * @return {number}
 */
var trapRainWater = function (heightMap) {
	const m = heightMap.length;
	const n = heightMap[0].length;
	if (m < 3 || n < 3) return 0;

	const visited = new Array(m).fill().map(() => new Array(n).fill(false));

	const priority = (a, b) => a[0] < b[0];
	const minHeap = new MinHeap([], priority);

	for (let i = 0; i < m; i++) {
		minHeap.insert([heightMap[i][0], i, 0]);
		minHeap.insert([heightMap[i][n - 1], i, n - 1]);
		visited[i][0] = visited[i][n - 1] = true;
	}

	for (let j = 1; j < n - 1; j++) {
		minHeap.insert([heightMap[0][j], 0, j]);
		minHeap.insert([heightMap[m - 1][j], m - 1, j]);
		visited[0][j] = visited[m - 1][j] = true;
	}

	const dirc = [
		[0, 1],
		[0, -1],
		[1, 0],
		[-1, 0]
	];

	let water = 0;
	while (minHeap.size()) {
		const [height, x, y] = minHeap.pop();
		for (let [dx, dy] of dirc) {
			const nx = x + dx;
			const ny = y + dy;

			if (nx < 0 || nx >= m || ny < 0 || ny >= n || visited[nx][ny]) {
				continue;
			}

			water += Math.max(0, height - heightMap[nx][ny]);
			minHeap.insert([Math.max(height, heightMap[nx][ny]), nx, ny]);
			visited[nx][ny] = true;
		}
	}

	return water;
};

// æœ€å°ä¼˜å…ˆé˜Ÿåˆ—
class MinHeap {
	constructor(arr = [], priority = (a, b) => a < b) {
		this.heap = arr;
		this.priority = priority;
		for (let i = Math.floor(this.heap.length / 2) - 1; i >= 0; i--) {
			this.heapifyDown(i);
		}
	}

	insert(num) {
		this.heap.push(num);
		this.heapifyUp(this.heap.length - 1);
	}

	pop() {
		if (this.heap.length === 0) return null;
		const top = this.heap[0];
		const last = this.heap.pop();
		if (this.heap.length > 0) {
			this.heap[0] = last;
			this.heapifyDown(0);
		}
		return top;
	}

	size() {
		return this.heap.length;
	}

	toArray() {
		return this.heap;
	}

	heapifyDown(i) {
		const n = this.heap.length;
		const left = 2 * i + 1;
		const right = 2 * i + 2;
		let smallest = i;

		if (left < n && this.priority(this.heap[left], this.heap[smallest])) {
			smallest = left;
		}
		if (right < n && this.priority(this.heap[right], this.heap[smallest])) {
			smallest = right;
		}

		if (smallest !== i) {
			[this.heap[i], this.heap[smallest]] = [this.heap[smallest], this.heap[i]];
			this.heapifyDown(smallest);
		}
	}

	heapifyUp(i) {
		while (i > 0) {
			const parent = Math.floor((i - 1) / 2);
			if (this.priority(this.heap[i], this.heap[parent])) {
				[this.heap[i], this.heap[parent]] = [this.heap[parent], this.heap[i]];
				i = parent;
			} else {
				break;
			}
		}
	}
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 42 | æ¥é›¨æ°´ | [[âœ“]](/problem/0042.md) |  [`æ ˆ`](/tag/stack.md) [`æ•°ç»„`](/tag/array.md) [`åŒæŒ‡é’ˆ`](/tag/two-pointers.md) `2+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/trapping-rain-water) [ğŸ”—](https://leetcode.com/problems/trapping-rain-water) |
| 2503 | çŸ©é˜µæŸ¥è¯¢å¯è·å¾—çš„æœ€å¤§åˆ†æ•° |  |  [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) [`å¹¶æŸ¥é›†`](/tag/union-find.md) [`æ•°ç»„`](/tag/array.md) `4+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/maximum-number-of-points-from-grid-queries) [ğŸ”—](https://leetcode.com/problems/maximum-number-of-points-from-grid-queries) |