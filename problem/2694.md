# [2694. äº‹ä»¶å‘å°„å™¨](https://leetcode.com/problems/event-emitter)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/event-emitter)

## é¢˜ç›®

<p>è®¾è®¡ä¸€ä¸ª <code>EventEmitter</code> ç±»ã€‚è¿™ä¸ªæ¥å£ä¸ Node.js æˆ– DOM çš„ Event Target æ¥å£ç›¸ä¼¼ï¼Œä½†æœ‰ä¸€äº›å·®å¼‚ã€‚<code>EventEmitter</code> åº”è¯¥å…è®¸è®¢é˜…äº‹ä»¶å’Œè§¦å‘äº‹ä»¶ã€‚</p>

<p>ä½ çš„ <code>EventEmitter</code> ç±»åº”è¯¥æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š</p>

<ul>
	<li><strong>subscribe</strong> - è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªä½œä¸ºå­—ç¬¦ä¸²çš„äº‹ä»¶åå’Œä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†è¢«è°ƒç”¨ã€‚ ä¸€ä¸ªäº‹ä»¶åº”è¯¥èƒ½å¤Ÿæœ‰å¤šä¸ªç›‘å¬å™¨ã€‚å½“è§¦å‘å¸¦æœ‰å¤šä¸ªå›è°ƒå‡½æ•°çš„äº‹ä»¶æ—¶ï¼Œåº”æŒ‰ç…§è®¢é˜…çš„é¡ºåºä¾æ¬¡è°ƒç”¨æ¯ä¸ªå›è°ƒå‡½æ•°ã€‚åº”è¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ã€‚ä½ å¯ä»¥å‡è®¾ä¼ é€’ç»™ <code>subscribe</code> çš„å›è°ƒå‡½æ•°éƒ½ä¸æ˜¯å¼•ç”¨ç›¸åŒçš„ã€‚ <code>subscribe</code> æ–¹æ³•è¿˜åº”è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <code>unsubscribe</code> æ–¹æ³•ï¼Œä½¿ç”¨æˆ·å¯ä»¥å–æ¶ˆè®¢é˜…ã€‚å½“è°ƒç”¨ <code>unsubscribe</code> æ–¹æ³•æ—¶ï¼Œå›è°ƒå‡½æ•°åº”è¯¥ä»è®¢é˜…åˆ—è¡¨ä¸­åˆ é™¤ï¼Œå¹¶è¿”å› undefinedã€‚</li>
	<li><strong>emit</strong> - è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªä½œä¸ºå­—ç¬¦ä¸²çš„äº‹ä»¶åå’Œä¸€ä¸ªå¯é€‰çš„å‚æ•°æ•°ç»„ï¼Œè¿™äº›å‚æ•°å°†ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚å¦‚æœæ²¡æœ‰è®¢é˜…ç»™å®šäº‹ä»¶çš„å›è°ƒå‡½æ•°ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚å¦åˆ™ï¼ŒæŒ‰ç…§å®ƒä»¬è¢«è®¢é˜…çš„é¡ºåºè¿”å›æ‰€æœ‰å›è°ƒå‡½æ•°è°ƒç”¨çš„ç»“æœæ•°ç»„ã€‚</li>
</ul>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š
</b>actions = ["EventEmitter", "emit", "subscribe", "subscribe", "emit"], 
values = [[], ["firstEvent", "function cb1() { return 5; }"],  ["firstEvent", "function cb1() { return 5; }"], ["firstEvent"]]
<b>è¾“å‡ºï¼š</b>[[],["emitted",[]],["subscribed"],["subscribed"],["emitted",[5,6]]]
<b>è§£é‡Šï¼š</b>
const emitter = new EventEmitter();
emitter.emit("firstEvent"); // [], è¿˜æ²¡æœ‰è®¢é˜…ä»»ä½•å›è°ƒå‡½æ•°
emitter.subscribe("firstEvent", function cb1() { return 5; });
emitter.subscribe("firstEvent", function cb2() { return 6; });
emitter.emit("firstEvent"); // [5, 6], è¿”å› cb1 å’Œ cb2 çš„è¾“å‡º
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š
</b>actions = ["EventEmitter", "subscribe", "emit", "emit"], 
values = [[], ["firstEvent", "function cb1(...args) { return args.join(','); }"], ["firstEvent", [1,2,3]], ["firstEvent", [3,4,6]]]
<b>è¾“å‡ºï¼š</b>[[],["subscribed"],["emitted",["1,2,3"]],["emitted",["3,4,6"]]]
<strong>è§£é‡Šï¼š</strong>æ³¨æ„ emit æ–¹æ³•åº”è¯¥èƒ½å¤Ÿæ¥å—ä¸€ä¸ªå¯é€‰çš„å‚æ•°æ•°ç»„ã€‚

const emitter = new EventEmitter();
emitter.subscribe("firstEvent, function cb1(...args) { return args.join(','); });
emitter.emit("firstEvent", [1, 2, 3]); // ["1,2,3"]
emitter.emit("firstEvent", [3, 4, 6]); // ["3,4,6"]
</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š
</b>actions = ["EventEmitter", "subscribe", "emit", "unsubscribe", "emit"], 
values = [[], ["firstEvent", "(...args) =&gt; args.join(',')"], ["firstEvent", [1,2,3]], [0], ["firstEvent", [4,5,6]]]
<b>è¾“å‡ºï¼š</b>[[],["subscribed"],["emitted",["1,2,3"]],["unsubscribed",0],["emitted",[]]]
<b>è§£é‡Šï¼š</b>
const emitter = new EventEmitter();
const sub = emitter.subscribe("firstEvent", (...args) =&gt; args.join(','));
emitter.emit("firstEvent", [1, 2, 3]); // ["1,2,3"]
sub.unsubscribe(); // undefined
emitter.emit("firstEvent", [4, 5, 6]); // [], æ²¡æœ‰è®¢é˜…è€…
</pre>

<p><strong>ç¤ºä¾‹ 4ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š
</b>actions = ["EventEmitter", "subscribe", "subscribe", "unsubscribe", "emit"], 
values = [[], ["firstEvent", "x =&gt; x + 1"], ["firstEvent", "x =&gt; x + 2"], [0], ["firstEvent", [5]]]
<b>è¾“å‡ºï¼š</b>[[],["subscribed"],["emitted",["1,2,3"]],["unsubscribed",0],["emitted",[7]]]
<b>è§£é‡Šï¼š</b>
const emitter = new EventEmitter();
const sub1 = emitter.subscribe("firstEvent", x =&gt; x + 1);
const sub2 = emitter.subscribe("firstEvent", x =&gt; x + 2);
sub1.unsubscribe(); // undefined
emitter.emit("firstEvent", [5]); // [7]</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= actions.length &lt;= 10</code></li>
	<li><code>values.length === actions.length</code></li>
	<li>æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ä¾‹å¦‚ï¼Œä½ ä¸éœ€è¦å¤„ç†å–æ¶ˆä¸€ä¸ªä¸å­˜åœ¨çš„è®¢é˜…çš„æƒ…å†µã€‚</li>
	<li>åªæœ‰ 4 ç§ä¸åŒçš„æ“ä½œï¼š<code>EventEmitter</code>ã€<code>emit</code>ã€<code>subscribe</code> å’Œ <code>unsubscribe</code>&nbsp;ã€‚ <code>EventEmitter</code> æ“ä½œæ²¡æœ‰å‚æ•°ã€‚</li>
	<li><code>emit</code> æ“ä½œæ¥æ”¶ 1 æˆ– 2 ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è§¦å‘çš„äº‹ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</li>
	<li><code>subscribe</code> æ“ä½œæ¥æ”¶ 2 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯äº‹ä»¶åï¼Œç¬¬äºŒä¸ªæ˜¯å›è°ƒå‡½æ•°ã€‚</li>
	<li><code>unsubscribe</code> æ“ä½œæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œå³ä¹‹å‰è¿›è¡Œè®¢é˜…çš„é¡ºåºï¼ˆä» 0 å¼€å§‹ï¼‰ã€‚</li>
</ul>


## è§£é¢˜æ€è·¯

1. **æ•°æ®ç»“æ„é€‰æ‹©**ï¼š

   - ä½¿ç”¨ `Map` å¯¹è±¡æ¥å­˜å‚¨äº‹ä»¶åç§°å’Œå¯¹åº”çš„å›è°ƒå‡½æ•°æ•°ç»„ã€‚`Map` æä¾›äº†é«˜æ•ˆçš„é”®å€¼å¯¹å­˜å‚¨ï¼Œä¾¿äºæ ¹æ®äº‹ä»¶åç§°å¿«é€ŸæŸ¥æ‰¾å’Œæ›´æ–°å›è°ƒå‡½æ•°ã€‚

2. **è®¢é˜…äº‹ä»¶**ï¼š

   - å®ç° `subscribe(eventName, callback)` æ–¹æ³•ï¼Œç”¨äºæ³¨å†Œäº‹ä»¶å’Œå›è°ƒå‡½æ•°ã€‚
   - æ£€æŸ¥äº‹ä»¶æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–ä¸ºä¸€ä¸ªç©ºæ•°ç»„ã€‚ç„¶åå°†å›è°ƒå‡½æ•°æ·»åŠ åˆ°äº‹ä»¶çš„å›è°ƒæ•°ç»„ä¸­ï¼Œå¹¶æ›´æ–° `Map`ã€‚
   - è¿”å›ä¸€ä¸ªåŒ…å« `unsubscribe` æ–¹æ³•çš„å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ³¨é”€äº‹ä»¶ã€‚

3. **æ³¨é”€äº‹ä»¶**ï¼š

   - åœ¨ `unsubscribe` æ–¹æ³•ä¸­ï¼Œä»äº‹ä»¶çš„å›è°ƒæ•°ç»„ä¸­ç§»é™¤æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚ä½¿ç”¨ `filter` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å›è°ƒæ•°ç»„ï¼Œå¹¶æ›´æ–° `Map` ä¸­çš„äº‹ä»¶ã€‚

4. **è§¦å‘äº‹ä»¶**ï¼š
   - å®ç° `emit(eventName, args = [])` æ–¹æ³•ï¼Œç”¨äºè§¦å‘äº‹ä»¶ã€‚
   - è·å–å¯¹åº”äº‹ä»¶çš„å›è°ƒå‡½æ•°æ•°ç»„ï¼Œå¹¶è°ƒç”¨æ¯ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼ é€’å‚æ•° `args`ã€‚ä½¿ç”¨ `map` æ–¹æ³•è¿”å›æ‰€æœ‰å›è°ƒå‡½æ•°çš„è¿”å›å€¼æ•°ç»„ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼šæ¯ä¸ªæ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(m)`ï¼Œå…¶ä¸­ `m` æ˜¯è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°æ•°é‡
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯äº‹ä»¶çš„æ•°é‡å’Œæ¯ä¸ªäº‹ä»¶çš„å›è°ƒå‡½æ•°æ•°é‡ï¼Œåœ¨ `events` ä¸­å­˜å‚¨äº†æ‰€æœ‰äº‹ä»¶åŠå…¶å›è°ƒã€‚

1. **`subscribe()` æ–¹æ³•**ï¼š

   - **æ—¶é—´å¤æ‚åº¦**ï¼š`O(1)`ï¼ˆå¹³å‡æƒ…å†µï¼‰ï¼Œæ·»åŠ å›è°ƒå‡½æ•°åˆ°æ•°ç»„çš„æ“ä½œæ˜¯å¸¸æ•°æ—¶é—´ï¼Œä½†åœ¨æœ€åæƒ…å†µä¸‹ï¼Œå¦‚æœå›è°ƒæ•°ç»„å¾ˆé•¿ï¼Œå¯èƒ½éœ€è¦ `O(m)`ï¼ˆ`m` æ˜¯è¯¥äº‹ä»¶çš„å›è°ƒæ•°é‡ï¼‰ã€‚
   - **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼ˆä¸è€ƒè™‘å›è°ƒå‡½æ•°çš„å­˜å‚¨ï¼‰ï¼Œæ¯æ¬¡è°ƒç”¨åªä½¿ç”¨å¸¸é‡ç©ºé—´æ¥å­˜å‚¨çŠ¶æ€ã€‚

2. **`unsubscribe()` æ–¹æ³•**ï¼š

   - **æ—¶é—´å¤æ‚åº¦**ï¼š`O(m)`ï¼Œå…¶ä¸­ `m` æ˜¯è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°æ•°é‡ï¼Œéœ€è¦éå†å›è°ƒæ•°ç»„æ¥æ‰¾åˆ°å¹¶ç§»é™¤æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚
   - **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œä¸éœ€è¦é¢å¤–ç©ºé—´ï¼Œåªæ˜¯ä¿®æ”¹ç°æœ‰çš„å›è°ƒæ•°ç»„ã€‚

3. **`emit()` æ–¹æ³•**ï¼š
   - **æ—¶é—´å¤æ‚åº¦**ï¼š`O(m)`ï¼Œå…¶ä¸­ `m` æ˜¯è¯¥äº‹ä»¶çš„å›è°ƒå‡½æ•°æ•°é‡ï¼Œéœ€è¦éå†æ‰€æœ‰æ³¨å†Œçš„å›è°ƒå‡½æ•°å¹¶æ‰§è¡Œå®ƒä»¬ã€‚
   - **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œåªæ˜¯åœ¨æ–¹æ³•å†…éƒ¨ä¼ é€’å‚æ•°ï¼Œä¸éœ€è¦é¢å¤–å­˜å‚¨ã€‚

## ä»£ç 

```javascript
class EventEmitter {
	constructor() {
		this.events = new Map();
	}

	/**
	 * @param {string} eventName
	 * @param {Function} callback
	 * @return {Object}
	 */
	subscribe(eventName, callback) {
		const callbacks = this.events.get(eventName) || [];
		// æ·»åŠ å›è°ƒå‡½æ•°
		callbacks.push(callback);
		this.events.set(eventName, callbacks);

		return {
			unsubscribe: () => {
				// ç§»é™¤å›è°ƒå‡½æ•°
				this.events.set(
					eventName,
					this.events.get(eventName).filter((i) => i !== callback)
				);
				return undefined;
			}
		};
	}

	/**
	 * @param {string} eventName
	 * @param {Array} args
	 * @return {Array}
	 */
	emit(eventName, args = []) {
		const callbacks = this.events.get(eventName) || [];
		// è°ƒç”¨æ¯ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼ é€’å‚æ•°
		return callbacks.map((cb) => cb(...args));
	}
}

/**
 * const emitter = new EventEmitter();
 *
 * // Subscribe to the onClick event with onClickCallback
 * function onClickCallback() { return 99 }
 * const sub = emitter.subscribe('onClick', onClickCallback);
 *
 * emitter.emit('onClick'); // [99]
 * sub.unsubscribe(); // undefined
 * emitter.emit('onClick'); // []
 */
```
