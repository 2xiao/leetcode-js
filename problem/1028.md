---
title: 1028. ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘
description: LeetCode 1028. ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘é¢˜è§£ï¼ŒRecover a Tree From Preorder Traversalï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 1028. ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘
  - ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘
  - Recover a Tree From Preorder Traversal
  - è§£é¢˜æ€è·¯
  - æ ‘
  - æ·±åº¦ä¼˜å…ˆæœç´¢
  - å­—ç¬¦ä¸²
  - äºŒå‰æ ‘
---

# 1028. ä»å…ˆåºéå†è¿˜åŸäºŒå‰æ ‘

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`äºŒå‰æ ‘`](/tag/binary-tree.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/recover-a-tree-from-preorder-traversal) [`LeetCode`](https://leetcode.com/problems/recover-a-tree-from-preorder-traversal)

## é¢˜ç›®

We run a preorder depth-first search (DFS) on the `root` of a binary tree.

At each node in this traversal, we output `D` dashes (where `D` is the depth
of this node), then we output the value of this node. If the depth of a node
is `D`, the depth of its immediate child is `D + 1`. The depth of the `root`
node is `0`.

If a node has only one child, that child is guaranteed to be **the left
child**.

Given the output `traversal` of this traversal, recover the tree and return
_its_ `root`.

**Example 1:**

![](https://assets.leetcode.com/uploads/2024/09/10/recover_tree_ex1.png)

> Input: traversal = "1-2--3--4-5--6--7"
>
> Output: [1,2,5,3,4,6,7]

**Example 2:**

![](https://assets.leetcode.com/uploads/2024/09/10/recover_tree_ex2.png)

> Input: traversal = "1-2--3---4-5--6---7"
>
> Output: [1,2,5,3,null,6,null,4,null,7]

**Example 3:**

![](https://assets.leetcode.com/uploads/2024/09/10/recover_tree_ex3.png)

> Input: traversal = "1-401--349---90--88"
>
> Output: [1,401,null,349,88,90]

**Constraints:**

- The number of nodes in the original tree is in the range `[1, 1000]`.
- `1 <= Node.val <= 10^9`

## é¢˜ç›®å¤§æ„

æˆ‘ä»¬ä»äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ `root` å¼€å§‹è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ã€‚

åœ¨éå†ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¤„ï¼Œæˆ‘ä»¬è¾“å‡º `D` æ¡çŸ­åˆ’çº¿ï¼ˆå…¶ä¸­ `D` æ˜¯è¯¥èŠ‚ç‚¹çš„æ·±åº¦ï¼‰ï¼Œç„¶åè¾“å‡ºè¯¥èŠ‚ç‚¹çš„å€¼ã€‚ï¼ˆ _å¦‚æœèŠ‚ç‚¹çš„æ·±åº¦ä¸º`D`ï¼Œåˆ™å…¶ç›´æ¥å­èŠ‚ç‚¹çš„æ·±åº¦ä¸º
`D + 1`ã€‚æ ¹èŠ‚ç‚¹çš„æ·±åº¦ä¸º `0`ï¼‰ã€‚_

å¦‚æœèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¿è¯è¯¥å­èŠ‚ç‚¹ä¸ºå·¦å­èŠ‚ç‚¹ã€‚

ç»™å‡ºéå†è¾“å‡º `S`ï¼Œè¿˜åŸæ ‘å¹¶è¿”å›å…¶æ ¹èŠ‚ç‚¹ `root`ã€‚

**ç¤ºä¾‹ 1ï¼š**

**![](https://assets.leetcode-cn.com/aliyun-lc-
upload/uploads/2019/04/12/recover-a-tree-from-preorder-traversal.png)**

> **è¾“å…¥ï¼š** "1-2--3--4-5--6--7"
>
> **è¾“å‡ºï¼š**[1,2,5,3,4,6,7]

**ç¤ºä¾‹ 2ï¼š**

**![](https://assets.leetcode-cn.com/aliyun-lc-
upload/uploads/2019/04/12/screen-shot-2019-04-10-at-114101-pm.png)**

> **è¾“å…¥ï¼š** "1-2--3---4-5--6---7"
>
> **è¾“å‡ºï¼š**[1,2,5,3,null,6,null,4,null,7]

**ç¤ºä¾‹ 3ï¼š**

![](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/04/12/screen-
shot-2019-04-10-at-114955-pm.png)

> **è¾“å…¥ï¼š** "1-401--349---90--88"
>
> **è¾“å‡ºï¼š**[1,401,null,349,88,90]

**æç¤ºï¼š**

- åŸå§‹æ ‘ä¸­çš„èŠ‚ç‚¹æ•°ä»‹äº `1` å’Œ `1000` ä¹‹é—´ã€‚
- æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ä»‹äº `1` å’Œ `10 ^ 9` ä¹‹é—´ã€‚

## è§£é¢˜æ€è·¯

1. **è§£æ `traversal` å­—ç¬¦ä¸²**

   - `traversal` ç”± `-` å’Œæ•°å­—ç»„æˆï¼Œå…¶ä¸­ `-` çš„æ•°é‡è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„æ·±åº¦ï¼Œæ•°å­—è¡¨ç¤ºèŠ‚ç‚¹çš„å€¼ã€‚
   - ä¾æ¬¡éå† `traversal`ï¼Œè§£ææ¯ä¸ªèŠ‚ç‚¹çš„ **æ·±åº¦** å’Œ **å€¼**ã€‚

2. **ä½¿ç”¨æ ˆæ¥ç»´æŠ¤æ ‘çš„æ„é€ **

   - **æ ˆ `stack`** ç»´æŠ¤å½“å‰è·¯å¾„ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œ`stack[i]` ä»£è¡¨æ·±åº¦ä¸º `i` çš„èŠ‚ç‚¹ã€‚
   - **é‡åˆ°æ–°çš„èŠ‚ç‚¹æ—¶**ï¼š
     - å…ˆè®¡ç®— `depth`ï¼ˆè¿ç»­ `-` çš„ä¸ªæ•°ï¼‰ã€‚
     - è§£æ `num`ï¼ˆè¿ç»­æ•°å­—ç»„æˆçš„å€¼ï¼‰ã€‚
     - æ ¹æ® `depth` ç¡®å®šå…¶çˆ¶èŠ‚ç‚¹ï¼Œå¹¶åŠ å…¥åˆ°å¯¹åº”çš„ `left` æˆ– `right` ä½ç½®ã€‚

3. **æ„é€ æ ‘**
   - å½“ `stack.length > depth` æ—¶ï¼Œè¯´æ˜å½“å‰èŠ‚ç‚¹çš„æ·±åº¦æ¯”æ ˆé¡¶å°æˆ–ç›¸ç­‰ï¼Œéœ€è¦å›æº¯åˆ°æ­£ç¡®çš„çˆ¶èŠ‚ç‚¹ï¼ˆå³ `stack[depth - 1]`ï¼‰ã€‚
   - å°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ° `stack[depth - 1]` çš„ `left` æˆ– `right` å­èŠ‚ç‚¹ã€‚
   - æœ€åå°†æ–°èŠ‚ç‚¹å…¥æ ˆã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œæ¯ä¸ªå­—ç¬¦åªä¼šè¢«éå†ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œæœ€åæƒ…å†µä¸‹æ ˆå­˜å‚¨ `n` ä¸ªèŠ‚ç‚¹ã€‚

## ä»£ç 

```javascript
/**
 * @param {string} traversal
 * @return {TreeNode}
 */
var recoverFromPreorder = function (traversal) {
	const n = traversal.length;
	let stack = [];
	let i = 0;

	while (i < n) {
		let depth = 0;
		while (i < n && traversal[i] === '-') {
			depth++;
			i++;
		}

		let num = 0;
		while (i < n && traversal[i] >= '0' && traversal[i] <= '9') {
			num = num * 10 + Number(traversal[i++]);
		}

		let node = new TreeNode(num);

		while (stack.length > depth) {
			stack.pop();
		}

		if (stack.length > 0) {
			if (!stack[stack.length - 1].left) {
				stack[stack.length - 1].left = node;
			} else {
				stack[stack.length - 1].right = node;
			}
		}

		stack.push(node);
	}

	return stack[0];
};
```
