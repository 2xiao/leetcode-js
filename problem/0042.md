---
title: 42. æ¥é›¨æ°´
description: LeetCode,42. æ¥é›¨æ°´,æ¥é›¨æ°´,Trapping Rain Water,è§£é¢˜æ€è·¯,æ ˆ,æ•°ç»„,åŒæŒ‡é’ˆ,åŠ¨æ€è§„åˆ’,å•è°ƒæ ˆ
keywords:
  - LeetCode
  - 42. æ¥é›¨æ°´
  - æ¥é›¨æ°´
  - Trapping Rain Water
  - è§£é¢˜æ€è·¯
  - æ ˆ
  - æ•°ç»„
  - åŒæŒ‡é’ˆ
  - åŠ¨æ€è§„åˆ’
  - å•è°ƒæ ˆ
---

# 42. æ¥é›¨æ°´

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ˆ`](/tag/stack.md) [`æ•°ç»„`](/tag/array.md) [`åŒæŒ‡é’ˆ`](/tag/two-pointers.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`å•è°ƒæ ˆ`](/tag/monotonic-stack.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/trapping-rain-water) [`LeetCode`](https://leetcode.com/problems/trapping-rain-water)

## é¢˜ç›®

Given `n` non-negative integers representing an elevation map where the width
of each bar is `1`, compute how much water it can trap after raining.

**Example 1:**

![](https://assets.leetcode.com/uploads/2018/10/22/rainwatertrap.png)

> Input: height = [0,1,0,2,1,0,1,3,2,1,2,1]
>
> Output: 6
>
> Explanation: The above elevation map (black section) is represented by array [0,1,0,2,1,0,1,3,2,1,2,1]. In this case, 6 units of rain water (blue section) are being trapped.

**Example 2:**

> Input: height = [4,2,0,3,2,5]
>
> Output: 9

**Constraints:**

- `n == height.length`
- `1 <= n <= 2 * 10^4`
- `0 <= height[i] <= 10^5`

## é¢˜ç›®å¤§æ„

ç»™å®š `n` ä¸ªéè´Ÿæ•´æ•°è¡¨ç¤ºæ¯ä¸ªå®½åº¦ä¸º `1` çš„æŸ±å­çš„é«˜åº¦å›¾ï¼Œè®¡ç®—æŒ‰æ­¤æ’åˆ—çš„æŸ±å­ï¼Œä¸‹é›¨ä¹‹åèƒ½æ¥å¤šå°‘é›¨æ°´ã€‚

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šåŠ¨æ€è§„åˆ’

å¯¹äºæ¥é›¨æ°´é—®é¢˜ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æ¯ä¸ªä½ç½®ä¸Šå¯ä»¥è“„æ°´çš„é‡ï¼Œç„¶åå°†è¿™äº›è“„æ°´é‡åŠ èµ·æ¥å¾—åˆ°æœ€ç»ˆçš„ç»“æœã€‚

åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œè“„æ°´é‡å–å†³äºå½“å‰ä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦å’Œå³ä¾§æœ€å¤§é«˜åº¦ã€‚å› æ­¤å¯ä»¥è€ƒè™‘é¢„å¤„ç†æ•°ç»„ï¼Œè®¡ç®—æ¯ä¸ªä½ç½®çš„å·¦ä¾§æœ€å¤§é«˜åº¦å’Œå³ä¾§æœ€å¤§é«˜åº¦ï¼Œç„¶ååœ¨éå†æ•°ç»„æ—¶ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå€¼æ¥è®¡ç®—è“„æ°´é‡ã€‚

1. **åˆå§‹åŒ–å·¦ä¾§æœ€å¤§é«˜åº¦æ•°ç»„ `leftMax`**ï¼š

   - ä»å·¦åˆ°å³éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªä½ç½® `i`ï¼Œ`leftMax[i]` å­˜å‚¨ä½ç½® `i` å·¦ä¾§ï¼ˆåŒ…æ‹¬ä½ç½® `i`ï¼‰çš„æœ€å¤§é«˜åº¦ã€‚

2. **åˆå§‹åŒ–å³ä¾§æœ€å¤§é«˜åº¦æ•°ç»„ `rightMax`**ï¼š

   - ä»å³åˆ°å·¦éå†æ•°ç»„ï¼Œå¯¹äºæ¯ä¸ªä½ç½® `i`ï¼Œ`rightMax[i]` å­˜å‚¨ä½ç½® `i` å³ä¾§ï¼ˆåŒ…æ‹¬ä½ç½® `i`ï¼‰çš„æœ€å¤§é«˜åº¦ã€‚

3. **éå†æ•°ç»„è®¡ç®—è“„æ°´é‡**ï¼š

   - å¯¹äºæ¯ä¸ªä½ç½® `i`ï¼Œè“„æ°´é‡ç­‰äº `min(leftMax[i], rightMax[i]) - height[i]`ï¼Œå…¶ä¸­ `height[i]` æ˜¯å½“å‰ä½ç½®çš„é«˜åº¦ã€‚
   - æ³¨æ„ï¼Œå¦‚æœ `min(leftMax[i], rightMax[i]) - height[i]` å°äºç­‰äºé›¶ï¼Œåˆ™å½“å‰ä½ç½®ä¸ä¼šè“„æ°´ã€‚

4. **å°†æ‰€æœ‰ä½ç½®çš„è“„æ°´é‡ç›¸åŠ å¾—åˆ°æœ€ç»ˆç»“æœ**ã€‚

è¿™ç§æ–¹æ³•çš„å…³é”®åœ¨äºé¢„å¤„ç†å·¦ä¾§å’Œå³ä¾§æœ€å¤§é«˜åº¦æ•°ç»„ï¼Œä½¿å¾—åœ¨è®¡ç®—è“„æ°´é‡æ—¶èƒ½å¤Ÿç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªæ•°ç»„çš„å€¼ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½é‡æ–°è®¡ç®—ã€‚æ—¶é—´å¤æ‚åº¦ä¸º `O(n)` ï¼Œç©ºé—´å¤æ‚åº¦ä¸º `O(n)` ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚

---

### æ€è·¯äºŒï¼šåŒæŒ‡é’ˆ

åŠ¨æ€è§„åˆ’çš„åšæ³•ä¸­ï¼Œéœ€è¦ç»´æŠ¤ä¸¤ä¸ªæ•°ç»„ `leftMax` å’Œ `rightMax`ï¼Œå› æ­¤ç©ºé—´å¤æ‚åº¦æ˜¯ `O(n)`ã€‚æ˜¯å¦å¯ä»¥å°†ç©ºé—´å¤æ‚åº¦é™åˆ° `O(1)` ï¼Ÿ

æ³¨æ„åˆ°ä¸‹æ ‡ `i` å¤„èƒ½æ¥çš„é›¨æ°´é‡ç”± `leftMax[i]` å’Œ `rightMax[i]` ä¸­çš„æœ€å°å€¼å†³å®šã€‚ç”±äºæ•°ç»„ `leftMax` æ˜¯ä»å·¦å¾€å³è®¡ç®—ï¼Œæ•°ç»„ `rightMax` æ˜¯ä»å³å¾€å·¦è®¡ç®—ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆå’Œä¸¤ä¸ªå˜é‡ä»£æ›¿ä¸¤ä¸ªæ•°ç»„ã€‚

1. **åˆå§‹åŒ–**ï¼šå®šä¹‰ä¸¤ä¸ªæŒ‡é’ˆ `left` å’Œ `right` ï¼Œåˆ†åˆ«æŒ‡å‘æ•°ç»„çš„å¼€å¤´å’Œç»“å°¾ã€‚ä½¿ç”¨ä¸¤ä¸ªå˜é‡ `leftMax` å’Œ `rightMax` åˆ†åˆ«è®°å½•å·¦ä¾§å’Œå³ä¾§çš„æœ€å¤§é«˜åº¦ï¼Œåˆå§‹åŒ–ä¸º `0`ã€‚

2. **å¾ªç¯éå†**ï¼šåœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œæ¯”è¾ƒ `height[left]` å’Œ `height[right]` ï¼Œé€‰æ‹©è¾ƒå°çš„ä¸€æ–¹ï¼Œæ ¹æ®è¿™ä¸€æ–¹çš„é«˜åº¦æ¥æ›´æ–° `leftMax` æˆ– `rightMax` ã€‚ç„¶åï¼Œæ ¹æ®å½“å‰çš„ `leftMax` å’Œ `rightMax` è®¡ç®—å½“å‰ä½ç½®ä¸Šçš„è“„æ°´é‡ã€‚
   - å¦‚æœ `height[left] < height[right]` ï¼Œåˆ™å¿…æœ‰ `leftMax < rightMax`ï¼Œä¸‹æ ‡ `left` å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº `leftMax âˆ’ height[left]` ï¼Œå°†ä¸‹æ ‡ `left` å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† `left` åŠ  `1`ï¼ˆå³å‘å³ç§»åŠ¨ä¸€ä½ï¼‰ï¼›
   - å¦‚æœ `height[left] â‰¥ height[right]`ï¼Œåˆ™å¿…æœ‰ `leftMax â‰¥ rightMax`ï¼Œä¸‹æ ‡ `right` å¤„èƒ½æ¥çš„é›¨æ°´é‡ç­‰äº `rightMax âˆ’ height[right]`ï¼Œå°†ä¸‹æ ‡ `right` å¤„èƒ½æ¥çš„é›¨æ°´é‡åŠ åˆ°èƒ½æ¥çš„é›¨æ°´æ€»é‡ï¼Œç„¶åå°† `right` å‡ `1`ï¼ˆå³å‘å·¦ç§»åŠ¨ä¸€ä½ï¼‰ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€éå†ä¸€æ¬¡æ•°ç»„ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œå› ä¸ºåªä½¿ç”¨äº†å¸¸æ•°é¢å¤–ç©ºé—´ã€‚

## ä»£ç 

::: code-tabs

@tab åŠ¨æ€è§„åˆ’

```javascript
/**
 * @param {number[]} height
 * @return {number}
 */
var trap = function (height) {
	const n = height.length;
	// å·¦ä¾§æœ€å¤§é«˜åº¦æ•°ç»„
	let leftMax = [height[0]];
	for (let i = 1; i < n; i++) {
		leftMax[i] = Math.max(height[i], leftMax[i - 1]);
	}

	// å³ä¾§æœ€å¤§é«˜åº¦æ•°ç»„
	let rightMax = [];
	rightMax[n - 1] = height[n - 1];
	for (let i = n - 2; i >= 0; i--) {
		rightMax[i] = Math.max(height[i], rightMax[i + 1]);
	}

	// éå†æ•°ç»„è®¡ç®—è“„æ°´é‡
	let res = 0;
	for (let i = 0; i < n - 1; i++) {
		res += Math.min(leftMax[i], rightMax[i]) - height[i];
	}
	return res;
};
```

@tab åŒæŒ‡é’ˆ

```javascript
/**
 * @param {number[]} height
 * @return {number}
 */
var trap = function (height) {
	let left = 0;
	let right = height.length - 1;
	let leftMax = 0;
	let rightMax = 0;
	let res = 0;

	while (left < right) {
		if (height[left] < height[right]) {
			leftMax = Math.max(leftMax, height[left]);
			res += leftMax - height[left];
			left++;
		} else {
			rightMax = Math.max(rightMax, height[right]);
			res += rightMax - height[right];
			right--;
		}
	}
	return res;
};
```

:::

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 11 | [ç››æœ€å¤šæ°´çš„å®¹å™¨](https://leetcode.com/problems/container-with-most-water) | [[âœ“]](/problem/0011.md) |  [`è´ªå¿ƒ`](/tag/greedy.md) [`æ•°ç»„`](/tag/array.md) [`åŒæŒ‡é’ˆ`](/tag/two-pointers.md) | <font color=#ffb800>Medium</font> |
| 238 | [é™¤è‡ªèº«ä»¥å¤–æ•°ç»„çš„ä¹˜ç§¯](https://leetcode.com/problems/product-of-array-except-self) | [[âœ“]](/problem/0238.md) |  [`æ•°ç»„`](/tag/array.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md) | <font color=#ffb800>Medium</font> |
| 407 | [æ¥é›¨æ°´ II](https://leetcode.com/problems/trapping-rain-water-ii) |  |  [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) [`æ•°ç»„`](/tag/array.md) [`çŸ©é˜µ`](/tag/matrix.md) `1+` | <font color=#ff334b>Hard</font> |
| 755 | [å€’æ°´ ğŸ”’](https://leetcode.com/problems/pour-water) |  |  [`æ•°ç»„`](/tag/array.md) [`æ¨¡æ‹Ÿ`](/tag/simulation.md) | <font color=#ffb800>Medium</font> |
| 2874 | [æœ‰åºä¸‰å…ƒç»„ä¸­çš„æœ€å¤§å€¼ II](https://leetcode.com/problems/maximum-value-of-an-ordered-triplet-ii) |  |  [`æ•°ç»„`](/tag/array.md) | <font color=#ffb800>Medium</font> |