# [146. LRU ç¼“å­˜](https://leetcode.com/problems/lru-cache)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`é“¾è¡¨`](/tag/linked-list.md) [`åŒå‘é“¾è¡¨`](/tag/doubly-linked-list.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/lru-cache)

## é¢˜ç›®

<div class="title__3Vvk">è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³&nbsp; <a href="https://baike.baidu.com/item/LRU" target="_blank">LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜</a> çº¦æŸçš„æ•°æ®ç»“æ„ã€‚</div>

<div class="title__3Vvk">å®ç° <code>LRUCache</code> ç±»ï¼š</div>

<div class="original__bRMd">
<div>
<ul>
	<li><code>LRUCache(int capacity)</code> ä»¥ <strong>æ­£æ•´æ•°</strong> ä½œä¸ºå®¹é‡&nbsp;<code>capacity</code> åˆå§‹åŒ– LRU ç¼“å­˜</li>
	<li><code>int get(int key)</code> å¦‚æœå…³é”®å­— <code>key</code> å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</li>
	<li><code>void put(int key, int value)</code>&nbsp;å¦‚æœå…³é”®å­—&nbsp;<code>key</code> å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼&nbsp;<code>value</code> ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„&nbsp;<code>key-value</code> ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡&nbsp;<code>capacity</code> ï¼Œåˆ™åº”è¯¥ <strong>é€å‡º</strong> æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚</li>
</ul>

<p>å‡½æ•° <code>get</code> å’Œ <code>put</code> å¿…é¡»ä»¥ <code>O(1)</code> çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚</p>
</div>
</div>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>
<strong>è¾“å…¥</strong>
["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]
<strong>è¾“å‡º</strong>
[null, null, null, 1, null, -1, null, -1, 3, 4]

<strong>è§£é‡Š</strong>
LRUCache lRUCache = new LRUCache(2);
lRUCache.put(1, 1); // ç¼“å­˜æ˜¯ {1=1}
lRUCache.put(2, 2); // ç¼“å­˜æ˜¯ {1=1, 2=2}
lRUCache.get(1);    // è¿”å› 1
lRUCache.put(3, 3); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {1=1, 3=3}
lRUCache.get(2);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.put(4, 4); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {4=4, 3=3}
lRUCache.get(1);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.get(3);    // è¿”å› 3
lRUCache.get(4);    // è¿”å› 4
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= capacity &lt;= 3000</code></li>
	<li><code>0 &lt;= key &lt;= 10000</code></li>
	<li><code>0 &lt;= value &lt;= 10<sup>5</sup></code></li>
	<li>æœ€å¤šè°ƒç”¨ <code>2 * 10<sup>5</sup></code> æ¬¡ <code>get</code> å’Œ <code>put</code></li>
</ul>


## è§£é¢˜æ€è·¯

`LRU` æ˜¯ `Least Recently Used` çš„ç¼©å†™ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œæ˜¯ä¸€ç§å¸¸ç”¨çš„ç¼“å­˜æ·˜æ±°ç®—æ³•ï¼Œé€‰æ‹©æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚

![](../image/2-2-7.png)

å¯ä»¥ç»´æŠ¤ä¸€ä¸ªæœ‰åºå•é“¾è¡¨ï¼Œè¶Šé è¿‘é“¾è¡¨å°¾éƒ¨çš„èŠ‚ç‚¹æ˜¯è¶Šæ—©ä¹‹å‰è®¿é—®çš„ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼š

- è¦æ’å…¥ B çš„æ—¶å€™ï¼Œå‘ç°ç¼“å­˜ä¸­æœ‰ B ï¼Œè¿™æ—¶éœ€è¦æŠŠ B æ”¾åˆ°é“¾é¦–ï¼Œå› ä¸ºå®ƒè¢«ä½¿ç”¨äº†ï¼›
- è¦æ’å…¥ E çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Eï¼Œç›´æ¥æŠŠ E æ’å…¥é“¾é¦–ï¼›
- è¦æ’å…¥ F çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Fï¼Œå®¹é‡å·²æ»¡ï¼Œéœ€è¦æ·˜æ±°æ‰ A ï¼Œå› ä¸º A æœ€ä¹…æœªè¢«ä½¿ç”¨ï¼›
- è¦æ’å…¥ C çš„æ—¶å€™ï¼Œå‘ç°ç¼“å­˜ä¸­æœ‰ C ï¼Œè¿™æ—¶éœ€è¦æŠŠ C æ”¾åˆ°é“¾é¦–ï¼›
- è¦æ’å…¥ H çš„æ—¶å€™ï¼Œç¼“å­˜ä¸­æ²¡æœ‰ Hï¼Œå®¹é‡å·²æ»¡ï¼Œéœ€è¦æ·˜æ±°æ‰ D ï¼Œå› ä¸º D æœ€ä¹…æœªè¢«ä½¿ç”¨ï¼›

å¯ä»¥å‘ç°ï¼ŒLRU æ›´æ–°å’Œæ’å…¥æ–°èŠ‚ç‚¹éƒ½å‘ç”Ÿåœ¨é“¾é¦–ï¼Œåˆ é™¤æ•°æ®éƒ½å‘ç”Ÿåœ¨é“¾å°¾ã€‚

`LRUCache` ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š

- `get` å½“æœ‰ä¸€ä¸ªæ–°çš„æ•°æ®è¢«è®¿é—®æ—¶ï¼š
  - å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œéå†å¾—åˆ°è¿™ä¸ªæ•°æ®å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼Œè¿”å›æ•°æ®çš„å€¼ï¼›
  - å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆ™è¿”å› `-1`ï¼›
- `put` å¾€é“¾è¡¨é‡Œæ–°å¢æ•°æ®æ—¶ï¼š
  - å¦‚æœæ­¤æ•°æ®ä¹‹å‰å·²ç»è¢«ç¼“å­˜åœ¨é“¾è¡¨ä¸­äº†ï¼Œæ›´æ–°æ­¤æ•°æ®çš„å€¼ï¼Œå¹¶å°†å…¶ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œå†æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›
  - å¦‚æœæ­¤æ•°æ®æ²¡æœ‰åœ¨ç¼“å­˜é“¾è¡¨ä¸­ï¼Œåˆåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š
    - å¦‚æœæ­¤æ—¶ç¼“å­˜æœªæ»¡ï¼Œåˆ™å°†æ­¤èŠ‚ç‚¹ç›´æ¥æ’å…¥åˆ°é“¾è¡¨çš„å¤´éƒ¨ï¼›
    - å¦‚æœæ­¤æ—¶ç¼“å­˜å·²æ»¡ï¼Œåˆ™é“¾è¡¨å°¾èŠ‚ç‚¹åˆ é™¤ï¼Œå°†æ–°çš„æ•°æ®èŠ‚ç‚¹æ’å…¥é“¾è¡¨çš„å¤´éƒ¨ã€‚

è¿™æ ·å°±ç”¨é“¾è¡¨å®ç°äº†ä¸€ä¸ª LRU ç¼“å­˜ï¼Œå¦‚æœä½¿ç”¨å•å‘é“¾è¡¨å®ç°ï¼Œåˆ™ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ï¼Œå› ä¸ºä¸ç®¡ç¼“å­˜æœ‰æ²¡æœ‰æ»¡ï¼Œéƒ½éœ€è¦éå†ä¸€éé“¾è¡¨ã€‚

å¯ä»¥ç»§ç»­ä¼˜åŒ–è¿™ä¸ªå®ç°æ€è·¯ï¼Œæ¯”å¦‚ä½¿ç”¨åŒå‘é“¾è¡¨ï¼Œå¹¶å¼•å…¥ **å“ˆå¸Œè¡¨ï¼ˆHash tableï¼‰** æ¥è®°å½•æ¯ä¸ªæ•°æ®çš„ä½ç½®ï¼Œå°†ç¼“å­˜è®¿é—®çš„æ—¶é—´å¤æ‚åº¦é™åˆ° `O(1)`ã€‚

## ä»£ç 

```javascript
class Node {
	// @param {number} key
	// @param {number} value
	constructor(key, value) {
		this.key = key;
		this.value = value;
		this.next = null;
		this.prev = null;
	}
}

class LRUCache {
	// @param {number} capacity
	constructor(capacity) {
		this.cap = capacity;
		this.cache = new Map();
		this.head = new Node(0, 0);
		this.tail = new Node(0, 0);
		this.head.next = this.tail;
		this.tail.prev = this.head;
	}

	// @param {number} key
	// @return {number}
	get(key) {
		if (this.cache.has(key)) {
			this.remove(this.cache.get(key));
			this.insert(this.cache.get(key));
			return this.cache.get(key).value;
		}
		return -1;
	}

	// @param {Node} node
	remove(node) {
		const prev = node.prev;
		const next = node.next;
		prev.next = next;
		next.prev = prev;
	}

	// @param {Node} node
	insert(node) {
		const next = this.head.next;
		this.head.next = node;
		next.prev = node;
		node.prev = this.head;
		node.next = next;
	}

	// @param {number} key
	// @param {number} value
	// @return {void}
	put(key, value) {
		if (this.cache.has(key)) {
			this.remove(this.cache.get(key));
		}
		this.cache.set(key, new Node(key, value));
		this.insert(this.cache.get(key));
		if (this.cache.size > this.cap) {
			const old = this.tail.prev;
			this.remove(old);
			this.cache.delete(old.key);
		}
	}
}

/**
 * Your LRUCache object will be instantiated and called as such:
 * var obj = new LRUCache(capacity)
 * var param_1 = obj.get(key)
 * obj.put(key,value)
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 460 | [LFU ç¼“å­˜](https://leetcode.com/problems/lfu-cache) |  |  [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`é“¾è¡¨`](/tag/linked-list.md) `1+` | <font color=#ff334b>Hard</font> |
| 588 | [è®¾è®¡å†…å­˜æ–‡ä»¶ç³»ç»Ÿ](https://leetcode.com/problems/design-in-memory-file-system) |  |  [`è®¾è®¡`](/tag/design.md) [`å­—å…¸æ ‘`](/tag/trie.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) `2+` | <font color=#ff334b>Hard</font> |
| 604 | [è¿­ä»£å‹ç¼©å­—ç¬¦ä¸²](https://leetcode.com/problems/design-compressed-string-iterator) |  |  [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å­—ç¬¦ä¸²`](/tag/string.md) `1+` | <font color=#15bd66>Easy</font> |
| 1756 | [è®¾è®¡æœ€è¿‘ä½¿ç”¨ï¼ˆMRUï¼‰é˜Ÿåˆ—](https://leetcode.com/problems/design-most-recently-used-queue) |  |  [`æ ˆ`](/tag/stack.md) [`è®¾è®¡`](/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/tag/binary-indexed-tree.md) `3+` | <font color=#ffb800>Medium</font> |