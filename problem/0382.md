# [382. é“¾è¡¨éšæœºèŠ‚ç‚¹](https://leetcode.com/problems/linked-list-random-node)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ°´å¡˜æŠ½æ ·`](/tag/reservoir-sampling.md) [`é“¾è¡¨`](/tag/linked-list.md) [`æ•°å­¦`](/tag/math.md) [`éšæœºåŒ–`](/tag/randomized.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/linked-list-random-node)

## é¢˜ç›®

<p>ç»™ä½ ä¸€ä¸ªå•é“¾è¡¨ï¼Œéšæœºé€‰æ‹©é“¾è¡¨çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¿”å›ç›¸åº”çš„èŠ‚ç‚¹å€¼ã€‚æ¯ä¸ªèŠ‚ç‚¹<strong> è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸€æ ·</strong> ã€‚</p>

<p>å®ç° <code>Solution</code> ç±»ï¼š</p>

<ul>
	<li><code>Solution(ListNode head)</code> ä½¿ç”¨æ•´æ•°æ•°ç»„åˆå§‹åŒ–å¯¹è±¡ã€‚</li>
	<li><code>int getRandom()</code> ä»é“¾è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹å¹¶è¿”å›è¯¥èŠ‚ç‚¹çš„å€¼ã€‚é“¾è¡¨ä¸­æ‰€æœ‰èŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡ç›¸ç­‰ã€‚</li>
</ul>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2021/03/16/getrand-linked-list.jpg" style="width: 302px; height: 62px;" />
<pre>
<strong>è¾“å…¥</strong>
["Solution", "getRandom", "getRandom", "getRandom", "getRandom", "getRandom"]
[[[1, 2, 3]], [], [], [], [], []]
<strong>è¾“å‡º</strong>
[null, 1, 3, 2, 2, 3]

<strong>è§£é‡Š</strong>
Solution solution = new Solution([1, 2, 3]);
solution.getRandom(); // è¿”å› 1
solution.getRandom(); // è¿”å› 3
solution.getRandom(); // è¿”å› 2
solution.getRandom(); // è¿”å› 2
solution.getRandom(); // è¿”å› 3
// getRandom() æ–¹æ³•åº”éšæœºè¿”å› 1ã€2ã€3ä¸­çš„ä¸€ä¸ªï¼Œæ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡ç›¸ç­‰ã€‚</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li>é“¾è¡¨ä¸­çš„èŠ‚ç‚¹æ•°åœ¨èŒƒå›´ <code>[1, 10<sup>4</sup>]</code> å†…</li>
	<li><code>-10<sup>4</sup> &lt;= Node.val &lt;= 10<sup>4</sup></code></li>
	<li>è‡³å¤šè°ƒç”¨&nbsp;<code>getRandom</code> æ–¹æ³• <code>10<sup>4</sup></code> æ¬¡</li>
</ul>

<p>&nbsp;</p>

<p><strong>è¿›é˜¶ï¼š</strong></p>

<ul>
	<li>å¦‚æœé“¾è¡¨éå¸¸å¤§ä¸”é•¿åº¦æœªçŸ¥ï¼Œè¯¥æ€ä¹ˆå¤„ç†ï¼Ÿ</li>
	<li>ä½ èƒ½å¦åœ¨ä¸ä½¿ç”¨é¢å¤–ç©ºé—´çš„æƒ…å†µä¸‹è§£å†³æ­¤é—®é¢˜ï¼Ÿ</li>
</ul>


## è§£é¢˜æ€è·¯

è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°æ°´å¡˜æŠ½æ ·ç®—æ³•ï¼Œç›®æ ‡æ˜¯ä»æœªçŸ¥é•¿åº¦çš„é“¾è¡¨ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ°´å¡˜æŠ½æ ·ç®—æ³•å…è®¸åœ¨éå†æ•°æ®æµçš„è¿‡ç¨‹ä¸­ï¼Œä»¥ç­‰æ¦‚ç‡æŠ½æ ·å…¶ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚

1. åˆå§‹åŒ–æ°´å¡˜ `result` ï¼Œwhile å¾ªç¯éå†é“¾è¡¨ã€‚
2. ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œä»¥é€’å¢çš„æ¦‚ç‡é€‰æ‹©èŠ‚ç‚¹çš„å€¼ï¼š
   - å¯¹äºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»¥ 1/1 çš„æ¦‚ç‡é€‰æ‹©è¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå³ `Math.floor(Math.random() * 1) === 0`ã€‚
   - å¯¹äºç¬¬äºŒä¸ªèŠ‚ç‚¹ï¼Œä»¥ 1/2 çš„æ¦‚ç‡é€‰æ‹©è¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå³ `Math.floor(Math.random() * 2) === 0`ã€‚
   - å¯¹äºç¬¬ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä»¥ 1/3 çš„æ¦‚ç‡é€‰æ‹©è¯¥èŠ‚ç‚¹çš„å€¼ï¼Œå³ `Math.floor(Math.random() * 3) === 0`ã€‚
   - ä»¥æ­¤ç±»æ¨ï¼Œå¯¹äºç¬¬ k ä¸ªèŠ‚ç‚¹ï¼Œä»¥ 1/k çš„æ¦‚ç‡é€‰æ‹©è¯¥èŠ‚ç‚¹çš„å€¼ã€‚
3. æœ€ç»ˆè¿”å›æ°´å¡˜ä¸­éšæœºé€‰æ‹©çš„èŠ‚ç‚¹çš„å€¼ã€‚

è¿™ä¸ªç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä¿æŒæ°´å¡˜ `result` ä¸­çš„å…ƒç´ ï¼Œä»¥ç›¸åŒçš„æ¦‚ç‡æ¥æ›¿æ¢ä¸ºæ–°é‡åˆ°çš„èŠ‚ç‚¹å€¼ã€‚è¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸­çš„æ¦‚ç‡éƒ½æ˜¯ `1/n`ï¼Œå…¶ä¸­ `n` æ˜¯èŠ‚ç‚¹çš„åºå·ã€‚æœ€ç»ˆåœ¨æ•´ä¸ªéå†è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰ç›¸åŒçš„è¢«é€‰ä¸­çš„æ¦‚ç‡ã€‚è¿™æ ·å®ç°äº†åœ¨æœªçŸ¥é•¿åº¦é“¾è¡¨ä¸­éšæœºé€‰æ‹©èŠ‚ç‚¹çš„ç›®æ ‡ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(N + M)`ï¼Œå…¶ä¸­ `n` æ˜¯é“¾è¡¨çš„èŠ‚ç‚¹æ•°ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ã€‚

## ä»£ç 

```javascript
/**
 * @param {ListNode} head
 */
var Solution = function (head) {
	this.head = head;
};

/**
 * @return {number}
 */
Solution.prototype.getRandom = function () {
	let result;
	let node = this.head;
	let count = 0;
	// while å¾ªç¯éå†é“¾è¡¨
	while (node) {
		count++;
		// ç”Ÿæˆä¸€ä¸ª [0, count) ä¹‹é—´çš„æ•´æ•°
		// è¿™ä¸ªæ•´æ•°ç­‰äº 0 çš„æ¦‚ç‡å°±æ˜¯ 1/count
		if (Math.floor(Math.random() * count) == 0) {
			result = node.val;
		}
		node = node.next;
	}
	return result;
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 398 | [éšæœºæ•°ç´¢å¼•](https://leetcode.com/problems/random-pick-index) |  |  [`æ°´å¡˜æŠ½æ ·`](/tag/reservoir-sampling.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°å­¦`](/tag/math.md) `1+` | <font color=#ffb800>Medium</font> |