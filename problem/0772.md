# [772. åŸºæœ¬è®¡ç®—å™¨ III](https://leetcode.com/problems/basic-calculator-iii)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/basic-calculator-iii)

## é¢˜ç›®

Implement a basic calculator to evaluate a simple expression string.

The expression string contains only non-negative integers, `'+'`, `'-'`, `'*'`, `'/'` operators, and open `'('` and closing parentheses `')'`. The integer division should **truncate toward zero**.

You may assume that the given expression is always valid. All intermediate results will be in the range of `[-2^31, 2^31 - 1]`.

calculator to evaluate it, and return _the result of the evaluation_.

**Note:** You are **not** allowed to use any built-in function which evaluates
strings as mathematical expressions, such as `eval()`.

**Example 1:**

> Input: s = "1+1"
>
> Output: 2

**Example 2:**

> Input: s = "6-4/2"
>
> Output: 4

**Example 3:**

> Input: s = "2*(5+5*2)/3+(6/2+8)"
>
> Output: 21

**Constraints:**

- `1 <= s <= 10^4`
- `s` consists of digits, `'+'`, `'-'`, `'*'`, `'/'`, `'('` and `')'`.
- `s` represents a valid expression.

## é¢˜ç›®å¤§æ„

å®ç°ä¸€ä¸ªåŸºæœ¬çš„è®¡ç®—å™¨æ¥è®¡ç®—ç®€å•çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ã€‚

è¡¨è¾¾å¼å­—ç¬¦ä¸²åªåŒ…å«éè´Ÿæ•´æ•°ï¼Œç®—ç¬¦ `'+'`ã€`'-'`ã€`'*'`ã€`'/'`ã€å·¦æ‹¬å· `'('` å’Œå³æ‹¬å·`'ï¼‰'` ã€‚æ•´æ•°é™¤æ³•éœ€è¦ **å‘ä¸‹æˆªæ–­** ã€‚

ä½ å¯ä»¥å‡å®šç»™å®šçš„è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€æœ‰çš„ä¸­é—´ç»“æœçš„èŒƒå›´å‡æ»¡è¶³ `[-2^31, 2^31 - 1]` ã€‚

**æ³¨æ„**ï¼šä½ ä¸èƒ½ä½¿ç”¨ä»»ä½•å°†å­—ç¬¦ä¸²ä½œä¸ºè¡¨è¾¾å¼æ±‚å€¼çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ `eval()` ã€‚

## è§£é¢˜æ€è·¯

è¿™ä¸ªé—®é¢˜ä¸å››åˆ™è¿ç®—ç±»ä¼¼ï¼Œæ¶‰åŠæ“ä½œç¬¦ä¼˜å…ˆçº§å¤„ç†å’Œæ‹¬å·è¡¨è¾¾å¼çš„é€’å½’è®¡ç®—ã€‚å¯ä»¥ä½¿ç”¨ **æ ˆ (stack)** æ¥å¸®åŠ©å¤„ç†è¡¨è¾¾å¼ï¼Œå¹¶ä½¿ç”¨ **é€’å½’** æ¥å¤„ç†æ‹¬å·ä¸­çš„å­è¡¨è¾¾å¼ã€‚

1.  å®šä¹‰ä¸€ä¸ªé€’å½’å‡½æ•° `helper` ç”¨äºé€’å½’åœ°éå†å­—ç¬¦ä¸²ï¼Œ`isDigit` è¾…åŠ©å‡½æ•°ç”¨äºåˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—ã€‚
2.  åœ¨é€’å½’å‡½æ•° `helper` ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæ ˆ å­˜å‚¨æ“ä½œæ•°ã€‚
3.  éå†è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼š
    - é‡åˆ°æ•°å­—æ—¶ï¼Œè®¡ç®—æ•´ä¸ªæ•°å­—ï¼ˆå¯èƒ½æœ‰å¤šä½ï¼‰ã€‚
    - é‡åˆ° `+`, `-` æ—¶ï¼Œä½ä¼˜å…ˆçº§ï¼Œæ”¾å…¥æ ˆä¸­ï¼Œç­‰å…¶ä»–ä¼˜å…ˆçº§é«˜çš„è¿ç®—å¤„ç†å®Œå†åšåŠ å‡æ³•ã€‚
    - é‡åˆ° `*`, `/` æ—¶ï¼Œé«˜ä¼˜å…ˆçº§ï¼Œéœ€è¦ç«‹å³è®¡ç®—ï¼Œå¹¶å°†ç»“æœæ›´æ–°åˆ°æ ˆä¸­ã€‚
    - é‡åˆ°å·¦æ‹¬å· `(` æ—¶ï¼Œé€’å½’è®¡ç®—æ‹¬å·å†…çš„è¡¨è¾¾å¼ï¼Œè¿™æ ·å¯ä»¥ä¼˜å…ˆè®¡ç®—åµŒå¥—çš„è¡¨è¾¾å¼ã€‚
    - é‡åˆ°å³æ‹¬å· `)` æ—¶ï¼Œè·³å‡ºå¾ªç¯ï¼Œè¿”å›å½“å‰å­è¡¨è¾¾å¼çš„ç»“æœã€‚
4.  æœ€åå°†æ ˆä¸­çš„æ‰€æœ‰æ•°å­—æ±‚å’Œï¼ˆå› ä¸ºä¹˜é™¤æ³•å·²ç»å¤„ç†äº†ï¼Œåªå‰©ä¸‹åŠ å‡æ³•ï¼‰ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚æ¯ä¸ªå­—ç¬¦åœ¨éå†è¿‡ç¨‹ä¸­ä¼šè¢«å¤„ç†ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œä¸»è¦æ˜¯æ ˆçš„æ·±åº¦ç”¨äºå­˜å‚¨æ‹¬å·å†…çš„ä¸­é—´ç»“æœã€‚

## ä»£ç 

```javascript
/**
 * @param {string} s
 * @return {number}
 */
var calculate = function (s) {
	let i = 0;

	const helper = () => {
		let stack = [];
		let num = 0;
		let sign = '+';

		while (i < s.length) {
			let char = s[i];

			if (isDigit(char)) {
				num = num * 10 + parseInt(char); // è®¡ç®—å®Œæ•´çš„æ•°å­—
			}

			if (char === '(') {
				i++; // è·³è¿‡ '('
				num = helper(); // é€’å½’è®¡ç®—æ‹¬å·å†…çš„è¡¨è¾¾å¼
			}

			if ((!isDigit(char) && char !== ' ') || i === s.length - 1) {
				if (sign === '+') {
					stack.push(num);
				} else if (sign === '-') {
					stack.push(-num);
				} else if (sign === '*') {
					stack.push(stack.pop() * num);
				} else if (sign === '/') {
					stack.push(Math.trunc(stack.pop() / num));
				}
				sign = char; // æ›´æ–°å½“å‰ç¬¦å·
				num = 0; // é‡ç½® num
			}

			if (char === ')') {
				break; // ç»“æŸå½“å‰æ‹¬å·çš„è®¡ç®—
			}

			i++;
		}

		return stack.reduce((a, b) => a + b, 0); // è¿”å›å½“å‰æ ˆä¸­æ•°å­—çš„æ€»å’Œ
	};

	return helper();
};

// è¾…åŠ©å‡½æ•°ï¼šåˆ¤æ–­å­—ç¬¦æ˜¯å¦ä¸ºæ•°å­—
const isDigit = (char) => {
	return char >= '0' && char <= '9';
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 224 | [åŸºæœ¬è®¡ç®—å™¨](https://leetcode.com/problems/basic-calculator) | [[âœ“]](/problem/0224.md) |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) `1+` | <font color=#ff334b>Hard</font> |
| 227 | [åŸºæœ¬è®¡ç®—å™¨ II](https://leetcode.com/problems/basic-calculator-ii) | [[âœ“]](/problem/0227.md) |  [`æ ˆ`](/tag/stack.md) [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md) | <font color=#ffb800>Medium</font> |
| 770 | [åŸºæœ¬è®¡ç®—å™¨ IV](https://leetcode.com/problems/basic-calculator-iv) |  |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) `2+` | <font color=#ff334b>Hard</font> |
| 1597 | [æ ¹æ®ä¸­ç¼€è¡¨è¾¾å¼æ„é€ äºŒå‰è¡¨è¾¾å¼æ ‘](https://leetcode.com/problems/build-binary-expression-tree-from-infix-expression) |  |  [`æ ˆ`](/tag/stack.md) [`æ ‘`](/tag/tree.md) [`å­—ç¬¦ä¸²`](/tag/string.md) `1+` | <font color=#ff334b>Hard</font> |