# [2721. å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥å‡½æ•°](https://2xiao.github.io/leetcode-js/problem/2721.html)

ðŸŸ  <font color=#ffb800>Medium</font>&emsp; ðŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/execute-asynchronous-functions-in-parallel) [`LeetCode`](https://leetcode.com/problems/execute-asynchronous-functions-in-parallel)

## é¢˜ç›®

Given an array of asynchronous functions `functions`, return a new promise
`promise`. Each function in the array accepts no arguments and returns a
promise. All the promises should be executed in parallel.

`promise` resolves:

- When all the promises returned from `functions` were resolved successfully in parallel. The resolved value of `promise` should be an array of all the resolved values of promises in the same order as they were in the `functions`. The `promise` should resolve when all the asynchronous functions in the array have completed execution in parallel.

`promise` rejects:

- When any of the promises returned from `functions` were rejected. `promise` should also reject with the reason of the first rejection.

Please solve it without using the built-in `Promise.all` function.

**Example 1:**

> Input: functions = [
>
> () => new Promise(resolve => setTimeout(() => resolve(5), 200))
>
> ]
>
> Output: {"t": 200, "resolved": [5]}
>
> Explanation:
>
> promiseAll(functions).then(console.log); // [5]
>
> The single function was resolved at 200ms with a value of 5.

**Example 2:**

> Input: functions = [
>
> > () => new Promise(resolve => setTimeout(() => resolve(1), 200)),
>
> > () => new Promise((resolve, reject) => setTimeout(() => reject("Error"), 100))
>
> ]
>
> Output: {"t": 100, "rejected": "Error"}
>
> Explanation: Since one of the promises rejected, the returned promise also rejected with the same error at the same time.

**Example 3:**

> Input: functions = [
>
> > () => new Promise(resolve => setTimeout(() => resolve(4), 50)),
>
> > () => new Promise(resolve => setTimeout(() => resolve(10), 150)),
>
> > () => new Promise(resolve => setTimeout(() => resolve(16), 100))
>
> ]
>
> Output: {"t": 150, "resolved": [4, 10, 16]}
>
> Explanation: All the promises resolved with a value. The returned promise resolved when the last promise resolved.

**Constraints:**

- `functions` is an array of functions that returns promises
- `1 <= functions.length <= 10`

## é¢˜ç›®å¤§æ„

ç»™å®šä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ•°ç»„ `functions`ï¼Œè¿”å›žä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ `promise`ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½ä¸æŽ¥å—å‚æ•°å¹¶è¿”å›žä¸€ä¸ª
promiseã€‚æ‰€æœ‰çš„ promise éƒ½åº”è¯¥å¹¶è¡Œæ‰§è¡Œã€‚

`promise` resolve æ¡ä»¶ï¼š

- å½“æ‰€æœ‰ä»Ž `functions` è¿”å›žçš„ promise éƒ½æˆåŠŸçš„å¹¶è¡Œè§£æžæ—¶ã€‚`promise` çš„è§£æžå€¼åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‰ç…§å®ƒä»¬åœ¨ `functions` ä¸­çš„é¡ºåºæŽ’åˆ—çš„ promise çš„è§£æžå€¼æ•°ç»„ã€‚`promise` åº”è¯¥åœ¨æ•°ç»„ä¸­çš„æ‰€æœ‰å¼‚æ­¥å‡½æ•°å¹¶è¡Œæ‰§è¡Œå®Œæˆæ—¶è§£æžã€‚

`promise` reject æ¡ä»¶ï¼š

- å½“ä»»ä½•ä»Ž `functions` è¿”å›žçš„ promise è¢«æ‹’ç»æ—¶ã€‚`promise` ä¹Ÿä¼šè¢«æ‹’ç»ï¼Œå¹¶è¿”å›žç¬¬ä¸€ä¸ªæ‹’ç»çš„åŽŸå› ã€‚

è¯·åœ¨ä¸ä½¿ç”¨å†…ç½®çš„ `Promise.all` å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³ã€‚

**æç¤ºï¼š**

- å‡½æ•° `functions` æ˜¯ä¸€ä¸ªè¿”å›ž promise çš„å‡½æ•°æ•°ç»„
- `1 <= functions.length <= 10`

## è§£é¢˜æ€è·¯

ä¸ºäº†å¹¶è¡Œæ‰§è¡Œæ•°ç»„ä¸­çš„å¼‚æ­¥å‡½æ•°å¹¶è¿”å›žä¸€ä¸ª `Promise`ï¼Œéœ€è¦æ‰‹åŠ¨å®žçŽ° `Promise.all` çš„åŠŸèƒ½ã€‚`Promise.all` çš„è¡Œä¸ºæ˜¯å½“æ•°ç»„ä¸­çš„æ‰€æœ‰ `Promise` éƒ½æˆåŠŸæ—¶ï¼Œè¿”å›žæ‰€æœ‰çš„ç»“æžœï¼›å¦‚æžœæœ‰ä»»ä½• `Promise` å¤±è´¥ï¼Œåˆ™ç«‹å³æ‹’ç»ã€‚

1. **åˆ›å»ºä¸€ä¸ªæ–°çš„ `Promise`**ï¼šè¯¥ Promise å°†åœ¨æ‰€æœ‰å¼‚æ­¥å‡½æ•°éƒ½æˆåŠŸæ—¶è§£æžï¼Œæˆ–åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªè¢«æ‹’ç»æ—¶æ‹’ç»ã€‚
2. **åˆ›å»ºä¸€ä¸ªç»“æžœæ•°ç»„**ï¼Œç”¨äºŽä¿å­˜æ¯ä¸ªå‡½æ•°çš„ç»“æžœï¼Œä»¥ç¡®ä¿æœ€ç»ˆçš„ç»“æžœé¡ºåºä¸Žè¾“å…¥é¡ºåºä¸€è‡´ã€‚
3. **æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨**ï¼Œç”¨äºŽè·Ÿè¸ªå·²å®Œæˆçš„ Promise æ•°é‡ã€‚
4. **éåŽ† `functions` æ•°ç»„**ï¼šå¯¹äºŽæ¯ä¸ªå‡½æ•°ï¼Œæ‰‹åŠ¨æ‰§è¡Œå®ƒå¹¶å¯¹å…¶è¿”å›žçš„ Promise è¿›è¡Œå¤„ç†ã€‚

   - è‹¥æˆåŠŸï¼Œå°†å‡½æ•°çš„æˆåŠŸç»“æžœå­˜å‚¨åœ¨ `results` æ•°ç»„ä¸­ï¼Œè®¡æ•°å™¨ `count` é€’å¢žï¼Œå½“æ‰€æœ‰å‡½æ•°éƒ½æˆåŠŸæ‰§è¡Œæ—¶ï¼Œè§£æž `results` æ•°ç»„ã€‚
   - è‹¥ä»»ä½•ä¸€ä¸ªå‡½æ•°è¿”å›žçš„ Promise è¢«æ‹’ç»ï¼Œåˆ™ç«‹å³æ‹’ç»æ•´ä¸ª `Promise`ï¼Œå¹¶ä¸”æŠ›å‡ºç¬¬ä¸€ä¸ªé”™è¯¯åŽŸå› ã€‚

#### å¤æ‚åº¦åˆ†æž

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯ `functions` çš„æ•°é‡ï¼Œéœ€è¦éåŽ†æ‰€æœ‰å‡½æ•°å¹¶è§¦å‘å®ƒä»¬çš„æ‰§è¡Œã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºŽå­˜å‚¨å‡½æ•°çš„ç»“æžœã€‚

## ä»£ç 

```javascript
/**
 * @param {Array<Function>} functions
 * @return {Promise<any>}
 */
var promiseAll = function (functions) {
	return new Promise((resolve, reject) => {
		let result = [],
			count = 0;
		functions.map((fn, i) => {
			fn()
				.then((res) => {
					result[i] = res;
					count++;

					// å½“æ‰€æœ‰å‡½æ•°éƒ½æˆåŠŸè§£æžæ—¶ï¼Œè§£æžæ•´ä¸ªç»“æžœ
					if (count == functions.length) {
						resolve(result);
					}
				})
				.catch((err) => reject(err)); // ä¸€æ—¦æœ‰ä»»ä½•å‡½æ•°è¢«æ‹’ç»ï¼Œç«‹å³æ‹’ç»æ•´ä¸ª promise
		});
	});
};

/**
 * const promise = promiseAll([() => new Promise(res => res(42))])
 * promise.then(console.log); // [42]
 */
```
