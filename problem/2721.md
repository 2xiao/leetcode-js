# [2721. å¹¶è¡Œæ‰§è¡Œå¼‚æ­¥å‡½æ•°](https://leetcode.com/problems/execute-asynchronous-functions-in-parallel)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/execute-asynchronous-functions-in-parallel)

## é¢˜ç›®

<p>ç»™å®šä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ•°ç»„ <code>functions</code>ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡&nbsp;<code>promise</code>ã€‚æ•°ç»„ä¸­çš„æ¯ä¸ªå‡½æ•°éƒ½ä¸æ¥å—å‚æ•°å¹¶è¿”å›ä¸€ä¸ª promiseã€‚æ‰€æœ‰çš„ promise éƒ½åº”è¯¥å¹¶è¡Œæ‰§è¡Œã€‚</p>

<p><code>promise</code> resolve æ¡ä»¶ï¼š</p>

<ul>
	<li>å½“æ‰€æœ‰ä» <code>functions</code> è¿”å›çš„ promise éƒ½æˆåŠŸçš„å¹¶è¡Œè§£ææ—¶ã€‚<code>promise</code> çš„è§£æå€¼åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‰ç…§å®ƒä»¬åœ¨ <code>functions</code> ä¸­çš„é¡ºåºæ’åˆ—çš„ promise çš„è§£æå€¼æ•°ç»„ã€‚<code>promise</code> åº”è¯¥åœ¨æ•°ç»„ä¸­çš„æ‰€æœ‰å¼‚æ­¥å‡½æ•°å¹¶è¡Œæ‰§è¡Œå®Œæˆæ—¶è§£æã€‚</li>
</ul>

<p><code>promise</code>&nbsp;reject æ¡ä»¶ï¼š</p>

<ul>
	<li>å½“ä»»ä½•ä» <code>functions</code> è¿”å›çš„ promise è¢«æ‹’ç»æ—¶ã€‚<code>promise</code> ä¹Ÿä¼šè¢«æ‹’ç»ï¼Œå¹¶è¿”å›ç¬¬ä¸€ä¸ªæ‹’ç»çš„åŸå› ã€‚</li>
</ul>

<p>è¯·åœ¨ä¸ä½¿ç”¨å†…ç½®çš„ <code>Promise.all</code> å‡½æ•°çš„æƒ…å†µä¸‹è§£å†³ã€‚</p>

<p>&nbsp;</p>

<p><strong class="example">ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š</b>functions = [
&nbsp; () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve(5), 200))
]
<b>è¾“å‡ºï¼š</b>{"t": 200, "resolved": [5]}
<b>è§£é‡Šï¼š</b>
promiseAll(functions).then(console.log); // [5]

å•ä¸ªå‡½æ•°åœ¨ 200 æ¯«ç§’åä»¥å€¼ 5 æˆåŠŸè§£æã€‚
</pre>

<p><strong class="example">ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š</b>functions = [
    () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve(1), 200)), 
    () =&gt; new Promise((resolve, reject) =&gt; setTimeout(() =&gt; reject("Error"), 100))
]
<b>è¾“å‡ºï¼š</b>{"t": 100, "rejected": "Error"}
<b>è§£é‡Šï¼š</b>ç”±äºå…¶ä¸­ä¸€ä¸ª promise è¢«æ‹’ç»ï¼Œè¿”å›çš„ promise ä¹Ÿåœ¨åŒä¸€æ—¶é—´è¢«æ‹’ç»å¹¶è¿”å›ç›¸åŒçš„é”™è¯¯ã€‚
</pre>

<p><strong class="example">ç¤ºä¾‹ 3ï¼š</strong></p>

<pre>
<b>è¾“å…¥ï¼š</b>functions = [
    () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve(4), 50)), 
    () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve(10), 150)), 
    () =&gt; new Promise(resolve =&gt; setTimeout(() =&gt; resolve(16), 100))
]
<b>è¾“å‡ºï¼š</b>{"t": 150, "resolved": [4, 10, 16]}
<b>è§£é‡Šï¼š</b>æ‰€æœ‰çš„ promise éƒ½æˆåŠŸæ‰§è¡Œã€‚å½“æœ€åä¸€ä¸ª promise è¢«è§£ææ—¶ï¼Œè¿”å›çš„ promise ä¹Ÿè¢«è§£æäº†ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li>å‡½æ•° <code>functions</code> æ˜¯ä¸€ä¸ªè¿”å› promise çš„å‡½æ•°æ•°ç»„</li>
	<li><code>1 &lt;= functions.length &lt;= 10</code></li>
</ul>


## è§£é¢˜æ€è·¯

ä¸ºäº†å¹¶è¡Œæ‰§è¡Œæ•°ç»„ä¸­çš„å¼‚æ­¥å‡½æ•°å¹¶è¿”å›ä¸€ä¸ª `Promise`ï¼Œéœ€è¦æ‰‹åŠ¨å®ç° `Promise.all` çš„åŠŸèƒ½ã€‚`Promise.all` çš„è¡Œä¸ºæ˜¯å½“æ•°ç»„ä¸­çš„æ‰€æœ‰ `Promise` éƒ½æˆåŠŸæ—¶ï¼Œè¿”å›æ‰€æœ‰çš„ç»“æœï¼›å¦‚æœæœ‰ä»»ä½• `Promise` å¤±è´¥ï¼Œåˆ™ç«‹å³æ‹’ç»ã€‚

1. **åˆ›å»ºä¸€ä¸ªæ–°çš„ `Promise`**ï¼šè¯¥ Promise å°†åœ¨æ‰€æœ‰å¼‚æ­¥å‡½æ•°éƒ½æˆåŠŸæ—¶è§£æï¼Œæˆ–åœ¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªè¢«æ‹’ç»æ—¶æ‹’ç»ã€‚
2. **åˆ›å»ºä¸€ä¸ªç»“æœæ•°ç»„**ï¼Œç”¨äºä¿å­˜æ¯ä¸ªå‡½æ•°çš„ç»“æœï¼Œä»¥ç¡®ä¿æœ€ç»ˆçš„ç»“æœé¡ºåºä¸è¾“å…¥é¡ºåºä¸€è‡´ã€‚
3. **æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨**ï¼Œç”¨äºè·Ÿè¸ªå·²å®Œæˆçš„ Promise æ•°é‡ã€‚
4. **éå† `functions` æ•°ç»„**ï¼šå¯¹äºæ¯ä¸ªå‡½æ•°ï¼Œæ‰‹åŠ¨æ‰§è¡Œå®ƒå¹¶å¯¹å…¶è¿”å›çš„ Promise è¿›è¡Œå¤„ç†ã€‚

   - è‹¥æˆåŠŸï¼Œå°†å‡½æ•°çš„æˆåŠŸç»“æœå­˜å‚¨åœ¨ `results` æ•°ç»„ä¸­ï¼Œè®¡æ•°å™¨ `count` é€’å¢ï¼Œå½“æ‰€æœ‰å‡½æ•°éƒ½æˆåŠŸæ‰§è¡Œæ—¶ï¼Œè§£æ `results` æ•°ç»„ã€‚
   - è‹¥ä»»ä½•ä¸€ä¸ªå‡½æ•°è¿”å›çš„ Promise è¢«æ‹’ç»ï¼Œåˆ™ç«‹å³æ‹’ç»æ•´ä¸ª `Promise`ï¼Œå¹¶ä¸”æŠ›å‡ºç¬¬ä¸€ä¸ªé”™è¯¯åŸå› ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯ `functions` çš„æ•°é‡ï¼Œéœ€è¦éå†æ‰€æœ‰å‡½æ•°å¹¶è§¦å‘å®ƒä»¬çš„æ‰§è¡Œã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨å‡½æ•°çš„ç»“æœã€‚

## ä»£ç 

```javascript
/**
 * @param {Array<Function>} functions
 * @return {Promise<any>}
 */
var promiseAll = function (functions) {
	return new Promise((resolve, reject) => {
		let result = [],
			count = 0;
		functions.map((fn, i) => {
			fn()
				.then((res) => {
					result[i] = res;
					count++;

					// å½“æ‰€æœ‰å‡½æ•°éƒ½æˆåŠŸè§£ææ—¶ï¼Œè§£ææ•´ä¸ªç»“æœ
					if (count == functions.length) {
						resolve(result);
					}
				})
				.catch((err) => reject(err)); // ä¸€æ—¦æœ‰ä»»ä½•å‡½æ•°è¢«æ‹’ç»ï¼Œç«‹å³æ‹’ç»æ•´ä¸ª promise
		});
	});
};

/**
 * const promise = promiseAll([() => new Promise(res => res(42))])
 * promise.then(console.log); // [42]
 */
```
