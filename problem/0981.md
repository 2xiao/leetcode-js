---
title: 981. åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨
description: LeetCode 981. åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨é¢˜è§£ï¼ŒTime Based Key-Value Storeï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 981. åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨
  - åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨
  - Time Based Key-Value Store
  - è§£é¢˜æ€è·¯
  - è®¾è®¡
  - å“ˆå¸Œè¡¨
  - å­—ç¬¦ä¸²
  - äºŒåˆ†æŸ¥æ‰¾
---

# 981. åŸºäºæ—¶é—´çš„é”®å€¼å­˜å‚¨

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/time-based-key-value-store) [`LeetCode`](https://leetcode.com/problems/time-based-key-value-store)

## é¢˜ç›®

Design a time-based key-value data structure that can store multiple values
for the same key at different time stamps and retrieve the key's value at a
certain timestamp.

Implement the `TimeMap` class:

- `TimeMap()` Initializes the object of the data structure.
- `void set(String key, String value, int timestamp)` Stores the key `key` with the value `value` at the given time `timestamp`.
- `String get(String key, int timestamp)` Returns a value such that `set` was called previously, with `timestamp_prev <= timestamp`. If there are multiple such values, it returns the value associated with the largest `timestamp_prev`. If there are no values, it returns `""`.

**Example 1:**

> **Input**
>
> ["TimeMap", "set", "get", "get", "set", "get", "get"]
>
> [[], ["foo", "bar", 1], ["foo", 1], ["foo", 3], ["foo", "bar2", 4], ["foo", 4], ["foo", 5]]
>
> **Output**
>
> [null, null, "bar", "bar", null, "bar2", "bar2"]
>
> **Explanation**
>
> ```
> TimeMap timeMap = new TimeMap();
>
> timeMap.set("foo", "bar", 1);  // store the key "foo" and value "bar" along with timestamp = 1.
>
> timeMap.get("foo", 1); // return "bar"
>
> timeMap.get("foo", 3); // return "bar", since there is no value corresponding to foo at timestamp 3 and timestamp 2, then the only value is at timestamp 1 is "bar".
>
> timeMap.set("foo", "bar2", 4); // store the key "foo" and value "bar2" along with timestamp = 4.
>
> timeMap.get("foo", 4); // return "bar2"
>
> timeMap.get("foo", 5); // return "bar2"
> ```
>
> **Constraints:**

- `1 <= key.length, value.length <= 100`
- `key` and `value` consist of lowercase English letters and digits.
- `1 <= timestamp <= 10^7`
- All the timestamps `timestamp` of `set` are strictly increasing.
- At most `2 * 10^5` calls will be made to `set` and `get`.

## é¢˜ç›®å¤§æ„

è®¾è®¡ä¸€ä¸ªåŸºäºæ—¶é—´çš„é”®å€¼æ•°æ®ç»“æ„ï¼Œè¯¥ç»“æ„å¯ä»¥åœ¨ä¸åŒæ—¶é—´æˆ³å­˜å‚¨å¯¹åº”åŒä¸€ä¸ªé”®çš„å¤šä¸ªå€¼ï¼Œå¹¶é’ˆå¯¹ç‰¹å®šæ—¶é—´æˆ³æ£€ç´¢é”®å¯¹åº”çš„å€¼ã€‚

å®ç° `TimeMap` ç±»ï¼š

- `TimeMap()` åˆå§‹åŒ–æ•°æ®ç»“æ„å¯¹è±¡
- `void set(String key, String value, int timestamp)` å­˜å‚¨ç»™å®šæ—¶é—´æˆ³ `timestamp` æ—¶çš„é”® `key` å’Œå€¼ `value`ã€‚
- `String get(String key, int timestamp)` è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼åœ¨ä¹‹å‰è°ƒç”¨äº† `set`ï¼Œå…¶ä¸­ `timestamp_prev <= timestamp` ã€‚å¦‚æœæœ‰å¤šä¸ªè¿™æ ·çš„å€¼ï¼Œå®ƒå°†è¿”å›ä¸æœ€å¤§ `timestamp_prev` å…³è”çš„å€¼ã€‚å¦‚æœæ²¡æœ‰å€¼ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ï¼ˆ`""`ï¼‰ã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š**
>
> ["TimeMap", "set", "get", "get", "set", "get", "get"]
>
> [[], ["foo", "bar", 1], ["foo", 1], ["foo", 3], ["foo", "bar2", 4], ["foo", 4], ["foo", 5]]
>
> **è¾“å‡ºï¼š**
>
> [null, null, "bar", "bar", null, "bar2", "bar2"]
>
> **è§£é‡Šï¼š**
>
> ```
> TimeMap timeMap = new TimeMap();
>
> timeMap.set("foo", "bar", 1);  // å­˜å‚¨é”® "foo" å’Œå€¼ "bar" ï¼Œæ—¶é—´æˆ³ timestamp = 1
>
> timeMap.get("foo", 1); // è¿”å› "bar"
>
> timeMap.get("foo", 3); // è¿”å› "bar", å› ä¸ºåœ¨æ—¶é—´æˆ³ 3 å’Œæ—¶é—´æˆ³ 2 å¤„æ²¡æœ‰å¯¹åº” "foo" çš„å€¼ï¼Œæ‰€ä»¥å”¯ä¸€çš„å€¼ä½äºæ—¶é—´æˆ³ 1 å¤„ï¼ˆå³ "bar"ï¼‰ ã€‚
>
> timeMap.set("foo", "bar2", 4); // å­˜å‚¨é”® "foo" å’Œå€¼ "bar2" ï¼Œæ—¶é—´æˆ³ timestamp = 4
>
> timeMap.get("foo", 4); // è¿”å› "bar2"
>
> timeMap.get("foo", 5); // è¿”å› "bar2"
>
> ```

**æç¤ºï¼š**

- `1 <= key.length, value.length <= 100`
- `key` å’Œ `value` ç”±å°å†™è‹±æ–‡å­—æ¯å’Œæ•°å­—ç»„æˆ
- `1 <= timestamp <= 10^7`
- `set` æ“ä½œä¸­çš„æ—¶é—´æˆ³ `timestamp` éƒ½æ˜¯ä¸¥æ ¼é€’å¢çš„
- æœ€å¤šè°ƒç”¨ `set` å’Œ `get` æ“ä½œ `2 * 10^5` æ¬¡

## è§£é¢˜æ€è·¯

å¯ä»¥ä½¿ç”¨ **å“ˆå¸Œè¡¨ + æœ‰åºæ•°ç»„ + äºŒåˆ†æŸ¥æ‰¾** æ¥å®ç° `TimeMap` ç±»ï¼š

1. ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `store`ï¼Œé”®ä¸º `key`ï¼Œå€¼ä¸ºä¸€ä¸ªåŒ…å«æ—¶é—´æˆ³å’Œå¯¹åº”å€¼çš„æ•°ç»„ï¼ˆå³åˆ—è¡¨ä¸­çš„å…ƒç´ ä¸º `[timestamp, value]`ï¼‰ã€‚
2. æ¯æ¬¡è°ƒç”¨ `set` æ—¶ï¼š
   - å¦‚æœ `key` åœ¨å“ˆå¸Œè¡¨ä¸­ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚
   - å°† `[timestamp, value]` æŒ‰ç…§æ—¶é—´æˆ³è¿½åŠ åˆ°æ•°ç»„æœ«å°¾ï¼ˆç”±äºæ—¶é—´æˆ³æ˜¯ä¸¥æ ¼é€’å¢çš„ï¼Œæ•°ç»„å§‹ç»ˆæœ‰åºï¼‰ã€‚
3. å¯¹äº `get` æ“ä½œï¼š
   - åœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾ `key` å¯¹åº”çš„æ•°ç»„ï¼Œè‹¥ä¸å­˜åœ¨ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚
   - ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°ä¸è¶…è¿‡ç»™å®š `timestamp` çš„æœ€å¤§æ—¶é—´æˆ³ç´¢å¼•ï¼Œå¹¶è¿”å›å¯¹åº”çš„å€¼ã€‚
   - å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - **`set` æ“ä½œ**ï¼šå¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ï¼Œä»…æ’å…¥å…ƒç´ ã€‚
  - **`get` æ“ä½œ**ï¼šä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(log n)`ï¼Œå…¶ä¸­ `n` æ˜¯æ¯ä¸ªé”®å¯¹åº”æ—¶é—´æˆ³çš„ä¸ªæ•°ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(m)`ï¼Œå…¶ä¸­ `m` ä¸º `set` æ“ä½œçš„æ€»æ¬¡æ•°ï¼Œå“ˆå¸Œè¡¨å­˜å‚¨æ‰€æœ‰é”®åŠå…¶æ—¶é—´æˆ³å’Œå€¼ã€‚

## ä»£ç 

```javascript
class TimeMap {
	constructor() {
		this.store = new Map(); // å“ˆå¸Œè¡¨å­˜å‚¨ key -> [[timestamp1, value1], [timestamp2, value2], ...]
	}

	set(key, value, timestamp) {
		if (!this.store.has(key)) {
			this.store.set(key, []);
		}
		this.store.get(key).push([timestamp, value]); // è¿½åŠ åˆ°æ•°ç»„æœ«å°¾
	}

	get(key, timestamp) {
		if (!this.store.has(key)) return ''; // å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²

		const values = this.store.get(key);

		let res = '';
		let left = 0,
			right = values.length - 1;

		// äºŒåˆ†æŸ¥æ‰¾
		while (left <= right) {
			const mid = Math.floor((left + right) / 2);
			if (values[mid][0] <= timestamp) {
				res = values[mid][1];
				left = mid + 1; // ç»§ç»­å‘å³å¯»æ‰¾æ›´å¤§çš„ timestamp
			} else {
				right = mid - 1; // ç¼©å°å³è¾¹ç•Œ
			}
		}

		return res;
	}
}

/**
 * Your TimeMap object will be instantiated and called as such:
 * var obj = new TimeMap()
 * obj.set(key,value,timestamp)
 * var param_2 = obj.get(key,timestamp)
 */
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 2034 | è‚¡ç¥¨ä»·æ ¼æ³¢åŠ¨ |  |  [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°æ®æµ`](/tag/data-stream.md) `2+` | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/stock-price-fluctuation) [ğŸ”—](https://leetcode.com/problems/stock-price-fluctuation) |