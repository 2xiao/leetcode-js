# [355. è®¾è®¡æ¨ç‰¹](https://leetcode.com/problems/design-twitter)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`é“¾è¡¨`](/tag/linked-list.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/design-twitter)

## é¢˜ç›®

<p>è®¾è®¡ä¸€ä¸ªç®€åŒ–ç‰ˆçš„æ¨ç‰¹(Twitter)ï¼Œå¯ä»¥è®©ç”¨æˆ·å®ç°å‘é€æ¨æ–‡ï¼Œå…³æ³¨/å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·ï¼Œèƒ½å¤Ÿçœ‹è§å…³æ³¨äººï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰çš„æœ€è¿‘ <code>10</code> æ¡æ¨æ–‡ã€‚</p>

<p>å®ç° <code>Twitter</code> ç±»ï¼š</p>

<ul>
	<li><code>Twitter()</code> åˆå§‹åŒ–ç®€æ˜“ç‰ˆæ¨ç‰¹å¯¹è±¡</li>
	<li><code>void postTweet(int userId, int tweetId)</code> æ ¹æ®ç»™å®šçš„ <code>tweetId</code> å’Œ <code>userId</code> åˆ›å»ºä¸€æ¡æ–°æ¨æ–‡ã€‚æ¯æ¬¡è°ƒç”¨æ­¤å‡½æ•°éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ <code>tweetId</code> ã€‚</li>
	<li><code>List&lt;Integer&gt; getNewsFeed(int userId)</code> æ£€ç´¢å½“å‰ç”¨æˆ·æ–°é—»æ¨é€ä¸­æœ€è¿‘&nbsp; <code>10</code> æ¡æ¨æ–‡çš„ ID ã€‚æ–°é—»æ¨é€ä¸­çš„æ¯ä¸€é¡¹éƒ½å¿…é¡»æ˜¯ç”±ç”¨æˆ·å…³æ³¨çš„äººæˆ–è€…æ˜¯ç”¨æˆ·è‡ªå·±å‘å¸ƒçš„æ¨æ–‡ã€‚æ¨æ–‡å¿…é¡» <strong>æŒ‰ç…§æ—¶é—´é¡ºåºç”±æœ€è¿‘åˆ°æœ€è¿œæ’åº</strong> ã€‚</li>
	<li><code>void follow(int followerId, int followeeId)</code> ID ä¸º <code>followerId</code> çš„ç”¨æˆ·å¼€å§‹å…³æ³¨ ID ä¸º <code>followeeId</code> çš„ç”¨æˆ·ã€‚</li>
	<li><code>void unfollow(int followerId, int followeeId)</code> ID ä¸º <code>followerId</code> çš„ç”¨æˆ·ä¸å†å…³æ³¨ ID ä¸º <code>followeeId</code> çš„ç”¨æˆ·ã€‚</li>
</ul>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>
<strong>è¾“å…¥</strong>
["Twitter", "postTweet", "getNewsFeed", "follow", "postTweet", "getNewsFeed", "unfollow", "getNewsFeed"]
[[], [1, 5], [1], [1, 2], [2, 6], [1], [1, 2], [1]]
<strong>è¾“å‡º</strong>
[null, null, [5], null, null, [6, 5], null, [5]]

<strong>è§£é‡Š</strong>
Twitter twitter = new Twitter();
twitter.postTweet(1, 5); // ç”¨æˆ· 1 å‘é€äº†ä¸€æ¡æ–°æ¨æ–‡ (ç”¨æˆ· id = 1, æ¨æ–‡ id = 5)
twitter.getNewsFeed(1);  // ç”¨æˆ· 1 çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª id ä¸º 5 çš„æ¨æ–‡
twitter.follow(1, 2);    // ç”¨æˆ· 1 å…³æ³¨äº†ç”¨æˆ· 2
twitter.postTweet(2, 6); // ç”¨æˆ· 2 å‘é€äº†ä¸€ä¸ªæ–°æ¨æ–‡ (æ¨æ–‡ id = 6)
twitter.getNewsFeed(1);  // ç”¨æˆ· 1 çš„è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ¨æ–‡ï¼Œid åˆ†åˆ«ä¸º -&gt; [6, 5] ã€‚æ¨æ–‡ id 6 åº”å½“åœ¨æ¨æ–‡ id 5 ä¹‹å‰ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ 5 ä¹‹åå‘é€çš„
twitter.unfollow(1, 2);  // ç”¨æˆ· 1 å–æ¶ˆå…³æ³¨äº†ç”¨æˆ· 2
twitter.getNewsFeed(1);  // ç”¨æˆ· 1 è·å–æ¨æ–‡åº”å½“è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª id ä¸º 5 çš„æ¨æ–‡ã€‚å› ä¸ºç”¨æˆ· 1 å·²ç»ä¸å†å…³æ³¨ç”¨æˆ· 2</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= userId, followerId, followeeId &lt;= 500</code></li>
	<li><code>0 &lt;= tweetId &lt;= 10<sup>4</sup></code></li>
	<li>æ‰€æœ‰æ¨ç‰¹çš„ ID éƒ½äº’ä¸ç›¸åŒ</li>
	<li><code>postTweet</code>ã€<code>getNewsFeed</code>ã€<code>follow</code> å’Œ <code>unfollow</code> æ–¹æ³•æœ€å¤šè°ƒç”¨ <code>3 * 10<sup>4</sup></code> æ¬¡</li>
</ul>


## è§£é¢˜æ€è·¯

å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨å’Œä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæˆ–è€…å †ï¼‰æ¥å­˜å‚¨ç”¨æˆ·çš„æ¨æ–‡å’Œå…³æ³¨å…³ç³»ã€‚

1. å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨æ¥å­˜å‚¨ç”¨æˆ·çš„æ¨æ–‡ã€‚å“ˆå¸Œè¡¨çš„é”®æ˜¯ç”¨æˆ·çš„ IDï¼Œå€¼æ˜¯ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæˆ–è€…å †ï¼‰ï¼Œç”¨äºæŒ‰ç…§æ—¶é—´æˆ³å­˜å‚¨ç”¨æˆ·çš„æ¨æ–‡ã€‚æ¯ä¸ªæ¨æ–‡å¯ä»¥åŒ…å«æ¨æ–‡çš„ ID å’Œæ—¶é—´æˆ³ã€‚

2. å½“ç”¨æˆ·å‘å¸ƒæ¨æ–‡æ—¶ï¼Œå°†æ¨æ–‡æ·»åŠ åˆ°ç›¸åº”ç”¨æˆ·çš„ä¼˜å…ˆé˜Ÿåˆ—ä¸­ã€‚ä¸ºäº†ä¿è¯æ¨æ–‡æŒ‰ç…§æ—¶é—´é¡ºåºæ’åºï¼Œå¯ä»¥ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºæ’åºçš„ä¾æ®ã€‚

3. è·å–æ–°é—»æ¨é€æ—¶ï¼Œéœ€è¦è·å–å½“å‰ç”¨æˆ·å…³æ³¨çš„äººçš„æ¨æ–‡ï¼Œå¹¶å°†è¿™äº›æ¨æ–‡è¿›è¡Œåˆå¹¶ã€‚ä¸ºäº†æ–¹ä¾¿åˆå¹¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¤§é¡¶å †ï¼Œæ¯æ¬¡ä»å †ä¸­å–å‡ºæœ€å¤§çš„æ—¶é—´æˆ³çš„æ¨æ–‡ï¼ŒåŒæ—¶å°†è¯¥æ¨æ–‡æ‰€å±ç”¨æˆ·çš„å…¶ä»–æ¨æ–‡åŠ å…¥å †ä¸­ã€‚

4. ç”¨æˆ·å…³æ³¨å’Œå–æ¶ˆå…³æ³¨å¯ä»¥é€šè¿‡ç»´æŠ¤å…³æ³¨å…³ç³»çš„å“ˆå¸Œè¡¨æ¥å®ç°ã€‚å“ˆå¸Œè¡¨çš„é”®æ˜¯å…³æ³¨è€…çš„ IDï¼Œå€¼æ˜¯ä¸€ä¸ªé›†åˆï¼ŒåŒ…å«è¯¥å…³æ³¨è€…å…³æ³¨çš„äººçš„ IDã€‚

## ä»£ç 

```javascript
class Twitter {
	constructor() {
		this.tweets = new Map(); // ç”¨æˆ·æ¨æ–‡çš„å“ˆå¸Œè¡¨
		this.following = new Map(); // å…³æ³¨å…³ç³»çš„å“ˆå¸Œè¡¨
		this.timestamp = 0; // æ—¶é—´æˆ³ï¼Œç”¨äºæ¨æ–‡çš„æ’åº
	}

	postTweet(userId, tweetId) {
		if (!this.tweets.has(userId)) {
			this.tweets.set(userId, []);
		}
		this.tweets.get(userId).push({ tweetId, timestamp: this.timestamp++ });
	}

	getNewsFeed(userId) {
		const heap = new MaxHeap();

		// åŠ å…¥è‡ªå·±çš„æ¨æ–‡
		if (this.tweets.has(userId)) {
			this.tweets.get(userId).forEach((tweet) => heap.insert(tweet));
		}

		// åŠ å…¥å…³æ³¨è€…çš„æ¨æ–‡
		if (this.following.has(userId)) {
			this.following.get(userId).forEach((followeeId) => {
				if (this.tweets.has(followeeId)) {
					this.tweets.get(followeeId).forEach((tweet) => heap.insert(tweet));
				}
			});
		}

		const result = [];
		while (!heap.isEmpty() && result.length < 10) {
			const tweet = heap.extractMax();
			result.push(tweet.tweetId);
		}

		return result;
	}

	follow(followerId, followeeId) {
		if (!this.following.has(followerId)) {
			this.following.set(followerId, new Set());
		}
		this.following.get(followerId).add(followeeId);
	}

	unfollow(followerId, followeeId) {
		if (this.following.has(followerId)) {
			this.following.get(followerId).delete(followeeId);
		}
	}
}

class MaxHeap {
	constructor() {
		this.heap = [];
	}

	insert(value) {
		this.heap.push(value);
		this.heapifyUp();
	}

	extractMax() {
		if (this.isEmpty()) {
			return null;
		}

		const max = this.heap[0];
		const last = this.heap.pop();

		if (this.heap.length > 0) {
			this.heap[0] = last;
			this.heapifyDown();
		}

		return max;
	}

	isEmpty() {
		return this.heap.length === 0;
	}

	heapifyUp() {
		let cur = this.heap.length - 1;

		while (cur > 0) {
			const parent = Math.floor((cur - 1) / 2);
			if (this.heap[cur].timestamp > this.heap[parent].timestamp) {
				[this.heap[cur], this.heap[parent]] = [
					this.heap[parent],
					this.heap[cur]
				];
				cur = parent;
			} else {
				break;
			}
		}
	}

	heapifyDown() {
		let cur = 0;

		while (true) {
			const leftChild = 2 * cur + 1;
			const rightChild = 2 * cur + 2;
			let next = null;

			if (
				leftChild < this.heap.length &&
				this.heap[leftChild].timestamp > this.heap[cur].timestamp
			) {
				next = leftChild;
			}

			if (
				rightChild < this.heap.length &&
				this.heap[rightChild].timestamp > this.heap[cur].timestamp
			) {
				next =
					this.heap[rightChild].timestamp > this.heap[leftChild].timestamp
						? rightChild
						: leftChild;
			}

			if (
				next !== null &&
				this.heap[cur].timestamp < this.heap[next].timestamp
			) {
				[this.heap[cur], this.heap[next]] = [this.heap[next], this.heap[cur]];
				cur = next;
			} else {
				break;
			}
		}
	}
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 1500 | [è®¾è®¡æ–‡ä»¶åˆ†äº«ç³»ç»Ÿ](https://leetcode.com/problems/design-a-file-sharing-system) |  |  [`è®¾è®¡`](/tag/design.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°æ®æµ`](/tag/data-stream.md) `2+` | <font color=#ffb800>Medium</font> |