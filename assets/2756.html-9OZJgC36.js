import{_ as o,r as p,o as c,c as l,a as n,b as s,d as a,w as i,e as u}from"./app-fBVbqwGY.js";const r={},k=n("h1",{id:"_2756-æ‰¹å¤„ç†æŸ¥è¯¢-ğŸ”’",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2756-æ‰¹å¤„ç†æŸ¥è¯¢-ğŸ”’","aria-hidden":"true"},"#"),s(" 2756. æ‰¹å¤„ç†æŸ¥è¯¢ ğŸ”’")],-1),d={href:"https://leetcode.cn/problems/query-batching",target:"_blank",rel:"noopener noreferrer"},m=n("code",null,"åŠ›æ‰£",-1),v={href:"https://leetcode.com/problems/query-batching",target:"_blank",rel:"noopener noreferrer"},y=n("code",null,"LeetCode",-1),b=u(`<h2 id="é¢˜ç›®" tabindex="-1"><a class="header-anchor" href="#é¢˜ç›®" aria-hidden="true">#</a> é¢˜ç›®</h2><p>Batching multiple small queries into a single large query can be a useful optimization. Write a class <code>QueryBatcher</code> that implements this functionality.</p><p>The constructor should accept two parameters:</p><ul><li>An asynchronous function <code>queryMultiple</code> which accepts an array of string keys <code>input</code>. It will resolve with an array of values that is the same length as the input array. Each index corresponds to the value associated with <code>input[i]</code>. You can assume the promise will never reject.</li><li>A throttle time in milliseconds <code>t</code>.</li></ul><p>The class has a single method.</p><ul><li><code>async getValue(key)</code>. Accepts a single string key and resolves with a single string value. The keys passed to this function should eventually get passed to the <code>queryMultiple</code> function. <code>queryMultiple</code> should never be called consecutively within <code>t</code> milliseconds. The first time <code>getValue</code> is called, <code>queryMultiple</code> should immediately be called with that single key. If after <code>t</code> milliseconds, <code>getValue</code> had been called again, all the passed keys should be passed to <code>queryMultiple</code> and ultimately returned. You can assume every key passed to this method is unique.</li></ul><p>The following diagram illustrates how the throttling algorithm works. Each rectangle represents 100ms. The throttle time is 400ms.</p><figure><img src="https://fastly.jsdelivr.net/gh/doocs/leetcode@main/solution/2700-2799/2756.Query Batching/images/throttle.png" alt="Throttle
info" tabindex="0" loading="lazy"><figcaption>Throttle info</figcaption></figure><p><strong>Example 1:</strong></p><blockquote><p>Input:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

t <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Output:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Explanation:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> batcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryBatcher</span><span class="token punctuation">(</span>queryMultiple<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;a!&quot; at t=10ms</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;b!&quot; at t=110ms</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;c!&quot; at t=110ms</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>queryMultiple simply adds an &quot;!&quot; to the key</p><p>At t=10ms, getValue(&#39;a&#39;) is called, queryMultiple([&#39;a&#39;]) is immediately called and the result is immediately returned.</p><p>At t=20ms, getValue(&#39;b&#39;) is called but the query is queued</p><p>At t=30ms, getValue(&#39;c&#39;) is called but the query is queued.</p><p>At t=110ms, queryMultiple([&#39;a&#39;, &#39;b&#39;]) is called and the results are immediately returned.</p></blockquote><p><strong>Example 2:</strong></p><blockquote><p>Input:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

t <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Output:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">210</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">210</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Explanation:</p><p>This example is the same as example 1 except there is a 100ms delay in queryMultiple. The results are the same except the promises resolve 100ms later.</p></blockquote><p><strong>Example 3:</strong></p><blockquote><p>Input:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> keys<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

t <span class="token operator">=</span> <span class="token number">100</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">}</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Output:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;e!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">350</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;d!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;f!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">450</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Explanation: queryMultiple([&#39;a&#39;]) is called at t=10ms, it is resolved at t=110ms</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">queryMultiple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;d&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> is called at t<span class="token operator">=</span>110ms<span class="token punctuation">,</span> it is resolved at 410ms
<span class="token function">queryMultiple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;e&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> is called at t<span class="token operator">=</span>250ms<span class="token punctuation">,</span> it is resolved at 350ms
<span class="token function">queryMultiple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;f&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> is called at t<span class="token operator">=</span>350ms<span class="token punctuation">,</span> it is resolved at 450ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p><strong>Constraints:</strong></p><ul><li><code>0 &lt;= t &lt;= 1000</code></li><li><code>0 &lt;= calls.length &lt;= 10</code></li><li><code>1 &lt;= key.length &lt;= 100</code></li><li>All keys are unique</li></ul><h2 id="é¢˜ç›®å¤§æ„" tabindex="-1"><a class="header-anchor" href="#é¢˜ç›®å¤§æ„" aria-hidden="true">#</a> é¢˜ç›®å¤§æ„</h2><p>å°†å¤šä¸ªå°æŸ¥è¯¢æ‰¹å¤„ç†ä¸ºå•ä¸ªå¤§æŸ¥è¯¢å¯ä»¥æ˜¯ä¸€ç§æœ‰ç”¨çš„ä¼˜åŒ–ã€‚è¯·ç¼–å†™ä¸€ä¸ªåä¸º <code>QueryBatcher</code> çš„ç±»æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>å®ƒçš„æ„é€ å‡½æ•°åº”æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š</p><ul><li>ä¸€ä¸ªå¼‚æ­¥å‡½æ•° <code>queryMultiple</code> ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²é”®çš„æ•°ç»„ä½œä¸ºè¾“å…¥ã€‚å®ƒå°†è¿”å›ä¸€ä¸ªä¸è¾“å…¥æ•°ç»„é•¿åº¦ç›¸åŒçš„å€¼æ•°ç»„ã€‚æ¯ä¸ªç´¢å¼•å¯¹åº”äºä¸ <code>input[i]</code> ç›¸å…³è”çš„å€¼ã€‚å¯ä»¥å‡è®¾è¯¥å¼‚æ­¥å‡½æ•°æ°¸è¿œä¸ä¼šè¢«æ‹’ç»ã€‚</li><li>ä¸€ä¸ªä»¥æ¯«ç§’ä¸ºå•ä½çš„èŠ‚æµæ—¶é—´<code>t</code>ã€‚</li></ul><p>è¯¥ç±»æœ‰ä¸€ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>async getValue(key)</code>ï¼šæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²é”®ï¼Œå¹¶è¿”å›ä¸€ä¸ªè§£æåçš„å­—ç¬¦ä¸²å€¼ã€‚ä¼ é€’ç»™æ­¤å‡½æ•°çš„é”®å€¼æœ€ç»ˆåº”ä¼ é€’ç»™ <code>queryMultiple</code> å‡½æ•°ã€‚åœ¨ <code>t</code> æ¯«ç§’å†…ä¸åº”è¿ç»­è°ƒç”¨ <code>queryMultiple</code> ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>getValue</code> æ—¶ï¼Œåº”ç«‹å³ä½¿ç”¨è¯¥å•ä¸ªé”®è°ƒç”¨ <code>queryMultiple</code> ã€‚å¦‚æœåœ¨ <code>t</code> æ¯«ç§’åå†æ¬¡è°ƒç”¨äº† <code>getValue</code> ï¼Œåˆ™æ‰€æœ‰ä¼ é€’çš„é”®åº”ä¼ é€’ç»™ <code>queryMultiple</code> ï¼Œå¹¶è¿”å›æœ€ç»ˆç»“æœã€‚å¯ä»¥å‡è®¾ä¼ é€’ç»™è¯¥æ–¹æ³•çš„æ¯ä¸ªé”®éƒ½æ˜¯å”¯ä¸€çš„ã€‚</li></ul><p>ä¸‹å›¾è¯´æ˜äº†èŠ‚æµç®—æ³•çš„å·¥ä½œåŸç†ã€‚æ¯ä¸ªçŸ©å½¢ä»£è¡¨ 100 æ¯«ç§’ã€‚èŠ‚æµæ—¶é—´ä¸º 400 æ¯«ç§’ã€‚</p><figure><img src="https://fastly.jsdelivr.net/gh/doocs/leetcode@main/solution/2700-2799/2756.Query Batching/images/throttle.png" alt="Throttle
info" tabindex="0" loading="lazy"><figcaption>Throttle info</figcaption></figure><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

t <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£é‡Šï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> batcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryBatcher</span><span class="token punctuation">(</span>queryMultiple<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;a!&quot; at t=10ms</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;b!&quot; at t=110ms</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> batcher<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">&#39;c&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;c!&quot; at t=110ms</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>queryMultiple ç®€å•åœ°ç»™é”®æ·»åŠ äº†&quot;!&quot;ã€‚</p><p>åœ¨ t=10ms æ—¶ï¼Œè°ƒç”¨ getValue(&#39;a&#39;)ï¼Œç«‹å³è°ƒç”¨ queryMultiple([&#39;a&#39;]) å¹¶ç«‹å³è¿”å›ç»“æœã€‚</p><p>åœ¨ t=20ms æ—¶ï¼Œè°ƒç”¨ getValue(&#39;b&#39;)ï¼Œä½†æŸ¥è¯¢éœ€è¦ç­‰å¾…ã€‚</p><p>åœ¨ t=30ms æ—¶ï¼Œè°ƒç”¨ getValue(&#39;c&#39;)ï¼Œä½†æŸ¥è¯¢éœ€è¦ç­‰å¾…ã€‚</p><p>åœ¨ t=110ms æ—¶ï¼Œè°ƒç”¨ queryMultiple([&#39;b&#39;, &#39;c&#39;]) å¹¶ç«‹å³è¿”å›ç»“æœã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 2ï¼›</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

t <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;a&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">&#39;c&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">210</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">210</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£é‡Šï¼š</strong></p><p>è¿™ä¸ªä¾‹å­ä¸ç¤ºä¾‹ 1 ç›¸åŒï¼Œåªæ˜¯åœ¨ queryMultiple ä¸­æœ‰ä¸€ä¸ª 100ms çš„å»¶è¿Ÿã€‚ç»“æœä¹Ÿç›¸åŒï¼Œåªæ˜¯ promise çš„è§£ææ—¶é—´å»¶è¿Ÿäº† 100msã€‚</p></blockquote><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><blockquote><p><strong>è¾“å…¥ï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">queryMultiple</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> keys<span class="token punctuation">.</span>length <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> keys<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> key <span class="token operator">+</span> <span class="token string">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

t <span class="token operator">=</span> <span class="token number">100</span>

calls <span class="token operator">=</span> <span class="token punctuation">[</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">}</span>
	<span class="token punctuation">{</span><span class="token string-property property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;time&quot;</span><span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å‡ºï¼š</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;a!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">110</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;e!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">350</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;b!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;c!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;d!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">410</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">{</span> <span class="token literal-property property">resolved</span><span class="token operator">:</span> <span class="token string">&#39;f!&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token number">450</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§£é‡Šï¼š</strong> åœ¨ t=10ms æ—¶ï¼Œè°ƒç”¨ queryMultiple([&#39;a&#39;]) ï¼Œåœ¨ t=110ms æ—¶è§£æã€‚</p><p>åœ¨ t=110ms æ—¶ï¼Œè°ƒç”¨ queryMultiple([&#39;b&#39;, &#39;c&#39;, &#39;d&#39;]) ï¼Œåœ¨ t=410ms æ—¶è§£æã€‚</p><p>åœ¨ t=250ms æ—¶ï¼Œè°ƒç”¨ queryMultiple([&#39;e&#39;]) ï¼Œåœ¨ t=350ms æ—¶è§£æã€‚</p><p>åœ¨ t=350ms æ—¶ï¼Œè°ƒç”¨ queryMultiple([&#39;f&#39;]) ï¼Œåœ¨ t=450ms æ—¶è§£æã€‚</p></blockquote><p><strong>æç¤ºï¼š</strong></p><ul><li><code>0 &lt;= t &lt;= 1000</code></li><li><code>0 &lt;= calls.length &lt;= 10</code></li><li><code>1 &lt;= key.length &lt;= 100</code></li><li>æ‰€æœ‰çš„é”®å€¼éƒ½æ˜¯å”¯ä¸€çš„</li></ul><h2 id="è§£é¢˜æ€è·¯" tabindex="-1"><a class="header-anchor" href="#è§£é¢˜æ€è·¯" aria-hidden="true">#</a> è§£é¢˜æ€è·¯</h2><ol><li><p><strong>æ„é€ å‡½æ•°</strong>ï¼šåˆå§‹åŒ–<code>queryMultiple</code>å‡½æ•°å’ŒèŠ‚æµæ—¶é—´<code>t</code>ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ‰¹æ¬¡ï¼ˆæ•°ç»„ï¼‰æ¥å­˜å‚¨éœ€è¦æŸ¥è¯¢çš„é”®ï¼Œä»¥åŠå¦ä¸€ä¸ªå¯¹è±¡æ¥å­˜å‚¨æ¯ä¸ªé”®çš„ Promise ä»¥ä¾¿åœ¨æ‰¹å¤„ç†åè§£æç»“æœã€‚</p><ul><li><code>queue</code> å­˜å‚¨å½“å‰æ‰¹æ¬¡çš„é”®ã€‚</li><li><code>promises</code> è®°å½•æ¯ä¸ªé”®å¯¹åº”çš„ Promiseï¼Œä½¿æ¯ä¸ªè°ƒç”¨è€…éƒ½èƒ½è·å–åˆ°æŸ¥è¯¢ç»“æœã€‚</li></ul></li><li><p><strong>æ‰¹å¤„ç†é€»è¾‘</strong>ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>getValue</code> æ—¶ï¼Œç«‹å³è§¦å‘æŸ¥è¯¢ã€‚</li><li>æ¥ä¸‹æ¥çš„è°ƒç”¨åœ¨<code>t</code>æ¯«ç§’å†…åªä¼šæ·»åŠ åˆ°æ‰¹æ¬¡ä¸­ï¼Œå¹¶ç­‰å¾…æ‰¹æ¬¡åˆ°è¾¾å»¶è¿Ÿæ—¶é—´åå†ä¸€èµ·æŸ¥è¯¢ã€‚</li><li>ä½¿ç”¨<code>setTimeout</code>æ§åˆ¶æ‰¹æ¬¡çš„é—´éš”æ—¶é—´ã€‚</li></ul></li><li><p><strong>getValue æ–¹æ³•</strong>ï¼š</p><ul><li><code>getValue</code>æ¥å—ä¸€ä¸ªé”®ï¼Œè¿”å›ä¸è¯¥é”®å…³è”çš„å€¼ã€‚</li><li>å¦‚æœè¯¥é”®æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆ™åˆ›å»ºä¸€ä¸ª Promiseï¼Œå°†å®ƒåŠ å…¥æ‰¹å¤„ç†é˜Ÿåˆ—<code>queue</code>ï¼Œå¹¶åœ¨æ‰¹æ¬¡æ‰§è¡Œåè§£æç»“æœã€‚</li><li>ä½¿ç”¨ <code>clearTimeout</code> å’Œ <code>setTimeout</code> æ¥æ§åˆ¶è°ƒç”¨é—´éš”ã€‚æ²¡æœ‰è®¡æ—¶å™¨æ—¶ç«‹å³æŸ¥è¯¢ï¼Œæœ‰è®¡æ—¶å™¨åˆ™ç­‰å¾…å…¶åˆ°æœŸã€‚</li><li>å½“è¾¾åˆ°<code>t</code>æ¯«ç§’å»¶è¿Ÿæ—¶ï¼Œå°†æ‰€æœ‰ç§¯ç´¯çš„é”®ä¼ é€’ç»™<code>queryMultiple</code>ï¼Œç„¶åå°†å¯¹åº”çš„ç»“æœæ˜ å°„ç»™å„è‡ªçš„ Promiseã€‚</li></ul></li><li><p><strong>_triggerQuery æ–¹æ³•</strong>ï¼š</p><ul><li>å°† <code>queue</code> ä¸­çš„æ‰€æœ‰é”®æ‰¹é‡æŸ¥è¯¢ï¼Œå¹¶å°†è¿”å›ç»“æœåˆ†é…åˆ°ç›¸åº”çš„ Promiseã€‚</li><li>æŸ¥è¯¢åæ¸…ç©º <code>queue</code> å¹¶é‡ç½®è®¡æ—¶å™¨ã€‚</li></ul></li></ol><h2 id="ä»£ç " tabindex="-1"><a class="header-anchor" href="#ä»£ç " aria-hidden="true">#</a> ä»£ç </h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">QueryBatcher</span> <span class="token punctuation">{</span>
	<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">queryMultiple<span class="token punctuation">,</span> t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>queryMultiple <span class="token operator">=</span> queryMultiple<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>t <span class="token operator">=</span> t<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// å­˜å‚¨éœ€è¦æŸ¥è¯¢çš„é”®</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>promises <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// å­˜å‚¨æ¯ä¸ªé”®çš„ Promise</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// ç”¨äºæ§åˆ¶æ‰¹æ¬¡çš„å»¶è¿Ÿ</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">async</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// å¦‚æœè¯¥é”®æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œåˆ™åˆå§‹åŒ–å®ƒçš„ Promise</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>resolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// å¦‚æœæ²¡æœ‰å»¶è¿Ÿè®¡æ—¶å™¨ï¼Œåˆ™ç«‹å³æŸ¥è¯¢å½“å‰æ‰¹æ¬¡ä¸­çš„é”®</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_triggerQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// å¦‚æœå·²è®¾ç½®å»¶è¿Ÿè®¡æ—¶å™¨ï¼Œåˆ™ç­‰å¾…å½“å‰è®¡æ—¶å™¨åˆ°æœŸåå†æŸ¥è¯¢</span>
				<span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_triggerQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ‰§è¡Œæ‰¹æ¬¡æŸ¥è¯¢å¹¶è§£æç»“æœ</span>
	<span class="token keyword">async</span> <span class="token function">_triggerQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">const</span> keysToQuery <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>queue<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æ¸…ç©ºå½“å‰é˜Ÿåˆ—</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// é‡ç½®è®¡æ—¶å™¨</span>

		<span class="token comment">// è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœåˆ†å‘ç»™ç›¸åº”çš„ Promise</span>
		<span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">queryMultiple</span><span class="token punctuation">(</span>keysToQuery<span class="token punctuation">)</span><span class="token punctuation">;</span>
		keysToQuery<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>promises<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// æŸ¥è¯¢ååˆ é™¤è¯¥é”®çš„ Promise</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,36);function g(h,q){const e=p("font"),t=p("ExternalLinkIcon");return c(),l("div",null,[k,n("p",null,[s("ğŸ”´ "),a(e,{color:"#ff334b"},{default:i(()=>[s("Hard")]),_:1}),s("â€ƒ ğŸ”—â€‚"),n("a",d,[m,a(t)]),s(),n("a",v,[y,a(t)])]),b])}const w=o(r,[["render",g],["__file","2756.html.vue"]]);export{w as default};
