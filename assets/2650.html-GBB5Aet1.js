import{_ as i,r as o,o as u,c as r,a as n,b as s,d as a,w as p,f as d,e}from"./app-fBVbqwGY.js";const k={},m=n("h1",{id:"_2650-è®¾è®¡å¯å–æ¶ˆå‡½æ•°",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2650-è®¾è®¡å¯å–æ¶ˆå‡½æ•°","aria-hidden":"true"},"#"),s(" 2650. è®¾è®¡å¯å–æ¶ˆå‡½æ•°")],-1),v={href:"https://leetcode.cn/problems/design-cancellable-function",target:"_blank",rel:"noopener noreferrer"},b=n("code",null,"åŠ›æ‰£",-1),h={href:"https://leetcode.com/problems/design-cancellable-function",target:"_blank",rel:"noopener noreferrer"},g=n("code",null,"LeetCode",-1),y=e(`<h2 id="é¢˜ç›®" tabindex="-1"><a class="header-anchor" href="#é¢˜ç›®" aria-hidden="true">#</a> é¢˜ç›®</h2><p>Sometimes you have a long running task, and you may wish to cancel it before it completes. To help with this goal, write a function <code>cancellable</code> that accepts a generator object and returns an array of two values: a <strong>cancel function</strong> and a <strong>promise</strong>.</p><p>You may assume the generator function will only yield promises. It is your function&#39;s responsibility to pass the values resolved by the promise back to the generator. If the promise rejects, your function should throw that error back to the generator.</p><p>If the cancel callback is called before the generator is done, your function should throw an error back to the generator. That error should be the string <code>&quot;Cancelled&quot;</code> (Not an <code>Error</code> object). If the error was caught, the returned promise should resolve with the next value that was yielded or returned. Otherwise, the promise should reject with the thrown error. No more code should be executed.</p><p>When the generator is done, the promise your function returned should resolve the value the generator returned. If, however, the generator throws an error, the returned promise should reject with the error.</p><p>An example of how your code would be used:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> val <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> val <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// calculation shouldn&#39;t be done.</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>cancel<span class="token punctuation">,</span> promise<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cancellable</span><span class="token punctuation">(</span><span class="token function">tasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>cancel<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// logs &quot;Cancelled&quot; at t=50ms</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If instead <code>cancel()</code> was not called or was called after <code>t=100ms</code>, the promise would have resolved <code>5</code>.</p><p><strong>Example 1:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token number">42</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),w=n("blockquote",{"resolved:42":""},[n("p",null,"Output:")],-1),f=e(`<blockquote><p>Explanation:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">generatorFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>cancel<span class="token punctuation">,</span> promise<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">cancellable</span><span class="token punctuation">(</span>generator<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>cancel<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resolves 42 at t=0ms</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The generator immediately yields 42 and finishes. Because of that, the returned promise immediately resolves 42. Note that cancelling a finished generator does nothing.</p><p><strong>Example 2:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">throw</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),_=n("blockquote",{"rejected:Error:Hello":""},[n("p",null,"Output:")],-1),x=e(`<blockquote><p>Explanation:</p></blockquote><p>A promise is yielded. The function handles this by waiting for it to resolve and then passes the resolved value back to the generator. Then an error is thrown which has the effect of causing the promise to reject with the same thrown error.</p><p><strong>Example 3:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token string">&#39;Success&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),j=n("blockquote",{"rejected:Cancelled":""},[n("p",null,"Output:")],-1),q=e(`<blockquote><p>Explanation:</p></blockquote><p>While the function is waiting for the yielded promise to resolve, cancel() is called. This causes an error message to be sent back to the generator. Since this error is uncaught, the returned promise rejected with this error.</p><p><strong>Example 4:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	result <span class="token operator">+=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	result <span class="token operator">+=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),P=n("blockquote",{"resolved:2":""},[n("p",null,"Output:")],-1),T=e(`<blockquote><p>Explanation:</p></blockquote><p>4 promises are yielded. Two of those promises have their values added to the result. After 200ms, the generator finishes with a value of 2, and that value is resolved by the returned promise.</p><p><strong>Example 5:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		result <span class="token operator">+=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		result <span class="token operator">+=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),E=n("blockquote",{"resolved:1":""},[n("p",null,"Output:")],-1),I=e(`<blockquote><p>Explanation:</p></blockquote><p>The first two yielded promises resolve and cause the result to increment. However, at t=150ms, the generator is cancelled. The error sent to the generator is caught and the result is returned and finally resolved by the returned promise.</p><p><strong>Example 6:</strong></p><blockquote><p>Input:</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">generatorFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;Promise Rejected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

cancelledAt <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),A=n("blockquote",{"resolved:4":""},[n("p",null,"Output:")],-1),C=e(`<blockquote><p>Explanation:</p></blockquote><p>The first yielded promise immediately rejects. This error is caught. Because the generator hasn&#39;t been cancelled, execution continues as usual. It ends up resolving 2 + 2 = 4.</p><p><strong>Constraints:</strong></p><ul><li><code>cancelledAt == null or 0 &lt;= cancelledAt &lt;= 1000</code></li><li><code>generatorFunction</code> returns a generator object</li></ul><h2 id="é¢˜ç›®å¤§æ„" tabindex="-1"><a class="header-anchor" href="#é¢˜ç›®å¤§æ„" aria-hidden="true">#</a> é¢˜ç›®å¤§æ„</h2><p>æœ‰æ—¶å€™ä½ ä¼šæœ‰ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä½ å¯èƒ½å¸Œæœ›åœ¨å®ƒå®Œæˆä¹‹å‰å–æ¶ˆå®ƒã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œè¯·ä½ ç¼–å†™ä¸€ä¸ªåä¸º <code>cancellable</code> çš„å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå€¼çš„æ•°ç»„ï¼šä¸€ä¸ª <strong>å–æ¶ˆå‡½æ•°</strong> å’Œä¸€ä¸ª <strong>promise</strong> å¯¹è±¡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾ç”Ÿæˆå™¨å‡½æ•°åªä¼šç”Ÿæˆ promise å¯¹è±¡ã€‚ä½ çš„å‡½æ•°è´Ÿè´£å°† promise å¯¹è±¡è§£æçš„å€¼ä¼ å›ç”Ÿæˆå™¨ã€‚å¦‚æœ promise è¢«æ‹’ç»ï¼Œä½ çš„å‡½æ•°åº”å°†è¯¥é”™è¯¯æŠ›å›ç»™ç”Ÿæˆå™¨ã€‚</p><p>å¦‚æœåœ¨ç”Ÿæˆå™¨å®Œæˆä¹‹å‰è°ƒç”¨äº†å–æ¶ˆå›è°ƒå‡½æ•°ï¼Œåˆ™ä½ çš„å‡½æ•°åº”è¯¥å°†é”™è¯¯æŠ›å›ç»™ç”Ÿæˆå™¨ã€‚è¯¥é”™è¯¯åº”è¯¥æ˜¯å­—ç¬¦ä¸² <code>&quot;Cancelled&quot;</code>ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ª <code>Error</code> å¯¹è±¡ï¼‰ã€‚å¦‚æœé”™è¯¯è¢«æ•è·ï¼Œåˆ™è¿”å›çš„ promise åº”è¯¥è§£æä¸ºä¸‹ä¸€ä¸ªç”Ÿæˆæˆ–è¿”å›çš„å€¼ã€‚å¦åˆ™ï¼Œpromise åº”è¯¥è¢«æ‹’ç»å¹¶æŠ›å‡ºè¯¥é”™è¯¯ã€‚ä¸åº”æ‰§è¡Œä»»ä½•å…¶ä»–ä»£ç ã€‚</p><p>å½“ç”Ÿæˆå™¨å®Œæˆæ—¶ï¼Œæ‚¨çš„å‡½æ•°è¿”å›çš„ promise åº”è¯¥è§£æä¸ºç”Ÿæˆå™¨è¿”å›çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœç”Ÿæˆå™¨æŠ›å‡ºé”™è¯¯ï¼Œåˆ™è¿”å›çš„ promise åº”è¯¥æ‹’ç»å¹¶æŠ›å‡ºè¯¥é”™è¯¯ã€‚</p><p><strong>æç¤ºï¼š</strong></p><ul><li><code>cancelledAt == null or 0 &lt;= cancelledAt &lt;= 1000</code></li><li><code>generatorFunction</code> è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</li></ul><h2 id="è§£é¢˜æ€è·¯" tabindex="-1"><a class="header-anchor" href="#è§£é¢˜æ€è·¯" aria-hidden="true">#</a> è§£é¢˜æ€è·¯</h2><ol><li><p><strong>åˆ›å»ºå–æ¶ˆå‡½æ•°</strong>ï¼š</p><ul><li>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå–æ¶ˆå‡½æ•° <code>cancel</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨æ—¶ä½¿ä¸€ä¸ª <code>Promise</code> è¢«æ‹’ç»ï¼Œæ‹’ç»åŸå› æ˜¯å­—ç¬¦ä¸² <code>&quot;Cancelled&quot;</code>ã€‚</li><li>ä½¿ç”¨ <code>Promise</code> çš„æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª <code>cancelPromise</code>ï¼Œå°†æ‹’ç»é€»è¾‘ç»‘å®šåˆ° <code>cancel</code> å‡½æ•°ä¸Šã€‚</li></ul></li><li><p><strong>è®¾ç½® promise çš„å¼‚æ­¥æ‰§è¡Œ</strong>ï¼š</p><ul><li>å®šä¹‰ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„å¼‚æ­¥å‡½æ•°ï¼Œç”¨äºå¤„ç†ç”Ÿæˆå™¨çš„æ‰§è¡Œã€‚</li><li>åœ¨å¼‚æ­¥å‡½æ•°å†…ï¼Œé€šè¿‡ <code>generator.next()</code> å¼€å§‹æ‰§è¡Œç”Ÿæˆå™¨ï¼Œå¹¶è·å–ç¬¬ä¸€ä¸ªç»“æœã€‚</li></ul></li><li><p><strong>å¤„ç†ç”Ÿæˆå™¨çš„è¾“å‡º</strong>ï¼š</p><ul><li>ä½¿ç”¨ <code>Promise.race</code> æ¥å¤„ç†ç”Ÿæˆå™¨äº§ç”Ÿçš„ Promise å’Œ <code>cancelPromise</code>ã€‚è¿™æ„å‘³ç€å¦‚æœ <code>cancelPromise</code> è¢«æ‹’ç»ï¼Œç”Ÿæˆå™¨å°†ä¼šç«‹å³åœæ­¢æ‰§è¡Œã€‚</li><li>å¦‚æœç”Ÿæˆå™¨çš„å½“å‰ Promise è¢«è§£å†³ï¼Œä½¿ç”¨è¯¥å€¼è°ƒç”¨ <code>generator.next()</code> ç»§ç»­æ‰§è¡Œç”Ÿæˆå™¨ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œåˆ™è°ƒç”¨ <code>generator.throw()</code> ä¼ é€’é”™è¯¯å¹¶ç»§ç»­ã€‚</li></ul></li><li><p><strong>è¿”å›ç»“æœ</strong>ï¼š</p><ul><li>å½“ç”Ÿæˆå™¨å®Œæˆæ—¶ï¼Œå¼‚æ­¥å‡½æ•°è¿”å›çš„å€¼å°†æˆä¸ºè¿”å›çš„ Promise çš„è§£å†³å€¼ã€‚</li><li>æœ€åï¼Œè¿”å›åŒ…å«å–æ¶ˆå‡½æ•°å’Œ Promise çš„æ•°ç»„ã€‚</li></ul></li></ol><h4 id="å¤æ‚åº¦åˆ†æ" tabindex="-1"><a class="header-anchor" href="#å¤æ‚åº¦åˆ†æ" aria-hidden="true">#</a> å¤æ‚åº¦åˆ†æ</h4><ul><li><strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<code>O(n)</code>ï¼Œå…¶ä¸­ <code>n</code> æ˜¯ç”Ÿæˆå™¨çš„æ­¥éª¤æ•°ã€‚æ¯æ¬¡è°ƒç”¨ <code>next()</code> æˆ– <code>throw()</code> éƒ½æ˜¯å¸¸é‡æ—¶é—´ <code>O(1)</code> æ“ä½œï¼Œå¤æ‚åº¦ä¸ç”Ÿæˆå™¨çš„æ‰§è¡Œæ­¥éª¤æ•°æˆæ­£æ¯”ã€‚</li><li><strong>ç©ºé—´å¤æ‚åº¦</strong>ï¼š<code>O(1)</code>ï¼Œç©ºé—´å¤æ‚åº¦ä¸»è¦æ¥è‡ªäº Promise çš„ä½¿ç”¨å’Œç”Ÿæˆå™¨çš„çŠ¶æ€ï¼Œç”±äºç”Ÿæˆå™¨çš„çŠ¶æ€ä¼šä¿ç•™åœ¨å †æ ˆä¸­ï¼Œä¸”æ¯æ¬¡è°ƒç”¨ <code>next()</code> æˆ– <code>throw()</code> æ—¶éƒ½ä¼šåˆ›å»ºæ–°çš„ Promiseï¼Œå› æ­¤æ•´ä½“ç©ºé—´å¤æ‚åº¦ä¸º <code>O(1)</code>ï¼Œä¸éšè¾“å…¥å¤§å°å˜åŒ–ã€‚</li></ul><h2 id="ä»£ç " tabindex="-1"><a class="header-anchor" href="#ä»£ç " aria-hidden="true">#</a> ä»£ç </h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Generator<span class="token punctuation">}</span></span> <span class="token parameter">generator</span>
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token punctuation">[</span>Function<span class="token punctuation">,</span> Promise<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
 */</span>
<span class="token keyword">var</span> <span class="token function-variable function">cancellable</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">generator</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> cancel<span class="token punctuation">;</span>
	<span class="token keyword">const</span> cancelPromise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token function-variable function">cancel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">&#39;Cancelled&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// æ¯ä¸€ä¸ª promise rejection éƒ½éœ€è¦è¢« catch</span>
	cancelPromise<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">let</span> next <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>next<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				next <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>next<span class="token punctuation">.</span>value<span class="token punctuation">,</span> cancelPromise<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				next <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> next<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span>cancel<span class="token punctuation">,</span> promise<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * function* tasks() <span class="token punctuation">{</span>
 *   const val = yield new Promise(resolve =&gt; resolve(2 + 2));
 *   yield new Promise(resolve =&gt; setTimeout(resolve, 100));
 *   return val + 1;
 * <span class="token punctuation">}</span>
 * const [cancel, promise] = cancellable(tasks());
 * setTimeout(cancel, 50);
 * promise.catch(console.log); // logs &quot;Cancelled&quot; at t=50ms
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç›¸å…³é¢˜ç›®" tabindex="-1"><a class="header-anchor" href="#ç›¸å…³é¢˜ç›®" aria-hidden="true">#</a> ç›¸å…³é¢˜ç›®</h2>`,18),O=n("thead",null,[n("tr",null,[n("th",{style:{"text-align":"center"}},"é¢˜å·"),n("th",{style:{"text-align":"left"}},"æ ‡é¢˜"),n("th",{style:{"text-align":"center"}},"é¢˜è§£"),n("th",{style:{"text-align":"left"}},"æ ‡ç­¾"),n("th",{style:{"text-align":"center"}},"éš¾åº¦"),n("th",{style:{"text-align":"center"}},"åŠ›æ‰£")])],-1),F=n("td",{style:{"text-align":"center"}},"2648",-1),N=n("td",{style:{"text-align":"left"}},"ç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—",-1),B={style:{"text-align":"center"}},L=n("td",{style:{"text-align":"left"}},null,-1),V=n("td",{style:{"text-align":"center"}},"ğŸŸ¢",-1),H={style:{"text-align":"center"}},S={href:"https://leetcode.cn/problems/generate-fibonacci-sequence",target:"_blank",rel:"noopener noreferrer"},R={href:"https://leetcode.com/problems/generate-fibonacci-sequence",target:"_blank",rel:"noopener noreferrer"},W=n("td",{style:{"text-align":"center"}},"2649",-1),G=n("td",{style:{"text-align":"left"}},"åµŒå¥—æ•°ç»„ç”Ÿæˆå™¨",-1),Y={style:{"text-align":"center"}},$=n("td",{style:{"text-align":"left"}},null,-1),z=n("td",{style:{"text-align":"center"}},"ğŸŸ ",-1),D={style:{"text-align":"center"}},J={href:"https://leetcode.cn/problems/nested-array-generator",target:"_blank",rel:"noopener noreferrer"},K={href:"https://leetcode.com/problems/nested-array-generator",target:"_blank",rel:"noopener noreferrer"};function M(Q,U){const l=o("font"),t=o("ExternalLinkIcon"),c=o("RouterLink");return u(),r("div",null,[m,n("p",null,[s("ğŸ”´ "),a(l,{color:"#ff334b"},{default:p(()=>[s("Hard")]),_:1}),s("â€ƒ ğŸ”—â€‚"),n("a",v,[b,a(t)]),s(),n("a",h,[g,a(t)])]),y,w,f,_,x,j,q,P,T,E,I,A,C,d(" prettier-ignore "),n("table",null,[O,n("tbody",null,[n("tr",null,[F,N,n("td",B,[a(c,{to:"/problem/2648.html"},{default:p(()=>[s("[âœ“]")]),_:1})]),L,V,n("td",H,[n("a",S,[s("ğŸ€„ï¸"),a(t)]),s(),n("a",R,[s("ğŸ”—"),a(t)])])]),n("tr",null,[W,G,n("td",Y,[a(c,{to:"/problem/2649.html"},{default:p(()=>[s("[âœ“]")]),_:1})]),$,z,n("td",D,[n("a",J,[s("ğŸ€„ï¸"),a(t)]),s(),n("a",K,[s("ğŸ”—"),a(t)])])])])])])}const Z=i(k,[["render",M],["__file","2650.html.vue"]]);export{Z as default};
