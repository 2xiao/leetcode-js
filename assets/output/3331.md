# [3331. ä¿®æ”¹åå­æ ‘çš„å¤§å°](https://leetcode.com/problems/find-subtree-sizes-after-changes)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/find-subtree-sizes-after-changes)

## é¢˜ç›®

You are given a tree rooted at node 0 that consists of `n` nodes numbered from
`0` to `n - 1`. The tree is represented by an array `parent` of size `n`,
where `parent[i]` is the parent of node `i`. Since node 0 is the root,
`parent[0] == -1`.

You are also given a string `s` of length `n`, where `s[i]` is the character
assigned to node `i`.

We make the following changes on the tree **one** time **simultaneously** for
all nodes `x` from `1` to `n - 1`:

  * Find the **closest** node `y` to node `x` such that `y` is an ancestor of `x`, and `s[x] == s[y]`.
  * If node `y` does not exist, do nothing.
  * Otherwise, **remove** the edge between `x` and its current parent and make node `y` the new parent of `x` by adding an edge between them.

Return an array `answer` of size `n` where `answer[i]` is the **size** of the
subtree rooted at node `i` in the **final** tree.

A **subtree** of `treeName` is a tree consisting of a node in `treeName` and
all of its descendants.



**Example 1:**

**Input:** parent = [-1,0,0,1,1,1], s = "abaabc"

**Output:** [6,3,1,1,1,1]

**Explanation:**

![](https://assets.leetcode.com/uploads/2024/08/15/graphex1drawio.png)

The parent of node 3 will change from node 1 to node 0.

**Example 2:**

**Input:** parent = [-1,0,4,0,1], s = "abbba"

**Output:** [5,2,1,1,1]

**Explanation:**

![](https://assets.leetcode.com/uploads/2024/08/20/exgraph2drawio.png)

The following changes will happen at the same time:

  * The parent of node 4 will change from node 1 to node 0.
  * The parent of node 2 will change from node 4 to node 1.



**Constraints:**

  * `n == parent.length == s.length`
  * `1 <= n <= 10^5`
  * `0 <= parent[i] <= n - 1` for all `i >= 1`.
  * `parent[0] == -1`
  * `parent` represents a valid tree.
  * `s` consists only of lowercase English letters.


## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€æ£µ `n` ä¸ªèŠ‚ç‚¹ä¸”æ ¹èŠ‚ç‚¹ä¸ºç¼–å· 0 çš„æ ‘ï¼ŒèŠ‚ç‚¹ç¼–å·ä¸º `0` åˆ° `n - 1` ã€‚è¿™æ£µæ ‘ç”¨ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„ `parent` è¡¨ç¤ºï¼Œå…¶ä¸­
`parent[i]` æ˜¯ç¬¬ `i` ä¸ªèŠ‚ç‚¹çš„çˆ¶äº²èŠ‚ç‚¹çš„ç¼–å·ã€‚ç”±äºèŠ‚ç‚¹ 0 æ˜¯æ ¹ï¼Œ`parent[0] == -1` ã€‚

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„å­—ç¬¦ä¸² `s` ï¼Œå…¶ä¸­ `s[i]` æ˜¯èŠ‚ç‚¹ `i` å¯¹åº”çš„å­—ç¬¦ã€‚

å¯¹äºèŠ‚ç‚¹ç¼–å·ä» `1` åˆ° `n - 1` çš„æ¯ä¸ªèŠ‚ç‚¹ `x` ï¼Œæˆ‘ä»¬ **åŒæ—¶** æ‰§è¡Œä»¥ä¸‹æ“ä½œ **ä¸€æ¬¡**  ï¼š

  * æ‰¾åˆ°è·ç¦»èŠ‚ç‚¹ `x` **æœ€è¿‘**  çš„ç¥–å…ˆèŠ‚ç‚¹ `y` ï¼Œä¸” `s[x] == s[y]` ã€‚
  * å¦‚æœèŠ‚ç‚¹ `y` ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¸åšä»»ä½•ä¿®æ”¹ã€‚
  * å¦åˆ™ï¼Œå°†èŠ‚ç‚¹ `x` ä¸å®ƒçˆ¶äº²èŠ‚ç‚¹ä¹‹é—´çš„è¾¹ **åˆ é™¤**  ï¼Œåœ¨ `x` ä¸ `y` ä¹‹é—´è¿æ¥ä¸€æ¡è¾¹ï¼Œä½¿ `y` å˜ä¸º `x` æ–°çš„çˆ¶èŠ‚ç‚¹ã€‚

è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„æ•°ç»„ `answer` ï¼Œå…¶ä¸­ `answer[i]` æ˜¯ **æœ€ç»ˆ**  æ ‘ä¸­ï¼ŒèŠ‚ç‚¹ `i` ä¸ºæ ¹çš„å­æ ‘çš„ **å¤§å°**
ã€‚

ä¸€ä¸ª **å­æ ‘**  `subtree` æŒ‡çš„æ˜¯èŠ‚ç‚¹ `subtree` å’Œå®ƒæ‰€æœ‰çš„åä»£èŠ‚ç‚¹ã€‚



**ç¤ºä¾‹ 1ï¼š**

**è¾“å…¥ï¼š** parent = [-1,0,0,1,1,1], s = "abaabc"

**è¾“å‡ºï¼š**[6,3,1,1,1,1]

**è§£é‡Šï¼š**

![](https://assets.leetcode.com/uploads/2024/08/15/graphex1drawio.png)

èŠ‚ç‚¹ 3 çš„çˆ¶èŠ‚ç‚¹ä»èŠ‚ç‚¹ 1 å˜ä¸ºèŠ‚ç‚¹ 0 ã€‚

**ç¤ºä¾‹ 2ï¼š**

**è¾“å…¥ï¼š** parent = [-1,0,4,0,1], s = "abbba"

**è¾“å‡ºï¼š**[5,2,1,1,1]

**è§£é‡Šï¼š**

![](https://assets.leetcode.com/uploads/2024/08/20/exgraph2drawio.png)

ä»¥ä¸‹å˜åŒ–ä¼šåŒæ—¶å‘ç”Ÿï¼š

  * èŠ‚ç‚¹ 4 çš„çˆ¶èŠ‚ç‚¹ä»èŠ‚ç‚¹ 1 å˜ä¸ºèŠ‚ç‚¹ 0 ã€‚
  * èŠ‚ç‚¹ 2 çš„çˆ¶èŠ‚ç‚¹ä»èŠ‚ç‚¹ 4 å˜ä¸ºèŠ‚ç‚¹ 1 ã€‚



**æç¤ºï¼š**

  * `n == parent.length == s.length`
  * `1 <= n <= 10^5`
  * å¯¹äºæ‰€æœ‰çš„ `i >= 1` ï¼Œéƒ½æœ‰ `0 <= parent[i] <= n - 1` ã€‚
  * `parent[0] == -1`
  * `parent` è¡¨ç¤ºä¸€æ£µåˆæ³•çš„æ ‘ã€‚
  * `s` åªåŒ…å«å°å†™è‹±æ–‡å­—æ¯ã€‚


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```