# [1687. ä»ä»“åº“åˆ°ç å¤´è¿è¾“ç®±å­](https://2xiao.github.io/leetcode-js/problem/1687.html)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`çº¿æ®µæ ‘`](/tag/segment-tree.md) [`é˜Ÿåˆ—`](/tag/queue.md) [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md) [`å•è°ƒé˜Ÿåˆ—`](/tag/monotonic-queue.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/delivering-boxes-from-storage-to-ports) [`LeetCode`](https://leetcode.com/problems/delivering-boxes-from-storage-to-ports)

## é¢˜ç›®

You have the task of delivering some boxes from storage to their ports using
only one ship. However, this ship has a **limit** on the **number of boxes**
and the **total weight** that it can carry.

You are given an array `boxes`, where `boxes[i] = [portsâ€‹â€‹iâ€‹, weighti]`, and
three integers `portsCount`, `maxBoxes`, and `maxWeight`.

  * `portsâ€‹â€‹i` is the port where you need to deliver the `ith` box and `weightsi` is the weight of the `ith` box.
  * `portsCount` is the number of ports.
  * `maxBoxes` and `maxWeight` are the respective box and weight limits of the ship.

The boxes need to be delivered **in the order they are given**. The ship will
follow these steps:

  * The ship will take some number of boxes from the `boxes` queue, not violating the `maxBoxes` and `maxWeight` constraints.
  * For each loaded box **in order** , the ship will make a **trip** to the port the box needs to be delivered to and deliver it. If the ship is already at the correct port, no **trip** is needed, and the box can immediately be delivered.
  * The ship then makes a return **trip** to storage to take more boxes from the queue.

The ship must end at storage after all the boxes have been delivered.

Return _the**minimum** number of **trips** the ship needs to make to deliver
all boxes to their respective ports._



**Example 1:**

> Input: boxes = [[1,1],[2,1],[1,1]], portsCount = 2, maxBoxes = 3, maxWeight = 3
> 
> Output: 4
> 
> Explanation: The optimal strategy is as follows: 
> - The ship takes all the boxes in the queue, goes to port 1, then port 2, then port 1 again, then returns to storage. 4 trips.
> 
> So the total number of trips is 4.
> 
> Note that the first and third boxes cannot be delivered together because the boxes need to be delivered in order (i.e. the second box needs to be delivered at port 2 before the third box).

**Example 2:**

> Input: boxes = [[1,2],[3,3],[3,1],[3,1],[2,4]], portsCount = 3, maxBoxes = 3, maxWeight = 6
> 
> Output: 6
> 
> Explanation: The optimal strategy is as follows: 
> - The ship takes the first box, goes to port 1, then returns to storage. 2 trips.
> - The ship takes the second, third and fourth boxes, goes to port 3, then returns to storage. 2 trips.
> - The ship takes the fifth box, goes to port 2, then returns to storage. 2 trips.
> 
> So the total number of trips is 2 + 2 + 2 = 6.

**Example 3:**

> Input: boxes = [[1,4],[1,2],[2,1],[2,1],[3,2],[3,4]], portsCount = 3, maxBoxes = 6, maxWeight = 7
> 
> Output: 6
> 
> Explanation: The optimal strategy is as follows:
> - The ship takes the first and second boxes, goes to port 1, then returns to storage. 2 trips.
> - The ship takes the third and fourth boxes, goes to port 2, then returns to storage. 2 trips.
> - The ship takes the fifth and sixth boxes, goes to port 3, then returns to storage. 2 trips.
> 
> So the total number of trips is 2 + 2 + 2 = 6.

**Constraints:**

  * `1 <= boxes.length <= 10^5`
  * `1 <= portsCount, maxBoxes, maxWeight <= 10^5`
  * `1 <= portsâ€‹â€‹i <= portsCount`
  * `1 <= weightsi <= maxWeight`


## é¢˜ç›®å¤§æ„

ä½ æœ‰ä¸€è¾†è´§è¿å¡è½¦ï¼Œä½ éœ€è¦ç”¨è¿™ä¸€è¾†è½¦æŠŠä¸€äº›ç®±å­ä»ä»“åº“è¿é€åˆ°ç å¤´ã€‚è¿™è¾†å¡è½¦æ¯æ¬¡è¿è¾“æœ‰ **ç®±å­æ•°ç›®çš„é™åˆ¶**  å’Œ **æ€»é‡é‡çš„é™åˆ¶**  ã€‚

ç»™ä½ ä¸€ä¸ªç®±å­æ•°ç»„ `boxes` å’Œä¸‰ä¸ªæ•´æ•° `portsCount`, `maxBoxes` å’Œ `maxWeight` ï¼Œå…¶ä¸­ `boxes[i] =
[portsâ€‹â€‹iâ€‹, weighti]` ã€‚

  * `portsâ€‹â€‹i` è¡¨ç¤ºç¬¬ `i` ä¸ªç®±å­éœ€è¦é€è¾¾çš„ç å¤´ï¼Œ `weightsi` æ˜¯ç¬¬ `i` ä¸ªç®±å­çš„é‡é‡ã€‚
  * `portsCount` æ˜¯ç å¤´çš„æ•°ç›®ã€‚
  * `maxBoxes` å’Œ `maxWeight` åˆ†åˆ«æ˜¯å¡è½¦æ¯è¶Ÿè¿è¾“ç®±å­æ•°ç›®å’Œé‡é‡çš„é™åˆ¶ã€‚

ç®±å­éœ€è¦æŒ‰ç…§ **æ•°ç»„é¡ºåº**  è¿è¾“ï¼ŒåŒæ—¶æ¯æ¬¡è¿è¾“éœ€è¦éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

  * å¡è½¦ä» `boxes` é˜Ÿåˆ—ä¸­æŒ‰é¡ºåºå–å‡ºè‹¥å¹²ä¸ªç®±å­ï¼Œä½†ä¸èƒ½è¿å `maxBoxes` å’Œ `maxWeight` é™åˆ¶ã€‚
  * å¯¹äºåœ¨å¡è½¦ä¸Šçš„ç®±å­ï¼Œæˆ‘ä»¬éœ€è¦ **æŒ‰é¡ºåº**  å¤„ç†å®ƒä»¬ï¼Œå¡è½¦ä¼šé€šè¿‡ **ä¸€è¶Ÿè¡Œç¨‹**  å°†æœ€å‰é¢çš„ç®±å­é€åˆ°ç›®çš„åœ°ç å¤´å¹¶å¸è´§ã€‚å¦‚æœå¡è½¦å·²ç»åœ¨å¯¹åº”çš„ç å¤´ï¼Œé‚£ä¹ˆä¸éœ€è¦ **é¢å¤–è¡Œç¨‹**  ï¼Œç®±å­ä¹Ÿä¼šç«‹é©¬è¢«å¸è´§ã€‚
  * å¡è½¦ä¸Šæ‰€æœ‰ç®±å­éƒ½è¢«å¸è´§åï¼Œå¡è½¦éœ€è¦ **ä¸€è¶Ÿè¡Œç¨‹**  å›åˆ°ä»“åº“ï¼Œä»ç®±å­é˜Ÿåˆ—é‡Œå†å–å‡ºä¸€äº›ç®±å­ã€‚

å¡è½¦åœ¨å°†æ‰€æœ‰ç®±å­è¿è¾“å¹¶å¸è´§åï¼Œæœ€åå¿…é¡»å›åˆ°ä»“åº“ã€‚

è¯·ä½ è¿”å›å°†æ‰€æœ‰ç®±å­é€åˆ°ç›¸åº”ç å¤´çš„ **æœ€å°‘è¡Œç¨‹**  æ¬¡æ•°ã€‚



**ç¤ºä¾‹ 1ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** boxes = [[1,1],[2,1],[1,1]], portsCount = 2, maxBoxes = 3, maxWeight = 3
> 
> **è¾“å‡ºï¼š** 4
> 
> **è§£é‡Šï¼š** æœ€ä¼˜ç­–ç•¥å¦‚ä¸‹ï¼š
> - å¡è½¦å°†æ‰€æœ‰ç®±å­è£…ä¸Šè½¦ï¼Œåˆ°è¾¾ç å¤´ 1 ï¼Œç„¶åå»ç å¤´ 2 ï¼Œç„¶åå†å›åˆ°ç å¤´ 1 ï¼Œæœ€åå›åˆ°ä»“åº“ï¼Œæ€»å…±éœ€è¦ 4 è¶Ÿè¡Œç¨‹ã€‚
> 
> æ‰€ä»¥æ€»è¡Œç¨‹æ•°ä¸º 4 ã€‚
> 
> æ³¨æ„åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªç®±å­ä¸èƒ½åŒæ—¶è¢«å¸è´§ï¼Œå› ä¸ºç®±å­éœ€è¦æŒ‰é¡ºåºå¤„ç†ï¼ˆä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªç®±å­éœ€è¦å…ˆè¢«é€åˆ°ç å¤´ 2 ï¼Œç„¶åæ‰èƒ½å¤„ç†ç¬¬ä¸‰ä¸ªç®±å­ï¼‰ã€‚
> 
> 

**ç¤ºä¾‹ 2ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** boxes = [[1,2],[3,3],[3,1],[3,1],[2,4]], portsCount = 3, maxBoxes = 3, maxWeight = 6
> 
> **è¾“å‡ºï¼š** 6
> 
> **è§£é‡Šï¼š** æœ€ä¼˜ç­–ç•¥å¦‚ä¸‹ï¼š
> - å¡è½¦é¦–å…ˆè¿è¾“ç¬¬ä¸€ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 1 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬äºŒã€ç¬¬ä¸‰ã€ç¬¬å››ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 3 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬äº”ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 2 ï¼Œå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> 
> æ€»è¡Œç¨‹æ•°ä¸º 2 + 2 + 2 = 6 ã€‚
> 
> 

**ç¤ºä¾‹ 3ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** boxes = [[1,4],[1,2],[2,1],[2,1],[3,2],[3,4]], portsCount = 3, maxBoxes = 6, maxWeight = 7
> 
> **è¾“å‡ºï¼š** 6
> 
> **è§£é‡Šï¼š** æœ€ä¼˜ç­–ç•¥å¦‚ä¸‹ï¼š
> - å¡è½¦è¿è¾“ç¬¬ä¸€å’Œç¬¬äºŒä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 1 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬ä¸‰å’Œç¬¬å››ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 2 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬äº”å’Œç¬¬å…­ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 3 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> 
> æ€»è¡Œç¨‹æ•°ä¸º 2 + 2 + 2 = 6 ã€‚
> 
> 

**ç¤ºä¾‹ 4ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** boxes = [[2,4],[2,5],[3,1],[3,2],[3,7],[3,1],[4,4],[1,3],[5,2]], portsCount = 5, maxBoxes = 5, maxWeight = 7
> 
> **è¾“å‡ºï¼š** 14
> 
> **è§£é‡Šï¼š** æœ€ä¼˜ç­–ç•¥å¦‚ä¸‹ï¼š
> - å¡è½¦è¿è¾“ç¬¬ä¸€ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 2 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬äºŒä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 2 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬ä¸‰å’Œç¬¬å››ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 3 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬äº”ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 3 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 2 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬å…­å’Œç¬¬ä¸ƒä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 3 ï¼Œç„¶åå»ç å¤´ 4 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 3 è¶Ÿè¡Œç¨‹ã€‚
> - å¡è½¦è¿è¾“ç¬¬å…«å’Œç¬¬ä¹ä¸ªç®±å­ï¼Œåˆ°è¾¾ç å¤´ 1 ï¼Œç„¶åå»ç å¤´ 5 ï¼Œç„¶åå›åˆ°ä»“åº“ï¼Œæ€»å…± 3 è¶Ÿè¡Œç¨‹ã€‚
> 
> æ€»è¡Œç¨‹æ•°ä¸º 2 + 2 + 2 + 2 + 3 + 3 = 14 ã€‚
> 
> 



**æç¤ºï¼š**

  * `1 <= boxes.length <= 10^5`
  * `1 <= portsCount, maxBoxes, maxWeight <= 10^5`
  * `1 <= portsâ€‹â€‹i <= portsCount`
  * `1 <= weightsi <= maxWeight`


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```