---
title: 2691. ä¸å¯å˜è¾…åŠ©å·¥å…· ğŸ”’
description: LeetCode 2691. ä¸å¯å˜è¾…åŠ©å·¥å…· ğŸ”’é¢˜è§£ï¼ŒImmutability Helperï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 2691. ä¸å¯å˜è¾…åŠ©å·¥å…· ğŸ”’
  - ä¸å¯å˜è¾…åŠ©å·¥å…·
  - Immutability Helper
  - è§£é¢˜æ€è·¯
---

# 2691. ä¸å¯å˜è¾…åŠ©å·¥å…· ğŸ”’

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/immutability-helper) [`LeetCode`](https://leetcode.com/problems/immutability-helper)

## é¢˜ç›®

Creating clones of immutable objects with minor alterations can be a tedious
process. Write a class `ImmutableHelper` that serves as a tool to help with
this requirement. The constructor accepts an immutable object `obj` which will
be a JSON object or array.

The class has a single method `produce` which accepts a function `mutator`.
The function returns a new object which is similar to the original except it
has those mutations applied.

`mutator` accepts a **proxied**  version of `obj`. A user of this function can
(appear to) mutate this object, but the original object `obj` should not
actually be effected.

For example, a user could write code like this:

> 
> 
> 
> 
> 
> const originalObj = {"x": 5};
> 
> const helper = new ImmutableHelper(originalObj);
> 
> const newObj = helper.produce((proxy) => {
> 
>   proxy.x = proxy.x + 1;
> 
> });
> 
> console.log(originalObj); // {"x": 5}
> 
> console.log(newObj); // {"x": 6}

Properties of the `mutator` function:

  * It will always return `undefined`.
  * It will never access keys that don't exist.
  * It will never delete keys (`delete obj.key`)
  * It will never call methods on a proxied object (`push`, `shift`, etc).
  * It will never set keys to objects (`proxy.x = {}`)

**Note on how the solution will be tested:**  the solution validator will only
analyze differences between what was returned and the original `obj`. Doing a
full comparison would be too computationally expensive. Also, any mutations to
the original object will result in a wrong answer.



**Example 1:**

> Input: 
> 
> obj = {"val": 10}, 
> 
> mutators = [
> 
>   proxy => { proxy.val += 1; },
> 
>   proxy => { proxy.val -= 1; }
> 
> ]
> 
> Output: 
> 
> [
> 
>   {"val": 11},
> 
>   {"val": 9}
> 
> ]
> 
> Explanation:
> 
> const helper = new ImmutableHelper({val: 10});
> 
> helper.produce(proxy => { proxy.val += 1; }); // { "val": 11 }
> 
> helper.produce(proxy => { proxy.val -= 1; }); // { "val": 9 }

**Example 2:**

> Input: 
> 
> obj = {"arr": [1, 2, 3]} 
> 
> mutators = [
> 
>  proxy => { 
> 
>    proxy.arr[0] = 5; 
> 
>    proxy.newVal = proxy.arr[0] + proxy.arr[1];
> 
>  }
> 
> ]
> 
> Output: 
> 
> [
> 
>   {"arr": [5, 2, 3], "newVal": 7 } 
> 
> ]
> 
> Explanation: Two edits were made to the original array. The first element in the array was to set 5. Then a new key was added with a value of 7.

**Example 3:**

> Input: 
> 
> obj = {"obj": {"val": {"x": 10, "y": 20}}}
> 
> mutators = [
> 
>   proxy => { 
> 
> > 
> let data = proxy.obj.val; 
> 
> > 
> let temp = data.x; 
> 
> > 
> data.x = data.y; 
> 
> > 
> data.y = temp; 
> 
>   }
> 
> ]
> 
> Output: 
> 
> [
> 
>   {"obj": {"val": {"x": 20, "y": 10}}}
> 
> ]
> 
> Explanation: The values of "x" and "y" were swapped.

**Constraints:**

  * `2 <= JSON.stringify(obj).length <= 4 * 10^5`
  * `mutators` is an array of functions
  * `total calls to produce() < 10^5`


## é¢˜ç›®å¤§æ„

åˆ›å»ºå¸¦æœ‰å¾®å°ä¿®æ”¹çš„ä¸å¯å˜å¯¹è±¡çš„å…‹éš†å‰¯æœ¬æ˜¯ä¸€ä¸ªç¹ççš„è¿‡ç¨‹ã€‚è¯·ä½ ç¼–å†™ä¸€ä¸ªåä¸º `ImmutableHelper`
çš„ç±»ï¼Œä½œä¸ºæ»¡è¶³è¿™ä¸€è¦æ±‚çš„å·¥å…·ã€‚æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ `obj` ï¼Œè¯¥å¯¹è±¡å°†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡æˆ–æ•°ç»„ã€‚

è¯¥ç±»æœ‰ä¸€ä¸ªåä¸º `produce` çš„æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªåä¸º `mutator` çš„å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå®ƒä¸åŸå§‹å¯¹è±¡ç›¸ä¼¼ï¼Œä½†åº”ç”¨äº†è¿™äº›å˜åŒ–ã€‚

`mutator` å‡½æ•°æ¥å— `obj` çš„ **ä»£ç†** ç‰ˆæœ¬ã€‚å‡½æ•°çš„ä½¿ç”¨è€…å¯ä»¥ï¼ˆçœ‹èµ·æ¥ï¼‰å¯¹è¯¥å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œä½†åŸå§‹å¯¹è±¡ `obj` å®é™…ä¸Šæ²¡æœ‰è¢«æ”¹å˜ã€‚

ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ç¼–å†™å¦‚ä¸‹ä»£ç ï¼š

> 
> 
> 
> 
> 
> const originalObj = {"x": 5};
> 
> const helper = new ImmutableHelper(originalObj);
> 
> const newObj = helper.produce((proxy) => {
> 
>   proxy.x = proxy.x + 1;
> 
> });
> 
> console.log(originalObj); // {"x": 5}
> 
> console.log(newObj); // {"x": 6}

`mutator` å‡½æ•°çš„å±æ€§ï¼š

  * å®ƒå§‹ç»ˆè¿”å› `undefined` ã€‚
  * å®ƒæ°¸è¿œä¸ä¼šè®¿é—®ä¸å­˜åœ¨çš„é”®ã€‚
  * å®ƒæ°¸è¿œä¸ä¼šåˆ é™¤é”®ï¼ˆ `delete obj.key` ï¼‰ã€‚
  * å®ƒæ°¸è¿œä¸ä¼šåœ¨ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•ï¼ˆ `push` ã€`shift` ç­‰ï¼‰ã€‚
  * å®ƒæ°¸è¿œä¸ä¼šå°†é”®è®¾ç½®ä¸ºå¯¹è±¡ï¼ˆ `proxy.x = {}` ï¼‰ã€‚

**å…³äºå¦‚ä½•æµ‹è¯•è§£å†³æ–¹æ¡ˆçš„è¯´æ˜ï¼š** è§£å†³æ–¹æ¡ˆéªŒè¯å™¨ä»…åˆ†æè¿”å›ç»“æœä¸åŸå§‹ `obj`
ä¹‹é—´çš„å·®å¼‚ã€‚è¿›è¡Œå®Œå…¨æ¯”è¾ƒçš„è®¡ç®—å¼€é”€å¤ªå¤§ã€‚æ­¤å¤–ï¼Œå¯¹åŸå§‹å¯¹è±¡è¿›è¡Œçš„ä»»ä½•å˜æ›´éƒ½å°†å¯¼è‡´ç­”æ¡ˆé”™è¯¯ã€‚



**ç¤ºä¾‹ 1ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š**
> 
> obj = {"val": 10}, 
> 
> mutators = [
> 
>   proxy => { proxy.val += 1; },
> 
>   proxy => { proxy.val -= 1; }
> 
> ]
> 
> **è¾“å‡ºï¼š**
> 
> [
> 
>   {"val": 11},
> 
>   {"val": 9}
> 
> ]
> 
> **è§£é‡Šï¼š**
> 
> const helper = new ImmutableHelper({val: 10});
> 
> helper.produce(proxy => { proxy.val += 1; }); // { "val": 11 }
> 
> helper.produce(proxy => { proxy.val -= 1; }); // { "val": 9 }
> 
> 

**ç¤ºä¾‹ 2ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š**
> 
> obj = {"arr": [1, 2, 3]} 
> 
> mutators = [
> 
>  proxy => { 
> 
>    proxy.arr[0] = 5; 
> 
>    proxy.newVal = proxy.arr[0] + proxy.arr[1];
> 
>  }
> 
> ]
> 
> **è¾“å‡ºï¼š**
> 
> [
> 
>   {"arr": [5, 2, 3], "newVal": 7 } 
> 
> ]
> 
> **è§£é‡Šï¼š** å¯¹åŸå§‹æ•°ç»„è¿›è¡Œäº†ä¸¤æ¬¡ç¼–è¾‘ã€‚é¦–å…ˆå°†æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ è®¾ç½®ä¸º 5ã€‚ç„¶åæ·»åŠ äº†ä¸€ä¸ªå€¼ä¸º 7 çš„æ–°é”®ã€‚
> 
> 

**ç¤ºä¾‹ 3ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š**
> 
> obj = {"obj": {"val": {"x": 10, "y": 20}}}
> 
> mutators = [
> 
>   proxy => { 
> 
> > 
> let data = proxy.obj.val; 
> 
> > 
> let temp = data.x; 
> 
> > 
> data.x = data.y; 
> 
> > 
> data.y = temp; 
> 
>   }
> 
> ]
> 
> **è¾“å‡ºï¼š**
> 
> [
> 
>   {"obj": {"val": {"x": 20, "y": 10}}}
> 
> ]
> 
> **è§£é‡Šï¼š** äº¤æ¢äº† "x" å’Œ "y" çš„å€¼ã€‚
> 
> 



**æç¤ºï¼š**

  * `2 <= JSON.stringify(obj).length <= 4 * 10^5`
  * `produce() çš„æ€»è°ƒç”¨æ¬¡æ•° < 10^5`


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 2690 | æ— ç©·æ–¹æ³•å¯¹è±¡ ğŸ”’ | [[âœ“]](/problem/2690.md) |  | ğŸŸ¢ | [ğŸ€„ï¸](https://leetcode.cn/problems/infinite-method-object) [ğŸ”—](https://leetcode.com/problems/infinite-method-object) |
| 2692 | ä½¿å¯¹è±¡ä¸å¯å˜ ğŸ”’ | [[âœ“]](/problem/2692.md) |  | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/make-object-immutable) [ğŸ”—](https://leetcode.com/problems/make-object-immutable) |