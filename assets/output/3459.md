---
title: 3459. 最长 V 形对角线段的长度
description: LeetCode 3459. 最长 V 形对角线段的长度题解，Length of Longest V-Shaped Diagonal Segment，包含解题思路、复杂度分析以及完整的 JavaScript 代码实现。
keywords:
  - LeetCode
  - 3459. 最长 V 形对角线段的长度
  - 最长 V 形对角线段的长度
  - Length of Longest V-Shaped Diagonal Segment
  - 解题思路
  - 记忆化搜索
  - 数组
  - 动态规划
  - 矩阵
---

# 3459. 最长 V 形对角线段的长度

🔴 <font color=#ff334b>Hard</font>&emsp; 🔖&ensp; [`记忆化搜索`](/tag/memoization.md) [`数组`](/tag/array.md) [`动态规划`](/tag/dynamic-programming.md) [`矩阵`](/tag/matrix.md)&emsp; 🔗&ensp;[`力扣`](https://leetcode.cn/problems/length-of-longest-v-shaped-diagonal-segment) [`LeetCode`](https://leetcode.com/problems/length-of-longest-v-shaped-diagonal-segment)

## 题目

You are given a 2D integer matrix `grid` of size `n x m`, where each element
is either `0`, `1`, or `2`.

A **V-shaped diagonal segment** is defined as:

  * The segment starts with `1`.
  * The subsequent elements follow this infinite sequence: `2, 0, 2, 0, ...`.
  * The segment: 
> 
> * Starts **along** a diagonal direction (top-left to bottom-right, bottom-right to top-left, top-right to bottom-left, or bottom-left to top-right).
> 
> * Continues the**sequence** in the same diagonal direction.
> 
> * Makes**at most one clockwise 90-degree****turn** to another diagonal direction while **maintaining** the sequence.

![](https://assets.leetcode.com/uploads/2025/01/11/length_of_longest3.jpg)

Return the **length** of the **longest** **V-shaped diagonal segment**. If no
valid segment _exists_ , return 0.



**Example 1:**

**Input:** grid =
[[2,2,1,2,2],[2,0,2,2,0],[2,0,1,1,0],[1,0,2,2,2],[2,0,0,2,2]]

**Output:** 5

**Explanation:**

![](https://assets.leetcode.com/uploads/2024/12/09/matrix_1-2.jpg)

The longest V-shaped diagonal segment has a length of 5 and follows these
coordinates: `(0,2) -> (1,3) -> (2,4)`, takes a **90-degree clockwise turn**
at `(2,4)`, and continues as `(3,3) -> (4,2)`.

**Example 2:**

**Input:** grid =
[[2,2,2,2,2],[2,0,2,2,0],[2,0,1,1,0],[1,0,2,2,2],[2,0,0,2,2]]

**Output:** 4

**Explanation:**

**![](https://assets.leetcode.com/uploads/2024/12/09/matrix_2.jpg)**

The longest V-shaped diagonal segment has a length of 4 and follows these
coordinates: `(2,3) -> (3,2)`, takes a **90-degree clockwise turn** at
`(3,2)`, and continues as `(2,1) -> (1,0)`.

**Example 3:**

**Input:** grid =
[[1,2,2,2,2],[2,2,2,2,0],[2,0,0,0,0],[0,0,2,2,2],[2,0,0,2,0]]

**Output:** 5

**Explanation:**

**![](https://assets.leetcode.com/uploads/2024/12/09/matrix_3.jpg)**

The longest V-shaped diagonal segment has a length of 5 and follows these
coordinates: `(0,0) -> (1,1) -> (2,2) -> (3,3) -> (4,4)`.

**Example 4:**

**Input:** grid = [[1]]

**Output:** 1

**Explanation:**

The longest V-shaped diagonal segment has a length of 1 and follows these
coordinates: `(0,0)`.



**Constraints:**

  * `n == grid.length`
  * `m == grid[i].length`
  * `1 <= n, m <= 500`
  * `grid[i][j]` is either `0`, `1` or `2`.


## 题目大意

给你一个大小为 `n x m` 的二维整数矩阵 `grid`，其中每个元素的值为 `0`、`1` 或 `2`。

**V 形对角线段** 定义如下：

  * 线段从 `1` 开始。
  * 后续元素按照以下无限序列的模式排列：`2, 0, 2, 0, ...`。
  * 该线段： 
> 
> * 起始于某个对角方向（左上到右下、右下到左上、右上到左下或左下到右上）。
> 
> * 沿着相同的对角方向继续，保持 **序列模式  **。
> 
> * 在保持 **序列模式  **的前提下，最多允许 **一次顺时针 90 度转向  **另一个对角方向。

![](https://pic.leetcode.cn/1739609732-jHpPma-length_of_longest3.jpg)

返回最长的 **V 形对角线段  **的 **长度  **。如果不存在有效的线段，则返回 0。



**示例 1：**

**输入：** grid = [[2,2,1,2,2],[2,0,2,2,0],[2,0,1,1,0],[1,0,2,2,2],[2,0,0,2,2]]

**输出：** 5

**解释：**

![](https://pic.leetcode.cn/1739609768-rhePxN-matrix_1-2.jpg)

最长的 V 形对角线段长度为 5，路径如下：`(0,2) → (1,3) → (2,4)`，在 `(2,4)` 处进行 **顺时针 90 度转向
**，继续路径为 `(3,3) → (4,2)`。

**示例 2：**

**输入：** grid = [[2,2,2,2,2],[2,0,2,2,0],[2,0,1,1,0],[1,0,2,2,2],[2,0,0,2,2]]

**输出：** 4

**解释：**

![](https://pic.leetcode.cn/1739609774-nYJElV-matrix_2.jpg)

最长的 V 形对角线段长度为 4，路径如下：`(2,3) → (3,2)`，在 `(3,2)` 处进行 **顺时针 90 度转向  **，继续路径为
`(2,1) → (1,0)`。

**示例 3：**

**输入：** grid = [[1,2,2,2,2],[2,2,2,2,0],[2,0,0,0,0],[0,0,2,2,2],[2,0,0,2,0]]

**输出：** 5

**解释：**

![](https://pic.leetcode.cn/1739609780-tlkdUW-matrix_3.jpg)

最长的 V 形对角线段长度为 5，路径如下：`(0,0) → (1,1) → (2,2) → (3,3) → (4,4)`。

**示例 4：**

**输入：** grid = [[1]]

**输出：** 1

**解释：**

最长的 V 形对角线段长度为 1，路径如下：`(0,0)`。



**提示：**

  * `n == grid.length`
  * `m == grid[i].length`
  * `1 <= n, m <= 500`
  * `grid[i][j]` 的值为 `0`、`1` 或 `2`。


## 解题思路

#### 复杂度分析

- **时间复杂度**：`O()`，
- **空间复杂度**：`O()`，

## 代码

```javascript

```