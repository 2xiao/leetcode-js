# [3214. åŒæ¯”å¢é•¿ç‡](https://leetcode.com/problems/year-on-year-growth-rate)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ•°æ®åº“`](/tag/database.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/year-on-year-growth-rate)

## é¢˜ç›®

Table: `user_transactions`

> 
> 
> 
> 
> 
> +------------------+----------+
> 
> | Column Name> 
>   | Type> 
>  | 
> 
> +------------------+----------+
> 
> | transaction_id   | integer  |
> 
> | product_id> 
>    | integer  |
> 
> | spend> 
> > 
> > 
> | decimal  |
> 
> | transaction_date | datetime |
> 
> +------------------+----------+
> 
> The transaction_id column uniquely identifies each row in this table.
> 
> Each row of this table contains the transaction ID, product ID, the spend amount, and the transaction date.
> 
> 

Write a solution to calculate the **year-on-year growth rate** for the total
spend **for each product**.

The result table should include the following columns:

  * `year`: The year of the transaction.
  * `product_id`: The ID of the product.
  * `curr_year_spend`: The total spend for the current year.
  * `prev_year_spend`: The total spend for the previous year.
  * `yoy_rate`: The year-on-year growth rate percentage, rounded to `2` decimal places.

Return _the result table ordered by_  `product_id`,`year` _in**ascending**
order_.

The result format is in the following example.



**Example:**

**Input:**

`user_transactions` table:

> 
> 
> 
> 
> 
> +----------------+------------+---------+---------------------+
> 
> | transaction_id | product_id | spend   | transaction_date> 
> |
> 
> +----------------+------------+---------+---------------------+
> 
> | 1341> 
> > 
>    | 123424> 
>  | 1500.60 | 2019-12-31 12:00:00 |
> 
> | 1423> 
> > 
>    | 123424> 
>  | 1000.20 | 2020-12-31 12:00:00 |
> 
> | 1623> 
> > 
>    | 123424> 
>  | 1246.44 | 2021-12-31 12:00:00 |
> 
> | 1322> 
> > 
>    | 123424> 
>  | 2145.32 | 2022-12-31 12:00:00 |
> 
> +----------------+------------+---------+---------------------+
> 
> 

**Output:**

> 
> 
> 
> 
> 
> +------+------------+----------------+----------------+----------+
> 
> | year | product_id | curr_year_spend| prev_year_spend| yoy_rate |
> 
> +------+------------+----------------+----------------+----------+
> 
> | 2019 | 123424> 
>  | 1500.60> 
> > 
> | NULL> 
> > 
>    | NULL> 
>  |
> 
> | 2020 | 123424> 
>  | 1000.20> 
> > 
> | 1500.60> 
> > 
> | -33.35   |
> 
> | 2021 | 123424> 
>  | 1246.44> 
> > 
> | 1000.20> 
> > 
> | 24.62> 
> |
> 
> | 2022 | 123424> 
>  | 2145.32> 
> > 
> | 1246.44> 
> > 
> | 72.12> 
> |
> 
> +------+------------+----------------+----------------+----------+
> 
> 

**Explanation:**

  * For product ID 123424: 
> 
> * In 2019: 
> 
>   * Current year's spend is 1500.60
> 
>   * No previous year's spend recorded
> 
>   * YoY growth rate: NULL
> 
> * In 2020: 
> 
>   * Current year's spend is 1000.20
> 
>   * Previous year's spend is 1500.60
> 
>   * YoY growth rate: ((1000.20 - 1500.60) / 1500.60) * 100 = -33.35%
> 
> * In 2021: 
> 
>   * Current year's spend is 1246.44
> 
>   * Previous year's spend is 1000.20
> 
>   * YoY growth rate: ((1246.44 - 1000.20) / 1000.20) * 100 = 24.62%
> 
> * In 2022: 
> 
>   * Current year's spend is 2145.32
> 
>   * Previous year's spend is 1246.44
> 
>   * YoY growth rate: ((2145.32 - 1246.44) / 1246.44) * 100 = 72.12%

**Note:** Output table is ordered by `product_id` and `year` in ascending
order.


## é¢˜ç›®å¤§æ„

è¡¨ï¼š`user_transactions`

> 
> 
> 
> 
> 
> +------------------+----------+
> 
> | Column Name> 
>   | Type> 
>  | 
> 
> +------------------+----------+
> 
> | transaction_id   | integer  |
> 
> | product_id> 
>    | integer  |
> 
> | spend> 
> > 
> > 
> | decimal  |
> 
> | transaction_date | datetime |
> 
> +------------------+----------+
> 
> transaction_id åˆ—å”¯ä¸€æ ‡è¯†äº†è¡¨ä¸­çš„æ¯ä¸€åˆ—ã€‚
> 
> è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œå«æœ‰äº¤æ˜“ IDï¼Œäº§å“ IDï¼Œæ€»èŠ±è´¹ä»¥åŠäº¤æ˜“æ—¥æœŸã€‚
> 
> 

ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥è®¡ç®— **æ¯ä¸ªäº§å“** æ€»æ”¯å‡ºçš„ **åŒæ¯”å¢é•¿ç‡** ã€‚

ç»“æœè¡¨åº”è¯¥åŒ…å«ä»¥ä¸‹åˆ—ï¼š

  * `year`ï¼šäº¤æ˜“çš„å¹´ä»½ã€‚
  * `product_id`ï¼šäº§å“çš„ IDã€‚
  * `curr_year_spend`ï¼šå½“å¹´çš„æ€»æ”¯å‡ºã€‚
  * `prev_year_spend`ï¼šä¸Šä¸€å¹´çš„æ€»æ”¯å‡ºã€‚
  * `yoy_rate`ï¼šåŒæ¯”å¢é€Ÿç™¾åˆ†æ¯”ï¼Œå››èˆäº”å…¥è‡³å°æ•°ç‚¹å 2 ä½ã€‚

è¿”å›ç»“æœè¡¨ä»¥ `product_id`ï¼Œ`year` **å‡åº** æ’åºã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ï¼š**

**è¾“å…¥ï¼š**

`user_transactions` è¡¨ï¼š

> 
> 
> 
> 
> 
> +----------------+------------+---------+---------------------+
> 
> | transaction_id | product_id | spend   | transaction_date> 
> |
> 
> +----------------+------------+---------+---------------------+
> 
> | 1341> 
> > 
>    | 123424> 
>  | 1500.60 | 2019-12-31 12:00:00 |
> 
> | 1423> 
> > 
>    | 123424> 
>  | 1000.20 | 2020-12-31 12:00:00 |
> 
> | 1623> 
> > 
>    | 123424> 
>  | 1246.44 | 2021-12-31 12:00:00 |
> 
> | 1322> 
> > 
>    | 123424> 
>  | 2145.32 | 2022-12-31 12:00:00 |
> 
> +----------------+------------+---------+---------------------+
> 
> 

**è¾“å‡ºï¼š**

> 
> 
> 
> 
> 
> +------+------------+----------------+----------------+----------+
> 
> | year | product_id | curr_year_spend| prev_year_spend| yoy_rate |
> 
> +------+------------+----------------+----------------+----------+
> 
> | 2019 | 123424> 
>  | 1500.60> 
> > 
> | NULL> 
> > 
>    | NULL> 
>  |
> 
> | 2020 | 123424> 
>  | 1000.20> 
> > 
> | 1500.60> 
> > 
> | -33.35   |
> 
> | 2021 | 123424> 
>  | 1246.44> 
> > 
> | 1000.20> 
> > 
> | 24.62> 
> |
> 
> | 2022 | 123424> 
>  | 2145.32> 
> > 
> | 1246.44> 
> > 
> | 72.12> 
> |
> 
> +------+------------+----------------+----------------+----------+
> 
> 

**è§£é‡Šï¼š**

  * å¯¹äºäº§å“ ID 123424: 
> 
> * åœ¨ 2019ï¼š 
> 
>   * å½“å¹´çš„æ”¯å‡ºæ˜¯ 1500.60
> 
>   * æ²¡æœ‰ä¸Šä¸€å¹´æ”¯å‡ºçš„è®°å½•
> 
>   * åŒæ¯”å¢é•¿ç‡ï¼šNULL
> 
> * åœ¨ 2020ï¼š 
> 
>   * å½“å¹´çš„æ”¯å‡ºæ˜¯ 1000.20
> 
>   * ä¸Šä¸€å¹´çš„æ”¯å‡ºæ˜¯ 1500.60
> 
>   * åŒæ¯”å¢é•¿ç‡ï¼š((1000.20 - 1500.60) / 1500.60) * 100 = -33.35%
> 
> * åœ¨ 2021ï¼š 
> 
>   * å½“å¹´çš„æ”¯å‡ºæ˜¯ 1246.44
> 
>   * ä¸Šä¸€å¹´çš„æ”¯å‡ºæ˜¯ 1000.20
> 
>   * åŒæ¯”å¢é•¿ç‡ï¼š((1246.44 - 1000.20) / 1000.20) * 100 = 24.62%
> 
> * åœ¨ 2022ï¼š 
> 
>   * å½“å¹´çš„æ”¯å‡ºæ˜¯ 2145.32
> 
>   * ä¸Šä¸€å¹´çš„æ”¯å‡ºæ˜¯ 1246.44
> 
>   * åŒæ¯”å¢é•¿ç‡ï¼š((2145.32 - 1246.44) / 1246.44) * 100 = 72.12%

**æ³¨æ„ï¼š** è¾“å‡ºè¡¨ä»¥ `product_id` å’Œ `year` å‡åºæ’åºã€‚


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```