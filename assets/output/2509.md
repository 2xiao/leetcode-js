# [2509. æŸ¥è¯¢æ ‘ä¸­ç¯çš„é•¿åº¦](https://2xiao.github.io/leetcode-js/problem/2509.html)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ‘`](/tag/tree.md) [`æ•°ç»„`](/tag/array.md) [`äºŒå‰æ ‘`](/tag/binary-tree.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/cycle-length-queries-in-a-tree) [`LeetCode`](https://leetcode.com/problems/cycle-length-queries-in-a-tree)

## é¢˜ç›®

You are given an integer `n`. There is a **complete binary tree** with `2n -
1` nodes. The root of that tree is the node with the value `1`, and every node
with a value `val` in the range `[1, 2n - 1 - 1]` has two children where:

  * The left node has the value `2 * val`, and
  * The right node has the value `2 * val + 1`.

You are also given a 2D integer array `queries` of length `m`, where
`queries[i] = [ai, bi]`. For each query, solve the following problem:

  1. Add an edge between the nodes with values `ai` and `bi`.
  2. Find the length of the cycle in the graph.
  3. Remove the added edge between nodes with values `ai` and `bi`.

**Note** that:

  * A **cycle** is a path that starts and ends at the same node, and each edge in the path is visited only once.
  * The length of a cycle is the number of edges visited in the cycle.
  * There could be multiple edges between two nodes in the tree after adding the edge of the query.

Return _an array_`answer` _of length_`m` _where_ `answer[i]` _is the answer to
the_ `ith` _query._



**Example 1:**

![](https://assets.leetcode.com/uploads/2022/10/25/bexample1.png)

> Input: n = 3, queries = [[5,3],[4,7],[2,3]]
> 
> Output: [4,5,3]
> 
> Explanation: The diagrams above show the tree of 23 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.
> - After adding the edge between nodes 3 and 5, the graph contains a cycle of nodes [5,2,1,3]. Thus answer to the first query is 4. We delete the added edge and process the next query.
> - After adding the edge between nodes 4 and 7, the graph contains a cycle of nodes [4,2,1,3,7]. Thus answer to the second query is 5. We delete the added edge and process the next query.
> - After adding the edge between nodes 2 and 3, the graph contains a cycle of nodes [2,1,3]. Thus answer to the third query is 3. We delete the added edge.

**Example 2:**

![](https://assets.leetcode.com/uploads/2022/10/25/aexample2.png)

> Input: n = 2, queries = [[1,2]]
> 
> Output: [2]
> 
> Explanation: The diagram above shows the tree of 22 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.
> - After adding the edge between nodes 1 and 2, the graph contains a cycle of nodes [2,1]. Thus answer for the first query is 2. We delete the added edge.

**Constraints:**

  * `2 <= n <= 30`
  * `m == queries.length`
  * `1 <= m <= 10^5`
  * `queries[i].length == 2`
  * `1 <= ai, bi <= 2n - 1`
  * `ai != bi`


## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` ï¼Œè¡¨ç¤ºä½ æœ‰ä¸€æ£µå«æœ‰ `2n - 1` ä¸ªèŠ‚ç‚¹çš„ **å®Œå…¨äºŒå‰æ ‘**  ã€‚æ ¹èŠ‚ç‚¹çš„ç¼–å·æ˜¯ `1` ï¼Œæ ‘ä¸­ç¼–å·åœ¨`[1, 2n - 1 -
1]` ä¹‹é—´ï¼Œç¼–å·ä¸º `val` çš„èŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæ»¡è¶³ï¼š

  * å·¦å­èŠ‚ç‚¹çš„ç¼–å·ä¸º `2 * val`
  * å³å­èŠ‚ç‚¹çš„ç¼–å·ä¸º `2 * val + 1`

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º `m` çš„æŸ¥è¯¢æ•°ç»„ `queries` ï¼Œå®ƒæ˜¯ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ï¼Œå…¶ä¸­ `queries[i] = [ai, bi]`
ã€‚å¯¹äºæ¯ä¸ªæŸ¥è¯¢ï¼Œæ±‚å‡ºä»¥ä¸‹é—®é¢˜çš„è§£ï¼š

  1. åœ¨èŠ‚ç‚¹ç¼–å·ä¸º `ai` å’Œ `bi` ä¹‹é—´æ·»åŠ ä¸€æ¡è¾¹ã€‚
  2. æ±‚å‡ºå›¾ä¸­ç¯çš„é•¿åº¦ã€‚
  3. åˆ é™¤èŠ‚ç‚¹ç¼–å·ä¸º `ai` å’Œ `bi` ä¹‹é—´æ–°æ·»åŠ çš„è¾¹ã€‚

**æ³¨æ„ï¼š**

  * **ç¯** æ˜¯å¼€å§‹å’Œç»“æŸäºåŒä¸€èŠ‚ç‚¹çš„ä¸€æ¡è·¯å¾„ï¼Œè·¯å¾„ä¸­æ¯æ¡è¾¹éƒ½åªä¼šè¢«è®¿é—®ä¸€æ¬¡ã€‚
  * ç¯çš„é•¿åº¦æ˜¯ç¯ä¸­è¾¹çš„æ•°ç›®ã€‚
  * åœ¨æ ‘ä¸­æ·»åŠ é¢å¤–çš„è¾¹åï¼Œä¸¤ä¸ªç‚¹ä¹‹é—´å¯èƒ½ä¼šæœ‰å¤šæ¡è¾¹ã€‚

è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º `m` çš„æ•°ç»„ _ _`answer` ï¼Œå…¶ä¸­ `answer[i]` æ˜¯ç¬¬ `i` ä¸ªæŸ¥è¯¢çš„ç»“æœ _ã€‚_



**ç¤ºä¾‹ 1ï¼š**

![](https://assets.leetcode.com/uploads/2022/10/25/bexample1.png)

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** n = 3, queries = [[5,3],[4,7],[2,3]]
> 
> **è¾“å‡ºï¼š**[4,5,3]
> 
> **è§£é‡Šï¼š** ä¸Šå›¾æ˜¯ä¸€æ£µæœ‰ 23 - 1 ä¸ªèŠ‚ç‚¹çš„æ ‘ã€‚çº¢è‰²èŠ‚ç‚¹è¡¨ç¤ºæ·»åŠ é¢å¤–è¾¹åå½¢æˆç¯çš„èŠ‚ç‚¹ã€‚
> - åœ¨èŠ‚ç‚¹ 3 å’ŒèŠ‚ç‚¹ 5 ä¹‹é—´æ·»åŠ è¾¹åï¼Œç¯ä¸º [5,2,1,3] ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœæ˜¯ 4 ã€‚åˆ æ‰æ·»åŠ çš„è¾¹åå¤„ç†ä¸‹ä¸€ä¸ªæŸ¥è¯¢ã€‚
> - åœ¨èŠ‚ç‚¹ 4 å’ŒèŠ‚ç‚¹ 7 ä¹‹é—´æ·»åŠ è¾¹åï¼Œç¯ä¸º [4,2,1,3,7] ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªæŸ¥è¯¢çš„ç»“æœæ˜¯ 5 ã€‚åˆ æ‰æ·»åŠ çš„è¾¹åå¤„ç†ä¸‹ä¸€ä¸ªæŸ¥è¯¢ã€‚
> - åœ¨èŠ‚ç‚¹ 2 å’ŒèŠ‚ç‚¹ 3 ä¹‹é—´æ·»åŠ è¾¹åï¼Œç¯ä¸º [2,1,3] ï¼Œæ‰€ä»¥ç¬¬ä¸‰ä¸ªæŸ¥è¯¢çš„ç»“æœæ˜¯ 3 ã€‚åˆ æ‰æ·»åŠ çš„è¾¹ã€‚
> 
> 

**ç¤ºä¾‹ 2ï¼š**

![](https://assets.leetcode.com/uploads/2022/10/25/aexample2.png)

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** n = 2, queries = [[1,2]]
> 
> **è¾“å‡ºï¼š**[2]
> 
> **è§£é‡Šï¼š** ä¸Šå›¾æ˜¯ä¸€æ£µæœ‰ 22 - 1 ä¸ªèŠ‚ç‚¹çš„æ ‘ã€‚çº¢è‰²èŠ‚ç‚¹è¡¨ç¤ºæ·»åŠ é¢å¤–è¾¹åå½¢æˆç¯çš„èŠ‚ç‚¹ã€‚
> - åœ¨èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 2 ä¹‹é—´æ·»åŠ è¾¹åï¼Œç¯ä¸º [2,1] ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªæŸ¥è¯¢çš„ç»“æœæ˜¯ 2 ã€‚åˆ æ‰æ·»åŠ çš„è¾¹ã€‚
> 
> 



**æç¤ºï¼š**

  * `2 <= n <= 30`
  * `m == queries.length`
  * `1 <= m <= 10^5`
  * `queries[i].length == 2`
  * `1 <= ai, bi <= 2n - 1`
  * `ai != bi`


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 116 | [å¡«å……æ¯ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªå³ä¾§èŠ‚ç‚¹æŒ‡é’ˆ](https://leetcode.com/problems/populating-next-right-pointers-in-each-node) | [[âœ“]](/problem/0116.md) |  [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) `2+` | <font color=#ffb800>Medium</font> |
| 236 | [äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ](https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree) | [[âœ“]](/problem/0236.md) |  [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`äºŒå‰æ ‘`](/tag/binary-tree.md) | <font color=#ffb800>Medium</font> |
| 1104 | [äºŒå‰æ ‘å¯»è·¯](https://leetcode.com/problems/path-in-zigzag-labelled-binary-tree) |  |  [`æ ‘`](/tag/tree.md) [`æ•°å­¦`](/tag/math.md) [`äºŒå‰æ ‘`](/tag/binary-tree.md) | <font color=#ffb800>Medium</font> |