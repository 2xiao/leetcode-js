# [262. è¡Œç¨‹å’Œç”¨æˆ·](https://leetcode.com/problems/trips-and-users)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ•°æ®åº“`](/leetcode/outline/tag/database.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/trips-and-users)


## é¢˜ç›®

Table: `Trips`

> 
> 
> 
> 
> 
> +-------------+----------+
> 
> | Column Name | Type> 
>  |
> 
> +-------------+----------+
> 
> | id> 
> > 
>   | int> 
>   |
> 
> | client_id   | int> 
>   |
> 
> | driver_id   | int> 
>   |
> 
> | city_id> 
>  | int> 
>   |
> 
> | status> 
>   | enum> 
>  |
> 
> | request_at  | varchar  |> 
>  
> 
> +-------------+----------+
> 
> id is the primary key (column with unique values) for this table.
> 
> The table holds all taxi trips. Each trip has a unique id, while client_id and driver_id are foreign keys to the users_id at the Users table.
> 
> Status is an ENUM (category) type of ('completed', 'cancelled_by_driver', 'cancelled_by_client').
> 
> 



Table: `Users`

> 
> 
> 
> 
> 
> +-------------+----------+
> 
> | Column Name | Type> 
>  |
> 
> +-------------+----------+
> 
> | users_id> 
> | int> 
>   |
> 
> | banned> 
>   | enum> 
>  |
> 
> | role> 
> > 
> | enum> 
>  |
> 
> +-------------+----------+
> 
> users_id is the primary key (column with unique values) for this table.
> 
> The table holds all users. Each user has a unique users_id, and role is an ENUM type of ('client', 'driver', 'partner').
> 
> banned is an ENUM (category) type of ('Yes', 'No').
> 
> 



The **cancellation rate** is computed by dividing the number of canceled (by
client or driver) requests with unbanned users by the total number of requests
with unbanned users on that day.

Write a solution to find the **cancellation rate** of requests with unbanned
users (**both client and driver must not be banned**) each day between
`"2013-10-01"` and `"2013-10-03"`. Round `Cancellation Rate` to **two
decimal** points.

Return the result table in **any order**.

The result format is in the following example.



**Example 1:**

> Input: 
> 
> Trips table:
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> | id | client_id | driver_id | city_id | status> 
> > 
> > 
>   | request_at |
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> | 1  | 1> 
> > 
>  | 10> 
> > 
> | 1> 
>    | completed> 
> > 
>    | 2013-10-01 |
> 
> | 2  | 2> 
> > 
>  | 11> 
> > 
> | 1> 
>    | cancelled_by_driver | 2013-10-01 |
> 
> | 3  | 3> 
> > 
>  | 12> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-01 |
> 
> | 4  | 4> 
> > 
>  | 13> 
> > 
> | 6> 
>    | cancelled_by_client | 2013-10-01 |
> 
> | 5  | 1> 
> > 
>  | 10> 
> > 
> | 1> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 6  | 2> 
> > 
>  | 11> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 7  | 3> 
> > 
>  | 12> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 8  | 2> 
> > 
>  | 12> 
> > 
> | 12> 
>   | completed> 
> > 
>    | 2013-10-03 |
> 
> | 9  | 3> 
> > 
>  | 10> 
> > 
> | 12> 
>   | completed> 
> > 
>    | 2013-10-03 |
> 
> | 10 | 4> 
> > 
>  | 13> 
> > 
> | 12> 
>   | cancelled_by_driver | 2013-10-03 |
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> Users table:
> 
> +----------+--------+--------+
> 
> | users_id | banned | role   |
> 
> +----------+--------+--------+
> 
> | 1> 
> > 
> | No> 
>  | client |
> 
> | 2> 
> > 
> | Yes> 
> | client |
> 
> | 3> 
> > 
> | No> 
>  | client |
> 
> | 4> 
> > 
> | No> 
>  | client |
> 
> | 10> 
>    | No> 
>  | driver |
> 
> | 11> 
>    | No> 
>  | driver |
> 
> | 12> 
>    | No> 
>  | driver |
> 
> | 13> 
>    | No> 
>  | driver |
> 
> +----------+--------+--------+
> 
> Output: 
> 
> +------------+-------------------+
> 
> | Day> 
> > 
> | Cancellation Rate |
> 
> +------------+-------------------+
> 
> | 2013-10-01 | 0.33> 
> > 
> > 
>   |
> 
> | 2013-10-02 | 0.00> 
> > 
> > 
>   |
> 
> | 2013-10-03 | 0.50> 
> > 
> > 
>   |
> 
> +------------+-------------------+
> 
> Explanation: 
> 
> On 2013-10-01:
  > - There were 4 requests in total, 2 of which were canceled.
  > - However, the request with Id=2 was made by a banned client (User_Id=2), so it is ignored in the calculation.
  > - Hence there are 3 unbanned requests in total, 1 of which was canceled.
  > - The Cancellation Rate is (1 / 3) = 0.33
> 
> On 2013-10-02:
  > - There were 3 requests in total, 0 of which were canceled.
  > - The request with Id=6 was made by a banned client, so it is ignored.
  > - Hence there are 2 unbanned requests in total, 0 of which were canceled.
  > - The Cancellation Rate is (0 / 2) = 0.00
> 
> On 2013-10-03:
  > - There were 3 requests in total, 1 of which was canceled.
  > - The request with Id=8 was made by a banned client, so it is ignored.
  > - Hence there are 2 unbanned request in total, 1 of which were canceled.
  > - The Cancellation Rate is (1 / 2) = 0.50
> 
> 


## é¢˜ç›®å¤§æ„

è¡¨ï¼š`Trips`

> 
> 
> 
> 
> 
> +-------------+----------+
> 
> | Column Name | Type> 
>  |
> 
> +-------------+----------+
> 
> | id> 
> > 
>   | int> 
>   |
> 
> | client_id   | int> 
>   |
> 
> | driver_id   | int> 
>   |
> 
> | city_id> 
>  | int> 
>   |
> 
> | status> 
>   | enum> 
>  |
> 
> | request_at  | varchar  |> 
>  
> 
> +-------------+----------+
> 
> id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
> 
> è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€ id ï¼Œå…¶ä¸­ client_id å’Œ driver_id æ˜¯ Users è¡¨ä¸­ users_id çš„å¤–é”®ã€‚
> 
> status æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¡Œç¨‹çŠ¶æ€çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º(â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_clientâ€™) ã€‚
> 
> 



è¡¨ï¼š`Users`

> 
> 
> 
> 
> 
> +-------------+----------+
> 
> | Column Name | Type> 
>  |
> 
> +-------------+----------+
> 
> | users_id> 
> | int> 
>   |
> 
> | banned> 
>   | enum> 
>  |
> 
> | role> 
> > 
> | enum> 
>  |
> 
> +-------------+----------+
> 
> users_id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
> 
> è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ users_id ï¼Œrole æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·èº«ä»½çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜clientâ€™, â€˜driverâ€™, â€˜partnerâ€™) ã€‚
> 
> banned æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜Yesâ€™, â€˜Noâ€™) ã€‚
> 
> 



**å–æ¶ˆç‡** çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)ã€‚

ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º `"2013-10-01"`** ** è‡³ `"2013-10-03"`** ** æœŸé—´éç¦æ­¢ç”¨æˆ·ï¼ˆ**ä¹˜å®¢å’Œå¸æœºéƒ½å¿…é¡»æœªè¢«ç¦æ­¢**
ï¼‰çš„å–æ¶ˆç‡ã€‚éç¦æ­¢ç”¨æˆ·å³ banned ä¸º No çš„ç”¨æˆ·ï¼Œç¦æ­¢ç”¨æˆ·å³ banned ä¸º Yes çš„ç”¨æˆ·ã€‚å…¶ä¸­å–æ¶ˆç‡ `Cancellation Rate`
éœ€è¦å››èˆäº”å…¥ä¿ç•™ **ä¸¤ä½å°æ•°** ã€‚

è¿”å›ç»“æœè¡¨ä¸­çš„æ•°æ® **æ— é¡ºåºè¦æ±‚** ã€‚

ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚



**ç¤ºä¾‹ 1ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** 
> 
> Trips è¡¨ï¼š
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> | id | client_id | driver_id | city_id | status> 
> > 
> > 
>   | request_at |
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> | 1  | 1> 
> > 
>  | 10> 
> > 
> | 1> 
>    | completed> 
> > 
>    | 2013-10-01 |
> 
> | 2  | 2> 
> > 
>  | 11> 
> > 
> | 1> 
>    | cancelled_by_driver | 2013-10-01 |
> 
> | 3  | 3> 
> > 
>  | 12> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-01 |
> 
> | 4  | 4> 
> > 
>  | 13> 
> > 
> | 6> 
>    | cancelled_by_client | 2013-10-01 |
> 
> | 5  | 1> 
> > 
>  | 10> 
> > 
> | 1> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 6  | 2> 
> > 
>  | 11> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 7  | 3> 
> > 
>  | 12> 
> > 
> | 6> 
>    | completed> 
> > 
>    | 2013-10-02 |
> 
> | 8  | 2> 
> > 
>  | 12> 
> > 
> | 12> 
>   | completed> 
> > 
>    | 2013-10-03 |
> 
> | 9  | 3> 
> > 
>  | 10> 
> > 
> | 12> 
>   | completed> 
> > 
>    | 2013-10-03 |
> 
> | 10 | 4> 
> > 
>  | 13> 
> > 
> | 12> 
>   | cancelled_by_driver | 2013-10-03 |
> 
> +----+-----------+-----------+---------+---------------------+------------+
> 
> Users è¡¨ï¼š
> 
> +----------+--------+--------+
> 
> | users_id | banned | role   |
> 
> +----------+--------+--------+
> 
> | 1> 
> > 
> | No> 
>  | client |
> 
> | 2> 
> > 
> | Yes> 
> | client |
> 
> | 3> 
> > 
> | No> 
>  | client |
> 
> | 4> 
> > 
> | No> 
>  | client |
> 
> | 10> 
>    | No> 
>  | driver |
> 
> | 11> 
>    | No> 
>  | driver |
> 
> | 12> 
>    | No> 
>  | driver |
> 
> | 13> 
>    | No> 
>  | driver |
> 
> +----------+--------+--------+
> 
> **è¾“å‡ºï¼š**
> 
> +------------+-------------------+
> 
> | Day> 
> > 
> | Cancellation Rate |
> 
> +------------+-------------------+
> 
> | 2013-10-01 | 0.33> 
> > 
> > 
>   |
> 
> | 2013-10-02 | 0.00> 
> > 
> > 
>   |
> 
> | 2013-10-03 | 0.50> 
> > 
> > 
>   |
> 
> +------------+-------------------+
> 
> **è§£é‡Šï¼š**
> 
> 2013-10-01ï¼š
  > - å…±æœ‰ 4 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 2 æ¡å–æ¶ˆã€‚
  > - ç„¶è€Œï¼Œid=2 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·ï¼ˆuser_id=2ï¼‰å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
  > - å› æ­¤ï¼Œæ€»å…±æœ‰ 3 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
  > - å–æ¶ˆç‡ä¸º (1 / 3) = 0.33
> 
> 2013-10-02ï¼š
  > - å…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚
  > - ç„¶è€Œï¼Œid=6 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
  > - å› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚
  > - å–æ¶ˆç‡ä¸º (0 / 2) = 0.00
> 
> 2013-10-03ï¼š
  > - å…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
  > - ç„¶è€Œï¼Œid=8 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
  > - å› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
  > - å–æ¶ˆç‡ä¸º (1 / 2) = 0.50
> 
> 


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```

## ç›¸å…³é¢˜ç›®

:::: md-demo ç›¸å…³é¢˜ç›®
- [Hopper å…¬å¸æŸ¥è¯¢ I](https://leetcode.com/problems/hopper-company-queries-i)
- [Hopper å…¬å¸æŸ¥è¯¢ II](https://leetcode.com/problems/hopper-company-queries-ii)
- [Hopper å…¬å¸æŸ¥è¯¢ III](https://leetcode.com/problems/hopper-company-queries-iii)

::::
