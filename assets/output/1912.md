# [1912. è®¾è®¡ç”µå½±ç§Ÿå€Ÿç³»ç»Ÿ](https://leetcode.com/problems/design-movie-rental-system)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æœ‰åºé›†åˆ`](/tag/ordered-set.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/design-movie-rental-system)

## é¢˜ç›®

You have a movie renting company consisting of `n` shops. You want to
implement a renting system that supports searching for, booking, and returning
movies. The system should also support generating a report of the currently
rented movies.

Each movie is given as a 2D integer array `entries` where `entries[i] =
[shopi, moviei, pricei]` indicates that there is a copy of movie `moviei` at
shop `shopi` with a rental price of `pricei`. Each shop carries **at most
one** copy of a movie `moviei`.

The system should support the following functions:

  * **Search** : Finds the **cheapest 5 shops** that have an **unrented copy** of a given movie. The shops should be sorted by **price** in ascending order, and in case of a tie, the one with the **smaller**`shopi` should appear first. If there are less than 5 matching shops, then all of them should be returned. If no shop has an unrented copy, then an empty list should be returned.
  * **Rent** : Rents an **unrented copy** of a given movie from a given shop.
  * **Drop** : Drops off a **previously rented copy** of a given movie at a given shop.
  * **Report** : Returns the **cheapest 5 rented movies** (possibly of the same movie ID) as a 2D list `res` where `res[j] = [shopj, moviej]` describes that the `jth` cheapest rented movie `moviej` was rented from the shop `shopj`. The movies in `res` should be sorted by **price** in ascending order, and in case of a tie, the one with the **smaller**`shopj` should appear first, and if there is still tie, the one with the **smaller**`moviej` should appear first. If there are fewer than 5 rented movies, then all of them should be returned. If no movies are currently being rented, then an empty list should be returned.

Implement the `MovieRentingSystem` class:

  * `MovieRentingSystem(int n, int[][] entries)` Initializes the `MovieRentingSystem` object with `n` shops and the movies in `entries`.
  * `List<Integer> search(int movie)` Returns a list of shops that have an **unrented copy** of the given `movie` as described above.
  * `void rent(int shop, int movie)` Rents the given `movie` from the given `shop`.
  * `void drop(int shop, int movie)` Drops off a previously rented `movie` at the given `shop`.
  * `List<List<Integer>> report()` Returns a list of cheapest **rented** movies as described above.

**Note:** The test cases will be generated such that `rent` will only be
called if the shop has an **unrented** copy of the movie, and `drop` will only
be called if the shop had **previously rented** out the movie.



**Example 1:**

> 
> 
> 
> 
> 
> **Input**
> 
> ["MovieRentingSystem", "search", "rent", "rent", "report", "drop", "search"]
> 
> [[3, [[0, 1, 5], [0, 2, 6], [0, 3, 7], [1, 1, 4], [1, 2, 7], [2, 1, 5]]], [1], [0, 1], [1, 2], [], [1, 2], [2]]
> 
> **Output**
> 
> [null, [1, 0, 2], null, null, [[0, 1], [1, 2]], null, [0, 1]]
> 
> 
> 
> **Explanation**
> 
> MovieRentingSystem movieRentingSystem = new MovieRentingSystem(3, [[0, 1, 5], [0, 2, 6], [0, 3, 7], [1, 1, 4], [1, 2, 7], [2, 1, 5]]);
> 
> movieRentingSystem.search(1);  // return [1, 0, 2], Movies of ID 1 are unrented at shops 1, 0, and 2. Shop 1 is cheapest; shop 0 and 2 are the same price, so order by shop number.
> 
> movieRentingSystem.rent(0, 1); // Rent movie 1 from shop 0. Unrented movies at shop 0 are now [2,3].
> 
> movieRentingSystem.rent(1, 2); // Rent movie 2 from shop 1. Unrented movies at shop 1 are now [1].
> 
> movieRentingSystem.report();   // return [[0, 1], [1, 2]]. Movie 1 from shop 0 is cheapest, followed by movie 2 from shop 1.
> 
> movieRentingSystem.drop(1, 2); // Drop off movie 2 at shop 1. Unrented movies at shop 1 are now [1,2].
> 
> movieRentingSystem.search(2);  // return [0, 1]. Movies of ID 2 are unrented at shops 0 and 1. Shop 0 is cheapest, followed by shop 1.

**Constraints:**

  * `1 <= n <= 3 * 10^5`
  * `1 <= entries.length <= 10^5`
  * `0 <= shopi < n`
  * `1 <= moviei, pricei <= 10^4`
  * Each shop carries **at most one** copy of a movie `moviei`.
  * At most `10^5` calls **in total** will be made to `search`, `rent`, `drop` and `report`.


## é¢˜ç›®å¤§æ„

ä½ æœ‰ä¸€ä¸ªç”µå½±ç§Ÿå€Ÿå…¬å¸å’Œ `n` ä¸ªç”µå½±å•†åº—ã€‚ä½ æƒ³è¦å®ç°ä¸€ä¸ªç”µå½±ç§Ÿå€Ÿç³»ç»Ÿï¼Œå®ƒæ”¯æŒæŸ¥è¯¢ã€é¢„è®¢å’Œè¿”è¿˜ç”µå½±çš„æ“ä½œã€‚åŒæ—¶ç³»ç»Ÿè¿˜èƒ½ç”Ÿæˆä¸€ä»½å½“å‰è¢«å€Ÿå‡ºç”µå½±çš„æŠ¥å‘Šã€‚

æ‰€æœ‰ç”µå½±ç”¨äºŒç»´æ•´æ•°æ•°ç»„ `entries` è¡¨ç¤ºï¼Œå…¶ä¸­ `entries[i] = [shopi, moviei, pricei]` è¡¨ç¤ºå•†åº—
`shopi` æœ‰ä¸€ä»½ç”µå½± `moviei` çš„æ‹·è´ï¼Œç§Ÿå€Ÿä»·æ ¼ä¸º `pricei` ã€‚æ¯ä¸ªå•†åº—æœ‰ **è‡³å¤šä¸€ä»½** ç¼–å·ä¸º `moviei` çš„ç”µå½±æ‹·è´ã€‚

ç³»ç»Ÿéœ€è¦æ”¯æŒä»¥ä¸‹æ“ä½œï¼š

  * **Searchï¼š** æ‰¾åˆ°æ‹¥æœ‰æŒ‡å®šç”µå½±ä¸” **æœªå€Ÿå‡º** çš„å•†åº—ä¸­ **æœ€ä¾¿å®œçš„ 5 ä¸ª** ã€‚å•†åº—éœ€è¦æŒ‰ç…§ **ä»·æ ¼** å‡åºæ’åºï¼Œå¦‚æœä»·æ ¼ç›¸åŒï¼Œåˆ™ `shopi` **è¾ƒå°** çš„å•†åº—æ’åœ¨å‰é¢ã€‚å¦‚æœæŸ¥è¯¢ç»“æœå°‘äº 5 ä¸ªå•†åº—ï¼Œåˆ™å°†å®ƒä»¬å…¨éƒ¨è¿”å›ã€‚å¦‚æœæŸ¥è¯¢ç»“æœæ²¡æœ‰ä»»ä½•å•†åº—ï¼Œåˆ™è¿”å›ç©ºåˆ—è¡¨ã€‚
  * **Rentï¼š** ä»æŒ‡å®šå•†åº—å€Ÿå‡ºæŒ‡å®šç”µå½±ï¼Œé¢˜ç›®ä¿è¯æŒ‡å®šç”µå½±åœ¨æŒ‡å®šå•†åº— **æœªå€Ÿå‡º** ã€‚
  * **Dropï¼š** åœ¨æŒ‡å®šå•†åº—è¿”è¿˜ **ä¹‹å‰å·²å€Ÿå‡º** çš„æŒ‡å®šç”µå½±ã€‚
  * **Reportï¼š** è¿”å› **æœ€ä¾¿å®œçš„ 5 éƒ¨å·²å€Ÿå‡ºç”µå½±** ï¼ˆå¯èƒ½æœ‰é‡å¤çš„ç”µå½± IDï¼‰ï¼Œå°†ç»“æœç”¨äºŒç»´åˆ—è¡¨ `res` è¿”å›ï¼Œå…¶ä¸­ `res[j] = [shopj, moviej]` è¡¨ç¤ºç¬¬ `j` ä¾¿å®œçš„å·²å€Ÿå‡ºç”µå½±æ˜¯ä»å•†åº— `shopj` å€Ÿå‡ºçš„ç”µå½± `moviej` ã€‚`res` ä¸­çš„ç”µå½±éœ€è¦æŒ‰ **ä»·æ ¼** å‡åºæ’åºï¼›å¦‚æœä»·æ ¼ç›¸åŒï¼Œåˆ™****`shopj` **è¾ƒå°** çš„æ’åœ¨å‰é¢ï¼›å¦‚æœä»ç„¶ç›¸åŒï¼Œåˆ™ `moviej` **è¾ƒå°** çš„æ’åœ¨å‰é¢ã€‚å¦‚æœå½“å‰å€Ÿå‡ºçš„ç”µå½±å°äº 5 éƒ¨ï¼Œåˆ™å°†å®ƒä»¬å…¨éƒ¨è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰å€Ÿå‡ºç”µå½±ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„åˆ—è¡¨ã€‚

è¯·ä½ å®ç° `MovieRentingSystem` ç±»ï¼š

  * `MovieRentingSystem(int n, int[][] entries)` å°† `MovieRentingSystem` å¯¹è±¡ç”¨ `n` ä¸ªå•†åº—å’Œ `entries` è¡¨ç¤ºçš„ç”µå½±åˆ—è¡¨åˆå§‹åŒ–ã€‚
  * `List<Integer> search(int movie)` å¦‚ä¸Šæ‰€è¿°ï¼Œè¿”å› **æœªå€Ÿå‡º** æŒ‡å®š `movie` çš„å•†åº—åˆ—è¡¨ã€‚
  * `void rent(int shop, int movie)` ä»æŒ‡å®šå•†åº— `shop` å€Ÿå‡ºæŒ‡å®šç”µå½± `movie` ã€‚
  * `void drop(int shop, int movie)` åœ¨æŒ‡å®šå•†åº— `shop` è¿”è¿˜ä¹‹å‰å€Ÿå‡ºçš„ç”µå½± `movie` ã€‚
  * `List<List<Integer>> report()` å¦‚ä¸Šæ‰€è¿°ï¼Œè¿”å›æœ€ä¾¿å®œçš„ **å·²å€Ÿå‡º** ç”µå½±åˆ—è¡¨ã€‚

**æ³¨æ„ï¼š** æµ‹è¯•æ•°æ®ä¿è¯ `rent` æ“ä½œä¸­æŒ‡å®šå•†åº—æ‹¥æœ‰ **æœªå€Ÿå‡º** çš„æŒ‡å®šç”µå½±ï¼Œä¸” `drop` æ“ä½œæŒ‡å®šçš„å•†åº— **ä¹‹å‰å·²å€Ÿå‡º** æŒ‡å®šç”µå½±ã€‚

**ç¤ºä¾‹ 1ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š**
> 
> ["MovieRentingSystem", "search", "rent", "rent", "report", "drop", "search"]
> 
> [[3, [[0, 1, 5], [0, 2, 6], [0, 3, 7], [1, 1, 4], [1, 2, 7], [2, 1, 5]]], [1], [0, 1], [1, 2], [], [1, 2], [2]]
> 
> **è¾“å‡ºï¼š**
> 
> [null, [1, 0, 2], null, null, [[0, 1], [1, 2]], null, [0, 1]]
> 
> 
> 
> **è§£é‡Šï¼š**
> 
> MovieRentingSystem movieRentingSystem = new MovieRentingSystem(3, [[0, 1, 5], [0, 2, 6], [0, 3, 7], [1, 1, 4], [1, 2, 7], [2, 1, 5]]);
> 
> movieRentingSystem.search(1);  // è¿”å› [1, 0, 2] ï¼Œå•†åº— 1ï¼Œ0 å’Œ 2 æœ‰æœªå€Ÿå‡ºçš„ ID ä¸º 1 çš„ç”µå½±ã€‚å•†åº— 1 æœ€ä¾¿å®œï¼Œå•†åº— 0 å’Œ 2 ä»·æ ¼ç›¸åŒï¼Œæ‰€ä»¥æŒ‰å•†åº—ç¼–å·æ’åºã€‚
> 
> movieRentingSystem.rent(0, 1); // ä»å•†åº— 0 å€Ÿå‡ºç”µå½± 1 ã€‚ç°åœ¨å•†åº— 0 æœªå€Ÿå‡ºç”µå½±ç¼–å·ä¸º [2,3] ã€‚
> 
> movieRentingSystem.rent(1, 2); // ä»å•†åº— 1 å€Ÿå‡ºç”µå½± 2 ã€‚ç°åœ¨å•†åº— 1 æœªå€Ÿå‡ºçš„ç”µå½±ç¼–å·ä¸º [1] ã€‚
> 
> movieRentingSystem.report();   // è¿”å› [[0, 1], [1, 2]] ã€‚å•†åº— 0 å€Ÿå‡ºçš„ç”µå½± 1 æœ€ä¾¿å®œï¼Œç„¶åæ˜¯å•†åº— 1 å€Ÿå‡ºçš„ç”µå½± 2 ã€‚
> 
> movieRentingSystem.drop(1, 2); // åœ¨å•†åº— 1 è¿”è¿˜ç”µå½± 2 ã€‚ç°åœ¨å•†åº— 1 æœªå€Ÿå‡ºçš„ç”µå½±ç¼–å·ä¸º [1,2] ã€‚
> 
> movieRentingSystem.search(2);  // è¿”å› [0, 1] ã€‚å•†åº— 0 å’Œ 1 æœ‰æœªå€Ÿå‡ºçš„ ID ä¸º 2 çš„ç”µå½±ã€‚å•†åº— 0 æœ€ä¾¿å®œï¼Œç„¶åæ˜¯å•†åº— 1 ã€‚
> 
> 

**æç¤ºï¼š**

  * `1 <= n <= 3 * 10^5`
  * `1 <= entries.length <= 10^5`
  * `0 <= shopi < n`
  * `1 <= moviei, pricei <= 10^4`
  * æ¯ä¸ªå•†åº— **è‡³å¤š** æœ‰ä¸€ä»½ç”µå½± `moviei` çš„æ‹·è´ã€‚
  * `search`ï¼Œ`rent`ï¼Œ`drop` å’Œ `report` çš„è°ƒç”¨ **æ€»å…±** ä¸è¶…è¿‡ `10^5` æ¬¡ã€‚


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```