---
title: 2791. æ ‘ä¸­å¯ä»¥å½¢æˆå›æ–‡çš„è·¯å¾„æ•°
description: LeetCode 2791. æ ‘ä¸­å¯ä»¥å½¢æˆå›æ–‡çš„è·¯å¾„æ•°é¢˜è§£ï¼ŒCount Paths That Can Form a Palindrome in a Treeï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 2791. æ ‘ä¸­å¯ä»¥å½¢æˆå›æ–‡çš„è·¯å¾„æ•°
  - æ ‘ä¸­å¯ä»¥å½¢æˆå›æ–‡çš„è·¯å¾„æ•°
  - Count Paths That Can Form a Palindrome in a Tree
  - è§£é¢˜æ€è·¯
  - ä½è¿ç®—
  - æ ‘
  - æ·±åº¦ä¼˜å…ˆæœç´¢
  - åŠ¨æ€è§„åˆ’
  - çŠ¶æ€å‹ç¼©
---

# 2791. æ ‘ä¸­å¯ä»¥å½¢æˆå›æ–‡çš„è·¯å¾„æ•°

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŠ¶æ€å‹ç¼©`](/tag/bitmask.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/count-paths-that-can-form-a-palindrome-in-a-tree) [`LeetCode`](https://leetcode.com/problems/count-paths-that-can-form-a-palindrome-in-a-tree)

## é¢˜ç›®

You are given a **tree** (i.e. a connected, undirected graph that has no
cycles) **rooted** at node `0` consisting of `n` nodes numbered from `0` to `n
- 1`. The tree is represented by a **0-indexed** array `parent` of size `n`,
where `parent[i]` is the parent of node `i`. Since node `0` is the root,
`parent[0] == -1`.

You are also given a string `s` of length `n`, where `s[i]` is the character
assigned to the edge between `i` and `parent[i]`. `s[0]` can be ignored.

Return _the number of pairs of nodes_`(u, v)`_such that_`u < v` _and the
characters assigned to edges on the path from_`u` _to_`v` _can
be**rearranged** to form a **palindrome**_.

A string is a **palindrome** when it reads the same backwards as forwards.



**Example 1:**

![](https://assets.leetcode.com/uploads/2023/07/15/treedrawio-8drawio.png)

> Input: parent = [-1,0,0,1,1,2], s = "acaabc"
> 
> Output: 8
> 
> Explanation: The valid pairs are:
> - All the pairs (0,1), (0,2), (1,3), (1,4) and (2,5) result in one character which is always a palindrome.
> - The pair (2,3) result in the string "aca" which is a palindrome.
> - The pair (1,5) result in the string "cac" which is a palindrome.
> - The pair (3,5) result in the string "acac" which can be rearranged into the palindrome "acca".

**Example 2:**

> Input: parent = [-1,0,0,0,0], s = "aaaaa"
> 
> Output: 10
> 
> Explanation: Any pair of nodes (u,v) where u < v is valid.

**Constraints:**

  * `n == parent.length == s.length`
  * `1 <= n <= 10^5`
  * `0 <= parent[i] <= n - 1` for all `i >= 1`
  * `parent[0] == -1`
  * `parent` represents a valid tree.
  * `s` consists of only lowercase English letters.


## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€æ£µ **æ ‘** ï¼ˆå³ï¼Œä¸€ä¸ªè¿é€šã€æ— å‘ä¸”æ— ç¯çš„å›¾ï¼‰ï¼Œ**æ ¹** èŠ‚ç‚¹ä¸º `0` ï¼Œç”±ç¼–å·ä» `0` åˆ° `n - 1` çš„ `n`
ä¸ªèŠ‚ç‚¹ç»„æˆã€‚è¿™æ£µæ ‘ç”¨ä¸€ä¸ªé•¿åº¦ä¸º `n` ã€ä¸‹æ ‡ä» **0** å¼€å§‹çš„æ•°ç»„ `parent` è¡¨ç¤ºï¼Œå…¶ä¸­ `parent[i]` ä¸ºèŠ‚ç‚¹ `i`
çš„çˆ¶èŠ‚ç‚¹ï¼Œç”±äºèŠ‚ç‚¹ `0` ä¸ºæ ¹èŠ‚ç‚¹ï¼Œæ‰€ä»¥ `parent[0] == -1` ã€‚

å¦ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„å­—ç¬¦ä¸² `s` ï¼Œå…¶ä¸­ `s[i]` æ˜¯åˆ†é…ç»™ `i` å’Œ `parent[i]` ä¹‹é—´çš„è¾¹çš„å­—ç¬¦ã€‚`s[0]` å¯ä»¥å¿½ç•¥ã€‚

æ‰¾å‡ºæ»¡è¶³ `u < v` ï¼Œä¸”ä» `u` åˆ° `v` çš„è·¯å¾„ä¸Šåˆ†é…çš„å­—ç¬¦å¯ä»¥ **é‡æ–°æ’åˆ—** å½¢æˆ **å›æ–‡** çš„æ‰€æœ‰èŠ‚ç‚¹å¯¹ `(u, v)`
ï¼Œå¹¶è¿”å›èŠ‚ç‚¹å¯¹çš„æ•°ç›®ã€‚

å¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²æ­£ç€è¯»å’Œåç€è¯»éƒ½ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ª **å›æ–‡** ã€‚



**ç¤ºä¾‹ 1ï¼š**

![](https://assets.leetcode.com/uploads/2023/07/15/treedrawio-8drawio.png)

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** parent = [-1,0,0,1,1,2], s = "acaabc"
> 
> **è¾“å‡ºï¼š** 8
> 
> **è§£é‡Šï¼š** ç¬¦åˆé¢˜ç›®è¦æ±‚çš„èŠ‚ç‚¹å¯¹åˆ†åˆ«æ˜¯ï¼š
> - (0,1)ã€(0,2)ã€(1,3)ã€(1,4) å’Œ (2,5) ï¼Œè·¯å¾„ä¸Šåªæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œæ»¡è¶³å›æ–‡å®šä¹‰ã€‚
> - (2,3)ï¼Œè·¯å¾„ä¸Šå­—ç¬¦å½¢æˆçš„å­—ç¬¦ä¸²æ˜¯ "aca" ï¼Œæ»¡è¶³å›æ–‡å®šä¹‰ã€‚
> - (1,5)ï¼Œè·¯å¾„ä¸Šå­—ç¬¦å½¢æˆçš„å­—ç¬¦ä¸²æ˜¯ "cac" ï¼Œæ»¡è¶³å›æ–‡å®šä¹‰ã€‚
> - (3,5)ï¼Œè·¯å¾„ä¸Šå­—ç¬¦å½¢æˆçš„å­—ç¬¦ä¸²æ˜¯ "acac" ï¼Œå¯ä»¥é‡æ’å½¢æˆå›æ–‡ "acca" ã€‚
> 
> 

**ç¤ºä¾‹ 2ï¼š**

> 
> 
> 
> 
> 
> **è¾“å…¥ï¼š** parent = [-1,0,0,0,0], s = "aaaaa"
> 
> **è¾“å‡ºï¼š** 10
> 
> **è§£é‡Šï¼š** ä»»ä½•æ»¡è¶³ u < v çš„èŠ‚ç‚¹å¯¹ (u,v) éƒ½ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚
> 
> 



**æç¤ºï¼š**

  * `n == parent.length == s.length`
  * `1 <= n <= 10^5`
  * å¯¹äºæ‰€æœ‰ `i >= 1` ï¼Œ`0 <= parent[i] <= n - 1` å‡æˆç«‹
  * `parent[0] == -1`
  * `parent` è¡¨ç¤ºä¸€æ£µæœ‰æ•ˆçš„æ ‘
  * `s` ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ


## è§£é¢˜æ€è·¯

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O()`ï¼Œ

## ä»£ç 

```javascript

```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 2867 | ç»Ÿè®¡æ ‘ä¸­çš„åˆæ³•è·¯å¾„æ•°ç›® |  |  [`æ ‘`](/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`æ•°å­¦`](/tag/math.md) `2+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/count-valid-paths-in-a-tree) [ğŸ”—](https://leetcode.com/problems/count-valid-paths-in-a-tree) |