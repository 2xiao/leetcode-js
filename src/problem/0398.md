---
title: 398. éšæœºæ•°ç´¢å¼•
description: LeetCode 398. éšæœºæ•°ç´¢å¼•é¢˜è§£ï¼ŒRandom Pick Indexï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 398. éšæœºæ•°ç´¢å¼•
  - éšæœºæ•°ç´¢å¼•
  - Random Pick Index
  - è§£é¢˜æ€è·¯
  - æ°´å¡˜æŠ½æ ·
  - å“ˆå¸Œè¡¨
  - æ•°å­¦
  - éšæœºåŒ–
---

# 398. éšæœºæ•°ç´¢å¼•

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ°´å¡˜æŠ½æ ·`](/tag/reservoir-sampling.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°å­¦`](/tag/math.md) [`éšæœºåŒ–`](/tag/randomized.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/random-pick-index) [`LeetCode`](https://leetcode.com/problems/random-pick-index)

## é¢˜ç›®

Given an integer array `nums` with possible **duplicates** , randomly output
the index of a given `target` number. You can assume that the given target
number must exist in the array.

Implement the `Solution` class:

- `Solution(int[] nums)` Initializes the object with the array `nums`.
- `int pick(int target)` Picks a random index `i` from `nums` where `nums[i] == target`. If there are multiple valid i's, then each index should have an equal probability of returning.

**Example 1:**

> **Input**
>
> ["Solution", "pick", "pick", "pick"]
>
> [[[1, 2, 3, 3, 3]], [3], [1], [3]]
>
> **Output**
>
> [null, 4, 0, 2]
>
> **Explanation**
>
> ```js
> Solution solution = new Solution([1, 2, 3, 3, 3]);
>
> solution.pick(3); // It should return either index 2, 3, or 4 randomly. Each index should have equal probability of returning.
>
> solution.pick(1); // It should return 0. Since in the array only nums[0] is equal to 1.
>
> solution.pick(3); // It should return either index 2, 3, or 4 randomly. Each index should have equal probability of returning.
> ```

**Constraints:**

- `1 <= nums.length <= 2 * 10^4`
- `-2^31 <= nums[i] <= 2^31 - 1`
- `target` is an integer from `nums`.
- At most `10^4` calls will be made to `pick`.

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªå¯èƒ½å«æœ‰ **é‡å¤å…ƒç´ ** çš„æ•´æ•°æ•°ç»„ `nums` ï¼Œè¯·ä½ éšæœºè¾“å‡ºç»™å®šçš„ç›®æ ‡æ•°å­— `target` çš„ç´¢å¼•ã€‚ä½ å¯ä»¥å‡è®¾ç»™å®šçš„æ•°å­—ä¸€å®šå­˜åœ¨äºæ•°ç»„ä¸­ã€‚

å®ç° `Solution` ç±»ï¼š

- `Solution(int[] nums)` ç”¨æ•°ç»„ `nums` åˆå§‹åŒ–å¯¹è±¡ã€‚
- `int pick(int target)` ä» `nums` ä¸­é€‰å‡ºä¸€ä¸ªæ»¡è¶³ `nums[i] == target` çš„éšæœºç´¢å¼• `i` ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªæœ‰æ•ˆçš„ç´¢å¼•ï¼Œåˆ™æ¯ä¸ªç´¢å¼•çš„è¿”å›æ¦‚ç‡åº”å½“ç›¸ç­‰ã€‚

**ç¤ºä¾‹ï¼š**

> **è¾“å…¥**
>
> ["Solution", "pick", "pick", "pick"]
>
> [[[1, 2, 3, 3, 3]], [3], [1], [3]]
>
> **è¾“å‡º**
>
> [null, 4, 0, 2]
>
> **è§£é‡Š**
>
> ```js
> Solution solution = new Solution([1, 2, 3, 3, 3]);
>
> solution.pick(3); // éšæœºè¿”å›ç´¢å¼• 2, 3 æˆ–è€… 4 ä¹‹ä¸€ã€‚æ¯ä¸ªç´¢å¼•çš„è¿”å›æ¦‚ç‡åº”è¯¥ç›¸ç­‰ã€‚
>
> solution.pick(1); // è¿”å› 0 ã€‚å› ä¸ºåªæœ‰ nums[0] ç­‰äº 1 ã€‚
>
> solution.pick(3); // éšæœºè¿”å›ç´¢å¼• 2, 3 æˆ–è€… 4 ä¹‹ä¸€ã€‚æ¯ä¸ªç´¢å¼•çš„è¿”å›æ¦‚ç‡åº”è¯¥ç›¸ç­‰ã€‚
> ```

**æç¤ºï¼š**

- `1 <= nums.length <= 2 * 10^4`
- `-2^31 <= nums[i] <= 2^31 - 1`
- `target` æ˜¯ `nums` ä¸­çš„ä¸€ä¸ªæ•´æ•°
- æœ€å¤šè°ƒç”¨ `pick` å‡½æ•° `10^4` æ¬¡

## è§£é¢˜æ€è·¯

- **æ„é€ å‡½æ•° (`Solution`)**ï¼š
  - é¢„å¤„ç† `nums` æ•°ç»„ï¼Œå°†æ¯ä¸ªæ•°å­—åŠå…¶æ‰€æœ‰ç´¢å¼•å­˜å…¥**å“ˆå¸Œè¡¨** `Map`ï¼Œé”®ä¸ºæ•°å­—ï¼Œå€¼ä¸ºç´¢å¼•æ•°ç»„ã€‚
- **éšæœºç´¢å¼•é€‰æ‹© (`pick`)**ï¼š
  - è·å– `target` çš„ç´¢å¼•æ•°ç»„ `arr`ï¼Œä½¿ç”¨ `Math.floor(Math.random() * arr.length)` éšæœºé€‰å–ç´¢å¼•ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - æ„é€ å‡½æ•°ï¼š`O(n)`
  - `pick()` æ–¹æ³•ï¼š`O(1)`
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨å“ˆå¸Œè¡¨ä¸­çš„æ•°å­—ä¸ç´¢å¼•æ˜ å°„ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[]} nums
 */
var Solution = function (nums) {
	this.map = new Map();
	for (let i = 0; i < nums.length; i++) {
		if (!this.map.has(nums[i])) {
			this.map.set(nums[i], []);
		}
		this.map.get(nums[i]).push(i);
	}
};

/**
 * @param {number} target
 * @return {number}
 */
Solution.prototype.pick = function (target) {
	const arr = this.map.get(target);
	return arr[Math.floor(Math.random() * arr.length)];
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 382 | é“¾è¡¨éšæœºèŠ‚ç‚¹ | [[âœ“]](/problem/0382.md) |  [`æ°´å¡˜æŠ½æ ·`](/tag/reservoir-sampling.md) [`é“¾è¡¨`](/tag/linked-list.md) [`æ•°å­¦`](/tag/math.md) `1+` | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/linked-list-random-node) [ğŸ”—](https://leetcode.com/problems/linked-list-random-node) |
| 528 | æŒ‰æƒé‡éšæœºé€‰æ‹© | [[âœ“]](/problem/0528.md) |  [`æ•°ç»„`](/tag/array.md) [`æ•°å­¦`](/tag/math.md) [`äºŒåˆ†æŸ¥æ‰¾`](/tag/binary-search.md) `2+` | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/random-pick-with-weight) [ğŸ”—](https://leetcode.com/problems/random-pick-with-weight) |
| 710 | é»‘åå•ä¸­çš„éšæœºæ•° |  |  [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°å­¦`](/tag/math.md) `3+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/random-pick-with-blacklist) [ğŸ”—](https://leetcode.com/problems/random-pick-with-blacklist) |