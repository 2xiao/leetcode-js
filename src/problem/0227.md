---
title: 227. åŸºæœ¬è®¡ç®—å™¨ II
description: LeetCode,227. åŸºæœ¬è®¡ç®—å™¨ II,åŸºæœ¬è®¡ç®—å™¨ II,Basic Calculator II,è§£é¢˜æ€è·¯,æ ˆ,æ•°å­¦,å­—ç¬¦ä¸²
keywords:
  - LeetCode
  - 227. åŸºæœ¬è®¡ç®—å™¨ II
  - åŸºæœ¬è®¡ç®—å™¨ II
  - Basic Calculator II
  - è§£é¢˜æ€è·¯
  - æ ˆ
  - æ•°å­¦
  - å­—ç¬¦ä¸²
---

# 227. åŸºæœ¬è®¡ç®—å™¨ II

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ ˆ`](/tag/stack.md) [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/basic-calculator-ii) [`LeetCode`](https://leetcode.com/problems/basic-calculator-ii)

## é¢˜ç›®

Given a string `s` which represents an expression, _evaluate this expression
and return its value_.

The integer division should truncate toward zero.

You may assume that the given expression is always valid. All intermediate
results will be in the range of `[-2^31, 2^31 - 1]`.

**Note:** You are not allowed to use any built-in function which evaluates
strings as mathematical expressions, such as `eval()`.

**Example 1:**

> Input: s = "3+2\*2"
>
> Output: 7

**Example 2:**

> Input: s = " 3/2 "
>
> Output: 1

**Example 3:**

> Input: s = " 3+5 / 2 "
>
> Output: 5

**Constraints:**

- `1 <= s.length <= 3 * 10^5`
- `s` consists of integers and operators `('+', '-', '*', '/')` separated by some number of spaces.
- `s` represents **a valid expression**.
- All the integers in the expression are non-negative integers in the range `[0, 2^31 - 1]`.
- The answer is **guaranteed** to fit in a **32-bit integer**.

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ `s` ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚

æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚

ä½ å¯ä»¥å‡è®¾ç»™å®šçš„è¡¨è¾¾å¼æ€»æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€æœ‰ä¸­é—´ç»“æœå°†åœ¨ `[-2^31, 2^31 - 1]` çš„èŒƒå›´å†…ã€‚

**æ³¨æ„ï¼š**ä¸å…è®¸ä½¿ç”¨ä»»ä½•å°†å­—ç¬¦ä¸²ä½œä¸ºæ•°å­¦è¡¨è¾¾å¼è®¡ç®—çš„å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ `eval()` ã€‚

## è§£é¢˜æ€è·¯

1. **ä½¿ç”¨æ ˆ**ï¼š

   - é‡‡ç”¨æ ˆæ¥å­˜å‚¨è®¡ç®—è¿‡ç¨‹ä¸­é—´çš„ç»“æœã€‚
   - é‡åˆ°ä¹˜æ³•å’Œé™¤æ³•æ—¶ç«‹å³è®¡ç®—å¹¶å°†ç»“æœæ”¾å…¥æ ˆä¸­ï¼›é‡åˆ°åŠ æ³•å’Œå‡æ³•æ—¶ï¼Œå…ˆå°†å½“å‰æ•°å­—å‹å…¥æ ˆä¸­ï¼Œåç»­å¤„ç†ã€‚

2. **éå†å­—ç¬¦ä¸²**ï¼š

   - éå†è¾“å…¥å­—ç¬¦ä¸²ï¼Œé€ä¸ªå­—ç¬¦å¤„ç†ï¼š
     - å½“é‡åˆ°æ•°å­—æ—¶ï¼Œæ„å»ºå®Œæ•´çš„æ•°å­—ï¼ˆå¯èƒ½æ˜¯å¤šä½æ•°ï¼‰ã€‚
     - å½“é‡åˆ°æ“ä½œç¬¦æ—¶ï¼Œæ ¹æ®ä¸Šä¸€ä¸ªæ“ä½œç¬¦å†³å®šå¦‚ä½•å¤„ç†æ ˆã€‚
     - æ³¨æ„å¤„ç†ç©ºæ ¼ï¼Œç¡®ä¿åªåœ¨é‡åˆ°æœ‰æ•ˆæ“ä½œç¬¦æ—¶è¿›è¡Œå¤„ç†ã€‚

3. **å¤„ç†æ“ä½œç¬¦**ï¼š

   - ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥è®°å½•å½“å‰æ“ä½œç¬¦ã€‚æ ¹æ®å½“å‰æ“ä½œç¬¦çš„ç±»å‹ï¼Œå†³å®šæ˜¯å°†å½“å‰æ•°å­—æ¨å…¥æ ˆä¸­ã€è¿˜æ˜¯æ‰§è¡Œä¹˜æ³•æˆ–é™¤æ³•ã€‚

4. **æœ€åè®¡ç®—ç»“æœ**ï¼š

   - éå†å®Œå­—ç¬¦ä¸²åï¼Œæ ˆä¸­ä¼šå­˜å‚¨æ‰€æœ‰çš„ç»“æœã€‚æœ€ç»ˆåªéœ€å°†æ ˆä¸­çš„æ‰€æœ‰æ•°å­—ç›¸åŠ ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯è¾“å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚éœ€è¦éå†å­—ç¬¦ä¸²ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨æ ˆä¸­é—´ç»“æœã€‚

## ä»£ç 

```javascript
/**
 * @param {string} s
 * @return {number}
 */
var calculate = function (s) {
	const isDigit = (char) => char >= '0' && char <= '9';
	let stack = [],
		sum = 0,
		operation = '+'; // åˆå§‹æ“ä½œç¬¦
	for (let i = 0; i < s.length; i++) {
		let char = s[i];

		// å¦‚æœæ˜¯æ•°å­—ï¼Œæ„å»ºå®Œæ•´çš„æ•°å­—
		if (isDigit(char)) {
			sum = sum * 10 + Number(char);
		}

		// è·³è¿‡ç©ºæ ¼
		if (char == ' ' && i < s.length - 1) {
			continue;
		}

		// å¦‚æœæ˜¯æ“ä½œç¬¦æˆ–è€…åˆ°è¾¾å­—ç¬¦ä¸²æœ«å°¾
		if (['+', '-', '*', '/'].includes(char) || i === s.length - 1) {
			if (operation == '+') {
				stack.push(sum);
			} else if (operation == '-') {
				stack.push(-sum);
			} else if (operation == '*') {
				stack.push(stack.pop() * sum);
			} else if (operation == '/') {
				stack.push((stack.pop() / sum) | 0);
			}
			// æ›´æ–°å½“å‰æ“ä½œç¬¦
			operation = char;
			sum = 0;
		}
	}
	return stack.reduce((a, b) => a + b, 0);
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------ | :------: |
| 224 | åŸºæœ¬è®¡ç®—å™¨ | [[âœ“]](/problem/0224.md) |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) `1+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/basic-calculator) [ğŸ”—](https://leetcode.com/problems/basic-calculator) |
| 282 | ç»™è¡¨è¾¾å¼æ·»åŠ è¿ç®—ç¬¦ |  |  [`æ•°å­¦`](/tag/math.md) [`å­—ç¬¦ä¸²`](/tag/string.md) [`å›æº¯`](/tag/backtracking.md) | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/expression-add-operators) [ğŸ”—](https://leetcode.com/problems/expression-add-operators) |
| 772 | åŸºæœ¬è®¡ç®—å™¨ III ğŸ”’ | [[âœ“]](/problem/0772.md) |  [`æ ˆ`](/tag/stack.md) [`é€’å½’`](/tag/recursion.md) [`æ•°å­¦`](/tag/math.md) `1+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/basic-calculator-iii) [ğŸ”—](https://leetcode.com/problems/basic-calculator-iii) |