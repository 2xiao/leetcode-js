---
title: 802. æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€
description: LeetCode 802. æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€é¢˜è§£ï¼ŒFind Eventual Safe Statesï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 802. æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€
  - æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€
  - Find Eventual Safe States
  - è§£é¢˜æ€è·¯
  - æ·±åº¦ä¼˜å…ˆæœç´¢
  - å¹¿åº¦ä¼˜å…ˆæœç´¢
  - å›¾
  - æ‹“æ‰‘æ’åº
---

# 802. æ‰¾åˆ°æœ€ç»ˆçš„å®‰å…¨çŠ¶æ€

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/tag/breadth-first-search.md) [`å›¾`](/tag/graph.md) [`æ‹“æ‰‘æ’åº`](/tag/topological-sort.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/find-eventual-safe-states) [`LeetCode`](https://leetcode.com/problems/find-eventual-safe-states)

## é¢˜ç›®

There is a directed graph of `n` nodes with each node labeled from `0` to `n - 1`. The graph is represented by a **0-indexed** 2D integer array `graph` where
`graph[i]` is an integer array of nodes adjacent to node `i`, meaning there is
an edge from node `i` to each node in `graph[i]`.

A node is a **terminal node** if there are no outgoing edges. A node is a
**safe node** if every possible path starting from that node leads to a
**terminal node** (or another safe node).

Return _an array containing all the**safe nodes** of the graph_. The answer
should be sorted in **ascending** order.

**Example 1:**

![Illustration of graph](https://s3-lc-upload.s3.amazonaws.com/uploads/2018/03/17/picture1.png)

> Input: graph = [[1,2],[2,3],[5],[0],[5],[],[]]
>
> Output: [2,4,5,6]
>
> Explanation: The given graph is shown above.
>
> Nodes 5 and 6 are terminal nodes as there are no outgoing edges from either of them.
>
> Every path starting at nodes 2, 4, 5, and 6 all lead to either node 5 or 6.

**Example 2:**

> Input: graph = [[1,2,3,4],[1,2],[3,4],[0,4],[]]
>
> Output: [4]
>
> Explanation:
>
> Only node 4 is a terminal node, and every path starting at node 4 leads to node 4.

**Constraints:**

- `n == graph.length`
- `1 <= n <= 10^4`
- `0 <= graph[i].length <= n`
- `0 <= graph[i][j] <= n - 1`
- `graph[i]` is sorted in a strictly increasing order.
- The graph may contain self-loops.
- The number of edges in the graph will be in the range `[1, 4 * 104]`.

## é¢˜ç›®å¤§æ„

æœ‰ä¸€ä¸ªæœ‰ `n` ä¸ªèŠ‚ç‚¹çš„æœ‰å‘å›¾ï¼ŒèŠ‚ç‚¹æŒ‰ `0` åˆ° `n - 1` ç¼–å·ã€‚å›¾ç”±ä¸€ä¸ª **ç´¢å¼•ä» 0 å¼€å§‹** çš„ 2D æ•´æ•°æ•°ç»„ `graph`è¡¨ç¤ºï¼Œ
`graph[i]`æ˜¯ä¸èŠ‚ç‚¹ `i` ç›¸é‚»çš„èŠ‚ç‚¹çš„æ•´æ•°æ•°ç»„ï¼Œè¿™æ„å‘³ç€ä»èŠ‚ç‚¹ `i` åˆ° `graph[i]`ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€æ¡è¾¹ã€‚

å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰è¿å‡ºçš„æœ‰å‘è¾¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹æ˜¯ **ç»ˆç«¯èŠ‚ç‚¹** ã€‚å¦‚æœä»è¯¥èŠ‚ç‚¹å¼€å§‹çš„æ‰€æœ‰å¯èƒ½è·¯å¾„éƒ½é€šå‘ **ç»ˆç«¯èŠ‚ç‚¹** ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸º **å®‰å…¨èŠ‚ç‚¹** ã€‚

è¿”å›ä¸€ä¸ªç”±å›¾ä¸­æ‰€æœ‰ **å®‰å…¨èŠ‚ç‚¹** ç»„æˆçš„æ•°ç»„ä½œä¸ºç­”æ¡ˆã€‚ç­”æ¡ˆæ•°ç»„ä¸­çš„å…ƒç´ åº”å½“æŒ‰ **å‡åº** æ’åˆ—ã€‚

**ç¤ºä¾‹ 1ï¼š**

![Illustration of graph](https://s3-lc-
upload.s3.amazonaws.com/uploads/2018/03/17/picture1.png)

> **è¾“å…¥ï¼š** graph = [[1,2],[2,3],[5],[0],[5],[],[]]
>
> **è¾“å‡ºï¼š**[2,4,5,6]
>
> **è§£é‡Šï¼š** ç¤ºæ„å›¾å¦‚ä¸Šã€‚
>
> èŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 6 æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ²¡æœ‰å‡ºè¾¹ã€‚
>
> ä»èŠ‚ç‚¹ 2ã€4ã€5 å’Œ 6 å¼€å§‹çš„æ‰€æœ‰è·¯å¾„éƒ½æŒ‡å‘èŠ‚ç‚¹ 5 æˆ– 6 ã€‚

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** graph = [[1,2,3,4],[1,2],[3,4],[0,4],[]]
>
> **è¾“å‡ºï¼š**[4]
>
> **è§£é‡Š:**
>
> åªæœ‰èŠ‚ç‚¹ 4 æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹ 4 å¼€å§‹çš„æ‰€æœ‰è·¯å¾„éƒ½é€šå‘èŠ‚ç‚¹ 4 ã€‚

**æç¤ºï¼š**

- `n == graph.length`
- `1 <= n <= 10^4`
- `0 <= graph[i].length <= n`
- `0 <= graph[i][j] <= n - 1`
- `graph[i]` æŒ‰ä¸¥æ ¼é€’å¢é¡ºåºæ’åˆ—ã€‚
- å›¾ä¸­å¯èƒ½åŒ…å«è‡ªç¯ã€‚
- å›¾ä¸­è¾¹çš„æ•°ç›®åœ¨èŒƒå›´ `[1, 4 * 104]` å†…ã€‚

## è§£é¢˜æ€è·¯

é¢˜ç›®è¦æ±‚æ‰¾å‡ºæ‰€æœ‰ **æœ€ç»ˆå®‰å…¨çš„èŠ‚ç‚¹**ã€‚å¦‚æœä»æŸèŠ‚ç‚¹å‡ºå‘ï¼Œä¸ä¼šè¿›å…¥ä»»ä½•ç¯ï¼Œåˆ™è¯¥èŠ‚ç‚¹ä¸ºæœ€ç»ˆå®‰å…¨èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œä»»åŠ¡å¯ä»¥å½’ç»“ä¸ºå›¾ä¸­ **åˆ¤æ–­å“ªäº›èŠ‚ç‚¹ä¸åœ¨ç¯å†…**ã€‚

å¯ä»¥é‡‡ç”¨ **æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰** æ¥æ£€æµ‹ç¯ï¼š

1. **è¾…åŠ©æ•°ç»„ï¼š**
   - `visited[i]`: æ ‡è®°èŠ‚ç‚¹ `i` æ˜¯å¦å·²è¢«è®¿é—®è¿‡ã€‚
   - `inStack[i]`: æ ‡è®°èŠ‚ç‚¹ `i` æ˜¯å¦åœ¨å½“å‰é€’å½’æ ˆä¸­ã€‚
2. **DFS æ£€æµ‹ç¯ï¼š**
   - éå†å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œè°ƒç”¨ `hasCycle` æ£€æµ‹æ˜¯å¦æœ‰ç¯ã€‚
   - å¦‚æœå½“å‰èŠ‚ç‚¹å·²åœ¨é€’å½’æ ˆä¸­ï¼ˆ`inStack[node] == true`ï¼‰ï¼Œè¯´æ˜å­˜åœ¨ç¯ï¼Œè¿”å› `true`ã€‚
   - å¦‚æœå½“å‰èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡ï¼ˆ`visited[node] == true`ï¼‰ï¼Œç›´æ¥è¿”å› `false`ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹æ— ç¯ã€‚
   - å¯¹å½“å‰èŠ‚ç‚¹çš„é‚»å±…é€’å½’æ£€æŸ¥ï¼Œè‹¥ä»»ä½•é‚»å±…å­˜åœ¨ç¯ï¼Œåˆ™å½“å‰èŠ‚ç‚¹ä¹Ÿåœ¨ç¯å†…ã€‚
   - å¦‚æœå½“å‰èŠ‚ç‚¹æ²¡æœ‰å½¢æˆç¯ï¼Œä»é€’å½’æ ˆä¸­ç§»é™¤ï¼ˆ`inStack[node] = false`ï¼‰ã€‚
3. **æ‰¾å‡ºå®‰å…¨èŠ‚ç‚¹ï¼š**
   - éå† `inStack` æ•°ç»„ï¼Œæ‰¾åˆ°æ‰€æœ‰ä¸åœ¨ç¯ä¸­çš„èŠ‚ç‚¹ã€‚
   - å®‰å…¨èŠ‚ç‚¹æ˜¯é‚£äº›æœ€ç»ˆ `inStack[node] == false` çš„èŠ‚ç‚¹ã€‚
4. **è¿”å›ç»“æœï¼š**
   - è¾“å‡ºæ‰€æœ‰å®‰å…¨èŠ‚ç‚¹çš„ç´¢å¼•ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦ï¼š** `O(V + E)`ï¼Œå…¶ä¸­ `V` æ˜¯èŠ‚ç‚¹æ•°ï¼Œ`E` æ˜¯è¾¹æ•°ï¼Œæ¯ä¸ªèŠ‚ç‚¹å’Œè¾¹æœ€å¤šè®¿é—®ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦ï¼š** `O(V)`ï¼Œä¸»è¦æ˜¯è¾…åŠ©æ•°ç»„ `visited` å’Œ `inStack` ä»¥åŠé€’å½’æ ˆçš„å¼€é”€ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[][]} graph
 * @return {number[]}
 */
var eventualSafeNodes = function (graph) {
	const n = graph.length;
	const visited = new Array(n).fill(false); // æ ‡è®°èŠ‚ç‚¹æ˜¯å¦è®¿é—®è¿‡
	const inStack = new Array(n).fill(false); // æ ‡è®°èŠ‚ç‚¹æ˜¯å¦åœ¨é€’å½’æ ˆä¸­

	// æ£€æµ‹æ˜¯å¦å­˜åœ¨ç¯
	const hasCycle = (node) => {
		if (inStack[node]) return true; // å½“å‰èŠ‚ç‚¹åœ¨é€’å½’æ ˆä¸­ï¼Œè¯´æ˜å½¢æˆç¯
		if (visited[node]) return false; // å·²è®¿é—®ä¸”æ— ç¯
		visited[node] = true; // æ ‡è®°å·²è®¿é—®
		inStack[node] = true; // å°†å½“å‰èŠ‚ç‚¹åŠ å…¥é€’å½’æ ˆ
		for (let neighbor of graph[node]) {
			if (hasCycle(neighbor)) {
				return true; // å‘ç°ç¯
			}
		}
		inStack[node] = false; // å½“å‰èŠ‚ç‚¹å‡ºæ ˆ
		return false; // æ— ç¯
	};

	// éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ£€æŸ¥ç¯
	for (let i = 0; i < n; i++) {
		hasCycle(i);
	}

	// æ‰¾å‡ºæœ€ç»ˆå®‰å…¨çš„èŠ‚ç‚¹
	const safeNodes = [];
	for (let i = 0; i < n; i++) {
		if (!inStack[i]) {
			safeNodes.push(i); // ä¸åœ¨ç¯ä¸­çš„èŠ‚ç‚¹æ˜¯å®‰å…¨èŠ‚ç‚¹
		}
	}

	return safeNodes;
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 2392 | ç»™å®šæ¡ä»¶ä¸‹æ„é€ çŸ©é˜µ |  |  [`å›¾`](/tag/graph.md) [`æ‹“æ‰‘æ’åº`](/tag/topological-sort.md) [`æ•°ç»„`](/tag/array.md) `1+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/build-a-matrix-with-conditions) [ğŸ”—](https://leetcode.com/problems/build-a-matrix-with-conditions) |