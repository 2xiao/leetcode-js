---
title: 346. æ•°æ®æµä¸­çš„ç§»åŠ¨å¹³å‡å€¼ ğŸ”’
description: LeetCode 346. æ•°æ®æµä¸­çš„ç§»åŠ¨å¹³å‡å€¼ ğŸ”’é¢˜è§£ï¼ŒMoving Average from Data Streamï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 346. æ•°æ®æµä¸­çš„ç§»åŠ¨å¹³å‡å€¼ ğŸ”’
  - æ•°æ®æµä¸­çš„ç§»åŠ¨å¹³å‡å€¼
  - Moving Average from Data Stream
  - è§£é¢˜æ€è·¯
  - è®¾è®¡
  - é˜Ÿåˆ—
  - æ•°ç»„
  - æ•°æ®æµ
---

# 346. æ•°æ®æµä¸­çš„ç§»åŠ¨å¹³å‡å€¼ ğŸ”’

ğŸŸ¢ <font color=#15bd66>Easy</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`é˜Ÿåˆ—`](/tag/queue.md) [`æ•°ç»„`](/tag/array.md) [`æ•°æ®æµ`](/tag/data-stream.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/moving-average-from-data-stream) [`LeetCode`](https://leetcode.com/problems/moving-average-from-data-stream)

## é¢˜ç›®

Given a stream of integers and a window size, calculate the moving average of all integers in the sliding window.

Implement the `MovingAverage` class:

- `MovingAverage(int size)` Initializes the object with the size of the window size.
- `double next(int val)` Returns the moving average of the last size values of the stream.

**Example:**

> Input
>
> ["MovingAverage", "next", "next", "next", "next"]
>
> [[3], [1], [10], [3], [5]]
>
> Output
>
> [null, 1.0, 5.5, 4.66667, 6.0]
>
> Explanation
>
> MovingAverage movingAverage = new MovingAverage(3);
>
> movingAverage.next(1); // return 1.0 = 1 / 1
>
> movingAverage.next(10); // return 5.5 = (1 + 10) / 2
>
> movingAverage.next(3); // return 4.66667 = (1 + 10 + 3) / 3
>
> movingAverage.next(5); // return 6.0 = (10 + 3 + 5) / 3

**Constraints:**

- `1 <= size <= 1000`
- `-10^5 <= val <= 10^5`
- At most `10^4` calls will be made to next.

## é¢˜ç›®å¤§æ„

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°æ®æµå’Œä¸€ä¸ªçª—å£å¤§å°ï¼Œæ ¹æ®è¯¥æ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œè®¡ç®—å…¶æ‰€æœ‰æ•´æ•°çš„ç§»åŠ¨å¹³å‡å€¼ã€‚

å®ç° `MovingAverage` ç±»ï¼š

- `MovingAverage(int size)` ç”¨çª—å£å¤§å°åˆå§‹åŒ–å¯¹è±¡ã€‚
- `double next(int val)` è¿”å›æµçš„æœ€åä¸€ä¸ªå¤§å°å€¼çš„ç§»åŠ¨å¹³å‡å€¼ã€‚

## è§£é¢˜æ€è·¯

è¿™é“é¢˜å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥åšï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ—è®°å½•æ•°å­—ï¼Œç”¨ä¸€ä¸ªå˜é‡è®°å½•çª—å£å’Œï¼Œæ¯æ¬¡æ›´æ–°çª—å£å’Œã€‚

1. **ä½¿ç”¨é˜Ÿåˆ—**ï¼š

   - ä¸ºäº†ç»´æŠ¤çª—å£å†…çš„æ•°å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆæ•°ç»„ï¼‰æ¥å­˜å‚¨æœ€æ–°çš„ `size` ä¸ªæ•°å€¼ã€‚
   - æ¯æ¬¡è°ƒç”¨ `next(val)` æ–¹æ³•æ—¶ï¼Œå°†æ–°çš„æ•°å€¼æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœé˜Ÿåˆ—çš„é•¿åº¦è¶…è¿‡æŒ‡å®šçš„ `size`ï¼Œåˆ™ç§»é™¤é˜Ÿåˆ—ä¸­æœ€æ—§çš„æ•°å€¼ï¼Œä»¥ä¿æŒé˜Ÿåˆ—çš„é•¿åº¦ä¸è¶…è¿‡ `size`ã€‚

2. **ç»´æŠ¤æ€»å’Œ**ï¼š

   - ä¸ºäº†å¿«é€Ÿè®¡ç®—å¹³å‡å€¼ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ª `sum` å˜é‡ï¼Œè®°å½•å½“å‰çª—å£å†…æ‰€æœ‰æ•°å€¼çš„å’Œã€‚
   - å½“æ·»åŠ æ–°çš„æ•°å€¼æ—¶ï¼Œæ›´æ–° `sum`ï¼š
     - å¦‚æœé˜Ÿåˆ—æœªæ»¡ï¼Œå°†æ–°æ•°å€¼ç›´æ¥æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶å€¼åŠ åˆ° `sum`ã€‚
     - å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé¦–å…ˆä» `sum` ä¸­å‡å»é˜Ÿåˆ—ä¸­æœ€æ—§çš„æ•°å€¼ï¼ˆå³ `shift` æ“ä½œï¼‰ï¼Œç„¶åå†å°†æ–°æ•°å€¼æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶å€¼åŠ åˆ° `sum`ã€‚

3. **è®¡ç®—å¹³å‡å€¼**ï¼š
   - è¿”å›å½“å‰ `sum` é™¤ä»¥é˜Ÿåˆ—çš„é•¿åº¦ï¼Œå³ä¸ºå½“å‰çª—å£çš„å¹³å‡å€¼ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯ `queue` æ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚

  - å½“é˜Ÿåˆ—æœªæ»¡æ—¶ï¼Œåªéœ€æ‰§è¡Œ `push` æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
  - å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œéœ€å…ˆæ‰§è¡Œ `shift`ï¼ˆåˆ é™¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å’Œ `push`ï¼ˆæ·»åŠ æ–°å…ƒç´ ï¼‰ï¼Œå…¶ä¸­ `shift` æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ï¼ˆå› ä¸ºéœ€è¦ç§»åŠ¨æ•°ç»„ä¸­çš„å…ƒç´ ï¼‰ã€‚å› æ­¤ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œ`next` æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚
  - å› æ­¤ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚

- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œ`queue` æ•°ç»„æœ€å¤§éœ€è¦ `O(n)` çš„ç©ºé—´ã€‚

## ä»£ç 

```javascript
class MovingAverage {
	constructor(size) {
		this.size = size;
		this.queue = [];
		this.sum = 0;
	}
	next(val) {
		if (this.queue.length < this.size) {
			this.queue.push(val);
			this.sum += val;
		} else {
			this.sum -= this.queue.shift();
			this.queue.push(val);
		}
		return this.sum / this.queue.length;
	}
}
```
