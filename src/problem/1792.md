---
title: 1792. æœ€å¤§å¹³å‡é€šè¿‡ç‡
description: LeetCode 1792. æœ€å¤§å¹³å‡é€šè¿‡ç‡é¢˜è§£ï¼ŒMaximum Average Pass Ratioï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 1792. æœ€å¤§å¹³å‡é€šè¿‡ç‡
  - æœ€å¤§å¹³å‡é€šè¿‡ç‡
  - Maximum Average Pass Ratio
  - è§£é¢˜æ€è·¯
  - è´ªå¿ƒ
  - æ•°ç»„
  - å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰
---

# 1792. æœ€å¤§å¹³å‡é€šè¿‡ç‡

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è´ªå¿ƒ`](/tag/greedy.md) [`æ•°ç»„`](/tag/array.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/tag/heap-priority-queue.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/maximum-average-pass-ratio) [`LeetCode`](https://leetcode.com/problems/maximum-average-pass-ratio)

## é¢˜ç›®

There is a school that has classes of students and each class will be having a
final exam. You are given a 2D integer array `classes`, where `classes[i] =
[passi, totali]`. You know beforehand that in the `ith` class, there are
`totali` total students, but only `passi` number of students will pass the
exam.

You are also given an integer `extraStudents`. There are another
`extraStudents` brilliant students that are **guaranteed** to pass the exam of
any class they are assigned to. You want to assign each of the `extraStudents`
students to a class in a way that **maximizes** the **average** pass ratio
across **all** the classes.

The **pass ratio** of a class is equal to the number of students of the class
that will pass the exam divided by the total number of students of the class.
The **average pass ratio** is the sum of pass ratios of all the classes
divided by the number of the classes.

Return _the**maximum** possible average pass ratio after assigning the
_`extraStudents` _students._ Answers within `10^-5` of the actual answer will
be accepted.

**Example 1:**

> Input: classes = [[1,2],[3,5],[2,2]], extraStudents = 2
>
> Output: 0.78333
>
> Explanation: You can assign the two extra students to the first class. The average pass ratio will be equal to (3/4 + 3/5 + 2/2) / 3 = 0.78333.

**Example 2:**

> Input: classes = [[2,4],[3,9],[4,5],[2,10]], extraStudents = 4
>
> Output: 0.53485

**Constraints:**

- `1 <= classes.length <= 10^5`
- `classes[i].length == 2`
- `1 <= passi <= totali <= 10^5`
- `1 <= extraStudents <= 10^5`

## é¢˜ç›®å¤§æ„

ä¸€æ‰€å­¦æ ¡é‡Œæœ‰ä¸€äº›ç­çº§ï¼Œæ¯ä¸ªç­çº§é‡Œæœ‰ä¸€äº›å­¦ç”Ÿï¼Œç°åœ¨æ¯ä¸ªç­éƒ½ä¼šè¿›è¡Œä¸€åœºæœŸæœ«è€ƒè¯•ã€‚ç»™ä½ ä¸€ä¸ªäºŒç»´æ•°ç»„ `classes` ï¼Œå…¶ä¸­ `classes[i] = [passi, totali]` ï¼Œè¡¨ç¤ºä½ æå‰çŸ¥é“äº†ç¬¬ `i` ä¸ªç­çº§æ€»å…±æœ‰ `totali` ä¸ªå­¦ç”Ÿï¼Œå…¶ä¸­åªæœ‰ `passi` ä¸ªå­¦ç”Ÿå¯ä»¥é€šè¿‡è€ƒè¯•ã€‚

ç»™ä½ ä¸€ä¸ªæ•´æ•° `extraStudents` ï¼Œè¡¨ç¤ºé¢å¤–æœ‰ `extraStudents` ä¸ªèªæ˜çš„å­¦ç”Ÿï¼Œä»–ä»¬ **ä¸€å®š**
èƒ½é€šè¿‡ä»»ä½•ç­çº§çš„æœŸæœ«è€ƒã€‚ä½ éœ€è¦ç»™è¿™ `extraStudents` ä¸ªå­¦ç”Ÿæ¯äººéƒ½å®‰æ’ä¸€ä¸ªç­çº§ï¼Œä½¿å¾— **æ‰€æœ‰** ç­çº§çš„ **å¹³å‡** é€šè¿‡ç‡ **æœ€å¤§**
ã€‚

ä¸€ä¸ªç­çº§çš„ **é€šè¿‡ç‡** ç­‰äºè¿™ä¸ªç­çº§é€šè¿‡è€ƒè¯•çš„å­¦ç”Ÿäººæ•°é™¤ä»¥è¿™ä¸ªç­çº§çš„æ€»äººæ•°ã€‚**å¹³å‡é€šè¿‡ç‡** æ˜¯æ‰€æœ‰ç­çº§çš„é€šè¿‡ç‡ä¹‹å’Œé™¤ä»¥ç­çº§æ•°ç›®ã€‚

è¯·ä½ è¿”å›åœ¨å®‰æ’è¿™ `extraStudents` ä¸ªå­¦ç”Ÿå»å¯¹åº”ç­çº§åçš„ **æœ€å¤§** å¹³å‡é€šè¿‡ç‡ã€‚ä¸æ ‡å‡†ç­”æ¡ˆè¯¯å·®èŒƒå›´åœ¨ `10^-5`
ä»¥å†…çš„ç»“æœéƒ½ä¼šè§†ä¸ºæ­£ç¡®ç»“æœã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š** classes = [[1,2],[3,5],[2,2]], extraStudents = 2
>
> **è¾“å‡ºï¼š** 0.78333
>
> **è§£é‡Šï¼š** ä½ å¯ä»¥å°†é¢å¤–çš„ä¸¤ä¸ªå­¦ç”Ÿéƒ½å®‰æ’åˆ°ç¬¬ä¸€ä¸ªç­çº§ï¼Œå¹³å‡é€šè¿‡ç‡ä¸º (3/4 + 3/5 + 2/2) / 3 = 0.78333 ã€‚

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** classes = [[2,4],[3,9],[4,5],[2,10]], extraStudents = 4
>
> **è¾“å‡ºï¼š** 0.53485

**æç¤ºï¼š**

- `1 <= classes.length <= 10^5`
- `classes[i].length == 2`
- `1 <= passi <= totali <= 10^5`
- `1 <= extraStudents <= 10^5`

## è§£é¢˜æ€è·¯

æœ¬é¢˜çš„ç›®æ ‡æ˜¯é€šè¿‡åˆ†é…é¢å¤–çš„èªæ˜å­¦ç”Ÿï¼Œä½¿å¾—æ‰€æœ‰ç­çº§çš„ **å¹³å‡é€šè¿‡ç‡** è¾¾åˆ°æœ€å¤§å€¼ã€‚

è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„è´ªå¿ƒç®—æ³•é—®é¢˜ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ä¼˜å…ˆåˆ†é…é¢å¤–å­¦ç”Ÿåˆ°èƒ½å¸¦æ¥ **æœ€å¤§é€šè¿‡ç‡å¢ç›Š** çš„ç­çº§ã€‚

å¯¹äºæŸä¸ªç­çº§ï¼Œå…¶é€šè¿‡ç‡å¢ç›Šå…¬å¼ä¸ºï¼š

`gain(pass, total) = ((pass + 1) / (total + 1)) - (pass / total)`

è¡¨ç¤ºå°†ä¸€ä¸ªé¢å¤–å­¦ç”Ÿåˆ†é…åˆ°è¯¥ç­çº§åï¼Œé€šè¿‡ç‡å¢åŠ çš„å€¼ã€‚

è¿™ä¸ªå¢ç›Šå€¼å¯ä»¥ç”¨æ¥å†³å®šé¢å¤–å­¦ç”Ÿçš„åˆ†é…ä¼˜å…ˆçº§ï¼Œæ¯æ¬¡å°†é¢å¤–å­¦ç”Ÿåˆ†é…åˆ°å¢ç›Šå€¼æœ€é«˜çš„ç­çº§ã€‚

1. **åˆå§‹å¢ç›Šè®¡ç®—**ï¼š

   - ä½¿ç”¨æœ€å¤§å †ï¼ˆMaxHeapï¼‰æ¥ç»´æŠ¤æ‰€æœ‰ç­çº§çš„å¢ç›Šå€¼ï¼Œå †é¡¶å§‹ç»ˆæ˜¯å½“å‰å¢ç›Šæœ€å¤§çš„ç­çº§ã€‚
   - å¯¹æ‰€æœ‰ç­çº§ï¼Œè®¡ç®—å…¶å½“å‰çš„å¢ç›Šå€¼ `gain(pass, total)`ï¼Œå¹¶å°†å…¶è¿åŒ `pass` å’Œ `total` ä¸€èµ·å­˜å…¥æœ€å¤§å †ã€‚

2. **åˆ†é…é¢å¤–å­¦ç”Ÿ**ï¼š

   - æ¯æ¬¡ä»å †ä¸­å–å‡ºå¢ç›Šå€¼æœ€å¤§çš„ç­çº§ï¼Œå°†ä¸€ä¸ªé¢å¤–å­¦ç”Ÿåˆ†é…ç»™è¯¥ç­çº§ã€‚
   - æ›´æ–°è¯¥ç­çº§çš„ `pass` å’Œ `total`ï¼Œé‡æ–°è®¡ç®—å…¶å¢ç›Šå€¼åæ’å›å †ä¸­ã€‚
   - é‡å¤è¯¥è¿‡ç¨‹ `extraStudents` æ¬¡ã€‚

3. **è®¡ç®—å¹³å‡é€šè¿‡ç‡**ï¼š
   - åˆ†é…å®Œé¢å¤–å­¦ç”Ÿåï¼Œéå†å †ä¸­æ‰€æœ‰ç­çº§ï¼Œè®¡ç®—æ€»çš„é€šè¿‡ç‡å¹¶æ±‚å¹³å‡å€¼ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n + k * log n)`ï¼Œå…¶ä¸­ `n` æ˜¯ç­çº§çš„æ•°é‡ï¼Œ`k` æ˜¯é¢å¤–å­¦ç”Ÿçš„äººæ•°ã€‚
  - åˆå§‹å †æ„å»ºï¼š`O(n)`ã€‚
  - æ¯æ¬¡åˆ†é…å­¦ç”Ÿï¼šå †æ’å…¥å’Œå¼¹å‡ºæ“ä½œçš„å¤æ‚åº¦ä¸º `O(log n)`ï¼Œæ€»è®¡éœ€è¦è¿›è¡Œ `k` æ¬¡åˆ†é…ï¼Œå› æ­¤ä¸º `O(k * log n)`ã€‚
  - è®¡ç®—å¹³å‡é€šè¿‡ç‡ï¼š`O(n)`ã€‚
  - æ€»å¤æ‚åº¦ä¸ºï¼š`O(n + k * log n)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œæœ€å¤§å †çš„ç©ºé—´å¤æ‚åº¦ä¸º `O(n)`ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[][]} classes
 * @param {number} extraStudents
 * @return {number}
 */
var maxAverageRatio = function (classes, extraStudents) {
	// é€šè¿‡ç‡å¢ç›Šå…¬å¼
	const gain = (pass, total) => (pass + 1) / (total + 1) - pass / total;

	// è®¡ç®—æ‰€æœ‰ç­çº§çš„é€šè¿‡ç‡å¢ç›Šå€¼
	const arr = classes.map(([pass, total]) => [gain(pass, total), pass, total]);
	const priority = (a, b) => a[0] > b[0];

	// å­˜å…¥æœ€å¤§å † [gain, pass, total]
	let maxHeap = new MaxHeap(arr, priority);

	// åˆ†é…é¢å¤–å­¦ç”Ÿ
	for (let i = 0; i < extraStudents; i++) {
		let [_, pass, total] = maxHeap.pop();
		pass += 1;
		total += 1;
		maxHeap.insert([gain(pass, total), pass, total]);
	}

	// è®¡ç®—å¹³å‡é€šè¿‡ç‡
	let totalRatio = maxHeap
		.toArray()
		.reduce((acc, cur) => acc + cur[1] / cur[2], 0);
	return totalRatio / classes.length;
};

class MaxHeap {
	constructor(arr = [], priority = (a, b) => a > b) {
		this.heap = arr;
		this.priority = priority;
		for (let i = Math.floor(this.heap.length / 2) - 1; i >= 0; i--) {
			this.heapifyDown(i);
		}
	}
	insert(num) {
		this.heap.push(num);
		this.heapifyUp(this.heap.length - 1);
	}
	pop() {
		if (this.heap.length == 0) return null;
		const top = this.heap[0];
		const last = this.heap.pop();
		if (this.heap.length) {
			this.heap[0] = last;
			this.heapifyDown(0);
		}
		return top;
	}
	toArray() {
		return this.heap;
	}
	heapifyDown(i) {
		const left = i * 2 + 1,
			right = i * 2 + 2;
		let max = i;
		if (
			left < this.heap.length &&
			this.priority(this.heap[left], this.heap[max])
		) {
			max = left;
		}
		if (
			right < this.heap.length &&
			this.priority(this.heap[right], this.heap[max])
		) {
			max = right;
		}
		if (max !== i) {
			[this.heap[i], this.heap[max]] = [this.heap[max], this.heap[i]];
			this.heapifyDown(max);
		}
	}

	heapifyUp(i) {
		while (i) {
			const parent = Math.floor((i - 1) / 2);
			if (this.priority(this.heap[i], this.heap[parent])) {
				[this.heap[i], this.heap[parent]] = [this.heap[parent], this.heap[i]];
				i = parent;
			} else {
				break;
			}
		}
	}
}
```
