# [2044. ç»Ÿè®¡æŒ‰ä½æˆ–èƒ½å¾—åˆ°æœ€å¤§å€¼çš„å­é›†æ•°ç›®](https://leetcode.com/problems/count-number-of-maximum-bitwise-or-subsets)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`æ•°ç»„`](/tag/array.md) [`å›æº¯`](/tag/backtracking.md) [`æšä¸¾`](/tag/enumeration.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/count-number-of-maximum-bitwise-or-subsets)

## é¢˜ç›®

Given an integer array `nums`, find the **maximum** possible **bitwise OR** of
a subset of `nums` and return _the **number of different non-empty subsets** with the maximum bitwise OR_.

An array `a` is a **subset** of an array `b` if `a` can be obtained from `b`
by deleting some (possibly zero) elements of `b`. Two subsets are considered
**different** if the indices of the elements chosen are different.

The bitwise OR of an array `a` is equal to `a[0] **OR** a[1] **OR** ... **OR**
a[a.length - 1]` (**0-indexed**).

**Example 1:**

> Input: nums = [3,1]
>
> Output: 2
>
> Explanation: The maximum possible bitwise OR of a subset is 3. There are 2 subsets with a bitwise OR of 3:
>
> - [3]
> - [3,1]

**Example 2:**

> Input: nums = [2,2,2]
>
> Output: 7
>
> Explanation: All non-empty subsets of [2,2,2] have a bitwise OR of 2. There are 2^3 - 1 = 7 total subsets.

**Example 3:**

> Input: nums = [3,2,1,5]
>
> Output: 6
>
> Explanation: The maximum possible bitwise OR of a subset is 7. There are 6 subsets with a bitwise OR of 7:
>
> - [3,5]
> - [3,1,5]
> - [3,2,5]
> - [3,2,1,5]
> - [2,5]
> - [2,1,5]

**Constraints:**

- `1 <= nums.length <= 16`
- `1 <= nums[i] <= 10^5`

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œè¯·ä½ æ‰¾å‡º `nums` å­é›† **æŒ‰ä½æˆ–** å¯èƒ½å¾—åˆ°çš„**æœ€å¤§å€¼** ï¼Œå¹¶è¿”å›æŒ‰ä½æˆ–èƒ½å¾—åˆ°æœ€å¤§å€¼çš„
**ä¸åŒéç©ºå­é›†çš„æ•°ç›®** ã€‚

å¦‚æœæ•°ç»„ `a` å¯ä»¥ç”±æ•°ç»„ `b` åˆ é™¤ä¸€äº›å…ƒç´ ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰å¾—åˆ°ï¼Œåˆ™è®¤ä¸ºæ•°ç»„ `a` æ˜¯æ•°ç»„ `b` çš„ä¸€ä¸ª **å­é›†**
ã€‚å¦‚æœé€‰ä¸­çš„å…ƒç´ ä¸‹æ ‡ä½ç½®ä¸ä¸€æ ·ï¼Œåˆ™è®¤ä¸ºä¸¤ä¸ªå­é›† **ä¸åŒ** ã€‚

å¯¹æ•°ç»„ `a` æ‰§è¡Œ **æŒ‰ä½æˆ–** ï¼Œç»“æœç­‰äº `a[0] OR a[1] OR ... OR a[a.length - 1]`ï¼ˆä¸‹æ ‡ä» **0** å¼€å§‹ï¼‰ã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š** nums = [3,1]
>
> **è¾“å‡ºï¼š** 2
>
> **è§£é‡Šï¼š** å­é›†æŒ‰ä½æˆ–èƒ½å¾—åˆ°çš„æœ€å¤§å€¼æ˜¯ 3 ã€‚æœ‰ 2 ä¸ªå­é›†æŒ‰ä½æˆ–å¯ä»¥å¾—åˆ° 3 ï¼š
>
> - [3]
> - [3,1]

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** nums = [2,2,2]
>
> **è¾“å‡ºï¼š** 7
>
> **è§£é‡Šï¼š**[2,2,2] çš„æ‰€æœ‰éç©ºå­é›†çš„æŒ‰ä½æˆ–éƒ½å¯ä»¥å¾—åˆ° 2 ã€‚æ€»å…±æœ‰ 2^3 - 1 = 7 ä¸ªå­é›†ã€‚

**ç¤ºä¾‹ 3ï¼š**

> **è¾“å…¥ï¼š** nums = [3,2,1,5]
>
> **è¾“å‡ºï¼š** 6
>
> **è§£é‡Šï¼š** å­é›†æŒ‰ä½æˆ–å¯èƒ½çš„æœ€å¤§å€¼æ˜¯ 7 ã€‚æœ‰ 6 ä¸ªå­é›†æŒ‰ä½æˆ–å¯ä»¥å¾—åˆ° 7 ï¼š
>
> - [3,5]
> - [3,1,5]
> - [3,2,5]
> - [3,2,1,5]
> - [2,5]
> - [2,1,5]

**æç¤ºï¼š**

- `1 <= nums.length <= 16`
- `1 <= nums[i] <= 10^5`

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šå›æº¯

è¿™é“é¢˜ç›®è¿˜å¯ä»¥ä½¿ç”¨å›æº¯æ¥åšï¼Œå¯¹åº”åˆ°ç®—æ³•è¯¦è§£[ã€Š3.4 å›æº¯ç®—æ³•ã€‹](../book/backtracking.md) ä¸­è®²åˆ°çš„ã€Œå…ƒç´ å¯é‡ä¸å¯å¤é€‰ - å­é›†ã€é¢˜å‹ã€‚

1. **åˆå§‹åŒ–**ï¼š

   - åˆ›å»ºä¸€ä¸ªå˜é‡ `maxOR` ç”¨äºå­˜å‚¨å½“å‰æ‰¾åˆ°çš„æœ€å¤§æŒ‰ä½æˆ–å€¼ï¼Œå¦ä¸€ä¸ªå˜é‡ `count` ç”¨äºè®°å½•å¯ä»¥å¾—åˆ°è¯¥æœ€å¤§å€¼çš„ä¸åŒéç©ºå­é›†çš„æ•°é‡ã€‚
   - ä½¿ç”¨ä¸€ä¸ª `track` å˜é‡æ¥ç»´æŠ¤å½“å‰å­é›†çš„æŒ‰ä½æˆ–å€¼ã€‚

2. **å›æº¯å‡½æ•°**ï¼š

   - å®šä¹‰ä¸€ä¸ªå›æº¯å‡½æ•° `backtrack(start)`ï¼Œç”¨äºç”Ÿæˆä» `start` å¼€å§‹çš„æ‰€æœ‰å­é›†ã€‚
   - åœ¨æ¯æ¬¡é€’å½’ä¸­ï¼Œéå†å½“å‰ç´¢å¼• `start` åˆ°æ•°ç»„æœ«å°¾çš„æ‰€æœ‰å…ƒç´ ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š
     - **è®°å½•çŠ¶æ€**ï¼šåœ¨å¤„ç†å½“å‰å…ƒç´ å‰ï¼Œä¿å­˜å½“å‰çš„ `track` å€¼ã€‚
     - **æ›´æ–° `track`**ï¼šå°†å½“å‰å…ƒç´ ä¸ `track` è¿›è¡ŒæŒ‰ä½æˆ–è¿ç®—ï¼Œæ›´æ–° `track`ã€‚
     - **æ›´æ–°æœ€å¤§å€¼å’Œè®¡æ•°**ï¼š
       - å¦‚æœå½“å‰ `track` çš„å€¼å¤§äº `maxOR`ï¼Œåˆ™æ›´æ–° `maxOR` å¹¶å°† `count` é‡ç½®ä¸º 1ï¼ˆè¡¨ç¤ºæ‰¾åˆ°ä¸€ä¸ªæ–°çš„æœ€å¤§å€¼ï¼‰ã€‚
       - å¦‚æœå½“å‰ `track` ç­‰äº `maxOR`ï¼Œåˆ™å°† `count` åŠ  1ï¼ˆè¡¨ç¤ºæ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å­é›†ï¼‰ã€‚
     - **é€’å½’è°ƒç”¨**ï¼šé€’å½’åœ°è°ƒç”¨ `backtrack(i + 1)`ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚
     - **æ¢å¤çŠ¶æ€**ï¼šåœ¨è¿”å›ä¹‹å‰ï¼Œå°† `track` æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€æ¬¡è¿­ä»£ã€‚

3. **å¯åŠ¨å›æº¯**ï¼š

   - ä»ç´¢å¼• 0 å¼€å§‹è°ƒç”¨ `backtrack(0)`ï¼Œä»¥ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å­é›†ã€‚

4. **è¿”å›ç»“æœ**ï¼š
   - å‡½æ•°ç»“æŸåè¿”å› `count`ï¼Œå³èƒ½å¤Ÿç”Ÿæˆæœ€å¤§æŒ‰ä½æˆ–å€¼çš„ä¸åŒéç©ºå­é›†çš„æ•°é‡ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(2^n)`ï¼Œå…¶ä¸­ n æ˜¯æ•°ç»„çš„é•¿åº¦ï¼Œæ¯ä¸ªå…ƒç´ å¯ä»¥é€‰æ‹©åŠ å…¥æˆ–ä¸åŠ å…¥å­é›†ä¸­ï¼Œæœ€å¤šä¼šæœ‰ `2^n` ä¸ªå­é›†ï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦æ£€æŸ¥æ‰€æœ‰å­é›†ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œä¸»è¦å¼€é”€æ˜¯é€’å½’æ ˆçš„ç©ºé—´ï¼Œé€’å½’è°ƒç”¨çš„æ·±åº¦æœ€å¤šä¸º `n`ã€‚

### æ€è·¯äºŒï¼šéšå¼å›æº¯

å¯ä»¥å¯¹ä¸Šé¢çš„ä»£ç è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

1. éšå¼å›æº¯
   ç»™å›æº¯å‡½æ•°å¢åŠ ä¸€ä¸ªå‚æ•° `currentOR`ï¼Œç›´æ¥é€šè¿‡ `currentOR` å‚æ•°æ¥è·Ÿè¸ªå½“å‰çš„æŒ‰ä½æˆ–å€¼ï¼Œå°† `track` çš„æ›´æ–°é€»è¾‘ç§»é™¤ï¼Œéšå¼åœ°å›æº¯ï¼Œç®€åŒ–çŠ¶æ€ç®¡ç†ã€‚

2. ç›´æ¥æ±‚å¾—æœ€å¤§æŒ‰ä½æˆ–å€¼ `maxOR`
   æŒ‰ä½æˆ–è¿ç®—ï¼ˆ`|`ï¼‰å¯¹ä¸¤ä¸ªæ•°çš„æ¯ä¸€ä½è¿›è¡Œæ¯”è¾ƒï¼Œåªè¦æœ‰ä¸€ä½æ˜¯ 1ï¼Œç»“æœçš„è¯¥ä½å°±æ˜¯ 1ã€‚å› æ­¤ï¼ŒæŒ‰ä½æˆ–çš„ç»“æœä¼šä¿ç•™æ‰€æœ‰å‚ä¸è¿ç®—æ•°çš„ 1ã€‚

   æ‰€ä»¥æœ€å¤§æŒ‰ä½æˆ–å€¼ `maxOR` å°±æ˜¯å°†æ•°ç»„ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒæŒ‰ä½æˆ–è¿ç®—ï¼Œå› ä¸ºå®ƒå°†åŒ…å«æ‰€æœ‰å…ƒç´ åœ¨å…¶äºŒè¿›åˆ¶è¡¨ç¤ºä¸­å­˜åœ¨çš„æ‰€æœ‰ 1 ä½ã€‚

   å³ï¼š`maxOR = nums.reduce((acc, num) => acc | num, 0)`

   å› æ­¤å¯ä»¥ç›´æ¥æ±‚å¾— `maxOR`ï¼Œç§»é™¤åœ¨é€’å½’ä¸­è®¡ç®—æœ€å¤§å€¼çš„é€»è¾‘ï¼Œç®€åŒ–çŠ¶æ€ç®¡ç†ã€‚

å¤æ‚åº¦åˆ†æåŒä¸Šã€‚

## ä»£ç 

:::: code-tabs
@tab å›æº¯

```javascript
/**
 * @param {number[]} nums
 * @return {number}
 */
var countMaxOrSubsets = function (nums) {
	const n = nums.length;
	let track = 0,
		maxOR = 0,
		count = 0;

	const backtrack = (start) => {
		for (let i = start; i < n; i++) {
			// è®°å½•å½“å‰çŠ¶æ€
			const currentTrack = track;

			// æ›´æ–° track
			track |= nums[i];

			// æ ¹æ® track çš„å€¼æ›´æ–° maxOR å’Œ count
			if (track > maxOR) {
				maxOR = track;
				count = 1; // æ‰¾åˆ°æ–°çš„æœ€å¤§å€¼ï¼Œé‡ç½®è®¡æ•°
			} else if (track === maxOR) {
				count++; // å½“å‰å€¼ç­‰äºæœ€å¤§å€¼ï¼Œè®¡æ•°åŠ  1
			}

			// é€’å½’è°ƒç”¨
			backtrack(i + 1);

			// æ¢å¤ track çš„çŠ¶æ€
			track = currentTrack;
		}
	};

	backtrack(0);
	return count;
};
```

@tab éšå¼å›æº¯

```javascript
/**
 * @param {number[]} nums
 * @return {number}
 */
var countMaxOrSubsets = function (nums) {
	const n = nums.length;
	const maxOR = nums.reduce((acc, num) => acc | num, 0);
	let count = 0;

	const backtrack = (start, currentOR) => {
		for (let i = start; i < n; i++) {
			const newOR = currentOR | nums[i];

			if (newOR === maxOR) {
				count++; // å¦‚æœå½“å‰æŒ‰ä½æˆ–å€¼ç­‰äºæœ€å¤§å€¼ï¼Œè®¡æ•°åŠ  1
			}

			backtrack(i + 1, newOR); // é€’å½’è°ƒç”¨ï¼Œæ›´æ–° currentOR
		}
	};

	backtrack(0, 0); // ä»ç´¢å¼• 0 å¼€å§‹ï¼Œåˆå§‹æŒ‰ä½æˆ–å€¼ä¸º 0
	return count;
};
```

::::

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 78 | [å­é›†](https://leetcode.com/problems/subsets) | [[âœ“]](/problem/0078.md) |  [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`æ•°ç»„`](/tag/array.md) [`å›æº¯`](/tag/backtracking.md) | <font color=#ffb800>Medium</font> |
| 2275 | [æŒ‰ä½ä¸ç»“æœå¤§äºé›¶çš„æœ€é•¿ç»„åˆ](https://leetcode.com/problems/largest-combination-with-bitwise-and-greater-than-zero) |  |  [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) `1+` | <font color=#ffb800>Medium</font> |
| 2419 | [æŒ‰ä½ä¸æœ€å¤§çš„æœ€é•¿å­æ•°ç»„](https://leetcode.com/problems/longest-subarray-with-maximum-bitwise-and) |  |  [`ä½è¿ç®—`](/tag/bit-manipulation.md) [`è„‘ç­‹æ€¥è½¬å¼¯`](/tag/brainteaser.md) [`æ•°ç»„`](/tag/array.md) | <font color=#ffb800>Medium</font> |