---
title: 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜
description: LeetCode 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜é¢˜è§£ï¼ŒRange Sum Query 2D - Immutableï¼ŒåŒ…å«è§£é¢˜æ€è·¯ã€å¤æ‚åº¦åˆ†æä»¥åŠå®Œæ•´çš„ JavaScript ä»£ç å®ç°ã€‚
keywords:
  - LeetCode
  - 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜
  - äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜
  - Range Sum Query 2D - Immutable
  - è§£é¢˜æ€è·¯
  - è®¾è®¡
  - æ•°ç»„
  - çŸ©é˜µ
  - å‰ç¼€å’Œ
---

# 304. äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µä¸å¯å˜

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`çŸ©é˜µ`](/tag/matrix.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/range-sum-query-2d-immutable) [`LeetCode`](https://leetcode.com/problems/range-sum-query-2d-immutable)

## é¢˜ç›®

Given a 2D matrix `matrix`, handle multiple queries of the following type:

- Calculate the **sum** of the elements of `matrix` inside the rectangle defined by its **upper left corner** `(row1, col1)` and **lower right corner** `(row2, col2)`.

Implement the `NumMatrix` class:

- `NumMatrix(int[][] matrix)` Initializes the object with the integer matrix `matrix`.
- `int sumRegion(int row1, int col1, int row2, int col2)` Returns the **sum** of the elements of `matrix` inside the rectangle defined by its **upper left corner** `(row1, col1)` and **lower right corner** `(row2, col2)`.

You must design an algorithm where `sumRegion` works on `O(1)` time
complexity.

**Example 1:**

![](https://assets.leetcode.com/uploads/2021/03/14/sum-grid.jpg)

> **Input**
>
> ["NumMatrix", "sumRegion", "sumRegion", "sumRegion"]
>
> [[[[3, 0, 1, 4, 2], [5, 6, 3, 2, 1], [1, 2, 0, 1, 5], [4, 1, 0, 1, 7], [1, 0, 3, 0, 5]]], [2, 1, 4, 3], [1, 1, 2, 2], [1, 2, 2, 4]]
>
> **Output**
>
> [null, 8, 11, 12]
>
> **Explanation**
>
> NumMatrix numMatrix = new NumMatrix([[3, 0, 1, 4, 2], [5, 6, 3, 2, 1], [1, 2, 0, 1, 5], [4, 1, 0, 1, 7], [1, 0, 3, 0, 5]]);
>
> numMatrix.sumRegion(2, 1, 4, 3); // return 8 (i.e sum of the red rectangle)
>
> numMatrix.sumRegion(1, 1, 2, 2); // return 11 (i.e sum of the green rectangle)
>
> numMatrix.sumRegion(1, 2, 2, 4); // return 12 (i.e sum of the blue rectangle)

**Constraints:**

- `m == matrix.length`
- `n == matrix[i].length`
- `1 <= m, n <= 200`
- `-10^4 <= matrix[i][j] <= 10^4`
- `0 <= row1 <= row2 < m`
- `0 <= col1 <= col2 < n`
- At most `10^4` calls will be made to `sumRegion`.

## é¢˜ç›®å¤§æ„

ç»™å®šä¸€ä¸ªäºŒç»´çŸ©é˜µ `matrix`ï¼Œä»¥ä¸‹ç±»å‹çš„å¤šä¸ªè¯·æ±‚ï¼š

- è®¡ç®—å…¶å­çŸ©å½¢èŒƒå›´å†…å…ƒç´ çš„æ€»å’Œï¼Œè¯¥å­çŸ©é˜µçš„ **å·¦ä¸Šè§’** ä¸º `(row1, col1)` ï¼Œ**å³ä¸‹è§’** ä¸º `(row2, col2)` ã€‚

å®ç° `NumMatrix` ç±»ï¼š

- `NumMatrix(int[][] matrix)` ç»™å®šæ•´æ•°çŸ©é˜µ `matrix` è¿›è¡Œåˆå§‹åŒ–
- `int sumRegion(int row1, int col1, int row2, int col2)` è¿”å› **å·¦ä¸Šè§’** `(row1, col1)` ã€**å³ä¸‹è§’** `(row2, col2)` æ‰€æè¿°çš„å­çŸ©é˜µçš„å…ƒç´  **æ€»å’Œ** ã€‚

**ç¤ºä¾‹ 1ï¼š**

![](https://pic.leetcode-cn.com/1626332422-wUpUHT-image.png)

> **è¾“å…¥:**
>
> ["NumMatrix","sumRegion","sumRegion","sumRegion"]
>
> [[[[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]],[2,1,4,3],[1,1,2,2],[1,2,2,4]]
>
> **è¾“å‡º:**
>
> [null, 8, 11, 12]
>
> **è§£é‡Š:**
>
> NumMatrix numMatrix = new NumMatrix([[3,0,1,4,2],[5,6,3,2,1],[1,2,0,1,5],[4,1,0,1,7],[1,0,3,0,5]]);
>
> numMatrix.sumRegion(2, 1, 4, 3); // return 8 (çº¢è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
>
> numMatrix.sumRegion(1, 1, 2, 2); // return 11 (ç»¿è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)
>
> numMatrix.sumRegion(1, 2, 2, 4); // return 12 (è“è‰²çŸ©å½¢æ¡†çš„å…ƒç´ æ€»å’Œ)

**æç¤ºï¼š**

- `m == matrix.length`
- `n == matrix[i].length`
- `1 <= m, n <= 200`
- `-10^5 <= matrix[i][j] <= 10^5`
- `0 <= row1 <= row2 < m`
- `0 <= col1 <= col2 < n`
- æœ€å¤šè°ƒç”¨ `10^4` æ¬¡ `sumRegion` æ–¹æ³•

## è§£é¢˜æ€è·¯

1. **æ„å»ºå‰ç¼€å’Œæ•°ç»„**ï¼š

   - ä½¿ç”¨ä¸€ä¸ªäºŒç»´æ•°ç»„ `sum` å­˜å‚¨å‰ç¼€å’Œã€‚
   - `sum[i][j]` è¡¨ç¤ºä»å·¦ä¸Šè§’ `(0, 0)` åˆ°å½“å‰ä½ç½® `(i-1, j-1)` çš„å­çŸ©é˜µå…ƒç´ æ€»å’Œã€‚
   - `sum[i][j]` çš„é€’æ¨å…¬å¼ä¸ºï¼š
     ```text
     sum[i][j] = matrix[i-1][j-1] + sum[i-1][j] + sum[i][j-1] - sum[i-1][j-1]
     ```
     å…¶ä¸­ï¼š
     - `matrix[i-1][j-1]` æ˜¯å½“å‰å…ƒç´ ã€‚
     - `sum[i-1][j]` æ˜¯ä¸Šä¸€è¡Œç´¯ç§¯çš„å‰ç¼€å’Œã€‚
     - `sum[i][j-1]` æ˜¯å½“å‰è¡Œå·¦è¾¹ç´¯ç§¯çš„å‰ç¼€å’Œã€‚
     - `sum[i-1][j-1]` æ˜¯é‡å¤è®¡ç®—çš„åŒºåŸŸï¼Œéœ€è¦å‡æ‰ã€‚

2. **æŸ¥è¯¢åŒºåŸŸå’Œ**ï¼š
   - å¯¹äºä»»æ„ç»™å®šçš„çŸ©é˜µåŒºåŸŸ `(row1, col1)` åˆ° `(row2, col2)`ï¼ŒåŒºåŸŸå’Œå¯ä»¥é€šè¿‡å‰ç¼€å’Œæ•°ç»„å¿«é€Ÿè®¡ç®—ï¼š
     ```text
     sumRegion = sum[row2+1][col2+1]
               - sum[row1][col2+1]
               - sum[row2+1][col1]
               + sum[row1][col1]
     ```
     å…¶ä¸­ï¼š
     - `sum[row2+1][col2+1]` æ˜¯å®Œæ•´åŒºåŸŸçš„å‰ç¼€å’Œã€‚
     - `sum[row1][col2+1]` æ˜¯å»æ‰ä¸Šæ–¹åŒºåŸŸçš„å‰ç¼€å’Œã€‚
     - `sum[row2+1][col1]` æ˜¯å»æ‰å·¦ä¾§åŒºåŸŸçš„å‰ç¼€å’Œã€‚
     - `sum[row1][col1]` æ˜¯ä¸Šæ–¹å’Œå·¦ä¾§é‡å åŒºåŸŸçš„å‰ç¼€å’Œï¼Œéœ€è¦åŠ å›æ¥ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š
  - **æ„é€ **ï¼šè®¡ç®—å‰ç¼€å’Œéœ€è¦éå†æ•´ä¸ªçŸ©é˜µï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(m * n)`ï¼Œå…¶ä¸­ `m` æ˜¯çŸ©é˜µçš„è¡Œæ•°ï¼Œ`n` æ˜¯çŸ©é˜µçš„åˆ—æ•°ã€‚
  - **æŸ¥è¯¢**ï¼šæ¯æ¬¡æŸ¥è¯¢åªæ¶‰åŠå¸¸æ•°æ¬¡åŠ å‡æ³•æ“ä½œï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(m * n)`ï¼Œéœ€è¦ä¸€ä¸ªå¤§å°ä¸º `(m + 1) x (n + 1)` çš„äºŒç»´æ•°ç»„å­˜å‚¨å‰ç¼€å’Œã€‚

## ä»£ç 

```javascript
/**
 * @param {number[][]} matrix
 */
var NumMatrix = function (matrix) {
	const m = matrix.length;
	const n = matrix[0].length;
	this.sum = new Array(m + 1).fill().map(() => new Array(n + 1).fill(0));

	for (let i = 1; i <= m; i++) {
		for (let j = 1; j <= n; j++) {
			this.sum[i][j] =
				matrix[i - 1][j - 1] +
				this.sum[i - 1][j] +
				this.sum[i][j - 1] -
				this.sum[i - 1][j - 1];
		}
	}
};

/**
 * @param {number} row1
 * @param {number} col1
 * @param {number} row2
 * @param {number} col2
 * @return {number}
 */
NumMatrix.prototype.sumRegion = function (row1, col1, row2, col2) {
	return (
		this.sum[row2 + 1][col2 + 1] -
		this.sum[row1][col2 + 1] -
		this.sum[row2 + 1][col1] +
		this.sum[row1][col1]
	);
};
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ | åŠ›æ‰£ |
| :------: | :------ | :------: | :------ | :------: | :------: |
| 303 | åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜ | [[âœ“]](/problem/0303.md) |  [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å‰ç¼€å’Œ`](/tag/prefix-sum.md) | ğŸŸ¢ | [ğŸ€„ï¸](https://leetcode.cn/problems/range-sum-query-immutable) [ğŸ”—](https://leetcode.com/problems/range-sum-query-immutable) |
| 308 | äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µå¯ä¿®æ”¹ ğŸ”’ |  |  [`è®¾è®¡`](/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/tag/binary-indexed-tree.md) [`çº¿æ®µæ ‘`](/tag/segment-tree.md) `2+` | ğŸ”´ | [ğŸ€„ï¸](https://leetcode.cn/problems/range-sum-query-2d-mutable) [ğŸ”—](https://leetcode.com/problems/range-sum-query-2d-mutable) |
| 3030 | æ‰¾å‡ºç½‘æ ¼çš„åŒºåŸŸå¹³å‡å¼ºåº¦ |  |  [`æ•°ç»„`](/tag/array.md) [`çŸ©é˜µ`](/tag/matrix.md) | ğŸŸ  | [ğŸ€„ï¸](https://leetcode.cn/problems/find-the-grid-of-region-average) [ğŸ”—](https://leetcode.com/problems/find-the-grid-of-region-average) |