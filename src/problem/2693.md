---
title: 2693. ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°
description: LeetCode,2693. ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°,ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°,Call Function with Custom Context,è§£é¢˜æ€è·¯
keywords:
  - LeetCode
  - 2693. ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°
  - ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°
  - Call Function with Custom Context
  - è§£é¢˜æ€è·¯
---

# 2693. ä½¿ç”¨è‡ªå®šä¹‰ä¸Šä¸‹æ–‡è°ƒç”¨å‡½æ•°

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/call-function-with-custom-context) [`LeetCode`](https://leetcode.com/problems/call-function-with-custom-context)

## é¢˜ç›®

Enhance all functions to have the `callPolyfill` method. The method accepts an
object `obj` as it's first parameter and any number of additional arguments.
The `obj` becomes the `this` context for the function. The additional
arguments are passed to the function (that the `callPolyfill` method belongs
on).

For example if you had the function:

```js
function tax(price, taxRate) {
	const totalCost = price * (1 + taxRate);
	console.log(`The cost of ${this.item} is ${totalCost}`);
}
```

Calling this function like `tax(10, 0.1)` will log `"The cost of undefined is
11"`. This is because the `this` context was not defined.

However, calling the function like `tax.callPolyfill({item: "salad"}, 10,
0.1)` will log `"The cost of salad is 11"`. The `this` context was
appropriately set, and the function logged an appropriate output.

Please solve this without using the built-in `Function.call` method.

**Example 1:**

> Input:
>
> fn = function add(b) { return this.a + b; }
>
> args = [{"a": 5}, 7]
>
> Output: 12
>
> Explanation:
>
> fn.callPolyfill({"a": 5}, 7); // 12
>
> callPolyfill sets the "this" context to {"a": 5}. 7 is passed as an argument.

**Example 2:**

> Input:
>
> fn = function tax(price, taxRate) { return `The cost of the ${this.item} is ${price * taxRate}`; }
>
> args = [{"item": "burger"}, 10, 1.1]
>
> Output: "The cost of the burger is 11"
>
> Explanation: callPolyfill sets the "this" context to {"item": "burger"}. 10 and 1.1 are passed as additional arguments.

**Constraints:**

- `typeof args[0] == 'object' and args[0] != null`
- `1 <= args.length <= 100`
- `2 <= JSON.stringify(args[0]).length <= 10^5`

## é¢˜ç›®å¤§æ„

å¢å¼ºæ‰€æœ‰å‡½æ•°ï¼Œä½¿å…¶å…·æœ‰ `callPolyfill` æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå¯¹è±¡ `obj` ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä»¥åŠä»»æ„æ•°é‡çš„é™„åŠ å‚æ•°ã€‚`obj` æˆä¸ºå‡½æ•°çš„
`this` ä¸Šä¸‹æ–‡ã€‚é™„åŠ å‚æ•°å°†ä¼ é€’ç»™è¯¥å‡½æ•°ï¼ˆå³ `callPolyfill` æ–¹æ³•æ‰€å±çš„å‡½æ•°ï¼‰ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä»¥ä¸‹å‡½æ•°ï¼š

```js
function tax(price, taxRate) {
	const totalCost = price * (1 + taxRate);
	console.log(`The cost of ${this.item} is ${totalCost}`);
}
```

è°ƒç”¨ `tax(10, 0.1)` å°†è¾“å‡º `"The cost of undefined is 11"` ã€‚è¿™æ˜¯å› ä¸º `this` ä¸Šä¸‹æ–‡æœªå®šä¹‰ã€‚

ç„¶è€Œï¼Œè°ƒç”¨ `tax.callPolyfill({item: "salad"}, 10, 0.1)` å°†è¾“å‡º `"The cost of salad is
11"` ã€‚`this` ä¸Šä¸‹æ–‡è¢«æ­£ç¡®è®¾ç½®ï¼Œå‡½æ•°è¾“å‡ºäº†é€‚å½“çš„ç»“æœã€‚

è¯·åœ¨ä¸ä½¿ç”¨å†…ç½®çš„ `Function.call` æ–¹æ³•çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

**ç¤ºä¾‹ 1ï¼š**

> **è¾“å…¥ï¼š**
>
> fn = function add(b) { return this.a + b; }
>
> args = [{"a": 5}, 7]
>
> **è¾“å‡ºï¼š** 12
>
> **è§£é‡Šï¼š**
>
> fn.callPolyfill({"a": 5}, 7); // 12
>
> callPolyfill å°† "this" ä¸Šä¸‹æ–‡è®¾ç½®ä¸º {"a": 5} ï¼Œå¹¶å°† 7 ä½œä¸ºå‚æ•°ä¼ é€’ã€‚

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š**
>
> fn = function tax(price, taxRate) { return `The cost of the ${this.item} is ${price * taxRate}`; }
>
> args = [{"item": "burger"}, 10, 1,1]
>
> **è¾“å‡ºï¼š** "The cost of the burger is 11"
>
> **è§£é‡Šï¼š**callPolyfill å°† "this" ä¸Šä¸‹æ–‡è®¾ç½®ä¸º {"item": "burger"} ï¼Œå¹¶å°† 10 å’Œ 1.1 ä½œä¸ºé™„åŠ å‚æ•°ä¼ é€’ã€‚

**æç¤ºï¼š**

- `typeof args[0] == 'object' and args[0] != null`
- `1 <= args.length <= 100`
- `2 <= JSON.stringify(args[0]).length <= 10^5`

## è§£é¢˜æ€è·¯

è¦å®ç° `callPolyfill` æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å°†è¦è°ƒç”¨çš„å‡½æ•°ä¸´æ—¶æ·»åŠ ä¸ºå¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥è°ƒç”¨å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®ç°æ€è·¯ï¼š

1. **å®šä¹‰ `callPolyfill` æ–¹æ³•**ï¼šå°†å…¶æ·»åŠ åˆ° `Function.prototype`ï¼Œä½¿æ‰€æœ‰å‡½æ•°éƒ½èƒ½è®¿é—®è¿™ä¸ªæ–¹æ³•ã€‚

   - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ `context`ï¼Œè¡¨ç¤ºå‡½æ•°è°ƒç”¨æ—¶çš„ `this` ä¸Šä¸‹æ–‡ã€‚
   - åé¢çš„å‚æ•°æ˜¯ä¼ é€’ç»™åŸå§‹å‡½æ•°çš„å‚æ•° `args`ã€‚

2. **å°†å‡½æ•°èµ‹å€¼ç»™å¯¹è±¡**ï¼š

   - åœ¨ `context` ä¸­ä¸´æ—¶åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ Symbol å±æ€§ï¼Œå› ä¸º Symbol å±æ€§åœ¨è¿­ä»£ä¸­ä¸å¯æšä¸¾ï¼›
   - å°† Symbol å±æ€§æŒ‡å‘è¦è°ƒç”¨çš„å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `this` æ¥å¼•ç”¨å½“å‰å‡½æ•°ã€‚

3. **è°ƒç”¨å‡½æ•°**ï¼šä½¿ç”¨ä¸´æ—¶åˆ›å»ºçš„æ–¹æ³•è°ƒç”¨å®ƒï¼Œä¼ å…¥é™„åŠ å‚æ•°ã€‚

4. **æ¸…ç†**ï¼šè°ƒç”¨åï¼Œä» `context` ä¸­åˆ é™¤ä¸´æ—¶å±æ€§ï¼Œç¡®ä¿ä¸ä¼šå¯¹ `context` äº§ç”Ÿå½±å“ã€‚

5. **è¿”å›ç»“æœ**ï¼šå¦‚æœå‡½æ•°æœ‰è¿”å›å€¼ï¼Œå¯ä»¥å°†å…¶è¿”å›ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œåªè¿›è¡Œäº†ä¸€æ¬¡å‡½æ•°è°ƒç”¨ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œåªä½¿ç”¨äº†å¸¸æ•°çº§çš„ç©ºé—´æ¥å­˜å‚¨ä¸´æ—¶æ–¹æ³•å’Œç»“æœã€‚

## ä»£ç 

```javascript
/**
 * @param {Object} context
 * @param {Array} args
 * @return {null|boolean|number|string|Array|Object}
 */
Function.prototype.callPolyfill = function (context, ...args) {
	// åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ Symbol å±æ€§
	const uniqueId = Symbol();
	// å°†å½“å‰å‡½æ•°ä¸´æ—¶èµ‹å€¼ä¸ºå¯¹è±¡çš„æ–¹æ³•
	context[uniqueId] = this;
	// è°ƒç”¨å‡½æ•°å¹¶ä¼ é€’å‚æ•°
	const result = context[uniqueId](...args);
	// æ¸…ç†ä¸´æ—¶å±æ€§
	delete context[uniqueId];
	return result;
};

/**
 * function increment() { this.count++; return this.count; }
 * increment.callPolyfill({count: 1}); // 2
 */
```
