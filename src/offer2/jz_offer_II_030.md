# [30. æ’å…¥ã€åˆ é™¤å’Œéšæœºè®¿é—®éƒ½æ˜¯ O(1) çš„å®¹å™¨](https://leetcode.cn/problems/FortPu)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`æ•°ç»„`](/tag/array.md) [`å“ˆå¸Œè¡¨`](/tag/hash-table.md) [`æ•°å­¦`](/tag/math.md) [`éšæœºåŒ–`](/tag/randomized.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.cn/problems/FortPu)

## é¢˜ç›®

è®¾è®¡ä¸€ä¸ªæ”¯æŒåœ¨ **å¹³å‡** æ—¶é—´å¤æ‚åº¦ `O(1)` ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œçš„æ•°æ®ç»“æ„ï¼š

- `insert(val)`ï¼šå½“å…ƒç´  `val` ä¸å­˜åœ¨æ—¶è¿”å› `true` ï¼Œå¹¶å‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¦åˆ™è¿”å› `false` ã€‚
- `remove(val)`ï¼šå½“å…ƒç´  `val` å­˜åœ¨æ—¶è¿”å› `true` ï¼Œå¹¶ä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¦åˆ™è¿”å› `false` ã€‚
- `getRandom`ï¼šéšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ **ç›¸åŒçš„æ¦‚ç‡** è¢«è¿”å›ã€‚

**ç¤ºä¾‹ :**

> **è¾“å…¥:** inputs = ["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
>
> [[], [1], [2], [2], [], [1], [2], []]
>
> **è¾“å‡º:**[null, true, false, true, 2, true, false, 2]
>
> **è§£é‡Š:** RandomizedSet randomSet = new RandomizedSet(); // åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„é›†åˆ
>
> randomSet.insert(1); // å‘é›†åˆä¸­æ’å…¥ 1 ï¼Œ è¿”å› true è¡¨ç¤º 1 è¢«æˆåŠŸåœ°æ’å…¥
>
> randomSet.remove(2); // è¿”å› falseï¼Œè¡¨ç¤ºé›†åˆä¸­ä¸å­˜åœ¨ 2
>
> randomSet.insert(2); // å‘é›†åˆä¸­æ’å…¥ 2 è¿”å› true ï¼Œé›†åˆç°åœ¨åŒ…å« [1,2]
>
> randomSet.getRandom(); // getRandom åº”éšæœºè¿”å› 1 æˆ– 2
>
> randomSet.remove(1); // ä»é›†åˆä¸­ç§»é™¤ 1 è¿”å› true ã€‚é›†åˆç°åœ¨åŒ…å« [2]
>
> randomSet.insert(2); // 2 å·²åœ¨é›†åˆä¸­ï¼Œæ‰€ä»¥è¿”å› false
>
> randomSet.getRandom(); // ç”±äº 2 æ˜¯é›†åˆä¸­å”¯ä¸€çš„æ•°å­—ï¼ŒgetRandom æ€»æ˜¯è¿”å› 2

**æç¤ºï¼š**

- `-2^31 <= val <= 2^31 - 1`
- æœ€å¤šè¿›è¡Œ` 2 * 10^5` æ¬¡ `insert` ï¼Œ `remove` å’Œ `getRandom` æ–¹æ³•è°ƒç”¨
- å½“è°ƒç”¨ `getRandom` æ–¹æ³•æ—¶ï¼Œé›†åˆä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ 

::: warning
æœ¬é¢˜ä¸ LeetCode [ç¬¬ 380 é¢˜](../problem/0380.md) ç›¸åŒã€‚
:::

## è§£é¢˜æ€è·¯

æœ¬é¢˜çš„éš¾ç‚¹åœ¨äºä¸¤ç‚¹ï¼š

1. æ’å…¥ï¼Œåˆ é™¤ï¼Œè·å–éšæœºå…ƒç´ è¿™ä¸‰ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦å¿…é¡»éƒ½æ˜¯ `O(1)`ã€‚
2. `getRandom` æ–¹æ³•è¿”å›çš„å…ƒç´ å¿…é¡»ç­‰æ¦‚ç‡è¿”å›éšæœºå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé›†åˆé‡Œé¢æœ‰ `n` ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡å¿…é¡»æ˜¯ `1/n`ã€‚

`HashSet` æ’å…¥ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾è¿™å‡ ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)` ï¼Œä½†æ˜¯ç”±äº`HashSet`å­˜å‚¨æ•°æ®æ—¶ï¼Œæ˜¯ç”±å“ˆå¸Œå‡½æ•°åˆ†æ•£åœ°å­˜åˆ°æ•´ä¸ªæ•°ç»„é‡Œé¢çš„ï¼Œé‡åˆ°å“ˆå¸Œå†²çªè¿˜ä¼šæœ‰æ‹‰é“¾æ³•ç­‰æœºåˆ¶ï¼Œæ‰€ä»¥åšä¸åˆ° `O(1)` æ—¶é—´ã€Œç­‰æ¦‚ç‡ã€éšæœºè·å–å…ƒç´ ã€‚

å¦‚æœæƒ³ã€Œç­‰æ¦‚ç‡ã€ä¸”ã€Œåœ¨ `O(1)` çš„æ—¶é—´ã€å–å‡ºå…ƒç´ ï¼Œä¸€å®šè¦æ»¡è¶³ï¼šåº•å±‚ç”¨æ•°ç»„å®ç°ï¼Œä¸”æ•°ç»„å¿…é¡»æ˜¯ç´§å‡‘çš„ã€‚å¯ä»¥ç›´æ¥ç”Ÿæˆéšæœºæ•°ä½œä¸ºç´¢å¼•ï¼Œä»æ•°ç»„ä¸­å–å‡ºè¯¥éšæœºç´¢å¼•å¯¹åº”çš„å…ƒç´ ï¼Œä½œä¸ºéšæœºå…ƒç´ ã€‚

ä½†å¦‚æœç”¨æ•°ç»„å­˜å‚¨å…ƒç´ çš„è¯ï¼Œæ’å…¥ï¼Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ€ä¹ˆåšåˆ° `O(1)` å‘¢ï¼Ÿ

ç”±äºå¯¹æ•°ç»„å°¾éƒ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ä¸ä¼šæ¶‰åŠæ•°æ®æ¬ç§»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)`ï¼Œæ‰€ä»¥ï¼š

- æ’å…¥æ•°æ®æ—¶ç›´æ¥æ’å…¥åˆ°æ•°ç»„å°¾ç«¯å³å¯ï¼›
- åˆ é™¤æ•°ç»„ä¸­çš„æŸä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå…ˆæŠŠè¿™ä¸ªå…ƒç´ äº¤æ¢åˆ°æ•°ç»„çš„å°¾éƒ¨ï¼Œç„¶åå† `pop` æ‰ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ æ—¶é€šè¿‡ç´¢å¼•è¿›è¡Œäº¤æ¢ï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `indexMap` æ¥è®°å½•æ¯ä¸ªå…ƒç´ å€¼å¯¹åº”çš„ç´¢å¼•ã€‚

## ä»£ç 

```javascript
class RandomizedSet {
	constructor() {
		this.nums = [];
		this.map = new Map();
	}

	// @param {number} val
	// @return {boolean}
	insert(val) {
		if (this.map.has(val)) return false;
		this.nums.push(val);
		this.map.set(val, this.nums.length - 1);
		return true;
	}

	// @param {number} val
	// @return {boolean}
	remove(val) {
		if (!this.map.has(val)) return false;
		const index = this.map.get(val);
		const last_val = this.nums[this.nums.length - 1];
		this.nums[index] = last_val;
		this.nums.pop();
		this.map.set(last_val, index);
		this.map.delete(val);
		return true;
	}

	// @return {number}
	getRandom() {
		return this.nums[Math.floor(Math.random() * this.nums.length)];
	}
}
```
