# [41. æ»‘åŠ¨çª—å£çš„å¹³å‡å€¼](https://2xiao.github.io/leetcode-js/offer2/jz_offer_II_041.html)

ğŸŸ¢ <font color=#15bd66>Easy</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/tag/design.md) [`é˜Ÿåˆ—`](/tag/queue.md) [`æ•°ç»„`](/tag/array.md) [`æ•°æ®æµ`](/tag/data-stream.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/qIsx9U)

## é¢˜ç›®

ç»™å®šä¸€ä¸ªçª—å£å¤§å°å’Œä¸€ä¸ªæ•´æ•°æ•°æ®æµï¼Œæ ¹æ®è¯¥æ»‘åŠ¨çª—å£çš„å¤§å°ï¼Œè®¡ç®—æ»‘åŠ¨çª—å£é‡Œæ‰€æœ‰æ•°å­—çš„å¹³å‡å€¼ã€‚

å®ç° `MovingAverage` ç±»ï¼š

- `MovingAverage(int size)` ç”¨çª—å£å¤§å° `size` åˆå§‹åŒ–å¯¹è±¡ã€‚
- `double next(int val)` æˆå‘˜å‡½æ•° `next` æ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½ä¼šå¾€æ»‘åŠ¨çª—å£å¢åŠ ä¸€ä¸ªæ•´æ•°ï¼Œè¯·è®¡ç®—å¹¶è¿”å›æ•°æ®æµä¸­æœ€å `size` ä¸ªå€¼çš„ç§»åŠ¨å¹³å‡å€¼ï¼Œå³æ»‘åŠ¨çª—å£é‡Œæ‰€æœ‰æ•°å­—çš„å¹³å‡å€¼ã€‚

**ç¤ºä¾‹ï¼š**

> **è¾“å…¥ï¼š**
>
> inputs = ["MovingAverage", "next", "next", "next", "next"]
>
> inputs = [[3], [1], [10], [3], [5]]
>
> **è¾“å‡ºï¼š**
>
> [null, 1.0, 5.5, 4.66667, 6.0]
>
> **è§£é‡Šï¼š**
>
> MovingAverage movingAverage = new MovingAverage(3);
>
> movingAverage.next(1); // è¿”å› 1.0 = 1 / 1
>
> movingAverage.next(10); // è¿”å› 5.5 = (1 + 10) / 2
>
> movingAverage.next(3); // è¿”å› 4.66667 = (1 + 10 + 3) / 3
>
> movingAverage.next(5); // è¿”å› 6.0 = (10 + 3 + 5) / 3

**æç¤ºï¼š**

- `1 <= size <= 1000`
- `-10^5 <= val <= 10^5`
- æœ€å¤šè°ƒç”¨ `next` æ–¹æ³• `10^4` æ¬¡

::: warning
æœ¬é¢˜ä¸ LeetCode [ç¬¬ 346 é¢˜](../problem/0346.md) ç›¸åŒã€‚
:::

## è§£é¢˜æ€è·¯

è¿™é“é¢˜å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—æ¥åšï¼Œç”¨ä¸€ä¸ªé˜Ÿåˆ—è®°å½•æ•°å­—ï¼Œç”¨ä¸€ä¸ªå˜é‡è®°å½•çª—å£å’Œï¼Œæ¯æ¬¡æ›´æ–°çª—å£å’Œã€‚

1. **ä½¿ç”¨é˜Ÿåˆ—**ï¼š

   - ä¸ºäº†ç»´æŠ¤çª—å£å†…çš„æ•°å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆæ•°ç»„ï¼‰æ¥å­˜å‚¨æœ€æ–°çš„ `size` ä¸ªæ•°å€¼ã€‚
   - æ¯æ¬¡è°ƒç”¨ `next(val)` æ–¹æ³•æ—¶ï¼Œå°†æ–°çš„æ•°å€¼æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚å¦‚æœé˜Ÿåˆ—çš„é•¿åº¦è¶…è¿‡æŒ‡å®šçš„ `size`ï¼Œåˆ™ç§»é™¤é˜Ÿåˆ—ä¸­æœ€æ—§çš„æ•°å€¼ï¼Œä»¥ä¿æŒé˜Ÿåˆ—çš„é•¿åº¦ä¸è¶…è¿‡ `size`ã€‚

2. **ç»´æŠ¤æ€»å’Œ**ï¼š

   - ä¸ºäº†å¿«é€Ÿè®¡ç®—å¹³å‡å€¼ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ª `sum` å˜é‡ï¼Œè®°å½•å½“å‰çª—å£å†…æ‰€æœ‰æ•°å€¼çš„å’Œã€‚
   - å½“æ·»åŠ æ–°çš„æ•°å€¼æ—¶ï¼Œæ›´æ–° `sum`ï¼š
     - å¦‚æœé˜Ÿåˆ—æœªæ»¡ï¼Œå°†æ–°æ•°å€¼ç›´æ¥æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶å€¼åŠ åˆ° `sum`ã€‚
     - å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œé¦–å…ˆä» `sum` ä¸­å‡å»é˜Ÿåˆ—ä¸­æœ€æ—§çš„æ•°å€¼ï¼ˆå³ `shift` æ“ä½œï¼‰ï¼Œç„¶åå†å°†æ–°æ•°å€¼æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶å€¼åŠ åˆ° `sum`ã€‚

3. **è®¡ç®—å¹³å‡å€¼**ï¼š
   - è¿”å›å½“å‰ `sum` é™¤ä»¥é˜Ÿåˆ—çš„é•¿åº¦ï¼Œå³ä¸ºå½“å‰çª—å£çš„å¹³å‡å€¼ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯ `queue` æ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚

  - å½“é˜Ÿåˆ—æœªæ»¡æ—¶ï¼Œåªéœ€æ‰§è¡Œ `push` æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º `O(1)`ã€‚
  - å½“é˜Ÿåˆ—å·²æ»¡æ—¶ï¼Œéœ€å…ˆæ‰§è¡Œ `shift`ï¼ˆåˆ é™¤é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å’Œ `push`ï¼ˆæ·»åŠ æ–°å…ƒç´ ï¼‰ï¼Œå…¶ä¸­ `shift` æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ï¼ˆå› ä¸ºéœ€è¦ç§»åŠ¨æ•°ç»„ä¸­çš„å…ƒç´ ï¼‰ã€‚å› æ­¤ï¼Œåœ¨æœ€åæƒ…å†µä¸‹ï¼Œ`next` æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚
  - å› æ­¤ï¼Œæ•´ä½“çš„æ—¶é—´å¤æ‚åº¦ä¸º `O(n)`ã€‚

- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œ`queue` æ•°ç»„æœ€å¤§éœ€è¦ `O(n)` çš„ç©ºé—´ã€‚

## ä»£ç 

```javascript
class MovingAverage {
	constructor(size) {
		this.size = size;
		this.queue = [];
		this.sum = 0;
	}
	next(val) {
		if (this.queue.length < this.size) {
			this.queue.push(val);
			this.sum += val;
		} else {
			this.sum -= this.queue.shift();
			this.queue.push(val);
		}
		return this.sum / this.queue.length;
	}
}
```
