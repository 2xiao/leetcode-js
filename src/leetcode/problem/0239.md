# [239. Sliding Window Maximum](https://leetcode.com/problems/sliding-window-maximum/)

ðŸ”´ <font color=#ff334b>Hard</font>&emsp; ðŸ”–&ensp; [`é˜Ÿåˆ—`](/leetcode/outline/tag/queue.md) [`æ•°ç»„`](/leetcode/outline/tag/array.md) [`æ»‘åŠ¨çª—å£`](/leetcode/outline/tag/sliding-window.md) [`å•è°ƒé˜Ÿåˆ—`](/leetcode/outline/tag/monotonic-queue.md) [`å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰`](/leetcode/outline/tag/heap-priority-queue.md)&emsp; ðŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/sliding-window-maximum/)

## é¢˜ç›®

You are given an array of integers `nums`, there is a sliding window of size
`k` which is moving from the very left of the array to the very right. You can
only see the `k` numbers in the window. Each time the sliding window moves
right by one position.

Return _the max sliding window_.

**Example 1:**

> Input: nums = [1,3,-1,-3,5,3,6,7], k = 3
>
> Output: [3,3,5,5,6,7]
>
> Explanation:
>
> ```
> Window position                Max
> ---------------               -----
> [1 3  -1] -3   5  3  6  7       3
> 1 [3  -1  -3]  5  3  6  7       3
> 1  3 [-1  -3   5] 3  6  7       5
> 1  3  -1 [-3   5  3] 6  7       5
> 1  3  -1  -3  [5  3  6] 7       6
> 1  3  -1  -3   5 [3  6  7]      7
> ```

**Example 2:**

> Input: nums = [1], k = 1
>
> Output: [1]

**Constraints:**

- `1 <= nums.length <= 10^5`
- `-10^4 <= nums[i] <= 10^4`
- `1 <= k <= nums.length`

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œæœ‰ä¸€ä¸ªå¤§å°ä¸º `k` çš„æ»‘åŠ¨çª—å£ä»Žæ•°ç»„çš„æœ€å·¦ä¾§ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€å³ä¾§ã€‚ä½ åªå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨çª—å£å†…çš„ `k` ä¸ªæ•°å­—ã€‚æ»‘åŠ¨çª—å£æ¯æ¬¡åªå‘å³ç§»åŠ¨ä¸€ä½ã€‚

è¿”å›ž **æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼** ã€‚

## è§£é¢˜æ€è·¯

### æ€è·¯ä¸€ï¼šåŒç«¯é˜Ÿåˆ—

åŒç«¯é˜Ÿåˆ—ï¼ˆDequeï¼Œå…¨ç§° Double Ended Queueï¼‰æ˜¯ä¸€ç§å¯ä»¥åœ¨ä¸¤ç«¯è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ•°æ®ç»“æž„ã€‚ç›¸æ¯”äºŽæ™®é€šçš„é˜Ÿåˆ—ï¼ˆåªèƒ½åœ¨ä¸€ç«¯æ’å…¥ï¼Œåœ¨å¦ä¸€ç«¯åˆ é™¤ï¼‰ï¼ŒåŒç«¯é˜Ÿåˆ—æ›´åŠ çµæ´»ï¼Œé€‚ç”¨äºŽä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ã€‚åœ¨ JavaScript ä¸­ï¼ŒåŒç«¯é˜Ÿåˆ—å¯ä»¥ä½¿ç”¨æ•°ç»„æ¥æ¨¡æ‹Ÿã€‚

1. éåŽ†æ•°ç»„ï¼šæ¯æ¬¡ç§»åŠ¨æ»‘åŠ¨çª—å£æ—¶ï¼Œå¯¹åŒç«¯é˜Ÿåˆ—è¿›è¡Œæ›´æ–°ï¼š

- å¦‚æžœé˜Ÿåˆ—å¤´éƒ¨çš„å…ƒç´ å·²ç»ä¸åœ¨å½“å‰çª—å£ä¸­ï¼ˆå³ç´¢å¼•å°äºŽ `i - k + 1`ï¼‰ï¼Œå°†å…¶ç§»é™¤ã€‚
- åœ¨é˜Ÿåˆ—å°¾éƒ¨ï¼Œç§»é™¤æ‰€æœ‰å°äºŽå½“å‰å…ƒç´ çš„å€¼ï¼Œå› ä¸ºå®ƒä»¬ä¸å¯èƒ½æˆä¸ºå½“å‰æˆ–ä¹‹åŽçª—å£çš„æœ€å¤§å€¼ã€‚
- å°†å½“å‰å…ƒç´ çš„ç´¢å¼•åŠ å…¥é˜Ÿåˆ—ã€‚

2. èŽ·å–æœ€å¤§å€¼ï¼šå¯¹äºŽæ¯ä¸€ä¸ªçª—å£ï¼Œé˜Ÿåˆ—çš„å‰ç«¯å§‹ç»ˆä¿å­˜å½“å‰çª—å£çš„æœ€å¤§å€¼çš„ç´¢å¼•ã€‚

æ³¨æ„ï¼š

- å­˜å‚¨æ•°ç»„å…ƒç´ çš„ç´¢å¼•ï¼šä¸ä¼šç›´æŽ¥å­˜å‚¨æ•°ç»„çš„å€¼ï¼Œè€Œæ˜¯å­˜å‚¨å…ƒç´ çš„ç´¢å¼•ï¼Œä»¥ä¾¿é€šè¿‡ç´¢å¼•è®¿é—®å…·ä½“çš„å€¼ï¼Œå¹¶é€šè¿‡ç´¢å¼•åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦è¿˜åœ¨å½“å‰æ»‘åŠ¨çª—å£ä¸­ã€‚
- ä¿æŒé˜Ÿåˆ—ä¸­çš„å…ƒç´ å•è°ƒé€’å‡ï¼šä¸ºäº†ä¿è¯é˜Ÿåˆ—çš„å‰ç«¯å§‹ç»ˆæ˜¯çª—å£çš„æœ€å¤§å€¼ï¼Œä¼šä»Žé˜Ÿåˆ—çš„åŽç«¯ç§»é™¤æ‰€æœ‰å°äºŽå½“å‰å…ƒç´ çš„ç´¢å¼•ã€‚

#### å¤æ‚åº¦åˆ†æž

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œå…¶ä¸­ `n` æ˜¯æ•°ç»„çš„é•¿åº¦ã€‚æ¯ä¸ªå…ƒç´ è¢«åŠ å…¥å’Œç§»é™¤é˜Ÿåˆ—è‡³å¤šå„ä¸€æ¬¡ï¼Œå› æ­¤æ€»çš„æ“ä½œæ¬¡æ•°ä¸º `O(n)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(k)`ï¼Œé˜Ÿåˆ—çš„å¤§å°åœ¨æœ€åæƒ…å†µä¸‹ä¸º `k`ã€‚

---

### æ€è·¯äºŒï¼šå †

å¤§é¡¶å †æ€§è´¨ï¼šå †æ˜¯ä¸€æ£µäºŒå‰æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ»¡è¶³ï¼šçˆ¶èŠ‚ç‚¹çš„å€¼å¤§äºŽå·¦å³å­èŠ‚ç‚¹çš„å€¼ï¼Œå †é¡¶å…ƒç´ æ˜¯å½“å‰å †ä¸­çš„æœ€å¤§å€¼ã€‚

ä½¿ç”¨å¤§é¡¶å †æ¥ä¿å­˜æ»‘åŠ¨çª—å£ä¸­çš„ `k` ä¸ªæ•°ï¼Œæ¯æ¬¡çª—å£ç§»åŠ¨æ—¶ï¼Œç§»é™¤å †ä¸­ä¸åœ¨å½“å‰çª—å£çš„å…ƒç´ ï¼Œå¹¶å°†æ–°å…ƒç´ å…¥å †ï¼Œå †é¡¶å…ƒç´ å°±æ˜¯æ»‘åŠ¨çª—å£ä¸­çš„æœ€å¤§å€¼ã€‚

#### å¤æ‚åº¦åˆ†æž

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n Ã— (k + log k))`ï¼Œè¿™åœ¨æœ€åæƒ…å†µä¸‹æ¯”ä½¿ç”¨åŒç«¯é˜Ÿåˆ—çš„ `O(n)` æ—¶é—´å¤æ‚åº¦è¦é«˜ï¼Œå°¤å…¶å½“ `k` æŽ¥è¿‘ `n` æ—¶ï¼Œå¤æ‚åº¦å˜ä¸º `O(n Ã— k)`ã€‚

  - æ’å…¥æ“ä½œéœ€è¦ `O(log k)`ã€‚
  - åˆ é™¤æ“ä½œçš„å¤æ‚åº¦ä¸º `O(k)`ï¼Œå› ä¸ºéœ€è¦éåŽ†å †æŸ¥æ‰¾éœ€è¦ç§»é™¤çš„å…ƒç´ ï¼Œç„¶åŽå†æ‰§è¡Œ `O(log k)` çš„è°ƒæ•´æ“ä½œã€‚
  - å¯¹äºŽæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæ»‘åŠ¨çª—å£ç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€æ¬¡ **æ’å…¥** å’Œä¸€æ¬¡ **åˆ é™¤** æ“ä½œï¼Œæ•°ç»„é•¿åº¦ä¸º `n`ï¼Œå› æ­¤ï¼Œæœ€åæƒ…å†µä¸‹æ€»æ—¶é—´å¤æ‚åº¦ä¸º `O(n * (k + log k))`ã€‚

- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(k)`ï¼Œå †ä¸­çš„æœ€å¤§å…ƒç´ ä¸ªæ•°ä¸º `k`ã€‚

## ä»£ç 

:::: code-tabs

@tab åŒç«¯é˜Ÿåˆ—

```javascript
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number[]}
 */
var maxSlidingWindow = function (nums, k) {
	let deque = [],
		res = [];
	for (let i = 0; i < nums.length; i++) {
		if (deque.length && deque[0] < i - k + 1) {
			deque.shift();
		}
		while (deque.length && nums[deque[deque.length - 1]] < nums[i]) {
			deque.pop();
		}
		deque.push(i);
		if (i >= k - 1) {
			res.push(nums[deque[0]]);
		}
	}
	return res;
};
```

@tab å †

```javascript
/**
 * @param {number[]} nums
 * @param {number} k
 * @return {number[]}
 */
var maxSlidingWindow = function (nums, k) {
	let maxHeap = new MaxHeap(),
		res = [];
	for (let i = 0; i < k; i++) {
		maxHeap.insert(nums[i]);
	}
	res.push(maxHeap.heap[0]);
	for (let i = 0; i < nums.length - k; i++) {
		maxHeap.remove(nums[i]);
		maxHeap.insert(nums[i + k]);
		res.push(maxHeap.heap[0]);
	}
	return res;
};

class MaxHeap {
	constructor() {
		this.heap = [];
	}
	insert(value) {
		this.heap.push(value);
		this.heapifyUp(this.heap.length - 1);
		this.heapifyDown(0);
	}
	remove(value) {
		const index = this.heap.indexOf(value);
		if (index !== this.heap.length - 1) {
			this.heap[index] = this.heap.pop();
			this.heapifyDown(index);
		} else {
			this.heap.pop();
		}
	}
	heapifyUp(i) {
		while (i) {
			const parent = ((i - 1) / 2) | 0;
			if (this.heap[parent] < this.heap[i]) {
				[this.heap[parent], this.heap[i]] = [this.heap[i], this.heap[parent]];
				i = parent;
			} else {
				break;
			}
		}
	}
	heapifyDown(i) {
		let left = i * 2 + 1,
			right = i * 2 + 2,
			min = i;
		if (this.heap[min] < this.heap[left]) {
			min = left;
		}
		if (this.heap[min] < this.heap[right]) {
			min = right;
		}
		if (min !== i) {
			[this.heap[min], this.heap[i]] = [this.heap[i], this.heap[min]];
			this.heapifyDown(min);
		}
	}
}
```

::::

## ç›¸å…³é¢˜ç›®

:::: md-demo ç›¸å…³é¢˜ç›®

- [76. æœ€å°è¦†ç›–å­ä¸²](./0076.md)
- [155. æœ€å°æ ˆ](./0155.md)
- [ðŸ”’ Longest Substring with At Most Two Distinct Characters](https://leetcode.com/problems/longest-substring-with-at-most-two-distinct-characters)
- [ðŸ”’ Paint House II](https://leetcode.com/problems/paint-house-ii)
- [1696. è·³è·ƒæ¸¸æˆ VI](https://leetcode.com/problems/jump-game-vi)
- [2398. é¢„ç®—å†…çš„æœ€å¤šæœºå™¨äººæ•°ç›®](https://leetcode.com/problems/maximum-number-of-robots-within-budget)
- [2517. ç¤¼ç›’çš„æœ€å¤§ç”œèœœåº¦](https://leetcode.com/problems/maximum-tastiness-of-candy-basket)
- [2530. æ‰§è¡Œ K æ¬¡æ“ä½œåŽçš„æœ€å¤§åˆ†æ•°](https://leetcode.com/problems/maximal-score-after-applying-k-operations)

::::
