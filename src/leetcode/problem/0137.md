# [137. Single Number II](https://leetcode.com/problems/single-number-ii/)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`ä½è¿ç®—`](/leetcode/outline/tag/bit-manipulation.md) [`æ•°ç»„`](/leetcode/outline/tag/array.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/single-number-ii/)

## é¢˜ç›®

Given an integer array `nums` where every element appears **three times**
except for one, which appears **exactly once**. _Find the single element and
return it_.

You must implement a solution with a linear runtime complexity and use only
constant extra space.

**Example 1:**

> Input: nums = [2,2,3,2]
>
> Output: 3

**Example 2:**

> Input: nums = [0,1,0,1,0,1,99]
>
> Output: 99

**Constraints:**

- `1 <= nums.length <= 3 * 10^4`
- `-2^31 <= nums[i] <= 2^31 - 1`
- Each element in `nums` appears exactly **three times** except for one element which appears **once**.

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` ï¼Œé™¤æŸä¸ªå…ƒç´ ä»…å‡ºç° **ä¸€æ¬¡** å¤–ï¼Œå…¶ä½™æ¯ä¸ªå…ƒç´ éƒ½æ°å‡ºç° **ä¸‰æ¬¡** ã€‚è¯·ä½ æ‰¾å‡ºå¹¶è¿”å›é‚£ä¸ªåªå‡ºç°äº†ä¸€æ¬¡çš„å…ƒç´ ã€‚

ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„ç®—æ³•ä¸”ä½¿ç”¨å¸¸æ•°çº§ç©ºé—´æ¥è§£å†³æ­¤é—®é¢˜ã€‚

## è§£é¢˜æ€è·¯

1. ä½¿ç”¨ä¸¤ä¸ªå˜é‡ `ones` å’Œ `twos` æ¥åˆ†åˆ«è®°å½•å½“å‰ä½ä¸­å‡ºç° 1 æ¬¡å’Œ 2 æ¬¡çš„æ•°å­—ï¼Œåˆå§‹åŒ–ä¸º `0`ï¼›
2. éå†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—ï¼Œæ›´æ–° `ones` å’Œ `twos` çš„çŠ¶æ€ï¼›
3. ä½¿ç”¨ä½è¿ç®—æ›´æ–° `twos`ï¼Œåªåœ¨ `ones` ä¸­å­˜åœ¨çš„æ•°å­—ä¸­å¢åŠ è®¡æ•°ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢å°†å·²ç»å‡ºç° 3 æ¬¡çš„æ•°å­—å†æ¬¡è®¡å…¥ï¼›

- `twos |= ones & num`: å°† `twos` ä¸­çš„ä½æ›´æ–°ä¸ºé‚£äº›åŒæ—¶åœ¨ `ones` å’Œ `num` ä¸­ä¸º `1` çš„ä½ï¼›
- `ones & num`: è¿™éƒ¨åˆ†è®¡ç®—åœ¨ `ones` å’Œ `num` ä¸­éƒ½ä¸º `1` çš„ä½ï¼Œç»“æœæ˜¯ä¸€ä¸ªæ–°çš„æ•´æ•°ï¼›
- `twos |=`: è¿™éƒ¨åˆ†æ˜¯å°†è®¡ç®—å¾—åˆ°çš„ç»“æœä¸ `twos` è¿›è¡ŒæŒ‰ä½æˆ–ï¼ˆORï¼‰æ“ä½œï¼Œæ›´æ–° `twos` çš„å€¼ï¼›

4. ä½¿ç”¨å¼‚æˆ–è¿ç®—æ›´æ–° `ones`ï¼Œæ·»åŠ å½“å‰æ•°å­—ï¼›

- `ones ^= num`: ä»»ä½•ä¸€ä¸ªæ•°å­—å¼‚æˆ–å®ƒè‡ªå·±éƒ½ç­‰äº `0` (`x ^ x = 0`)ï¼Œå‡ºç°ä¸¤æ¬¡çš„æ•°å­—åœ¨å¼‚æˆ–ä¸­ä¼šè¢«æŠµæ¶ˆæ‰ï¼›

5. `threes` å˜é‡é€šè¿‡ `ones & twos` è®¡ç®—å¾—å‡ºï¼Œè¡¨ç¤ºå“ªäº›æ•°å­—å‡ºç°äº† 3 æ¬¡ï¼›

6. ä½¿ç”¨ä½æ¸…é™¤æ“ä½œå°†è¿™äº›æ•°å­—ä» `ones` å’Œ `twos` ä¸­ç§»é™¤ï¼Œ`ones &= ~threes`ï¼›

- `~threes`: è¿™æ˜¯ `threes` çš„æŒ‰ä½å–åï¼ˆbitwise NOTï¼‰ï¼Œå°†æ‰€æœ‰çš„äºŒè¿›åˆ¶ä½åè½¬ã€‚å³ï¼Œå¦‚æœ `threes` ä¸­æŸä¸ªä½ç½®æ˜¯ `1`ï¼Œé‚£ä¹ˆ `~threes` ä¸­è¯¥ä½ç½®å°±æ˜¯ `0`ï¼Œåä¹‹äº¦ç„¶ã€‚
- `ones` ä¸­çš„æ¯ä¸€ä½å’Œ `~threes` ä¸­çš„æ¯ä¸€ä½è¿›è¡ŒæŒ‰ä½ä¸ï¼ˆANDï¼‰æ“ä½œã€‚
- å¦‚æœ `threes` ä¸­çš„æŸä¸€ä½æ˜¯ `1`ï¼Œé‚£ä¹ˆ `~threes` ä¸­çš„å¯¹åº”ä½æ˜¯ `0`ï¼Œå› æ­¤ `ones` çš„è¯¥ä½å°†è¢«ç½®ä¸º `0`ã€‚
- å¦‚æœ `threes` ä¸­çš„æŸä¸€ä½æ˜¯ `0`ï¼Œé‚£ä¹ˆ `~threes` ä¸­çš„å¯¹åº”ä½æ˜¯ `1`ï¼Œå› æ­¤ `ones` çš„è¯¥ä½ä¿æŒä¸å˜ã€‚

7. åœ¨éå†å®Œæˆåï¼Œ`ones` ä¸­çš„å€¼å°±æ˜¯åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—ã€‚

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œåªéœ€éå†æ•°ç»„ä¸€æ¬¡ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(1)`ï¼Œåªä½¿ç”¨äº†å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ã€‚

## ä»£ç 

```javascript
/**
 * @param {number[]} nums
 * @return {number}
 */
var singleNumber = function (nums) {
	let ones = 0,
		twos = 0;

	for (let num of nums) {
		// æ›´æ–° twosï¼šåªè®°å½•åœ¨ ones ä¸­å·²ç»å‡ºç°è¿‡çš„æ•°å­—
		twos |= ones & num;

		// æ›´æ–° onesï¼šå°†å½“å‰æ•°å­—åŠ å…¥ ones
		ones ^= num;

		// å°†å‡ºç° 3 æ¬¡çš„æ•°å­—ä» ones å’Œ twos ä¸­ç§»é™¤
		const threes = ones & twos;
		ones &= ~threes;
		twos &= ~threes;
	}

	return ones; // ç»“æœåœ¨ ones ä¸­
};
```

## ç›¸å…³é¢˜ç›®

:::: md-demo ç›¸å…³é¢˜ç›®

- [136. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­—](./0136.md)
- [260. åªå‡ºç°ä¸€æ¬¡çš„æ•°å­— III](https://leetcode.com/problems/single-number-iii)

::::
