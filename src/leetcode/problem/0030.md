# [30. ä¸²è”æ‰€æœ‰å•è¯çš„å­ä¸²](https://leetcode.com/problems/substring-with-concatenation-of-all-words)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`å“ˆå¸Œè¡¨`](/leetcode/outline/tag/hash-table.md) [`å­—ç¬¦ä¸²`](/leetcode/outline/tag/string.md) [`æ»‘åŠ¨çª—å£`](/leetcode/outline/tag/sliding-window.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/substring-with-concatenation-of-all-words/)

## é¢˜ç›®

You are given a string `s` and an array of strings `words`. All the strings of
`words` are of **the same length**.

A **concatenated substring** in `s` is a substring that contains all the
strings of any permutation of `words` concatenated.

- For example, if `words = ["ab","cd","ef"]`, then `"abcdef"`, `"abefcd"`, `"cdabef"`, `"cdefab"`, `"efabcd"`, and `"efcdab"` are all concatenated strings. `"acdbef"` is not a concatenated substring because it is not the concatenation of any permutation of `words`.

Return _the starting indices of all the concatenated substrings in_`s`. You
can return the answer in **any order**.

**Example 1:**

> Input: s = "barfoothefoobarman", words = ["foo","bar"]
>
> Output: [0,9]
>
> Explanation: Since words.length == 2 and words[i].length == 3, the concatenated substring has to be of length 6.
>
> The substring starting at 0 is "barfoo". It is the concatenation of ["bar","foo"] which is a permutation of words.
>
> The substring starting at 9 is "foobar". It is the concatenation of ["foo","bar"] which is a permutation of words.
>
> The output order does not matter. Returning [9,0] is fine too.

**Example 2:**

> Input: s = "wordgoodgoodgoodbestword", words = ["word","good","best","word"]
>
> Output: []
>
> Explanation: Since words.length == 4 and words[i].length == 4, the concatenated substring has to be of length 16.
>
> There is no substring of length 16 in s that is equal to the concatenation of any permutation of words.
>
> We return an empty array.

**Example 3:**

> Input: s = "barfoofoobarthefoobarman", words = ["bar","foo","the"]
>
> Output: [6,9,12]
>
> Explanation: Since words.length == 3 and words[i].length == 3, the concatenated substring has to be of length 9.
>
> The substring starting at 6 is "foobarthe". It is the concatenation of ["foo","bar","the"] which is a permutation of words.
>
> The substring starting at 9 is "barthefoo". It is the concatenation of ["bar","the","foo"] which is a permutation of words.
>
> The substring starting at 12 is "thefoobar". It is the concatenation of ["the","foo","bar"] which is a permutation of words.

**Constraints:**

- `1 <= s.length <= 10^4`
- `1 <= words.length <= 5000`
- `1 <= words[i].length <= 30`
- `s` and `words[i]` consist of lowercase English letters.

## é¢˜ç›®å¤§æ„

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² `s` å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ `words`ã€‚ `words` ä¸­æ‰€æœ‰å­—ç¬¦ä¸² é•¿åº¦ç›¸åŒã€‚

- s ä¸­çš„ **ä¸²è”å­ä¸²** æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« `words` ä¸­æ‰€æœ‰å­—ç¬¦ä¸²ä»¥ä»»æ„é¡ºåºæ’åˆ—è¿æ¥èµ·æ¥çš„å­ä¸²ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœ `words = ["ab","cd","ef"]`ï¼Œ é‚£ä¹ˆ `"abcdef"`ï¼Œ `"abefcd"`ï¼Œ`"cdabef"`ï¼Œ `"cdefab"`ï¼Œ`"efabcd"`ï¼Œ å’Œ `"efcdab"` éƒ½æ˜¯ä¸²è”å­ä¸²ã€‚ `"acdbef"` ä¸æ˜¯ä¸²è”å­ä¸²ï¼Œå› ä¸ºä»–ä¸æ˜¯ä»»ä½• `words` æ’åˆ—çš„è¿æ¥ã€‚
è¿”å›æ‰€æœ‰ä¸²è”å­ä¸²åœ¨ `s` ä¸­çš„å¼€å§‹ç´¢å¼•ã€‚ä½ å¯ä»¥ä»¥ **ä»»æ„é¡ºåº** è¿”å›ç­”æ¡ˆã€‚

## è§£é¢˜æ€è·¯

æ­¤é¢˜æ˜¯ [ç¬¬ 438 é¢˜ æ‰¾åˆ°å­—ç¬¦ä¸²ä¸­æ‰€æœ‰å­—æ¯å¼‚ä½è¯](./0438.md) çš„è¿›é˜¶ç‰ˆã€‚ä¸åŒçš„æ˜¯ç¬¬ 438 é¢˜çš„å…ƒç´ æ˜¯å­—æ¯ï¼Œè€Œæ­¤é¢˜çš„å…ƒç´ æ˜¯å•è¯ï¼Œå¯ä»¥ç”¨ç±»ä¼¼çš„æ»‘åŠ¨çª—å£æ–¹æ³•æ¥è§£æ­¤é¢˜ã€‚

1. ä½¿ç”¨åŒæŒ‡é’ˆä¸­çš„å·¦å³æŒ‡é’ˆï¼Œåˆå§‹åŒ– `left = right = 0`ï¼ŒæŠŠç´¢å¼•å·¦é—­å³å¼€åŒºé—´ `[left, right)` ç§°ä¸ºä¸€ä¸ªã€Œçª—å£ã€ï¼›
2. ä¸æ–­åœ°å¢åŠ  `right` æŒ‡é’ˆæ‰©å¤§çª—å£ `[left, right)`ï¼Œç›´åˆ°çª—å£ä¸­çš„å­—ç¬¦ä¸²ç¬¦åˆè¦æ±‚ï¼ˆåŒ…å«äº† `words.length * words[0].length` ä¸ªå­—ç¬¦ï¼‰ï¼›
3. åœæ­¢å¢åŠ  `right`ï¼Œè½¬è€Œä¸æ–­å¢åŠ  `left` æŒ‡é’ˆç¼©å°çª—å£ `[left, right)`ï¼Œç›´åˆ°çª—å£ä¸­çš„å­—ç¬¦ä¸²ä¸å†ç¬¦åˆè¦æ±‚ï¼›
4. æ¯æ¬¡çª—å£ä¸­çš„å­—ç¬¦ä¸²é•¿åº¦ç¬¦åˆè¦æ±‚æ—¶ï¼Œéƒ½è¦é€šè¿‡`isConcatenatedString`å‡½æ•°ï¼Œåˆ¤æ–­çª—å£ä¸­çš„å­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆé¢˜ç›®è¦æ±‚ï¼Œå¹¶æ›´æ–°ä¸€è½®ç»“æœï¼›
5. é‡å¤ç¬¬ 2 å’Œç¬¬ 3 æ­¥ï¼Œç›´åˆ° `right` åˆ°è¾¾å­—ç¬¦ä¸² `s2` çš„å°½å¤´ï¼›

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(lÃ—n)`ï¼Œå…¶ä¸­ `l` æ˜¯è¾“å…¥ `s` çš„é•¿åº¦ï¼Œ`n` æ˜¯ `words` ä¸­æ¯ä¸ªå•è¯çš„é•¿åº¦ã€‚éœ€è¦åš `n` æ¬¡æ»‘åŠ¨çª—å£ï¼Œæ¯æ¬¡éœ€è¦éå†ä¸€æ¬¡ `s`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(mÃ—n)`ï¼Œå…¶ä¸­ `m` æ˜¯ `words` çš„å•è¯æ•°ï¼Œ`n` æ˜¯ `words` ä¸­æ¯ä¸ªå•è¯çš„é•¿åº¦ã€‚æ¯æ¬¡æ»‘åŠ¨çª—å£æ—¶ï¼Œéœ€è¦ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¿å­˜å•è¯é¢‘æ¬¡ã€‚

## ä»£ç 

```javascript
/**
 * @param {string} s
 * @param {string[]} words
 * @return {number[]}
 */
var findSubstring = function (s, words) {
	let window = '',
		need = {};
	for (let i of words) {
		need[i] = (need[i] || 0) + 1;
	}

	const len = words.length * words[0].length;

	let left = 0,
		right = 0,
		// è®°å½•ç»“æœ
		res = [];

	while (right < s.length) {
		// è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–°
		window += s[right];
		right++;

		// åˆ¤æ–­å·¦ä¾§çª—å£æ˜¯å¦è¦æ”¶ç¼©
		while (window.length > len) {
			left++;
			// è¿›è¡Œçª—å£å†…æ•°æ®çš„ä¸€ç³»åˆ—æ›´æ–°
			window = window.substring(1, window.length);
		}

		// å½“çª—å£ç¬¦åˆæ¡ä»¶æ—¶ï¼ŒæŠŠèµ·å§‹ç´¢å¼•åŠ å…¥ res
		if (isConcatenatedString(window, words, need)) {
			res.push(left);
		}
	}
	return res;
};

// åˆ¤æ–­ str æ˜¯å¦ä¸º words çš„ä¸²è”å­ä¸²
var isConcatenatedString = function (str, words, need) {
	let obj = {},
		valid = 0;

	const n = words[0].length,
		m = words.length;
	if (str.length !== m * n) return false;

	for (let i = 0; i < m; i++) {
		let word = str.slice(i * n, (i + 1) * n);
		if (need[word]) {
			obj[word] = (obj[word] || 0) + 1;
			if (obj[word] == need[word]) {
				valid += 1;
			}
		}
	}

	return valid == Object.keys(need).length;
};
```

## ç›¸å…³é¢˜ç›®

| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 76 | [æœ€å°è¦†ç›–å­ä¸²](https://leetcode.com/problems/minimum-window-substring) | [[âœ“]](https://2xiao.github.io/leetcode-js/leetcode/problem/0076) |  [`å“ˆå¸Œè¡¨`](/leetcode/outline/tag/hash-table.md) [`å­—ç¬¦ä¸²`](/leetcode/outline/tag/string.md) [`æ»‘åŠ¨çª—å£`](/leetcode/outline/tag/sliding-window.md) | <font color=#ff334b>Hard</font> |

<style>
.blue {
    background-color: #096dd9;
    padding: 0.25rem 0.5rem;
    margin: 0;
    font-size: 0.85em;
    border-radius: 3px;
    color: white;
    font-weight: 500;
}
table th:first-of-type { width: 10%; }
table th:nth-of-type(2) { width: 35%; }
table th:nth-of-type(3) { width: 10%; }
table th:nth-of-type(4) { width: 35%; }
table th:nth-of-type(5) { width: 10%; }
</style>
