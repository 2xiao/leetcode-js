# [380. Insert Delete GetRandom O(1)](https://leetcode.com/problems/insert-delete-getrandom-o1/)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/leetcode/outline/tag/design.md) [`æ•°ç»„`](/leetcode/outline/tag/array.md) [`å“ˆå¸Œè¡¨`](/leetcode/outline/tag/hash-table.md) [`æ•°å­¦`](/leetcode/outline/tag/mathematics.md) [`éšæœºåŒ–`](/leetcode/outline/tag/randomized-algorithms.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/insert-delete-getrandom-o1/)

## é¢˜ç›®

Implement the `RandomizedSet` class:

- `RandomizedSet()` Initializes the `RandomizedSet` object.
- `bool insert(int val)` Inserts an item `val` into the set if not present. Returns `true` if the item was not present, `false` otherwise.
- `bool remove(int val)` Removes an item `val` from the set if present. Returns `true` if the item was present, `false` otherwise.
- `int getRandom()` Returns a random element from the current set of elements (it's guaranteed that at least one element exists when this method is called). Each element must have the **same probability** of being returned.

You must implement the functions of the class such that each function works in
**average** `O(1)` time complexity.

**Example 1:**

> **Input**
>
> ["RandomizedSet", "insert", "remove", "insert", "getRandom", "remove", "insert", "getRandom"]
>
> [[], [1], [2], [2], [], [1], [2], []]
>
> **Output**
>
> [null, true, false, true, 2, true, false, 2]
>
> **Explanation**
>
> RandomizedSet randomizedSet = new RandomizedSet();
>
> randomizedSet.insert(1); // Inserts 1 to the set. Returns true as 1 was inserted successfully.
>
> randomizedSet.remove(2); // Returns false as 2 does not exist in the set.
>
> randomizedSet.insert(2); // Inserts 2 to the set, returns true. Set now contains [1,2].
>
> randomizedSet.getRandom(); // getRandom() should return either 1 or 2 randomly.
>
> randomizedSet.remove(1); // Removes 1 from the set, returns true. Set now contains [2].
>
> randomizedSet.insert(2); // 2 was already in the set, so return false.
>
> randomizedSet.getRandom(); // Since 2 is the only number in the set, getRandom() will always return 2.

**Constraints:**

- `-231 <= val <= 231 - 1`
- At most ` 2 * ``105 ` calls will be made to `insert`, `remove`, and `getRandom`.
- There will be **at least one** element in the data structure when `getRandom` is called.

## é¢˜ç›®å¤§æ„

å®ç° `RandomizedSet` ç±»ï¼š

- `RandomizedSet()` åˆå§‹åŒ– `RandomizedSet` å¯¹è±¡
- `bool insert(int val)` å½“å…ƒç´  `val` ä¸å­˜åœ¨æ—¶ï¼Œå‘é›†åˆä¸­æ’å…¥è¯¥é¡¹ï¼Œå¹¶è¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
- `bool remove(int val)` å½“å…ƒç´  `val` å­˜åœ¨æ—¶ï¼Œä»é›†åˆä¸­ç§»é™¤è¯¥é¡¹ï¼Œå¹¶è¿”å› `true` ï¼›å¦åˆ™ï¼Œè¿”å› `false` ã€‚
- `int getRandom()` éšæœºè¿”å›ç°æœ‰é›†åˆä¸­çš„ä¸€é¡¹ï¼ˆæµ‹è¯•ç”¨ä¾‹ä¿è¯è°ƒç”¨æ­¤æ–¹æ³•æ—¶é›†åˆä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ¯ä¸ªå…ƒç´ åº”è¯¥æœ‰ **ç›¸åŒçš„æ¦‚ç‡** è¢«è¿”å›ã€‚

ä½ å¿…é¡»å®ç°ç±»çš„æ‰€æœ‰å‡½æ•°ï¼Œå¹¶æ»¡è¶³æ¯ä¸ªå‡½æ•°çš„ **å¹³å‡** æ—¶é—´å¤æ‚åº¦ä¸º `O(1)` ã€‚

## è§£é¢˜æ€è·¯

æœ¬é¢˜çš„éš¾ç‚¹åœ¨äºä¸¤ç‚¹ï¼š

1. æ’å…¥ï¼Œåˆ é™¤ï¼Œè·å–éšæœºå…ƒç´ è¿™ä¸‰ä¸ªæ“ä½œçš„æ—¶é—´å¤æ‚åº¦å¿…é¡»éƒ½æ˜¯ `O(1)`ã€‚
2. `getRandom` æ–¹æ³•è¿”å›çš„å…ƒç´ å¿…é¡»ç­‰æ¦‚ç‡è¿”å›éšæœºå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé›†åˆé‡Œé¢æœ‰ `n` ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ è¢«è¿”å›çš„æ¦‚ç‡å¿…é¡»æ˜¯ `1/n`ã€‚

`HashSet` æ’å…¥ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾è¿™å‡ ç§æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)` ï¼Œä½†æ˜¯ç”±äº`HashSet`å­˜å‚¨æ•°æ®æ—¶ï¼Œæ˜¯ç”±å“ˆå¸Œå‡½æ•°åˆ†æ•£åœ°å­˜åˆ°æ•´ä¸ªæ•°ç»„é‡Œé¢çš„ï¼Œé‡åˆ°å“ˆå¸Œå†²çªè¿˜ä¼šæœ‰æ‹‰é“¾æ³•ç­‰æœºåˆ¶ï¼Œæ‰€ä»¥åšä¸åˆ° `O(1)` æ—¶é—´ã€Œç­‰æ¦‚ç‡ã€éšæœºè·å–å…ƒç´ ã€‚

å¦‚æœæƒ³ã€Œç­‰æ¦‚ç‡ã€ä¸”ã€Œåœ¨ `O(1)` çš„æ—¶é—´ã€å–å‡ºå…ƒç´ ï¼Œä¸€å®šè¦æ»¡è¶³ï¼šåº•å±‚ç”¨æ•°ç»„å®ç°ï¼Œä¸”æ•°ç»„å¿…é¡»æ˜¯ç´§å‡‘çš„ã€‚å¯ä»¥ç›´æ¥ç”Ÿæˆéšæœºæ•°ä½œä¸ºç´¢å¼•ï¼Œä»æ•°ç»„ä¸­å–å‡ºè¯¥éšæœºç´¢å¼•å¯¹åº”çš„å…ƒç´ ï¼Œä½œä¸ºéšæœºå…ƒç´ ã€‚

ä½†å¦‚æœç”¨æ•°ç»„å­˜å‚¨å…ƒç´ çš„è¯ï¼Œæ’å…¥ï¼Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ€ä¹ˆåšåˆ° `O(1)` å‘¢ï¼Ÿ

ç”±äºå¯¹æ•°ç»„å°¾éƒ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶ä¸ä¼šæ¶‰åŠæ•°æ®æ¬ç§»ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ `O(1)`ï¼Œæ‰€ä»¥ï¼š

- æ’å…¥æ•°æ®æ—¶ç›´æ¥æ’å…¥åˆ°æ•°ç»„å°¾ç«¯å³å¯ï¼›
- åˆ é™¤æ•°ç»„ä¸­çš„æŸä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå…ˆæŠŠè¿™ä¸ªå…ƒç´ äº¤æ¢åˆ°æ•°ç»„çš„å°¾éƒ¨ï¼Œç„¶åå† `pop` æ‰ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ æ—¶é€šè¿‡ç´¢å¼•è¿›è¡Œäº¤æ¢ï¼Œç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨ `indexMap` æ¥è®°å½•æ¯ä¸ªå…ƒç´ å€¼å¯¹åº”çš„ç´¢å¼•ã€‚

## ä»£ç 

```javascript
class RandomizedSet {
  constructor() {
    this.nums = [];
    this.map = new Map();
  }

  // @param {number} val
  // @return {boolean}
  insert(val) {
    if (this.map.has(val)) return false;
    this.nums.push(val);
    this.map.set(val, this.nums.length - 1);
    return true;
  }

  // @param {number} val
  // @return {boolean}
  remove(val) {
    if (!this.map.has(val)) return false;
    const index = this.map.get(val);
    const last_val = this.nums[this.nums.length - 1];
    this.nums[index] = last_val;
    this.nums.pop();
    this.map.set(last_val, index);
    this.map.delete(val);
    return true;
  }

  // @return {number}
  getRandom() {
    return this.nums[Math.floor(Math.random() * this.nums.length)];
  }
}
```

## ç›¸å…³é¢˜ç›®

:::: md-demo ç›¸å…³é¢˜ç›®

- [381. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´  - å…è®¸é‡å¤](https://leetcode.com/problems/insert-delete-getrandom-o1-duplicates-allowed)

::::
