# [138. éšæœºé“¾è¡¨çš„å¤åˆ¶](https://leetcode.com/problems/copy-list-with-random-pointer)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`å“ˆå¸Œè¡¨`](/leetcode/outline/tag/hash-table.md) [`é“¾è¡¨`](/leetcode/outline/tag/linked-list.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/copy-list-with-random-pointer/)

## é¢˜ç›®

A linked list of length `n` is given such that each node contains an
additional random pointer, which could point to any node in the list, or
`null`.

Construct a [**deep
copy**](https://en.wikipedia.org/wiki/Object_copying#Deep_copy) of the list.
The deep copy should consist of exactly `n` **brand new** nodes, where each
new node has its value set to the value of its corresponding original node.
Both the `next` and `random` pointer of the new nodes should point to new
nodes in the copied list such that the pointers in the original list and
copied list represent the same list state. **None of the pointers in the new
list should point to nodes in the original list**.

For example, if there are two nodes `X` and `Y` in the original list, where
`X.random --> Y`, then for the corresponding two nodes `x` and `y` in the
copied list, `x.random --> y`.

Return _the head of the copied linked list_.

The linked list is represented in the input/output as a list of `n` nodes.
Each node is represented as a pair of `[val, random_index]` where:

- `val`: an integer representing `Node.val`
- `random_index`: the index of the node (range from `0` to `n-1`) that the `random` pointer points to, or `null` if it does not point to any node.

Your code will **only** be given the `head` of the original linked list.

**Example 1:**

![](https://assets.leetcode.com/uploads/2019/12/18/e1.png)

> Input: head = [[7,null],[13,0],[11,4],[10,2],[1,0]]
>
> Output: [[7,null],[13,0],[11,4],[10,2],[1,0]]

**Example 2:**

![](https://assets.leetcode.com/uploads/2019/12/18/e2.png)

> Input: head = [[1,1],[2,1]]
>
> Output: [[1,1],[2,1]]

**Example 3:**

**![](https://assets.leetcode.com/uploads/2019/12/18/e3.png)**

> Input: head = [[3,null],[3,0],[3,null]]
>
> Output: [[3,null],[3,0],[3,null]]

**Constraints:**

- `0 <= n <= 1000`
- `-10^4 <= Node.val <= 10^4`
- `Node.random` is `null` or is pointing to some node in the linked list.

## é¢˜ç›®å¤§æ„

ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º `n` çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ `random` ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚

æ„é€ è¿™ä¸ªé“¾è¡¨çš„ æ·±æ‹·è´ã€‚ æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± `n` ä¸ª å…¨æ–° èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ `next` æŒ‡é’ˆå’Œ `random` æŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœåŸé“¾è¡¨ä¸­æœ‰ `X` å’Œ `Y` ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ `X.random --> Y` ã€‚é‚£ä¹ˆåœ¨å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹ `x` å’Œ `y` ï¼ŒåŒæ ·æœ‰ `x.random --> y` ã€‚

è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚

ç”¨ä¸€ä¸ªç”± `n` ä¸ªèŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ¥è¡¨ç¤ºè¾“å…¥/è¾“å‡ºä¸­çš„é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ª `[val, random_index]` è¡¨ç¤ºï¼š

- `val`ï¼šä¸€ä¸ªè¡¨ç¤º `Node.val` çš„æ•´æ•°ã€‚
- `random_index`ï¼šéšæœºæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ç´¢å¼•ï¼ˆèŒƒå›´ä» `0` åˆ° `n-1`ï¼‰ï¼›å¦‚æœä¸æŒ‡å‘ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸º `null` ã€‚

ä½ çš„ä»£ç  **åª** æ¥å—åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹ `head` ä½œä¸ºä¼ å…¥å‚æ•°ã€‚

## è§£é¢˜æ€è·¯

å¯¹äºæ•°æ®ç»“æ„å¤åˆ¶ï¼Œä¸ç®¡æ€ä¹ˆå˜ï¼Œä½ å°±è®°ä½æœ€ç®€å•çš„æ–¹å¼ï¼š **ä¸€ä¸ªå“ˆå¸Œè¡¨ + ä¸¤æ¬¡éå†** ã€‚

ç¬¬ä¸€æ¬¡éå†ä¸“é—¨å…‹éš†èŠ‚ç‚¹ï¼Œå€ŸåŠ©å“ˆå¸Œè¡¨æŠŠåŸå§‹èŠ‚ç‚¹å’Œå…‹éš†èŠ‚ç‚¹çš„æ˜ å°„å­˜å‚¨èµ·æ¥ï¼›ç¬¬äºŒæ¬¡ä¸“é—¨ç»„è£…èŠ‚ç‚¹ï¼Œç…§ç€åŸæ•°æ®ç»“æ„çš„æ ·å­ï¼ŒæŠŠå…‹éš†èŠ‚ç‚¹çš„æŒ‡é’ˆç»„è£…èµ·æ¥ã€‚

é¢˜ç›®å¦‚æœè®©ä½ å…‹éš†å¸¦éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘ï¼Œæˆ–è€…å…‹éš†å›¾ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡æ˜¯éå†çš„æ–¹å¼ä» for å¾ªç¯è¿­ä»£éå†å˜æˆ traverse é€’å½’å‡½æ•°éå†ç½¢äº†ã€‚

å¦å¤–ï¼Œè¿™é“é¢˜å’Œ [ç¬¬ 133 é¢˜ å…‹éš†å›¾](./0133) æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œå› ä¸ºé“¾è¡¨åŠ ä¸€ä¸ªéšæœºæŒ‡é’ˆæœ¬è´¨ä¸Šå°±å˜æˆäº†ä¸€å¹…å›¾ã€‚

## ä»£ç 

```javascript
/**
 * // Definition for a Node.
 * function Node(val, next, random) {
 *    this.val = val;
 *    this.next = next;
 *    this.random = random;
 * };
 */

/**
 * @param {Node} head
 * @return {Node}
 */
var copyRandomList = function (head) {
	let clone = new Map();
	for (let p = head; p !== null; p = p.next) {
		if (!clone.has(p)) {
			clone.set(p, new Node(p.val));
		}
	}
	for (let p = head; p !== null; p = p.next) {
		if (p.next !== null) {
			clone.get(p).next = clone.get(p.next);
		}
		if (p.random !== null) {
			clone.get(p).random = clone.get(p.random);
		}
	}
	return clone.get(head);
};
```

## ç›¸å…³é¢˜ç›®

| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 133 | [å…‹éš†å›¾](https://leetcode.com/problems/clone-graph) | [[âœ“]](https://2xiao.github.io/leetcode-js/leetcode/problem/0133) |  [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/breadth-first-search.md) [`å›¾`](/leetcode/outline/tag/graph.md) `1+` | <font color=#ffb800>Medium</font> |
| 1485 | [å…‹éš†å«éšæœºæŒ‡é’ˆçš„äºŒå‰æ ‘](https://leetcode.com/problems/clone-binary-tree-with-random-pointer) |  |  [`æ ‘`](/leetcode/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/breadth-first-search.md) `2+` | <font color=#ffb800>Medium</font> |
| 1490 | [å…‹éš† N å‰æ ‘](https://leetcode.com/problems/clone-n-ary-tree) |  |  [`æ ‘`](/leetcode/outline/tag/tree.md) [`æ·±åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/depth-first-search.md) [`å¹¿åº¦ä¼˜å…ˆæœç´¢`](/leetcode/outline/tag/breadth-first-search.md) `1+` | <font color=#ffb800>Medium</font> |

<style>
.blue {
    background-color: #096dd9;
    padding: 0.25rem 0.5rem;
    margin: 0;
    font-size: 0.85em;
    border-radius: 3px;
    color: white;
    font-weight: 500;
}
table th:first-of-type { width: 10%; }
table th:nth-of-type(2) { width: 35%; }
table th:nth-of-type(3) { width: 10%; }
table th:nth-of-type(4) { width: 35%; }
table th:nth-of-type(5) { width: 10%; }
</style>
