# [307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode.com/problems/range-sum-query-mutable)

ğŸŸ  <font color=#ffb800>Medium</font>&emsp; ğŸ”–&ensp; [`è®¾è®¡`](/leetcode/outline/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/leetcode/outline/tag/fenwick-tree.md) [`çº¿æ®µæ ‘`](/leetcode/outline/tag/segment-tree.md) [`æ•°ç»„`](/leetcode/outline/tag/array.md)&emsp; ğŸ”—&ensp;[`LeetCode`](https://leetcode.com/problems/range-sum-query-mutable/)

## é¢˜ç›®

Given an integer array `nums`, handle multiple queries of the following types:

1. **Update** the value of an element in `nums`.
2. Calculate the **sum** of the elements of `nums` between indices `left` and `right` **inclusive** where `left <= right`.

Implement the `NumArray` class:

- `NumArray(int[] nums)` Initializes the object with the integer array `nums`.
- `void update(int index, int val)` **Updates** the value of `nums[index]` to be `val`.
- `int sumRange(int left, int right)` Returns the **sum** of the elements of `nums` between indices `left` and `right` **inclusive** (i.e. `nums[left] + nums[left + 1] + ... + nums[right]`).

**Example 1:**

> **Input**
>
> ["NumArray", "sumRange", "update", "sumRange"]
>
> [[[1, 3, 5]], [0, 2], [1, 2], [0, 2]]
>
> **Output**
>
> [null, 9, null, 8]
>
> **Explanation**
>
> NumArray numArray = new NumArray([1, 3, 5]);
>
> numArray.sumRange(0, 2); // return 1 + 3 + 5 = 9
>
> numArray.update(1, 2); // nums = [1, 2, 5]
>
> numArray.sumRange(0, 2); // return 1 + 2 + 5 = 8

**Constraints:**

- `1 <= nums.length <= 3 * 10^4`
- `-100 <= nums[i] <= 100`
- `0 <= index < nums.length`
- `-100 <= val <= 100`
- `0 <= left <= right < nums.length`
- At most `3 * 10^4` calls will be made to `update` and `sumRange`.

## é¢˜ç›®å¤§æ„

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums`ï¼Œè¯·ä½ å®Œæˆä¸¤ç±»æŸ¥è¯¢ï¼š

1. **æ›´æ–°** æ•°ç»„ `nums` ä¸‹æ ‡å¯¹åº”çš„å€¼
2. è¿”å›æ•°ç»„ `nums` ä¸­ç´¢å¼• `left` å’Œ `right` ï¼ˆåŒ…å« `left` å’Œ `right`ï¼‰ä¹‹é—´çš„ `nums` å…ƒç´ çš„ **å’Œ** ï¼Œå…¶ä¸­ `left <= right`

å®ç° `NumArray` ç±»ï¼š

- `NumArray(int[] nums)` ä½¿ç”¨æ•°ç»„ `nums` åˆå§‹åŒ–å¯¹è±¡
- `void update(int index, int val)` å°† `nums[index]` çš„å€¼ **æ›´æ–°** ä¸º `val`
- `int sumRange(int i, int j)` è¿”å›æ•°ç»„ `nums` ä¸­ç´¢å¼• `left` å’Œ `right` ä¹‹é—´çš„å…ƒç´ çš„ æ€»å’Œ ï¼ŒåŒ…å« `left` å’Œ `right` ä¸¤ç‚¹ï¼ˆä¹Ÿå°±æ˜¯ `nums[left] + nums[left + 1] + ... + nums[right]` ï¼‰

## è§£é¢˜æ€è·¯

è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡çº¿æ®µæ ‘æ¥è§£å†³ï¼š

1. **åˆå§‹åŒ–ï¼š** åœ¨ `NumArray` ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œé¦–å…ˆå°†è¾“å…¥çš„æ•°ç»„ `nums` å­˜å‚¨èµ·æ¥ï¼Œå¹¶æ„å»ºä¸€ä¸ªçº¿æ®µæ ‘ï¼Œè¡¨ç¤ºæ•´ä¸ªæ•°ç»„çš„å’Œã€‚æ¯ä¸ªçº¿æ®µæ ‘èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªåŒºé—´çš„èµ·å§‹ä½ç½®ã€ç»“æŸä½ç½®å’Œè¯¥åŒºé—´çš„å’Œã€‚

2. **æ›´æ–°æ“ä½œï¼š** å½“è°ƒç”¨ `update` æ–¹æ³•æ—¶ï¼Œæ ¹æ®ç»™å®šçš„ç´¢å¼•å’Œæ–°çš„å€¼ï¼Œæ›´æ–°æ•°ç»„ `nums` å¯¹åº”ä½ç½®çš„å€¼ï¼Œå¹¶åœ¨çº¿æ®µæ ‘ä¸­æ›´æ–°å¯¹åº”çš„èŠ‚ç‚¹çš„å€¼ã€‚è¿™ä¸ªæ›´æ–°è¿‡ç¨‹æ˜¯é€šè¿‡é€’å½’åœ°å‘ä¸‹æ›´æ–°çº¿æ®µæ ‘èŠ‚ç‚¹å®ç°çš„ã€‚

3. **åŒºé—´å’ŒæŸ¥è¯¢ï¼š** å½“è°ƒç”¨ `sumRange` æ–¹æ³•æ—¶ï¼Œéœ€è¦æŸ¥è¯¢æ•°ç»„ä¸­æŒ‡å®šåŒºé—´ `[i, j]` çš„å’Œã€‚åœ¨çº¿æ®µæ ‘ä¸­ï¼Œå¯ä»¥é€šè¿‡é€’å½’åœ°æŸ¥è¯¢å·¦å³å­æ ‘æ¥è·å¾—åŒºé—´ `[i, j]` çš„å’Œï¼š
   - å¦‚æœå½“å‰èŠ‚ç‚¹çš„åŒºé—´å®Œå…¨åŒ…å«åœ¨ `[i, j]` ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥èŠ‚ç‚¹çš„å’Œã€‚
   - å¦åˆ™ï¼Œæ ¹æ®å½“å‰èŠ‚ç‚¹çš„ä¸­ç‚¹å°†æŸ¥è¯¢åŒºé—´ `[i, j]` åˆ†ä¸ºå·¦å³ä¸¤éƒ¨åˆ†ï¼Œé€’å½’åœ°æŸ¥è¯¢å·¦å³å­æ ‘ï¼Œå¹¶å°†ä¸¤éƒ¨åˆ†çš„å’Œç›¸åŠ ã€‚

## ä»£ç 

```javascript
class NumArray {
  // @param {number[]} nums
  constructor(nums) {
    this.nums = nums;
    this.segmentTree = this.buildSegmentTree(nums, 0, nums.length - 1);
  }
  // @param {number[]} nums
  // @param {number} start
  // @param {number} end
  buildSegmentTree(nums, start, end) {
    if (start == end) {
      return { start, end, left: null, right: null, sum: nums[start] };
    }
    const mid = Math.floor((start + end) / 2);
    const left = this.buildSegmentTree(nums, start, mid);
    const right = this.buildSegmentTree(nums, mid + 1, end);
    const sum = left.sum + right.sum;
    return { start, end, left, right, sum };
  }

  // @param {number} index
  // @param {number} val
  // @return {void}
  update(index, val) {
    this.updateSegmentTree(this.segmentTree, index, val);
  }

  updateSegmentTree(root, index, val) {
    if (root.start == root.end) {
      root.sum = val;
      return;
    }
    const mid = Math.floor((root.start + root.end) / 2);
    if (index <= mid) {
      this.updateSegmentTree(root.left, index, val);
    } else {
      this.updateSegmentTree(root.right, index, val);
    }
    root.sum =
      (root.left ? root.left.sum : 0) + (root.right ? root.right.sum : 0);
  }

  // @param {number} left
  // @param {number} right
  // @return {number}
  sumRange(left, right) {
    return this.querySegmentTree(this.segmentTree, left, right);
  }

  querySegmentTree(root, start, end) {
    if (root.start > end || root.end < start) return 0;
    if (root.start >= start && root.end <= end) return root.sum;

    const mid = Math.floor((root.start + root.end) / 2);
    const leftSum = this.querySegmentTree(root.left, start, Math.min(mid, end));
    const rightSum = this.querySegmentTree(
      root.right,
      Math.max(mid + 1, start),
      end
    );
    return leftSum + rightSum;
  }
}
```

## ç›¸å…³é¢˜ç›®

<!-- prettier-ignore -->
| é¢˜å· | æ ‡é¢˜ | é¢˜è§£ | æ ‡ç­¾ | éš¾åº¦ |
| :------: | :------ | :------: | :------ | :------ |
| 303 | [åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„ä¸å¯å˜](https://leetcode.com/problems/range-sum-query-immutable) | [[âœ“]](https://2xiao.github.io/leetcode-js/leetcode/problem/0303) |  [`è®¾è®¡`](/leetcode/outline/tag/design.md) [`æ•°ç»„`](/leetcode/outline/tag/array.md) [`å‰ç¼€å’Œ`](/leetcode/outline/tag/prefix-sum.md) | <font color=#15bd66>Easy</font> |
| 308 | [äºŒç»´åŒºåŸŸå’Œæ£€ç´¢ - çŸ©é˜µå¯ä¿®æ”¹](https://leetcode.com/problems/range-sum-query-2d-mutable) |  |  [`è®¾è®¡`](/leetcode/outline/tag/design.md) [`æ ‘çŠ¶æ•°ç»„`](/leetcode/outline/tag/binary-indexed-tree.md) [`çº¿æ®µæ ‘`](/leetcode/outline/tag/segment-tree.md) `2+` | <font color=#ff334b>Hard</font> |
| 2381 | [å­—æ¯ç§»ä½ II](https://leetcode.com/problems/shifting-letters-ii) |  |  [`æ•°ç»„`](/leetcode/outline/tag/array.md) [`å­—ç¬¦ä¸²`](/leetcode/outline/tag/string.md) [`å‰ç¼€å’Œ`](/leetcode/outline/tag/prefix-sum.md) | <font color=#ffb800>Medium</font> |

<style>
.blue {
    background-color: #096dd9;
    padding: 0.25rem 0.5rem;
    margin: 0;
    font-size: 0.85em;
    border-radius: 3px;
    color: white;
    font-weight: 500;
}
table th:first-of-type { width: 10%; }
table th:nth-of-type(2) { width: 35%; }
table th:nth-of-type(3) { width: 10%; }
table th:nth-of-type(4) { width: 35%; }
table th:nth-of-type(5) { width: 10%; }
</style>
