# [40. çŸ©é˜µä¸­æœ€å¤§çš„çŸ©å½¢](https://2xiao.github.io/leetcode-js/offer2/jz_offer_II_040.html)

ğŸ”´ <font color=#ff334b>Hard</font>&emsp; ğŸ”–&ensp; [`æ ˆ`](/tag/stack.md) [`æ•°ç»„`](/tag/array.md) [`åŠ¨æ€è§„åˆ’`](/tag/dynamic-programming.md) [`çŸ©é˜µ`](/tag/matrix.md) [`å•è°ƒæ ˆ`](/tag/monotonic-stack.md)&emsp; ğŸ”—&ensp;[`åŠ›æ‰£`](https://leetcode.cn/problems/PLYXKQ)

## é¢˜ç›®

ç»™å®šä¸€ä¸ªç”± `0` å’Œ `1` ç»„æˆçš„çŸ©é˜µ `matrix` ï¼Œæ‰¾å‡ºåªåŒ…å« `1` çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚

**æ³¨æ„ï¼š** æ­¤é¢˜ `matrix` è¾“å…¥æ ¼å¼ä¸ºä¸€ç»´ `01` å­—ç¬¦ä¸²æ•°ç»„ã€‚

**ç¤ºä¾‹ 1ï¼š**

![](https://assets.leetcode.com/uploads/2020/09/14/maximal.jpg)

> **è¾“å…¥ï¼š** matrix = ["10100","10111","11111","10010"]
>
> **è¾“å‡ºï¼š** 6
>
> **è§£é‡Šï¼š** æœ€å¤§çŸ©å½¢å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚

**ç¤ºä¾‹ 2ï¼š**

> **è¾“å…¥ï¼š** matrix = []
>
> **è¾“å‡ºï¼š** 0

**ç¤ºä¾‹ 3ï¼š**

> **è¾“å…¥ï¼š** matrix = ["0"]
>
> **è¾“å‡ºï¼š** 0

**ç¤ºä¾‹ 4ï¼š**

> **è¾“å…¥ï¼š** matrix = ["1"]
>
> **è¾“å‡ºï¼š** 1

**ç¤ºä¾‹ 5ï¼š**

> **è¾“å…¥ï¼š** matrix = ["00"]
>
> **è¾“å‡ºï¼š** 0

**æç¤ºï¼š**

- `rows == matrix.length`
- `cols == matrix[0].length`
- `0 <= row, cols <= 200`
- `matrix[i][j]` ä¸º `'0'` æˆ– `'1'`

::: warning
æœ¬é¢˜ä¸ LeetCode [ç¬¬ 85 é¢˜](../problem/0085.md) ç›¸åŒï¼ˆè¾“å…¥å‚æ•°æ ¼å¼ä¸åŒï¼‰ã€‚
:::

## è§£é¢˜æ€è·¯

- æ£€æŸ¥çŸ©é˜µæ˜¯å¦ä¸ºç©ºã€‚
- åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ `heights`ï¼Œç”¨äºå­˜å‚¨å½“å‰è¡Œçš„é«˜åº¦ã€‚
- å°†æ¯ä¸€è¡Œè§†ä¸ºåŸºäºä¸Šæ–¹è¿ç»­ `1` çš„é«˜åº¦ã€‚å¦‚æœå½“å‰å…ƒç´ æ˜¯ `1`ï¼Œåˆ™å…¶é«˜åº¦ç­‰äºå½“å‰è¡Œçš„ `1` çš„æ•°é‡ï¼›å¦‚æœæ˜¯ `0`ï¼Œåˆ™é«˜åº¦ä¸º `0`ã€‚

  - ä¾‹å¦‚ï¼Œç»™å®šçŸ©é˜µï¼š
    ```
    [
      ["1", "0", "1", "0", "0"],
      ["1", "0", "1", "1", "1"],
      ["1", "1", "1", "1", "1"],
      ["1", "0", "0", "1", "0"]
    ]
    ```
    å¯¹åº”çš„é«˜åº¦çŸ©é˜µä¸ºï¼š
    ```
    [
      [1, 0, 1, 0, 0],
      [2, 0, 2, 1, 1],
      [3, 1, 3, 2, 2],
      [4, 0, 0, 3, 0]
    ]
    ```

- éå†æ¯ä¸€è¡Œï¼Œæ›´æ–° `heights` æ•°ç»„ã€‚
- å¯¹æ¯ä¸€è¡Œè°ƒç”¨ `largestRectangleArea` å‡½æ•°è®¡ç®—æœ€å¤§çŸ©å½¢é¢ç§¯ã€‚

  - å¯¹äºæ¯ä¸€è¡Œçš„é«˜åº¦æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨å•è°ƒæ ˆæ¥è®¡ç®—æœ€å¤§çŸ©å½¢é¢ç§¯ã€‚
  - ä½¿ç”¨æ ˆæ¥ç»´æŠ¤é«˜åº¦çš„ç´¢å¼•ï¼Œç¡®ä¿æ ˆä¸­çš„é«˜åº¦æ˜¯å•è°ƒé€’å¢çš„ã€‚éå†é«˜åº¦æ•°ç»„ï¼Œå¦‚æœå½“å‰é«˜åº¦å°äºæ ˆé¡¶å…ƒç´ ï¼Œè®¡ç®—ä»¥æ ˆé¡¶é«˜åº¦ä¸ºæœ€å°é«˜åº¦çš„çŸ©å½¢é¢ç§¯ï¼Œå¹¶æ›´æ–°æœ€å¤§é¢ç§¯ã€‚
  - é€šè¿‡éå†é«˜åº¦æ•°ç»„ï¼Œè®¡ç®—ä»¥æ¯ä¸ªé«˜åº¦ä¸ºæœ€å°é«˜åº¦çš„çŸ©å½¢é¢ç§¯ã€‚

#### å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**ï¼š`O(m * n)`ï¼Œå…¶ä¸­ `m` æ˜¯çŸ©é˜µçš„è¡Œæ•°ï¼Œ`n` æ˜¯åˆ—æ•°ã€‚æ¯è¡Œçš„æœ€å¤§çŸ©å½¢è®¡ç®—æ˜¯ `O(n)`ã€‚
- **ç©ºé—´å¤æ‚åº¦**ï¼š`O(n)`ï¼Œç”¨äºå­˜å‚¨é«˜åº¦æ•°ç»„å’Œæ ˆã€‚

## ä»£ç 

```javascript
/**
 * @param {character[][]} matrix
 * @return {number}
 */
var maximalRectangle = function (matrix) {
	if (!matrix.length || !matrix[0].length) return 0;

	const heights = new Array(matrix[0].length).fill(0);
	let maxArea = 0;

	for (let i = 0; i < matrix.length; i++) {
		for (let j = 0; j < matrix[0].length; j++) {
			// æ›´æ–°å½“å‰è¡Œçš„é«˜åº¦
			heights[j] = matrix[i][j] === '1' ? heights[j] + 1 : 0;
		}

		maxArea = Math.max(maxArea, largestRectangleArea(heights));
	}

	return maxArea;
};

var largestRectangleArea = function (heights) {
	const stack = [];
	let maxArea = 0;
	heights.push(0); // åœ¨æ•°ç»„æœ«å°¾æ·»åŠ 0ä»¥æ¸…ç©ºæ ˆ

	for (let i = 0; i < heights.length; i++) {
		while (stack.length && heights[i] < heights[stack[stack.length - 1]]) {
			const h = heights[stack.pop()];
			const w = stack.length ? i - stack[stack.length - 1] - 1 : i;
			maxArea = Math.max(maxArea, h * w);
		}
		stack.push(i);
	}

	return maxArea;
};
```
